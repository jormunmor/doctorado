<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>OptaPlanner User Guide</title><link rel="stylesheet" type="text/css" href="css/jbossorg.css"/><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" title="OptaPlanner User Guide"><div class="titlepage"><div><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>OptaPlanner User Guide</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="orgname"><a class="link" href="http://www.optaplanner.org/community/team.html">The OptaPlanner team</a></span></h3></div></div></div><div><p class="releaseinfo">Version 6.2.0.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="chapter"><a href="#plannerIntroduction">1. OptaPlanner introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#whatIsOptaPlanner">1.1. What is OptaPlanner?</a></span></dt><dt><span class="section"><a href="#requirements">1.2. Requirements</a></span></dt><dt><span class="section"><a href="#whatIsAPlanningProblem">1.3. What is a planning problem?</a></span></dt><dd><dl><dt><span class="section"><a href="#aPlanningProblemIsNPCompleteOrNPHard">1.3.1. A planning problem is NP-complete or NP-hard</a></span></dt><dt><span class="section"><a href="#aPlanningProblemHasConstraints">1.3.2. A planning problem has (hard and soft) constraints</a></span></dt><dt><span class="section"><a href="#aPlanningProblemHasAHugeSearchSpace">1.3.3. A planning problem has a huge search space</a></span></dt></dl></dd><dt><span class="section"><a href="#downloadAndRunTheExamples">1.4. Download and run the examples</a></span></dt><dd><dl><dt><span class="section"><a href="#getTheReleaseZipAndRunTheExamples">1.4.1. Get the release zip and run the examples</a></span></dt><dt><span class="section"><a href="#runTheExamplesInAnIDE">1.4.2. Run the examples in an IDE (IntelliJ, Eclipse, NetBeans)</a></span></dt><dt><span class="section"><a href="#useWithMavenGradleEtc">1.4.3. Use OptaPlanner with Maven, Gradle, Ivy, Buildr or ANT</a></span></dt><dt><span class="section"><a href="#buildFromSource">1.4.4. Build OptaPlanner from source</a></span></dt></dl></dd><dt><span class="section"><a href="#governance">1.5. Governance</a></span></dt><dd><dl><dt><span class="section"><a href="#statusOfOptaPlanner">1.5.1. Status of OptaPlanner</a></span></dt><dt><span class="section"><a href="#backwardsCompatibility">1.5.2. Backwards compatibility</a></span></dt><dt><span class="section"><a href="#communityAndSupport">1.5.3. Community and support</a></span></dt><dt><span class="section"><a href="#relationshipWithKie">1.5.4. Relationship with Drools and jBPM</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#quickStart">2. Quick start</a></span></dt><dd><dl><dt><span class="section"><a href="#cloudBalancingTutorial">2.1. Cloud balancing tutorial</a></span></dt><dd><dl><dt><span class="section"><a href="#cloudBalancingProblemDescription">2.1.1. Problem description</a></span></dt><dt><span class="section"><a href="#cloudBalancingProblemSize">2.1.2. Problem size</a></span></dt><dt><span class="section"><a href="#cloudBalancingDomainModelDesign">2.1.3. Domain model design</a></span></dt><dt><span class="section"><a href="#cloudBalancingMainMethod">2.1.4. Main method</a></span></dt><dt><span class="section"><a href="#cloudBalancingSolverConfiguration">2.1.5. Solver configuration</a></span></dt><dt><span class="section"><a href="#cloudBalancingDomainModelImplementation">2.1.6. Domain model implementation</a></span></dt><dt><span class="section"><a href="#cloudBalancingScoreConfiguration">2.1.7. Score configuration</a></span></dt><dt><span class="section"><a href="#cloudBalancingBeyondThisTutorial">2.1.8. Beyond this tutorial</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#useCasesAndExamples">3. Use cases and examples</a></span></dt><dd><dl><dt><span class="section"><a href="#examplesOverview">3.1. Examples overview</a></span></dt><dt><span class="section"><a href="#basicExamples">3.2. Basic examples</a></span></dt><dd><dl><dt><span class="section"><a href="#nQueens">3.2.1. N queens</a></span></dt><dt><span class="section"><a href="#cloudBalancing">3.2.2. Cloud balancing</a></span></dt><dt><span class="section"><a href="#tsp">3.2.3. Traveling salesman (TSP - Traveling salesman problem)</a></span></dt><dt><span class="section"><a href="#dinnerParty">3.2.4. Dinner party</a></span></dt><dt><span class="section"><a href="#tennis">3.2.5. Tennis club scheduling</a></span></dt></dl></dd><dt><span class="section"><a href="#realExamples">3.3. Real examples</a></span></dt><dd><dl><dt><span class="section"><a href="#curriculumCourse">3.3.1. Course timetabling (ITC 2007 track 3 - Curriculum course scheduling)</a></span></dt><dt><span class="section"><a href="#machineReassignment">3.3.2. Machine reassignment (Google ROADEF 2012)</a></span></dt><dt><span class="section"><a href="#vehicleRouting">3.3.3. Vehicle routing</a></span></dt><dt><span class="section"><a href="#projectJobScheduling">3.3.4. Project job scheduling</a></span></dt><dt><span class="section"><a href="#bedAllocation">3.3.5. Hospital bed planning (PAS - Patient admission scheduling)</a></span></dt></dl></dd><dt><span class="section"><a href="#difficultExamples">3.4. Difficult examples</a></span></dt><dd><dl><dt><span class="section"><a href="#examination">3.4.1. Exam timetabling (ITC 2007 track 1 - Examination)</a></span></dt><dt><span class="section"><a href="#employeeRostering">3.4.2. Employee rostering (INRC 2010 - Nurse rostering)</a></span></dt><dt><span class="section"><a href="#travelingTournament">3.4.3. Traveling tournament problem (TTP)</a></span></dt><dt><span class="section"><a href="#cheapTimeScheduling">3.4.4. Cheap time scheduling</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#plannerConfiguration">4. Planner configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#plannerConfigurationOverview">4.1. Overview</a></span></dt><dt><span class="section"><a href="#solverConfiguration">4.2. Solver configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#solverConfigurationByXML">4.2.1. Solver configuration by XML</a></span></dt><dt><span class="section"><a href="#solverConfigurationByJavaAPI">4.2.2. Solver configuration by Java API</a></span></dt></dl></dd><dt><span class="section"><a href="#modelAPlanningProblem">4.3. Model a planning problem</a></span></dt><dd><dl><dt><span class="section"><a href="#isThisClassAProblemFactOrPlanningEntity">4.3.1. Is this class a problem fact or planning entity?</a></span></dt><dt><span class="section"><a href="#problemFact">4.3.2. Problem fact</a></span></dt><dt><span class="section"><a href="#planningEntity">4.3.3. Planning entity</a></span></dt><dt><span class="section"><a href="#planningVariable">4.3.4. Planning variable</a></span></dt><dt><span class="section"><a href="#planningValueAndPlanningValueRange">4.3.5. Planning value and planning value range</a></span></dt><dt><span class="section"><a href="#shadowVariable">4.3.6. Shadow variable</a></span></dt><dt><span class="section"><a href="#planningProblemAndPlanningSolution">4.3.7. Planning problem and planning solution</a></span></dt></dl></dd><dt><span class="section"><a href="#useTheSolver">4.4. Use the <code class="literal">Solver</code></a></span></dt><dd><dl><dt><span class="section"><a href="#theSolverInterface">4.4.1. The <code class="literal">Solver</code> interface</a></span></dt><dt><span class="section"><a href="#solvingAProblem">4.4.2. Solving a problem</a></span></dt><dt><span class="section"><a href="#environmentMode">4.4.3. Environment mode: Are there bugs in my code?</a></span></dt><dt><span class="section"><a href="#logging">4.4.4. Logging level: What is the <code class="literal">Solver</code> doing?</a></span></dt><dt><span class="section"><a href="#randomNumberGenerator">4.4.5. Random number generator</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#scoreCalculation">5. Score calculation</a></span></dt><dd><dl><dt><span class="section"><a href="#scoreTerminology">5.1. Score terminology</a></span></dt><dd><dl><dt><span class="section"><a href="#whatIsAScore">5.1.1. What is a score?</a></span></dt><dt><span class="section"><a href="#scoreConstraintSignum">5.1.2. Score constraint signum (positive or negative)</a></span></dt><dt><span class="section"><a href="#scoreConstraintWeight">5.1.3. Score constraint weight</a></span></dt><dt><span class="section"><a href="#scoreLevel">5.1.4. Score level</a></span></dt><dt><span class="section"><a href="#paretoScoring">5.1.5. Pareto scoring (AKA multi-objective optimization scoring)</a></span></dt><dt><span class="section"><a href="#combiningScoreTechniques">5.1.6. Combining score techniques</a></span></dt><dt><span class="section"><a href="#scoreInterface">5.1.7. <code class="literal">Score</code> interface</a></span></dt><dt><span class="section"><a href="#avoidFloatingPointNumbersInScoreCalculation">5.1.8. Avoid floating point numbers in score calculation</a></span></dt></dl></dd><dt><span class="section"><a href="#scoreDefinition">5.2. Choose a Score definition</a></span></dt><dd><dl><dt><span class="section"><a href="#simpleScore">5.2.1. SimpleScore</a></span></dt><dt><span class="section"><a href="#hardSoftScore">5.2.2. HardSoftScore (recommended)</a></span></dt><dt><span class="section"><a href="#hardMediumSoftScore">5.2.3. HardMediumSoftScore</a></span></dt><dt><span class="section"><a href="#bendableScore">5.2.4. BendableScore</a></span></dt><dt><span class="section"><a href="#customScore">5.2.5. Implementing a custom Score</a></span></dt></dl></dd><dt><span class="section"><a href="#calculateTheScore">5.3. Calculate the <code class="literal">Score</code></a></span></dt><dd><dl><dt><span class="section"><a href="#scoreCalculationTypes">5.3.1. Score calculation types</a></span></dt><dt><span class="section"><a href="#easyJavaScoreCalculation">5.3.2. Easy Java score calculation</a></span></dt><dt><span class="section"><a href="#incrementalJavaScoreCalculation">5.3.3. Incremental Java score calculation</a></span></dt><dt><span class="section"><a href="#droolsScoreCalculation">5.3.4. Drools score calculation</a></span></dt><dt><span class="section"><a href="#initializingScoreTrend">5.3.5. InitializingScoreTrend</a></span></dt><dt><span class="section"><a href="#invalidScoreDetection">5.3.6. Invalid score detection</a></span></dt></dl></dd><dt><span class="section"><a href="#scoreCalculationPerformanceTricks">5.4. Score calculation performance tricks</a></span></dt><dd><dl><dt><span class="section"><a href="#scoreCalculationPerformanceTricksOverview">5.4.1. Overview</a></span></dt><dt><span class="section"><a href="#averageCalculationCountPerSecond">5.4.2. Average calculation count per second</a></span></dt><dt><span class="section"><a href="#incrementalScoreCalculation">5.4.3. Incremental score calculation (with delta's)</a></span></dt><dt><span class="section"><a href="#avoidCallingRemoteServicesDuringScoreCalculation">5.4.4. Avoid calling remote services during score calculation</a></span></dt><dt><span class="section"><a href="#pointlessConstraints">5.4.5. Pointless constraints</a></span></dt><dt><span class="section"><a href="#buildInHardConstraint">5.4.6. Built-in hard constraint</a></span></dt><dt><span class="section"><a href="#otherScoreCalculationPerformanceTricks">5.4.7. Other score calculation performance tricks</a></span></dt><dt><span class="section"><a href="#scoreTrap">5.4.8. Score trap</a></span></dt><dt><span class="section"><a href="#stepLimitBenchmark">5.4.9. stepLimit benchmark</a></span></dt><dt><span class="section"><a href="#fairnessScoreConstraints">5.4.10. Fairness score constraints</a></span></dt></dl></dd><dt><span class="section"><a href="#explainingTheScore">5.5. Explaining the score: using score calculation outside the <code class="literal">Solver</code></a></span></dt></dl></dd><dt><span class="chapter"><a href="#optimizationAlgorithms">6. Optimization algorithms</a></span></dt><dd><dl><dt><span class="section"><a href="#searchSpaceSize">6.1. Search space size in the real world</a></span></dt><dt><span class="section"><a href="#doesPlannerFindTheOptimalSolution">6.2. Does Planner find the optimal solution?</a></span></dt><dt><span class="section"><a href="#architectureOverview">6.3. Architecture overview</a></span></dt><dt><span class="section"><a href="#optimizationAlgorithmsOverview">6.4. Optimization algorithms overview</a></span></dt><dt><span class="section"><a href="#whichOptimizationAlgorithmsShouldIUse">6.5. Which optimization algorithms should I use?</a></span></dt><dt><span class="section"><a href="#solverPhase">6.6. Solver phase</a></span></dt><dt><span class="section"><a href="#scopeOverview">6.7. Scope overview</a></span></dt><dt><span class="section"><a href="#termination">6.8. Termination</a></span></dt><dd><dl><dt><span class="section"><a href="#timeMillisSpentTermination">6.8.1. TimeMillisSpentTermination</a></span></dt><dt><span class="section"><a href="#unimprovedTimeMillisSpentTermination">6.8.2. UnimprovedTimeMillisSpentTermination</a></span></dt><dt><span class="section"><a href="#bestScoreTermination">6.8.3. BestScoreTermination</a></span></dt><dt><span class="section"><a href="#bestScoreFeasibleTermination">6.8.4. BestScoreFeasibleTermination</a></span></dt><dt><span class="section"><a href="#stepCountTermination">6.8.5. StepCountTermination</a></span></dt><dt><span class="section"><a href="#unimprovedStepCountTermination">6.8.6. UnimprovedStepCountTermination</a></span></dt><dt><span class="section"><a href="#combiningMultipleTerminations">6.8.7. Combining multiple Terminations</a></span></dt><dt><span class="section"><a href="#asynchronousTermination">6.8.8. Asynchronous termination from another thread</a></span></dt></dl></dd><dt><span class="section"><a href="#SolverEventListener">6.9. SolverEventListener</a></span></dt><dt><span class="section"><a href="#customSolverPhase">6.10. Custom solver phase</a></span></dt></dl></dd><dt><span class="chapter"><a href="#moveAndNeighborhoodSelection">7. <code class="literal">Move</code> and neighborhood selection</a></span></dt><dd><dl><dt><span class="section"><a href="#moveAndNeighborhoodSelectionIntroduction">7.1. <code class="literal">Move</code> and neighborhood introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#whatIsAMove">7.1.1. What is a <code class="literal">Move</code>?</a></span></dt><dt><span class="section"><a href="#whatIsAMoveSelector">7.1.2. What is a <code class="literal">MoveSelector</code>?</a></span></dt><dt><span class="section"><a href="#subselectingOfEntitiesValuesAndOtherMoves">7.1.3. Subselecting of entities, values and other moves</a></span></dt></dl></dd><dt><span class="section"><a href="#genericMoveSelectors">7.2. Generic MoveSelectors</a></span></dt><dd><dl><dt><span class="section"><a href="#changeMoveSelector">7.2.1. <code class="literal">changeMoveSelector</code></a></span></dt><dt><span class="section"><a href="#swapMoveSelector">7.2.2. swapMoveSelector</a></span></dt><dt><span class="section"><a href="#pillarChangeMoveSelector">7.2.3. pillarChangeMoveSelector</a></span></dt><dt><span class="section"><a href="#pillarSwapMoveSelector">7.2.4. pillarSwapMoveSelector</a></span></dt><dt><span class="section"><a href="#tailChainSwapMoveSelector">7.2.5. tailChainSwapMoveSelector or 2-opt (chained variables only)</a></span></dt><dt><span class="section"><a href="#subChainChangeMoveSelector">7.2.6. subChainChangeMoveSelector (chained variables only)</a></span></dt><dt><span class="section"><a href="#subChainSwapMoveSelector">7.2.7. subChainSwapMoveSelector (chained variables only)</a></span></dt></dl></dd><dt><span class="section"><a href="#combiningMultipleMoveSelectors">7.3. Combining multiple <code class="literal">MoveSelector</code>s</a></span></dt><dd><dl><dt><span class="section"><a href="#unionMoveSelector">7.3.1. unionMoveSelector</a></span></dt><dt><span class="section"><a href="#cartesianProductMoveSelector">7.3.2. cartesianProductMoveSelector</a></span></dt></dl></dd><dt><span class="section"><a href="#entitySelector">7.4. EntitySelector</a></span></dt><dt><span class="section"><a href="#valueSelector">7.5. ValueSelector</a></span></dt><dt><span class="section"><a href="#generalSelectorFeatures">7.6. General <code class="literal">Selector</code> features</a></span></dt><dd><dl><dt><span class="section"><a href="#cacheType">7.6.1. <code class="literal">CacheType</code>: Create moves ahead of time or Just In Time</a></span></dt><dt><span class="section"><a href="#selectionOrder">7.6.2. SelectionOrder: original, sorted, random, shuffled or probabilistic</a></span></dt><dt><span class="section"><a href="#recommendedCombinationsOfCacheTypeAndSelectionOrder">7.6.3. Recommended combinations of <code class="literal">CacheType</code> and <code class="literal">SelectionOrder</code></a></span></dt><dt><span class="section"><a href="#filteredSelection">7.6.4. Filtered selection</a></span></dt><dt><span class="section"><a href="#sortedSelection">7.6.5. Sorted selection</a></span></dt><dt><span class="section"><a href="#probabilisticSelection">7.6.6. Probabilistic selection</a></span></dt><dt><span class="section"><a href="#limitedSelection">7.6.7. Limited selection</a></span></dt><dt><span class="section"><a href="#mimicSelection">7.6.8. Mimic selection (record/replay)</a></span></dt><dt><span class="section"><a href="#nearbySelection">7.6.9. Nearby selection</a></span></dt></dl></dd><dt><span class="section"><a href="#customMoves">7.7. Custom moves</a></span></dt><dd><dl><dt><span class="section"><a href="#whichMoveTypesMightBeMissing">7.7.1. Which move types might be missing in my implementation?</a></span></dt><dt><span class="section"><a href="#customMovesIntroduction">7.7.2. Custom moves introduction</a></span></dt><dt><span class="section"><a href="#theInterfaceMove">7.7.3. The interface <code class="literal">Move</code></a></span></dt><dt><span class="section"><a href="#moveListFactory">7.7.4. <code class="literal">MoveListFactory</code>: the easy way to generate custom moves</a></span></dt><dt><span class="section"><a href="#moveIteratorFactory">7.7.5. <code class="literal">MoveIteratorFactory</code>: generate custom moves just in time</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#exhaustiveSearch">8. Exhaustive Search</a></span></dt><dd><dl><dt><span class="section"><a href="#exhaustiveSearchOverview">8.1. Overview</a></span></dt><dt><span class="section"><a href="#bruteForce">8.2. Brute Force</a></span></dt><dd><dl><dt><span class="section"><a href="#bruteForceAlgorithm">8.2.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#bruteForceConfiguration">8.2.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#branchAndBound">8.3. Branch And Bound</a></span></dt><dd><dl><dt><span class="section"><a href="#branchAndBoundAlgorithm">8.3.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#branchAndBoundConfiguration">8.3.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#scalabilityOfExhaustiveSearch">8.4. Scalability of Exhaustive Search</a></span></dt></dl></dd><dt><span class="chapter"><a href="#constructionHeuristics">9. Construction heuristics</a></span></dt><dd><dl><dt><span class="section"><a href="#constructionHeuristicsOverview">9.1. Overview</a></span></dt><dt><span class="section"><a href="#firstFit">9.2. First Fit</a></span></dt><dd><dl><dt><span class="section"><a href="#firstFitAlgorithm">9.2.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#firstFitConfiguration">9.2.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#firstFitDecreasing">9.3. First Fit Decreasing</a></span></dt><dd><dl><dt><span class="section"><a href="#firstFitDecreasingAlgorithm">9.3.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#firstFitDecreasingConfiguration">9.3.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#weakestFit">9.4. Weakest Fit</a></span></dt><dd><dl><dt><span class="section"><a href="#weakestFitAlgorithm">9.4.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#weakestFitConfiguration">9.4.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#weakestFitDecreasing">9.5. Weakest Fit Decreasing</a></span></dt><dd><dl><dt><span class="section"><a href="#weakestFitDecreasingAlgorithm">9.5.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#weakestFitDecreasingConfiguration">9.5.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#strongestFit">9.6. Strongest Fit</a></span></dt><dd><dl><dt><span class="section"><a href="#strongestFitAlgorithm">9.6.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#strongestFitConfiguration">9.6.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#strongestFitDecreasing">9.7. Strongest Fit Decreasing</a></span></dt><dd><dl><dt><span class="section"><a href="#strongestFitDecreasingAlgorithm">9.7.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#strongestFitDecreasingConfiguration">9.7.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#allocateEntityFromQueue">9.8. Allocate Entity From Queue</a></span></dt><dd><dl><dt><span class="section"><a href="#allocateEntityFromQueueAlgorithm">9.8.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#allocateEntityFromQueueConfiguration">9.8.2. Configuration</a></span></dt><dt><span class="section"><a href="#allocateEntityFromQueueMultipleVariables">9.8.3. Multiple variables</a></span></dt><dt><span class="section"><a href="#allocateEntityFromQueueMultipleEntityClasses">9.8.4. Multiple entity classes</a></span></dt><dt><span class="section"><a href="#constructionHeuristicsPickEarlyType">9.8.5. Pick early type</a></span></dt></dl></dd><dt><span class="section"><a href="#allocateToValueFromQueue">9.9. Allocate To Value From Queue</a></span></dt><dd><dl><dt><span class="section"><a href="#allocateToValueFromQueueAlgorithm">9.9.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#allocateToValueFromQueueConfiguration">9.9.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#cheapestInsertion">9.10. Cheapest Insertion</a></span></dt><dd><dl><dt><span class="section"><a href="#cheapestInsertionAlgorithm">9.10.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#cheapestInsertionConfiguration">9.10.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#regretInsertion">9.11. Regret Insertion</a></span></dt><dd><dl><dt><span class="section"><a href="#regretInsertionAlgorithm">9.11.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#regretInsertionConfiguration">9.11.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#allocateFromPool">9.12. Allocate From Pool</a></span></dt><dd><dl><dt><span class="section"><a href="#allocateFromPoolAlgorithm">9.12.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#allocateFromPoolConfiguration">9.12.2. Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#localSearch">10. Local Search</a></span></dt><dd><dl><dt><span class="section"><a href="#localSearchOverview">10.1. Overview</a></span></dt><dt><span class="section"><a href="#localSearchConcepts">10.2. Local Search concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#localSearchStepByStep">10.2.1. Step by step</a></span></dt><dt><span class="section"><a href="#localSearchConceptsDecideTheNextStep">10.2.2. Decide the next step</a></span></dt><dt><span class="section"><a href="#localSearchAcceptor">10.2.3. Acceptor</a></span></dt><dt><span class="section"><a href="#localSearchForager">10.2.4. Forager</a></span></dt></dl></dd><dt><span class="section"><a href="#hillClimbing">10.3. Hill Climbing (Simple Local Search)</a></span></dt><dd><dl><dt><span class="section"><a href="#hillClimbingAlgorithm">10.3.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#hillClimbingStuckInLocalOptima">10.3.2. Stuck in local optima</a></span></dt><dt><span class="section"><a href="#hillClimbingConfigure">10.3.3. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#tabuSearch">10.4. Tabu Search</a></span></dt><dd><dl><dt><span class="section"><a href="#tabuSearchAlgorithm">10.4.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#tabuSearchConfiguration">10.4.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#simulatedAnnealing">10.5. Simulated Annealing</a></span></dt><dd><dl><dt><span class="section"><a href="#simulatedAnnealingAlgorithm">10.5.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#simulatedAnnealingConfiguration">10.5.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#lateAcceptance">10.6. Late Acceptance</a></span></dt><dd><dl><dt><span class="section"><a href="#lateAcceptanceAlgorithm">10.6.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#lateAcceptanceConfiguration">10.6.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#stepCountingHillClimbing">10.7. Step Counting Hill Climbing</a></span></dt><dd><dl><dt><span class="section"><a href="#stepCountingHillClimbingAlgorithm">10.7.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#stepCountingHillClimbingConfiguration">10.7.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#strategicOscillation">10.8. Strategic Oscillation</a></span></dt><dd><dl><dt><span class="section"><a href="#strategicOscillationAlgorithm">10.8.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#strategicOscillationConfiguration">10.8.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#customTerminationSelectorOrAcceptor">10.9. Using a custom Termination, MoveSelector, EntitySelector, ValueSelector or Acceptor</a></span></dt></dl></dd><dt><span class="chapter"><a href="#evolutionaryAlgorithms">11. Evolutionary Algorithms</a></span></dt><dd><dl><dt><span class="section"><a href="#evolutionaryAlgorithmsOverview">11.1. Overview</a></span></dt><dt><span class="section"><a href="#evolutionaryStrategies">11.2. Evolutionary Strategies</a></span></dt><dt><span class="section"><a href="#geneticAlgorithms">11.3. Genetic Algorithms</a></span></dt></dl></dd><dt><span class="chapter"><a href="#hyperheuristics">12. Hyperheuristics</a></span></dt><dd><dl><dt><span class="section"><a href="#hyperheuristicsOverview">12.1. Overview</a></span></dt></dl></dd><dt><span class="chapter"><a href="#partitionedSearch">13. Partitioned search</a></span></dt><dd><dl><dt><span class="section"><a href="#partitionedSearchOverview">13.1. Overview</a></span></dt></dl></dd><dt><span class="chapter"><a href="#benchmarker">14. Benchmarking and tweaking</a></span></dt><dd><dl><dt><span class="section"><a href="#findTheBestSolverConfiguration">14.1. Find the best <code class="literal">Solver</code> configuration</a></span></dt><dt><span class="section"><a href="#benchmarkConfiguration">14.2. Benchmark configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarker.addDependency">14.2.1. Add dependency on <code class="literal">optaplanner-benchmark</code></a></span></dt><dt><span class="section"><a href="#buildAndRunAPlannerBenchmark">14.2.2. Build and run a <code class="literal">PlannerBenchmark</code></a></span></dt><dt><span class="section"><a href="#solutionFileIO">14.2.3. SolutionFileIO: input and output of Solution files</a></span></dt><dt><span class="section"><a href="#warmingUpTheHotSpotCompiler">14.2.4. Warming up the HotSpot compiler</a></span></dt><dt><span class="section"><a href="#benchmarkBlueprint">14.2.5. Benchmark blueprint: a predefined configuration</a></span></dt><dt><span class="section"><a href="#writeTheOutputSolutionOfBenchmarkRuns">14.2.6. Write the output solution of benchmark runs</a></span></dt><dt><span class="section"><a href="#benchmarkLogging">14.2.7. Benchmark logging</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReport">14.3. Benchmark report</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarkHtmlReport">14.3.1. HTML report</a></span></dt><dt><span class="section"><a href="#rankingTheSolvers">14.3.2. Ranking the <code class="literal">Solver</code>s</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReportSummaryStatistics">14.4. Summary statistics</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarkReportBestScoreSummary">14.4.1. Best score summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestScoreScalabilitySummary">14.4.2. Best score scalability summary (graph)</a></span></dt><dt><span class="section"><a href="#benchmarkReportWinningScoreDifferenceSummary">14.4.3. Winning score difference summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportWorstScoreDifferencePercentageSummary">14.4.4. Worst score difference percentage (ROI) summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportAverageCalculationCountSummary">14.4.5. Average calculation count summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportTimeSpentSummary">14.4.6. Time spent summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportTimeSpentScalabilitySummary">14.4.7. Time spent scalability summary (graph)</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestScorePerTimeSpentSummary">14.4.8. Best score per time spent summary (graph)</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReportStatisticPerDataset">14.5. Statistic per dataset (graph and CSV)</a></span></dt><dd><dl><dt><span class="section"><a href="#enableAProblemStatistic">14.5.1. Enable a problem statistic</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestScoreOverTimeStatistic">14.5.2. Best score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportStepScoreOverTimeStatistic">14.5.3. Step score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportCalculateCountPerSecondStatistic">14.5.4. Calculate count per second statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestSolutionMutationOverTimeStatistic">14.5.5. Best solution mutation over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportMoveCountPerStepStatistic">14.5.6. Move count per step statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportMemoryUseStatistic">14.5.7. Memory use statistic (graph and CSV)</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReportStatisticPerSingleBenchmark">14.6. Statistic per single benchmark (graph and CSV)</a></span></dt><dd><dl><dt><span class="section"><a href="#enableASingleStatistic">14.6.1. Enable a single statistic</a></span></dt><dt><span class="section"><a href="#benchmarkReportConstraintMatchTotalBestScoreOverTimeStatistic">14.6.2. Constraint match total best score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportConstraintMatchTotalStepScoreOverTimeStatistic">14.6.3. Constraint match total step score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportPickedMoveTypeBestScoreDiffOverTimeStatistic">14.6.4. Picked move type best score diff over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportPickedMoveTypeStepScoreDiffOverTimeStatistic">14.6.5. Picked move type step score diff over time statistic (graph and CSV)</a></span></dt></dl></dd><dt><span class="section"><a href="#advancedBenchmarking">14.7. Advanced benchmarking</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarkingPerformanceTricks">14.7.1. Benchmarking performance tricks</a></span></dt><dt><span class="section"><a href="#templateBasedBenchmarking">14.7.2. Template based benchmarking and matrix benchmarking</a></span></dt><dt><span class="section"><a href="#benchmarkReportAggregation">14.7.3. Benchmark report aggregation</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#repeatedPlanning">15. Repeated planning</a></span></dt><dd><dl><dt><span class="section"><a href="#introductionToRepeatedPlanning">15.1. Introduction to repeated planning</a></span></dt><dt><span class="section"><a href="#backupPlanning">15.2. Backup planning</a></span></dt><dt><span class="section"><a href="#continuousPlanning">15.3. Continuous planning (windowed planning)</a></span></dt><dd><dl><dt><span class="section"><a href="#immovablePlanningEntities">15.3.1. Immovable planning entities</a></span></dt><dt><span class="section"><a href="#nonvolatileReplanning">15.3.2. Nonvolatile replanning (semi movable planning entities) </a></span></dt></dl></dd><dt><span class="section"><a href="#realTimePlanning">15.4. Real-time planning</a></span></dt><dd><dl><dt><span class="section"><a href="#problemFactChange">15.4.1. <code class="literal">ProblemFactChange</code></a></span></dt><dt><span class="section"><a href="#daemon">15.4.2. Daemon: <code class="literal">solve()</code> does not return</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#integration">16. Integration</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationOverview">16.1. Overview</a></span></dt><dt><span class="section"><a href="#integrationWithPersistentStorage">16.2. Persistent storage</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationWithJpaAndHibernate">16.2.1. Database: JPA and Hibernate</a></span></dt><dt><span class="section"><a href="#integrationWithXStream">16.2.2. XML: XStream</a></span></dt><dt><span class="section"><a href="#integrationWithJaxb">16.2.3. XML: JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#integrationWithSoaAndEsb">16.3. SOA and ESB</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationWithCamel">16.3.1. Camel and Karaf</a></span></dt></dl></dd><dt><span class="section"><a href="#integrationWithOtherEnvironments">16.4. Other environments</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationWithJBossModules">16.4.1. JBoss modules, WildFly and JBoss EAP</a></span></dt><dt><span class="section"><a href="#integrationWithOSGi">16.4.2. OSGi</a></span></dt><dt><span class="section"><a href="#integrationWithAndroid">16.4.3. Android</a></span></dt></dl></dd><dt><span class="section"><a href="#integrationWithHumanPlanners">16.5. Integration with human planners (politics)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#development">17. Development</a></span></dt><dd><dl><dt><span class="section"><a href="#methodologyOverview">17.1. Methodology overview</a></span></dt></dl></dd></dl></div><div class="chapter" title="Chapter 1. OptaPlanner introduction"><div class="titlepage"><div><div><h2 class="title"><a id="plannerIntroduction"/>Chapter 1. OptaPlanner introduction</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#whatIsOptaPlanner">1.1. What is OptaPlanner?</a></span></dt><dt><span class="section"><a href="#requirements">1.2. Requirements</a></span></dt><dt><span class="section"><a href="#whatIsAPlanningProblem">1.3. What is a planning problem?</a></span></dt><dd><dl><dt><span class="section"><a href="#aPlanningProblemIsNPCompleteOrNPHard">1.3.1. A planning problem is NP-complete or NP-hard</a></span></dt><dt><span class="section"><a href="#aPlanningProblemHasConstraints">1.3.2. A planning problem has (hard and soft) constraints</a></span></dt><dt><span class="section"><a href="#aPlanningProblemHasAHugeSearchSpace">1.3.3. A planning problem has a huge search space</a></span></dt></dl></dd><dt><span class="section"><a href="#downloadAndRunTheExamples">1.4. Download and run the examples</a></span></dt><dd><dl><dt><span class="section"><a href="#getTheReleaseZipAndRunTheExamples">1.4.1. Get the release zip and run the examples</a></span></dt><dt><span class="section"><a href="#runTheExamplesInAnIDE">1.4.2. Run the examples in an IDE (IntelliJ, Eclipse, NetBeans)</a></span></dt><dt><span class="section"><a href="#useWithMavenGradleEtc">1.4.3. Use OptaPlanner with Maven, Gradle, Ivy, Buildr or ANT</a></span></dt><dt><span class="section"><a href="#buildFromSource">1.4.4. Build OptaPlanner from source</a></span></dt></dl></dd><dt><span class="section"><a href="#governance">1.5. Governance</a></span></dt><dd><dl><dt><span class="section"><a href="#statusOfOptaPlanner">1.5.1. Status of OptaPlanner</a></span></dt><dt><span class="section"><a href="#backwardsCompatibility">1.5.2. Backwards compatibility</a></span></dt><dt><span class="section"><a href="#communityAndSupport">1.5.3. Community and support</a></span></dt><dt><span class="section"><a href="#relationshipWithKie">1.5.4. Relationship with Drools and jBPM</a></span></dt></dl></dd></dl></div><div class="section" title="1.1. What is OptaPlanner?"><div class="titlepage"><div><div><h2 class="title"><a id="whatIsOptaPlanner"/>1.1. What is OptaPlanner?</h2></div></div></div><div class="mediaobject"><img src="images/Chapter-Planner_introduction/optaPlannerLogo.png"/></div><p><span class="bold"><strong><a class="link" href="http://www.optaplanner.org">OptaPlanner</a> is a lightweight,
    embeddable constraint satisfaction engine which optimizes planning problems.</strong></span> It solves use cases such
    as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Employee shift rostering</strong></span>: timetabling nurses, repairmen, ...</p></li><li class="listitem"><p><span class="bold"><strong>Agenda scheduling</strong></span>: scheduling meetings, appointments, maintenance jobs,
        advertisements, ...</p></li><li class="listitem"><p><span class="bold"><strong>Educational timetabling</strong></span>: scheduling lessons, courses, exams, conference
        presentations, ...</p></li><li class="listitem"><p><span class="bold"><strong>Vehicle routing</strong></span>: planning vehicles (trucks, trains, boats, airplanes,
        ...) with freight and/or people</p></li><li class="listitem"><p><span class="bold"><strong>Bin packing</strong></span>: filling containers, trucks, ships and storage warehouses,
        but also cloud computers nodes, ...</p></li><li class="listitem"><p><span class="bold"><strong>Job shop scheduling</strong></span>: planning car assembly lines, machine queue planning,
        workforce task planning, ...</p></li><li class="listitem"><p><span class="bold"><strong>Cutting stock</strong></span>: minimizing waste while cutting paper, steel, carpet,
        ...</p></li><li class="listitem"><p><span class="bold"><strong>Sport scheduling</strong></span>: planning football leagues, baseball leagues, ...</p></li><li class="listitem"><p><span class="bold"><strong>Financial optimization</strong></span>: investment portfolio optimization, risk
        spreading, ...</p></li></ul></div><div class="mediaobject"><img src="images/Chapter-Planner_introduction/useCaseOverview.png"/></div><p>Every organization faces planning problems: provide products or services with a limited set of
    <span class="emphasis"><em>constrained</em></span> resources (employees, assets, time and money). OptaPlanner optimizes such planning
    to do more business with less resources. This is known as <span class="emphasis"><em>Constraint Satisfaction Programming</em></span>
    (which is part of the <span class="emphasis"><em>Operations Research</em></span> discipline).</p><p>OptaPlanner helps normal Java<sup>TM</sup> programmers solve constraint satisfaction problems
    efficiently. Under the hood, it combines optimization heuristics and metaheuristics with very efficient score
    calculation.</p></div><div class="section" title="1.2. Requirements"><div class="titlepage"><div><div><h2 class="title"><a id="requirements"/>1.2. Requirements</h2></div></div></div><p>OptaPlanner is <span class="emphasis"><em>open source</em></span> software, released under <a class="link" href="http://www.apache.org/licenses/LICENSE-2.0.html">the Apache Software License 2.0</a>. This license is
    very liberal and allows reuse for commercial purposes. Read <a class="link" href="http://www.apache.org/foundation/licence-FAQ.html#WhatDoesItMEAN">the layman's
    explanation</a>.</p><p>OptaPlanner is 100% pure Java<sup>TM</sup> and runs on any JVM 1.6 or higher. It <a class="link" href="#integration" title="Chapter 16. Integration">integrates very easily</a> with other Java<sup>TM</sup> technologies.
    OptaPlanner is available in <a class="link" href="#useWithMavenGradleEtc" title="1.4.3. Use OptaPlanner with Maven, Gradle, Ivy, Buildr or ANT">the Maven Central Repository</a>.</p><div class="mediaobject"><img src="images/Chapter-Planner_introduction/compatibility.png"/></div></div><div class="section" title="1.3. What is a planning problem?"><div class="titlepage"><div><div><h2 class="title"><a id="whatIsAPlanningProblem"/>1.3. What is a planning problem?</h2></div></div></div><div class="section" title="1.3.1. A planning problem is NP-complete or NP-hard"><div class="titlepage"><div><div><h3 class="title"><a id="aPlanningProblemIsNPCompleteOrNPHard"/>1.3.1. A planning problem is NP-complete or NP-hard</h3></div></div></div><p>All the use cases above are <span class="emphasis"><em>probably</em></span> <a class="link" href="http://en.wikipedia.org/wiki/NP-complete">NP-complete</a> or harder. In layman's terms, NP-complete
      means:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>It's easy to verify a given solution to a problem in reasonable time.</p></li><li class="listitem"><p>There is no silver bullet to find the optimal solution of a problem in reasonable time (*).</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>(*) At least, none of the smartest computer scientists in the world have found such a silver bullet yet.
        But if they find one for 1 NP-complete problem, it will work for every NP-complete problem.</p><p>In fact, there's a $ 1,000,000 reward for anyone that proves if <a class="link" href="http://en.wikipedia.org/wiki/P_%3D_NP_problem">such a silver bullet actually exists or
        not</a>.</p></div><p>The implication of this is pretty dire: solving your problem is probably harder than you anticipated,
      because the 2 common techniques won't suffice:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A Brute Force algorithm (even a smarter variant) will take too long.</p></li><li class="listitem"><p>A quick algorithm, for example in bin packing, <span class="emphasis"><em>putting in the largest items first</em></span>,
          will return a solution that is far from optimal.</p></li></ul></div><p>By using advanced optimization algorithms, <span class="bold"><strong>OptaPlanner does find a good solution in
      reasonable time for such planning problems.</strong></span></p></div><div class="section" title="1.3.2. A planning problem has (hard and soft) constraints"><div class="titlepage"><div><div><h3 class="title"><a id="aPlanningProblemHasConstraints"/>1.3.2. A planning problem has (hard and soft) constraints</h3></div></div></div><p>Usually, a planning problem has at least 2 levels of constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A <span class="emphasis"><em>(negative) hard constraint</em></span> must not be broken. For example: <span class="emphasis"><em>1 teacher
          can not teach 2 different lessons at the same time</em></span>.</p></li><li class="listitem"><p>A <span class="emphasis"><em>(negative) soft constraint</em></span> should not be broken if it can be avoided. For
          example: <span class="emphasis"><em>Teacher A does not like to teach on Friday afternoon</em></span>.</p></li></ul></div><p>Some problems have positive constraints too:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A <span class="emphasis"><em>positive soft constraint (or reward)</em></span> should be fulfilled if possible. For
          example: <span class="emphasis"><em>Teacher B likes to teach on Monday morning</em></span>.</p></li></ul></div><p>Some basic problems (such as N Queens) only have hard constraints. Some problems have 3 or more levels of
      constraints, for example hard, medium and soft constraints.</p><p>These constraints define the <span class="emphasis"><em>score calculation</em></span> (AKA <span class="emphasis"><em>fitness
      function</em></span>) of a planning problem. Each solution of a planning problem can be graded with a score.
      <span class="bold"><strong>With OptaPlanner, score constraints are written in an Object Oriented language, such as
      Java code or Drools rules</strong></span>. Such code is easy, flexible and scalable.</p></div><div class="section" title="1.3.3. A planning problem has a huge search space"><div class="titlepage"><div><div><h3 class="title"><a id="aPlanningProblemHasAHugeSearchSpace"/>1.3.3. A planning problem has a huge search space</h3></div></div></div><p>A planning problem has a number of <span class="emphasis"><em>solutions</em></span>. There are several categories of
      solutions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A <span class="emphasis"><em>possible solution</em></span> is any solution, whether or not it breaks any number of
          constraints. Planning problems tend to have an incredibly large number of possible solutions. Many of those
          solutions are worthless.</p></li><li class="listitem"><p>A <span class="emphasis"><em>feasible solution</em></span> is a solution that does not break any (negative) hard
          constraints. The number of feasible solutions tends to be relative to the number of possible solutions.
          Sometimes there are no feasible solutions. Every feasible solution is a possible solution.</p></li><li class="listitem"><p>An <span class="emphasis"><em>optimal solution</em></span> is a solution with the highest score. Planning problems tend to
          have 1 or a few optimal solutions. There is always at least 1 optimal solution, even in the case that there
          are no feasible solutions and the optimal solution isn't feasible.</p></li><li class="listitem"><p>The <span class="emphasis"><em>best solution found</em></span> is the solution with the highest score found by an
          implementation in a given amount of time. The best solution found is likely to be feasible and, given enough
          time, it's an optimal solution.</p></li></ul></div><p>Counterintuitively, the number of possible solutions is huge (if calculated correctly), even with a small
      dataset. As you can see in the examples, most instances have a lot more possible solutions than the minimal number
      of atoms in the known universe (10^80). Because there is no silver bullet to find the optimal solution, any
      implementation is forced to evaluate at least a subset of all those possible solutions.</p><p>OptaPlanner supports several optimization algorithms to efficiently wade through that incredibly large
      number of possible solutions. Depending on the use case, some optimization algorithms perform better than others,
      but it's impossible to tell in advance. <span class="bold"><strong>With OptaPlanner, it is easy to switch the
      optimization algorithm</strong></span>, by changing the solver configuration in a few lines of XML or code.</p></div></div><div class="section" title="1.4. Download and run the examples"><div class="titlepage"><div><div><h2 class="title"><a id="downloadAndRunTheExamples"/>1.4. Download and run the examples</h2></div></div></div><div class="section" title="1.4.1. Get the release zip and run the examples"><div class="titlepage"><div><div><h3 class="title"><a id="getTheReleaseZipAndRunTheExamples"/>1.4.1. Get the release zip and run the examples</h3></div></div></div><p>To try it now:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Download a release zip of OptaPlanner from <a class="link" href="http://www.optaplanner.org">the OptaPlanner
          website</a>.</p></li><li class="listitem"><p>Unzip it.</p></li><li class="listitem"><p>Open the directory <code class="filename">examples</code> and run the script.</p><p>Linux or Mac:</p><pre><code class="no-highlight">$ cd examples
$ ./runExamples.sh</code></pre><p>Windows:</p><pre><code class="no-highlight">$ cd examples
$ runExamples.bat</code></pre></li></ul></div><div class="mediaobject"><img src="images/Chapter-Planner_introduction/distributionZip.png"/></div><p>The Examples GUI application will open. Just pick an example:</p><div class="mediaobject"><img src="images/Chapter-Planner_introduction/plannerExamplesAppScreenshot.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>OptaPlanner itself has no GUI dependencies. It runs just as well on a server or a mobile JVM as it does on
        the desktop.</p></div></div><div class="section" title="1.4.2. Run the examples in an IDE (IntelliJ, Eclipse, NetBeans)"><div class="titlepage"><div><div><h3 class="title"><a id="runTheExamplesInAnIDE"/>1.4.2. Run the examples in an IDE (IntelliJ, Eclipse, NetBeans)</h3></div></div></div><p>To run the examples in your favorite IDE:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Configure your IDE:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>In IntelliJ IDEA and NetBeans, just open the file <code class="filename">examples/sources/pom.xml</code> as a
              new project, the maven integration will take care of the rest.</p></li><li class="listitem"><p>In Eclipse, open a new project for the directory <code class="filename">examples/sources</code>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Add all the jars to the classpath from the directory <code class="filename">binaries</code> and the
                  directory <code class="filename">examples/binaries</code>, except for the file
                  <code class="filename">examples/binaries/optaplanner-examples-*.jar</code>.</p></li><li class="listitem"><p>Add the Java source directory <code class="filename">src/main/java</code> and the Java resources
                  directory <code class="filename">src/main/resources</code>.</p></li></ul></div></li></ul></div></li><li class="listitem"><p>Create a run configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Main class: <code class="literal">org.optaplanner.examples.app.OptaPlannerExamplesApp</code></p></li><li class="listitem"><p>VM parameters (optional): <code class="literal">-Xmx512M -server</code></p></li></ul></div></li><li class="listitem"><p>Run that run configuration.</p></li></ol></div></div><div class="section" title="1.4.3. Use OptaPlanner with Maven, Gradle, Ivy, Buildr or ANT"><div class="titlepage"><div><div><h3 class="title"><a id="useWithMavenGradleEtc"/>1.4.3. Use OptaPlanner with Maven, Gradle, Ivy, Buildr or ANT</h3></div></div></div><p>The OptaPlanner jars are also available in <a class="link" href="http://search.maven.org/#search|ga|1|org.optaplanner">the central maven repository</a> (and also in
      <a class="link" href="https://repository.jboss.org/nexus/index.html#nexus-search;gav~org.optaplanner~~~~">the JBoss
      maven repository</a>).</p><p>If you use Maven, add a dependency to <code class="literal">optaplanner-core</code> in your project's
      <code class="filename">pom.xml</code>:</p><pre><code class="language-xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
      &lt;artifactId&gt;optaplanner-core&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre><p>This is similar for Gradle, Ivy and Buildr. To identify the latest version, check <a class="link" href="http://search.maven.org/#search|ga|1|org.optaplanner">the central maven repository</a>.</p><p>Because you might end up using other OptaPlanner modules too, it's recommended to import the
      <code class="literal">optaplanner-bom</code> in Maven's <code class="literal">dependencyManagement</code> so the OptaPlanner version
      is specified only once:</p><pre><code class="language-xml">  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
        &lt;artifactId&gt;optaplanner-bom&lt;/artifactId&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;version&gt;...&lt;/version&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
      ...
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;</code></pre><p>If you're still using ANT (without Ivy), copy all the jars from the download zip's
      <code class="filename">binaries</code> directory in your classpath.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The download zip's <code class="filename">binaries</code> directory contains far more jars then
        <code class="literal">optaplanner-core</code> actually uses. It also contains the jars used by other modules, such as
        <code class="literal">optaplanner-benchmark</code>.</p><p>Check the maven repository <code class="filename">pom.xml</code> files to determine the minimal dependency set of a
        specific module (for a specific version).</p></div></div><div class="section" title="1.4.4. Build OptaPlanner from source"><div class="titlepage"><div><div><h3 class="title"><a id="buildFromSource"/>1.4.4. Build OptaPlanner from source</h3></div></div></div><p>It's easy to build OptaPlanner from source:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="link" href="https://help.github.com/articles/set-up-git/">Set up Git</a> and clone
          <code class="literal">optaplanner</code> from GitHub (or alternatively, download <a class="link" href="https://github.com/droolsjbpm/optaplanner/zipball/master">the zipball</a>):</p><pre><code class="no-highlight">$ git clone git@github.com:droolsjbpm/optaplanner.git optaplanner
...</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If you don't have a GitHub account or your local Git installation isn't configured with it, use this
            command instead, to avoid an authentication issue:</p><pre><code class="no-highlight">$ git clone https://github.com/droolsjbpm/optaplanner.git optaplanner
...</code></pre></div></li><li class="listitem"><p>Build it with <a class="link" href="http://maven.apache.org/">Maven</a>:</p><pre><code class="no-highlight">$ cd optaplanner
$ mvn clean install -DskipTests
...</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The first time, Maven might take a long time, because it needs to download jars.</p></div></li><li class="listitem"><p>Run the examples:</p><pre><code class="no-highlight">$ cd optaplanner-examples
$ mvn exec:exec
...</code></pre></li><li class="listitem"><p>Edit the sources in your favorite IDE.</p></li><li class="listitem"><p>Optional: use a Java profiler.</p></li></ol></div></div></div><div class="section" title="1.5. Governance"><div class="titlepage"><div><div><h2 class="title"><a id="governance"/>1.5. Governance</h2></div></div></div><div class="section" title="1.5.1. Status of OptaPlanner"><div class="titlepage"><div><div><h3 class="title"><a id="statusOfOptaPlanner"/>1.5.1. Status of OptaPlanner</h3></div></div></div><p>OptaPlanner is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Stable</strong></span>: Heavily tested with unit, integration and stress tests.</p></li><li class="listitem"><p><span class="bold"><strong>Reliable</strong></span>: Used in production across the world.</p></li><li class="listitem"><p><span class="bold"><strong>Scalable</strong></span>: One of the examples handles 50 000 variables with 5 000
          variables each, multiple constraint types and billions of possible constraint matches.</p></li><li class="listitem"><p><span class="bold"><strong>Documented</strong></span>: See this detailed manual or one of the many
          examples.</p></li></ul></div></div><div class="section" title="1.5.2. Backwards compatibility"><div class="titlepage"><div><div><h3 class="title"><a id="backwardsCompatibility"/>1.5.2. Backwards compatibility</h3></div></div></div><p>OptaPlanner separates its API and implementation:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Public API</strong></span>: All classes in the package namespace <span class="bold"><strong>org.optaplanner.core.api</strong></span> are 100% backwards compatible in future releases.</p></li><li class="listitem"><p><span class="bold"><strong>Impl classes</strong></span>: All classes in the package namespace <span class="bold"><strong>org.optaplanner.core.impl</strong></span> are not backwards compatible: they might change in future
          releases. The recipe called <a class="link" href="https://github.com/droolsjbpm/optaplanner/blob/master/optaplanner-distribution/src/main/assembly/filtered-resources/UpgradeFromPreviousVersionRecipe.txt"><code class="filename">UpgradeFromPreviousVersionRecipe.txt</code></a>
          describes every such change and on how to quickly deal with it when upgrading to a newer version. That recipe
          file is included in every release zip.</p></li><li class="listitem"><p><span class="bold"><strong>XML configuration</strong></span>: The XML solver configuration is backwards compatible
          for all elements, except for elements that require the use of non public API classes. The XML solver
          configuration is defined by the classes in the package namespace <span class="bold"><strong>org.optaplanner.core.config</strong></span>.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>This documentation covers some impl classes too. Those documented impl classes are reliable and safe to
        use (unless explicitly marked as experimental in this documentation), but we're just not entirely comfortable
        yet to write their signatures in stone.</p></div></div><div class="section" title="1.5.3. Community and support"><div class="titlepage"><div><div><h3 class="title"><a id="communityAndSupport"/>1.5.3. Community and support</h3></div></div></div><p>For news and articles, check <a class="link" href="http://www.optaplanner.org/blog/">our blog</a>, Google+
      (<a class="link" href="https://plus.google.com/+OptaPlannerOrg">OptaPlanner</a>, <a class="link" href="https://plus.google.com/+GeoffreyDeSmet">Geoffrey De Smet</a>) and twitter (<a class="link" href="https://twitter.com/OptaPlanner">OptaPlanner</a>, <a class="link" href="https://twitter.com/GeoffreyDeSmet">Geoffrey De Smet</a>). <span class="bold"><strong>If OptaPlanner
      helps you, help us by blogging or tweeting about it!</strong></span></p><p>Public questions are welcome on <a class="link" href="http://www.optaplanner.org/community/forum.html">our
      community forum</a>. Bugs and feature requests are welcome in <a class="link" href="https://issues.jboss.org/browse/PLANNER">our issue tracker</a>. Pull requests are very welcome on
      GitHub and get priority treatment! By open sourcing your improvements, you 'll benefit from our peer review and
      from our improvements made on top of your improvements.</p><p>Red Hat sponsors OptaPlanner development by employing the core team. For enterprise support and consulting,
      take a look at <a class="link" href="http://www.optaplanner.org/community/product.html">the BRMS and BPMS
      products</a> (which contain OptaPlanner) or <a class="link" href="http://www.redhat.com/en/about/contact/sales">contact Red Hat</a>.</p></div><div class="section" title="1.5.4. Relationship with Drools and jBPM"><div class="titlepage"><div><div><h3 class="title"><a id="relationshipWithKie"/>1.5.4. Relationship with Drools and jBPM</h3></div></div></div><p>OptaPlanner is part of the <a class="link" href="http://www.kiegroup.org">KIE group of projects</a>. It
      releases regularly (often once or twice per month) together with the <a class="link" href="http://www.drools.org/">Drools</a> rule engine and the <a class="link" href="http://www.jbpm.org/">jBPM</a> workflow engine.</p><div class="mediaobject"><img src="images/Chapter-Planner_introduction/kieFunctionalityOverview.png"/></div><p>See <a class="link" href="#architectureOverview" title="6.3. Architecture overview">the architecture overview</a> to learn more about the optional
      integration with Drools.</p></div></div></div><div class="chapter" title="Chapter 2. Quick start"><div class="titlepage"><div><div><h2 class="title"><a id="quickStart"/>Chapter 2. Quick start</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#cloudBalancingTutorial">2.1. Cloud balancing tutorial</a></span></dt><dd><dl><dt><span class="section"><a href="#cloudBalancingProblemDescription">2.1.1. Problem description</a></span></dt><dt><span class="section"><a href="#cloudBalancingProblemSize">2.1.2. Problem size</a></span></dt><dt><span class="section"><a href="#cloudBalancingDomainModelDesign">2.1.3. Domain model design</a></span></dt><dt><span class="section"><a href="#cloudBalancingMainMethod">2.1.4. Main method</a></span></dt><dt><span class="section"><a href="#cloudBalancingSolverConfiguration">2.1.5. Solver configuration</a></span></dt><dt><span class="section"><a href="#cloudBalancingDomainModelImplementation">2.1.6. Domain model implementation</a></span></dt><dt><span class="section"><a href="#cloudBalancingScoreConfiguration">2.1.7. Score configuration</a></span></dt><dt><span class="section"><a href="#cloudBalancingBeyondThisTutorial">2.1.8. Beyond this tutorial</a></span></dt></dl></dd></dl></div><div class="section" title="2.1. Cloud balancing tutorial"><div class="titlepage"><div><div><h2 class="title"><a id="cloudBalancingTutorial"/>2.1. Cloud balancing tutorial</h2></div></div></div><div class="section" title="2.1.1. Problem description"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingProblemDescription"/>2.1.1. Problem description</h3></div></div></div><p>Suppose your company owns a number of cloud computers and needs to run a number of processes on those
      computers. Assign each process to a computer under the following 4 constraints.</p><p>Hard constraints which must be fulfilled:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Every computer must be able to handle the minimum hardware requirements of the sum of its
          processes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The CPU power of a computer must be at least the sum of the CPU power required by the processes
              assigned to that computer.</p></li><li class="listitem"><p>The RAM memory of a computer must be at least the sum of the RAM memory required by the processes
              assigned to that computer.</p></li><li class="listitem"><p>The network bandwidth of a computer must be at least the sum of the network bandwidth required by
              the processes assigned to that computer.</p></li></ul></div></li></ul></div><p>Soft constraints which should be optimized:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Each computer that has one or more processes assigned, incurs a maintenance cost (which is fixed per
          computer).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Minimize the total maintenance cost.</p></li></ul></div></li></ul></div><p>How would you do that? This problem is a form of <span class="emphasis"><em>bin packing</em></span>. Here's a simplified
      example where we assign 4 processes to 2 computers with 2 constraints (CPU and RAM) with a simple
      algorithm:</p><div class="mediaobject"><img src="images/Chapter-Quick_start/cloudBalanceUseCase.png"/></div><p>The simple algorithm used here is the <span class="emphasis"><em>First Fit Decreasing</em></span> algorithm, which assigns the
      bigger processes first and assigns the smaller processes to the remaining space. As you can see, it's not optimal,
      because it does not leave enough room to assign the yellow process D.</p><p>Planner does find the more optimal solution fast, by using additional, smarter algorithms. And it scales
      too: both in data (more processes, more computers) and constraints (more hardware requirements, other
      constraints). So let's take a look how we can use Planner for this.</p></div><div class="section" title="2.1.2. Problem size"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingProblemSize"/>2.1.2. Problem size</h3></div></div></div><pre><code class="no-highlight">2computers-6processes      has   2 computers and    6 processes with a search space of      64.
3computers-9processes      has   3 computers and    9 processes with a search space of    10^4.
4computers-012processes    has   4 computers and   12 processes with a search space of    10^7.
100computers-300processes  has 100 computers and  300 processes with a search space of  10^600.
200computers-600processes  has 200 computers and  600 processes with a search space of 10^1380.
400computers-1200processes has 400 computers and 1200 processes with a search space of 10^3122.
800computers-2400processes has 800 computers and 2400 processes with a search space of 10^6967.</code></pre></div><div class="section" title="2.1.3. Domain model design"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingDomainModelDesign"/>2.1.3. Domain model design</h3></div></div></div><p>Let's start by taking a look at the domain model. It's pretty simple:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">Computer</code>: represents a computer with certain hardware (CPU power, RAM memory, network
          bandwidth) and maintenance cost.</p></li><li class="listitem"><p><code class="literal">Process</code>: represents a process with a demand. Needs to be assigned to a
          <code class="literal">Computer</code> by Planner.</p></li><li class="listitem"><p><code class="literal">CloudBalance</code>: represents a problem. Contains every <code class="literal">Computer</code> and
          <code class="literal">Process</code> for a certain data set.</p></li></ul></div><div class="mediaobject"><img src="images/Chapter-Quick_start/cloudBalanceClassDiagram.png"/></div><p>In the UML class diagram above, the Planner concepts are already annotated:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Planning entity: the class (or classes) that changes during planning. In this example that's the class
          <code class="literal">Process</code>.</p></li><li class="listitem"><p>Planning variable: the property (or properties) of a planning entity class that changes during planning.
          In this example, that's the property <code class="literal">computer</code> on the class
          <code class="literal">Process</code>.</p></li><li class="listitem"><p>Solution: the class that represents a data set and contains all planning entities. In this example
          that's the class <code class="literal">CloudBalance</code>.</p></li></ul></div></div><div class="section" title="2.1.4. Main method"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingMainMethod"/>2.1.4. Main method</h3></div></div></div><p>Try it yourself. <a class="link" href="#downloadAndRunTheExamples" title="1.4. Download and run the examples">Download and configure the examples in your
      favorite IDE.</a> Run <code class="literal">org.optaplanner.examples.cloudbalancing.app.CloudBalancingHelloWorld</code>.
      By default, it is configured to run for 120 seconds. It will execute this code:</p><div class="example"><a id="d0e722"/><p class="title"><strong>Example 2.1. CloudBalancingHelloWorld.java</strong></p><div class="example-contents"><pre><code class="language-java">public class CloudBalancingHelloWorld {

    public static void main(String[] args) {
        // Build the Solver
        SolverFactory solverFactory = SolverFactory.createFromXmlResource(
                "org/optaplanner/examples/cloudbalancing/solver/cloudBalancingSolverConfig.xml");
        Solver solver = solverFactory.buildSolver();

        // Load a problem with 400 computers and 1200 processes
        CloudBalance unsolvedCloudBalance = new CloudBalancingGenerator().createCloudBalance(400, 1200);

        // Solve the problem
        solver.solve(unsolvedCloudBalance);
        CloudBalance solvedCloudBalance = (CloudBalance) solver.getBestSolution();

        // Display the result
        System.out.println("\nSolved cloudBalance with 400 computers and 1200 processes:\n"
                + toDisplayString(solvedCloudBalance));
    }

    ...

}</code></pre></div></div><br class="example-break"/><p>The code above does this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Build the <code class="literal">Solver</code> based on a solver configuration (in this case an XML file from the
          classpath).</p><pre><code class="language-java">        SolverFactory solverFactory = SolverFactory.createFromXmlResource(
                "org/optaplanner/examples/cloudbalancing/solver/cloudBalancingSolverConfig.xml");
        Solver solver = solverFactory.buildSolver();</code></pre></li><li class="listitem"><p>Load the problem. <code class="literal">CloudBalancingGenerator</code> generates a random problem: you'll replace
          this with a class that loads a real problem, for example from a database.</p><pre><code class="language-java">        CloudBalance unsolvedCloudBalance = new CloudBalancingGenerator().createCloudBalance(400, 1200);</code></pre></li><li class="listitem"><p>Solve the problem.</p><pre><code class="language-java">        solver.solve(unsolvedCloudBalance);
        CloudBalance solvedCloudBalance = (CloudBalance) solver.getBestSolution();</code></pre></li><li class="listitem"><p>Display the result.</p><pre><code class="language-java">        System.out.println("\nSolved cloudBalance with 400 computers and 1200 processes:\n"
                + toDisplayString(solvedCloudBalance));</code></pre></li></ul></div><p>The only non-obvious part is building the <code class="literal">Solver</code>. Let's examine that.</p></div><div class="section" title="2.1.5. Solver configuration"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingSolverConfiguration"/>2.1.5. Solver configuration</h3></div></div></div><p>Take a look at the solver configuration:</p><div class="example"><a id="d0e766"/><p class="title"><strong>Example 2.2. cloudBalancingSolverConfig.xml</strong></p><div class="example-contents"><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;solver&gt;
  &lt;!--&lt;environmentMode&gt;FAST_ASSERT&lt;/environmentMode&gt;--&gt;

  &lt;!-- Domain model configuration --&gt;
  &lt;solutionClass&gt;org.optaplanner.examples.cloudbalancing.domain.CloudBalance&lt;/solutionClass&gt;
  &lt;entityClass&gt;org.optaplanner.examples.cloudbalancing.domain.CloudProcess&lt;/entityClass&gt;

  &lt;!-- Score configuration --&gt;
  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    &lt;easyScoreCalculatorClass&gt;org.optaplanner.examples.cloudbalancing.solver.score.CloudBalancingEasyScoreCalculator&lt;/easyScoreCalculatorClass&gt;
    &lt;!--&lt;scoreDrl&gt;org/optaplanner/examples/cloudbalancing/solver/cloudBalancingScoreRules.drl&lt;/scoreDrl&gt;--&gt;
    &lt;initializingScoreTrend&gt;ONLY_DOWN&lt;/initializingScoreTrend&gt;
  &lt;/scoreDirectorFactory&gt;

  &lt;!-- Optimization algorithms configuration --&gt;
  &lt;termination&gt;
    &lt;secondsSpentLimit&gt;120&lt;/secondsSpentLimit&gt;
  &lt;/termination&gt;
  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;FIRST_FIT_DECREASING&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;
  &lt;localSearch&gt;
    &lt;acceptor&gt;
      &lt;entityTabuSize&gt;7&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1000&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;
&lt;/solver&gt;</code></pre></div></div><br class="example-break"/><p>This solver configuration consists out of 3 parts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Domain model configuration</strong></span>: What can Planner change? We need to make
          Planner aware of our domain classes:</p><pre><code class="language-xml">  &lt;solutionClass&gt;org.optaplanner.examples.cloudbalancing.domain.CloudBalance&lt;/solutionClass&gt;
  &lt;entityClass&gt;org.optaplanner.examples.cloudbalancing.domain.CloudProcess&lt;/entityClass&gt;</code></pre></li><li class="listitem"><p><span class="bold"><strong>Score configuration</strong></span>: How should Planner optimize the planning
          variables? Since we have hard and soft constraints, we use a <code class="literal">HardSoftScore</code>. But we also
          need to tell Planner how to calculate such the score, depending on our business requirements. Further down, we
          'll look into 2 alternatives to calculate the score: using a simple Java implementation or using Drools
          DRL.</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    &lt;easyScoreCalculatorClass&gt;org.optaplanner.examples.cloudbalancing.solver.score.CloudBalancingEasyScoreCalculator&lt;/easyScoreCalculatorClass&gt;
    &lt;!--&lt;scoreDrl&gt;org/optaplanner/examples/cloudbalancing/solver/cloudBalancingScoreRules.drl&lt;/scoreDrl&gt;--&gt;
    &lt;initializingScoreTrend&gt;ONLY_DOWN&lt;/initializingScoreTrend&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre></li><li class="listitem"><p><span class="bold"><strong>Optimization algorithms configuration</strong></span>: How should Planner optimize it?
          Don't worry about this for now: this is a good default configuration that works on most planning problems. It
          will already surpass human planners and most in-house implementations. Using the Planner benchmark toolkit,
          you can tweak it to get even better results.</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;secondsSpentLimit&gt;120&lt;/secondsSpentLimit&gt;
  &lt;/termination&gt;
  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;FIRST_FIT_DECREASING&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;
  &lt;localSearch&gt;
    &lt;acceptor&gt;
      &lt;entityTabuSize&gt;7&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1000&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre></li></ul></div><p>Let's examine the domain model classes and the score configuration.</p></div><div class="section" title="2.1.6. Domain model implementation"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingDomainModelImplementation"/>2.1.6. Domain model implementation</h3></div></div></div><div class="section" title="2.1.6.1. The Computer class"><div class="titlepage"><div><div><h4 class="title"><a id="cloudBalancingClassComputer"/>2.1.6.1. The <code class="literal">Computer</code> class</h4></div></div></div><p>The <code class="literal">Computer</code> class is a POJO (Plain Old Java Object), nothing special. Usually, you'll
        have more of this kind of classes.</p><div class="example"><a id="d0e814"/><p class="title"><strong>Example 2.3. CloudComputer.java</strong></p><div class="example-contents"><pre><code class="language-java">public class CloudComputer ... {

    private int cpuPower;
    private int memory;
    private int networkBandwidth;
    private int cost;

    ... // getters
}</code></pre></div></div><br class="example-break"/></div><div class="section" title="2.1.6.2. The Process class"><div class="titlepage"><div><div><h4 class="title"><a id="cloudBalancingClassProcess"/>2.1.6.2. The <code class="literal">Process</code> class</h4></div></div></div><p>The <code class="literal">Process</code> class is a little bit special. We need to tell Planner that it can change
        the field <code class="literal">computer</code>, so we annotate the class with <code class="literal">@PlanningEntity</code> and the
        getter <code class="literal">getComputer</code> with <code class="literal">@PlanningVariable</code>:</p><div class="example"><a id="d0e842"/><p class="title"><strong>Example 2.4. CloudProcess.java</strong></p><div class="example-contents"><pre><code class="language-java">@PlanningEntity(...)
public class CloudProcess ... {

    private int requiredCpuPower;
    private int requiredMemory;
    private int requiredNetworkBandwidth;

    private CloudComputer computer;

    ... // getters

    @PlanningVariable(valueRangeProviderRefs = {"computerRange"})
    public CloudComputer getComputer() {
        return computer;
    }

    public void setComputer(CloudComputer computer) {
        computer = computer;
    }

    // ************************************************************************
    // Complex methods
    // ************************************************************************

    ...

}</code></pre></div></div><br class="example-break"/><p>The values that Planner can choose from for the field <code class="literal">computer</code>, are retrieved from a
        method on the <code class="literal">Solution</code> implementation: <code class="literal">CloudBalance.getComputerList()</code>
        which returns a list of all computers in the current data set. We tell Planner about this by using the
        <code class="literal">valueRangeProviderRefs</code> property.</p></div><div class="section" title="2.1.6.3. The CloudBalance class"><div class="titlepage"><div><div><h4 class="title"><a id="cloudBalancingClassCloudBalance"/>2.1.6.3. The <code class="literal">CloudBalance</code> class</h4></div></div></div><p>The <code class="literal">CloudBalance</code> class implements the <code class="filename">Solution</code> interface. It holds
        a list of all computers and processes. We need to tell Planner how to retrieve the collection of processes which
        it can change, so we need to annotate the getter <code class="literal">getProcessList</code> with
        <code class="literal">@PlanningEntityCollectionProperty</code>.</p><p>The <code class="literal">CloudBalance</code> class also has a property <code class="literal">score</code> which is the
        <code class="literal">Score</code> of that <code class="literal">Solution</code> instance in its current state:</p><div class="example"><a id="d0e895"/><p class="title"><strong>Example 2.5. CloudBalance.java</strong></p><div class="example-contents"><pre><code class="language-java">public class CloudBalance ... implements Solution&lt;HardSoftScore&gt; {

    private List&lt;CloudComputer&gt; computerList;

    private List&lt;CloudProcess&gt; processList;

    private HardSoftScore score;

    @ValueRangeProvider(id = "computerRange")
    public List&lt;CloudComputer&gt; getComputerList() {
        return computerList;
    }

    @PlanningEntityCollectionProperty
    public List&lt;CloudProcess&gt; getProcessList() {
        return processList;
    }

    ...

    public HardSoftScore getScore() {
        return score;
    }

    public void setScore(HardSoftScore score) {
        this.score = score;
    }

    // ************************************************************************
    // Complex methods
    // ************************************************************************

    public Collection&lt;? extends Object&gt; getProblemFacts() {
        List&lt;Object&gt; facts = new ArrayList&lt;Object&gt;();
        facts.addAll(computerList);
        // Do not add the planning entity's (processList) because that will be done automatically
        return facts;
    }

    ...

}</code></pre></div></div><br class="example-break"/><p>The <code class="literal">getProblemFacts()</code> method is only needed for score calculation with Drools. It's not
        needed for the other score calculation types.</p></div></div><div class="section" title="2.1.7. Score configuration"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingScoreConfiguration"/>2.1.7. Score configuration</h3></div></div></div><p>Planner will search for the <code class="literal">Solution</code> with the highest <code class="literal">Score</code>. We're
      using a <code class="literal">HardSoftScore</code>, which means Planner will look for the solution with no hard constraints
      broken (fulfill hardware requirements) and as little as possible soft constraints broken (minimize maintenance
      cost).</p><div class="mediaobject"><img src="images/Chapter-Quick_start/cloudBalanceScoreCalculation.png"/></div><p>Of course, Planner needs to be told about these domain-specific score constraints. There are several ways to
      implement such a score function:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Easy Java</p></li><li class="listitem"><p>Incremental Java</p></li><li class="listitem"><p>Drools</p></li></ul></div><p>Let's take a look at 2 different implementations:</p><div class="section" title="2.1.7.1. Easy Java score configuration"><div class="titlepage"><div><div><h4 class="title"><a id="cloudBalancingEasyJavaScoreConfiguration"/>2.1.7.1. Easy Java score configuration</h4></div></div></div><p>One way to define a score function is to implement the interface <code class="literal">EasyScoreCalculator</code>
        in plain Java.</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    &lt;easyScoreCalculatorClass&gt;org.optaplanner.examples.cloudbalancing.solver.score.CloudBalancingEasyScoreCalculator&lt;/easyScoreCalculatorClass&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Just implement the <code class="literal">calculateScore(Solution)</code> method to return a
        <code class="literal">HardSoftScore</code> instance.</p><div class="example"><a id="d0e954"/><p class="title"><strong>Example 2.6. CloudBalancingEasyScoreCalculator.java</strong></p><div class="example-contents"><pre><code class="language-java">public class CloudBalancingEasyScoreCalculator implements EasyScoreCalculator&lt;CloudBalance&gt; {

    /**
     * A very simple implementation. The double loop can easily be removed by using Maps as shown in
     * {@link CloudBalancingMapBasedEasyScoreCalculator#calculateScore(CloudBalance)}.
     */
    public HardSoftScore calculateScore(CloudBalance cloudBalance) {
        int hardScore = 0;
        int softScore = 0;
        for (CloudComputer computer : cloudBalance.getComputerList()) {
            int cpuPowerUsage = 0;
            int memoryUsage = 0;
            int networkBandwidthUsage = 0;
            boolean used = false;

            // Calculate usage
            for (CloudProcess process : cloudBalance.getProcessList()) {
                if (computer.equals(process.getComputer())) {
                    cpuPowerUsage += process.getRequiredCpuPower();
                    memoryUsage += process.getRequiredMemory();
                    networkBandwidthUsage += process.getRequiredNetworkBandwidth();
                    used = true;
                }
            }
            
            // Hard constraints
            int cpuPowerAvailable = computer.getCpuPower() - cpuPowerUsage;
            if (cpuPowerAvailable &lt; 0) {
                hardScore += cpuPowerAvailable;
            }
            int memoryAvailable = computer.getMemory() - memoryUsage;
            if (memoryAvailable &lt; 0) {
                hardScore += memoryAvailable;
            }
            int networkBandwidthAvailable = computer.getNetworkBandwidth() - networkBandwidthUsage;
            if (networkBandwidthAvailable &lt; 0) {
                hardScore += networkBandwidthAvailable;
            }
            
            // Soft constraints
            if (used) {
                softScore -= computer.getCost();
            }
        }
        return HardSoftScore.valueOf(hardScore, softScore);
    }

}</code></pre></div></div><br class="example-break"/><p>Even if we optimize the code above to use <code class="literal">Map</code>s to iterate through the
        <code class="literal">processList</code> only once, <span class="bold"><strong>it is still slow</strong></span> because it doesn't
        do incremental score calculation. To fix that, either use an incremental Java score function or a Drools score
        function. Let's take a look at the latter.</p></div><div class="section" title="2.1.7.2. Drools score configuration"><div class="titlepage"><div><div><h4 class="title"><a id="cloudBalancingDroolsScoreConfiguration"/>2.1.7.2. Drools score configuration</h4></div></div></div><p>To use the Drools rule engine as a score function, simply add a <code class="literal">scoreDrl</code> resource in
        the classpath:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    &lt;scoreDrl&gt;org/optaplanner/examples/cloudbalancing/solver/cloudBalancingScoreRules.drl&lt;/scoreDrl&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>First, we want to make sure that all computers have enough CPU, RAM and network bandwidth to support all
        their processes, so we make these hard constraints:</p><div class="example"><a id="d0e982"/><p class="title"><strong>Example 2.7. cloudBalancingScoreRules.drl - hard constraints</strong></p><div class="example-contents"><pre><code class="no-highlight">...

import org.optaplanner.examples.cloudbalancing.domain.CloudBalance;
import org.optaplanner.examples.cloudbalancing.domain.CloudComputer;
import org.optaplanner.examples.cloudbalancing.domain.CloudProcess;

global HardSoftScoreHolder scoreHolder;

// ############################################################################
// Hard constraints
// ############################################################################

rule "requiredCpuPowerTotal"
    when
        $computer : CloudComputer($cpuPower : cpuPower)
        $requiredCpuPowerTotal : Number(intValue &gt; $cpuPower) from accumulate(
            CloudProcess(
                computer == $computer,
                $requiredCpuPower : requiredCpuPower),
            sum($requiredCpuPower)
        )
    then
        scoreHolder.addHardConstraintMatch(kcontext, $cpuPower - $requiredCpuPowerTotal.intValue());
end

rule "requiredMemoryTotal"
    ...
end

rule "requiredNetworkBandwidthTotal"
    ...
end</code></pre></div></div><br class="example-break"/><p>Next, if those constraints are met, we want to minimize the maintenance cost, so we add that as a soft
        constraint:</p><div class="example"><a id="d0e989"/><p class="title"><strong>Example 2.8. cloudBalancingScoreRules.drl - soft constraints</strong></p><div class="example-contents"><pre><code class="no-highlight">// ############################################################################
// Soft constraints
// ############################################################################

rule "computerCost"
    when
        $computer : CloudComputer($cost : cost)
        exists CloudProcess(computer == $computer)
    then
        scoreHolder.addSoftConstraintMatch(kcontext, - $cost);
end</code></pre></div></div><br class="example-break"/><p>If you use the Drools rule engine for score calculation, you can integrate with other Drools technologies,
        such as decision tables (XLS or web based), the KIE Workbench rule repository, ...</p></div></div><div class="section" title="2.1.8. Beyond this tutorial"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancingBeyondThisTutorial"/>2.1.8. Beyond this tutorial</h3></div></div></div><p>Now that this simple example works, try going further. Enrich the domain model and add extra constraints
      such as these:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Each <code class="literal">Process</code> belongs to a <code class="literal">Service</code>. A computer might crash, so
          processes running the same service should be assigned to different computers.</p></li><li class="listitem"><p>Each <code class="literal">Computer</code> is located in a <code class="literal">Building</code>. A building might burn down,
          so processes of the same services should be assigned to computers in different buildings.</p></li></ul></div></div></div></div><div class="chapter" title="Chapter 3. Use cases and examples"><div class="titlepage"><div><div><h2 class="title"><a id="useCasesAndExamples"/>Chapter 3. Use cases and examples</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#examplesOverview">3.1. Examples overview</a></span></dt><dt><span class="section"><a href="#basicExamples">3.2. Basic examples</a></span></dt><dd><dl><dt><span class="section"><a href="#nQueens">3.2.1. N queens</a></span></dt><dt><span class="section"><a href="#cloudBalancing">3.2.2. Cloud balancing</a></span></dt><dt><span class="section"><a href="#tsp">3.2.3. Traveling salesman (TSP - Traveling salesman problem)</a></span></dt><dt><span class="section"><a href="#dinnerParty">3.2.4. Dinner party</a></span></dt><dt><span class="section"><a href="#tennis">3.2.5. Tennis club scheduling</a></span></dt></dl></dd><dt><span class="section"><a href="#realExamples">3.3. Real examples</a></span></dt><dd><dl><dt><span class="section"><a href="#curriculumCourse">3.3.1. Course timetabling (ITC 2007 track 3 - Curriculum course scheduling)</a></span></dt><dt><span class="section"><a href="#machineReassignment">3.3.2. Machine reassignment (Google ROADEF 2012)</a></span></dt><dt><span class="section"><a href="#vehicleRouting">3.3.3. Vehicle routing</a></span></dt><dt><span class="section"><a href="#projectJobScheduling">3.3.4. Project job scheduling</a></span></dt><dt><span class="section"><a href="#bedAllocation">3.3.5. Hospital bed planning (PAS - Patient admission scheduling)</a></span></dt></dl></dd><dt><span class="section"><a href="#difficultExamples">3.4. Difficult examples</a></span></dt><dd><dl><dt><span class="section"><a href="#examination">3.4.1. Exam timetabling (ITC 2007 track 1 - Examination)</a></span></dt><dt><span class="section"><a href="#employeeRostering">3.4.2. Employee rostering (INRC 2010 - Nurse rostering)</a></span></dt><dt><span class="section"><a href="#travelingTournament">3.4.3. Traveling tournament problem (TTP)</a></span></dt><dt><span class="section"><a href="#cheapTimeScheduling">3.4.4. Cheap time scheduling</a></span></dt></dl></dd></dl></div><div class="section" title="3.1. Examples overview"><div class="titlepage"><div><div><h2 class="title"><a id="examplesOverview"/>3.1. Examples overview</h2></div></div></div><p>Planner has several examples. In this manual we explain mainly using the n queens example and
    cloud balancing example. So it's advisable to read at least those sections.</p><p>The source code of all these examples is available in the distribution zip under
    <code class="filename">examples/sources</code> and also in git under
    <code class="filename">optaplanner/optaplanner-examples</code>.</p><div class="table"><a id="d0e1036"/><p class="title"><strong>Table 3.1. Examples overview</strong></p><div class="table-contents"><table summary="Examples overview" border="1"><colgroup><col width="2*" align="left"/><col width="1*" align="left"/><col width="1*" align="left"/><col width="1*" align="left"/><col width="2*" align="left"/></colgroup><thead><tr><th align="left">Example</th><th align="left">Domain</th><th align="left">Size</th><th align="left">Competition?</th><th align="left">Special features used</th></tr></thead><tbody><tr><td align="left"><a class="link" href="#nQueens" title="3.2.1. N queens">N queens</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">256</code></p></li><li class="listitem"><p>Value &lt;= 256</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^616</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Pointless (<a class="link" href="http://en.wikipedia.org/wiki/Eight_queens_puzzle#Explicit_solutions">cheatable</a>)</p></li></ul></div></td><td align="left">None</td></tr><tr><td align="left"><a class="link" href="#cloudBalancing" title="3.2.2. Cloud balancing">Cloud balancing</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">2400</code></p></li><li class="listitem"><p>Value &lt;= 800</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^6967</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>No</p></li><li class="listitem"><p>Defined by us</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#realTimePlanning" title="15.4. Real-time planning">Real-time planning</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#tsp" title="3.2.3. Traveling salesman (TSP - Traveling salesman problem)">Traveling salesman</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 chained variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">980</code></p></li><li class="listitem"><p>Value &lt;= 980</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^2927</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Unrealistic</p></li><li class="listitem"><p><a class="link" href="http://www.math.uwaterloo.ca/tsp/">TSP web</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#realTimePlanning" title="15.4. Real-time planning">Real-time planning</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#dinnerParty" title="3.2.4. Dinner party">Dinner party</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">144</code></p></li><li class="listitem"><p>Value &lt;= 72</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^310</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Unrealistic</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Decision Table spreadsheet for score constraints</p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#tennis" title="3.2.5. Tennis club scheduling">Tennis club scheduling</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">72</code></p></li><li class="listitem"><p>Value &lt;= 7</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^60</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>No</p></li><li class="listitem"><p>Defined by us</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#fairnessScoreConstraints" title="5.4.10. Fairness score constraints">Fairness score constraints</a></p></li><li class="listitem"><p><a class="link" href="#immovablePlanningEntities" title="15.3.1. Immovable planning entities">Immovable entities</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#curriculumCourse" title="3.3.1. Course timetabling (ITC 2007 track 3 - Curriculum course scheduling)">Course timetabling</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>2 variables</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">434</code></p></li><li class="listitem"><p>Value &lt;= 25 and &lt;= <code class="literal">20</code></p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^1171</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Realistic</p></li><li class="listitem"><p><a class="link" href="http://www.cs.qub.ac.uk/itc2007/curriculmcourse/course_curriculm_index.htm">ITC 2007 track
                  3</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#immovablePlanningEntities" title="15.3.1. Immovable planning entities">Immovable entities</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#machineReassignment" title="3.3.2. Machine reassignment (Google ROADEF 2012)">Machine reassignment</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">50000</code></p></li><li class="listitem"><p>Value &lt;= 5000</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^184948</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Nearly <span class="bold"><strong>realistic</strong></span></p></li><li class="listitem"><p><a class="link" href="http://challenge.roadef.org/2012/en/">ROADEF 2012</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#realTimePlanning" title="15.4. Real-time planning">Real-time planning</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#vehicleRouting" title="3.3.3. Vehicle routing">Vehicle routing</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 chained variable</p></li><li class="listitem"><p>1 shadow entity class</p></li><li class="listitem"><p>1 automatic shadow variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">134</code></p></li><li class="listitem"><p>Value &lt;= 141</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^285</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Unrealistic</p></li><li class="listitem"><p><a class="link" href="http://neo.lcc.uma.es/vrp/">VRP web</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#customVariableListener" title="4.3.6.4. Custom VariableListener">VariableListener</a></p></li><li class="listitem"><p><a class="link" href="#realTimePlanning" title="15.4. Real-time planning">Real-time planning</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#vehicleRouting" title="3.3.3. Vehicle routing">Vehicle routing</a> with time windows</td><td align="left"><p>Extra on Vehicle routing:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 shadow variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">1000</code></p></li><li class="listitem"><p>Value &lt;= 1250</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^3000</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Unrealistic</p></li><li class="listitem"><p><a class="link" href="http://neo.lcc.uma.es/vrp/">VRP web</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#customVariableListener" title="4.3.6.4. Custom VariableListener">VariableListener</a></p></li><li class="listitem"><p><a class="link" href="#realTimePlanning" title="15.4. Real-time planning">Real-time planning</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#projectJobScheduling" title="3.3.4. Project job scheduling">Project job scheduling</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>2 variables</p></li><li class="listitem"><p>1 shadow variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">640</code></p></li><li class="listitem"><p>Value &lt;= ? and &lt;= <code class="literal">?</code></p></li><li class="listitem"><p>Search space &lt;= <code class="literal">?</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Nearly <span class="bold"><strong>realistic</strong></span></p></li><li class="listitem"><p><a class="link" href="http://allserv.kahosl.be/mista2013challenge/">MISTA 2013</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#bendableScore" title="5.2.4. BendableScore">Bendable score</a></p></li><li class="listitem"><p><a class="link" href="#customVariableListener" title="4.3.6.4. Custom VariableListener">VariableListener</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#bedAllocation" title="3.3.5. Hospital bed planning (PAS - Patient admission scheduling)">Hospital bed planning</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 nullable variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">2750</code></p></li><li class="listitem"><p>Value &lt;= 471</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^6851</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Unrealistic</p></li><li class="listitem"><p><a class="link" href="http://allserv.kahosl.be/~peter/pas/">Kaho PAS</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Overconstrained planning</p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#examination" title="3.4.1. Exam timetabling (ITC 2007 track 1 - Examination)">Exam timetabling</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>2 entity classes (same hierarchy)</p></li><li class="listitem"><p>2 variables</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">1096</code></p></li><li class="listitem"><p>Value &lt;= 80 and &lt;= <code class="literal">49</code></p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^3374</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Realistic</strong></span></p></li><li class="listitem"><p><a class="link" href="http://www.cs.qub.ac.uk/itc2007/examtrack/exam_track_index.htm">ITC 2007 track
                  1</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#customVariableListener" title="4.3.6.4. Custom VariableListener">VariableListener</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#employeeRostering" title="3.4.2. Employee rostering (INRC 2010 - Nurse rostering)">Employee rostering</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">752</code></p></li><li class="listitem"><p>Value &lt;= 50</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^1277</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Realistic</strong></span></p></li><li class="listitem"><p><a class="link" href="http://www.kuleuven-kortrijk.be/nrpcompetition">INRC 2010</a></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="#continuousPlanning" title="15.3. Continuous planning (windowed planning)">Continuous planning</a></p></li><li class="listitem"><p><a class="link" href="#realTimePlanning" title="15.4. Real-time planning">Real-time planning</a></p></li></ul></div></td></tr><tr><td align="left"><a class="link" href="#travelingTournament" title="3.4.3. Traveling tournament problem (TTP)">Traveling tournament</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>1 variable</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">1560</code></p></li><li class="listitem"><p>Value &lt;= 78</p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^2951</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Unrealistic</p></li><li class="listitem"><p><a class="link" href="http://mat.gsia.cmu.edu/TOURN/">TTP</a></p></li></ul></div></td><td align="left">None</td></tr><tr><td align="left"><a class="link" href="#cheapTimeScheduling" title="3.4.4. Cheap time scheduling">Cheap time scheduling</a></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1 entity class</p></li><li class="listitem"><p>2 variables</p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Entity &lt;= <code class="literal">500</code></p></li><li class="listitem"><p>Value &lt;= 100 and &lt;= <code class="literal">288</code></p></li><li class="listitem"><p>Search space &lt;= <code class="literal">10^20078</code></p></li></ul></div></td><td align="left"><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Nearly <span class="bold"><strong>realistic</strong></span></p></li><li class="listitem"><p><a class="link" href="http://iconchallenge.insight-centre.org/">ICON</a></p></li></ul></div></td><td align="left">None</td></tr></tbody></table></div></div><br class="table-break"/><p>A <span class="emphasis"><em>realistic competition</em></span> is <span class="bold"><strong>an official, independent
    competition</strong></span>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>that clearly defines a real-word use case</p></li><li class="listitem"><p>with real-world constraints</p></li><li class="listitem"><p>with multiple, real-world datasets</p></li><li class="listitem"><p>that expects reproducible results within a specific time limit on specific hardware</p></li><li class="listitem"><p>that has had serious participation from the academic and/or enterprise Operations Research
        community</p></li></ul></div><p>These realistic competitions provide an objective comparison of Planner with competitive software and
    academic research.</p></div><div class="section" title="3.2. Basic examples"><div class="titlepage"><div><div><h2 class="title"><a id="basicExamples"/>3.2. Basic examples</h2></div></div></div><div class="section" title="3.2.1. N queens"><div class="titlepage"><div><div><h3 class="title"><a id="nQueens"/>3.2.1. N queens</h3></div></div></div><div class="section" title="3.2.1.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="nQueensProblemDescription"/>3.2.1.1. Problem description</h4></div></div></div><p>Place n queens on a n sized chessboard so no 2 queens can attack each other. The most common n queens
        puzzle is the 8 queens puzzle, with <span class="emphasis"><em>n = 8</em></span>:</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/screenshotNQueens.png"/></div><p>Constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Use a chessboard of <span class="emphasis"><em>n</em></span> columns and <span class="emphasis"><em>n</em></span> rows.</p></li><li class="listitem"><p>Place <span class="emphasis"><em>n</em></span> queens on the chessboard.</p></li><li class="listitem"><p>No 2 queens can attack each other. A queen can attack any other queen on the same horizontal, vertical
            or diagonal line.</p></li></ul></div><p>This documentation heavily uses the 4 queens puzzle as the primary example.</p><p>A proposed solution could be:</p><div class="figure"><a id="d0e1780"/><p class="title"><strong>Figure 3.1. A wrong solution for the 4 queens puzzle</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Use_cases_and_examples/partiallySolvedNQueens04Explained.png" align="middle" alt="A wrong solution for the 4 queens puzzle"/></div></div></div><br class="figure-break"/><p>The above solution is wrong because queens <code class="literal">A1</code> and <code class="literal">B0</code> can attack each
        other (so can queens <code class="literal">B0</code> and <code class="literal">D0</code>). Removing queen <code class="literal">B0</code>
        would respect the "no 2 queens can attack each other" constraint, but would break the "place n queens"
        constraint.</p><p>Below is a correct solution:</p><div class="figure"><a id="d0e1805"/><p class="title"><strong>Figure 3.2. A correct solution for the 4 queens puzzle</strong></p><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/Chapter-Use_cases_and_examples/solvedNQueens04.png" align="middle" alt="A correct solution for the 4 queens puzzle"/></div></div></div><br class="figure-break"/><p>All the constraints have been met, so the solution is correct. Note that most n queens puzzles have
        multiple correct solutions. We'll focus on finding a single correct solution for a given n, not on finding the
        number of possible correct solutions for a given n.</p></div><div class="section" title="3.2.1.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="nQueensProblemSize"/>3.2.1.2. Problem size</h4></div></div></div><pre><code class="no-highlight">4queens   has   4 queens with a search space of    256.
8queens   has   8 queens with a search space of   10^7.
16queens  has  16 queens with a search space of  10^19.
32queens  has  32 queens with a search space of  10^48.
64queens  has  64 queens with a search space of 10^115.
256queens has 256 queens with a search space of 10^616.</code></pre><p>The implementation of the N queens example has not been optimized because it functions as a beginner
        example. Nevertheless, it can easily handle 64 queens. With a few changes it has been shown to easily handle
        5000 queens and more.</p></div><div class="section" title="3.2.1.3. Domain model"><div class="titlepage"><div><div><h4 class="title"><a id="nQueensDomainModel"/>3.2.1.3. Domain model</h4></div></div></div><p>Use a good domain model: it will be easier to understand and solve your planning problem. This is the
        domain model for the n queens example:</p><pre><code class="language-java">public class Column {
    
    private int index;

    // ... getters and setters
}</code></pre><pre><code class="language-java">public class Row {
    
    private int index;

    // ... getters and setters
}</code></pre><pre><code class="language-java">public class Queen {
    
    private Column column;
    private Row row;

    public int getAscendingDiagonalIndex() {...}
    public int getDescendingDiagonalIndex() {...}

    // ... getters and setters
}</code></pre><p>A <code class="literal">Queen</code> instance has a <code class="literal">Column</code> (for example: 0 is column A, 1 is
        column B, ...) and a <code class="literal">Row</code> (its row, for example: 0 is row 0, 1 is row 1, ...). Based on the
        column and the row, the ascending diagonal line as well as the descending diagonal line can be calculated. The
        column and row indexes start from the upper left corner of the chessboard.</p><pre><code class="language-java">public class NQueens implements Solution&lt;SimpleScore&gt; {
    
    private int n;
    private List&lt;Column&gt; columnList;
    private List&lt;Row&gt; rowList;

    private List&lt;Queen&gt; queenList;

    private SimpleScore score;

    // ... getters and setters
}</code></pre><p>A single <code class="literal">NQueens</code> instance contains a list of all <code class="literal">Queen</code> instances. It
        is the <code class="literal">Solution</code> implementation which will be supplied to, solved by and retrieved from the
        Solver. Notice that in the 4 queens example, NQueens's <code class="literal">getN()</code> method will always return
        4.</p><div class="table"><a id="d0e1858"/><p class="title"><strong>Table 3.2. A solution for 4 queens shown in the domain model</strong></p><div class="table-contents"><table summary="A solution for 4 queens shown in the domain model" border="1"><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead><tr><th align="center">A solution</th><th align="center">Queen</th><th>columnIndex</th><th>rowIndex</th><th>ascendingDiagonalIndex (columnIndex + rowIndex)</th><th>descendingDiagonalIndex (columnIndex - rowIndex)</th></tr></thead><tbody><tr><td rowspan="4"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/partiallySolvedNQueens04Explained.png"/></div></td><td>A1</td><td>0</td><td>1</td><td><span class="bold"><strong>1 (**)</strong></span></td><td>-1</td></tr><tr><td>B0</td><td>1</td><td><span class="bold"><strong>0 (*)</strong></span></td><td><span class="bold"><strong>1 (**)</strong></span></td><td>1</td></tr><tr><td>C2</td><td>2</td><td>2</td><td>4</td><td>0</td></tr><tr><td>D0</td><td>3</td><td><span class="bold"><strong>0 (*)</strong></span></td><td>3</td><td>3</td></tr></tbody></table></div></div><br class="table-break"/><p>When 2 queens share the same column, row or diagonal line, such as (*) and (**), they can attack each
        other.</p></div></div><div class="section" title="3.2.2. Cloud balancing"><div class="titlepage"><div><div><h3 class="title"><a id="cloudBalancing"/>3.2.2. Cloud balancing</h3></div></div></div><p>This example is explained in <a class="link" href="#cloudBalancingTutorial" title="2.1. Cloud balancing tutorial">a tutorial</a>.</p></div><div class="section" title="3.2.3. Traveling salesman (TSP - Traveling salesman problem)"><div class="titlepage"><div><div><h3 class="title"><a id="tsp"/>3.2.3. Traveling salesman (TSP - Traveling salesman problem)</h3></div></div></div><div class="section" title="3.2.3.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="tspProblemDescription"/>3.2.3.1. Problem description</h4></div></div></div><p>Given a list of cities, find the shortest tour for a salesman that visits each city exactly once.</p><p>The problem is defined by <a class="link" href="http://en.wikipedia.org/wiki/Travelling_salesman_problem">Wikipedia</a>. It is <a class="link" href="http://www.math.uwaterloo.ca/tsp/">one of the most intensively studied problems</a> in
        computational mathematics. Yet, in the real world, it's often only part of a planning problem, along with other
        constraints, such as employee shift rostering constraints.</p></div><div class="section" title="3.2.3.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="tspProblemSize"/>3.2.3.2. Problem size</h4></div></div></div><pre><code class="no-highlight">dj38     has  38 cities with a search space of   10^58.
europe40 has  40 cities with a search space of   10^62.
st70     has  70 cities with a search space of  10^126.
pcb442   has 442 cities with a search space of 10^1166.
lu980    has 980 cities with a search space of 10^2927.</code></pre></div><div class="section" title="3.2.3.3. Problem difficulty"><div class="titlepage"><div><div><h4 class="title"><a id="tspProblemDifficulty"/>3.2.3.3. Problem difficulty</h4></div></div></div><p>Despite TSP's simple definition, the problem is surprisingly hard to solve. Because it's an NP-hard
        problem (like most planning problems), the optimal solution for a specific problem dataset can change a lot when
        that problem dataset is slightly altered:</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/tspOptimalSolutionVolatility.png"/></div></div></div><div class="section" title="3.2.4. Dinner party"><div class="titlepage"><div><div><h3 class="title"><a id="dinnerParty"/>3.2.4. Dinner party</h3></div></div></div><div class="section" title="3.2.4.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="dinnerPartyProblemDescription"/>3.2.4.1. Problem description</h4></div></div></div><p>Miss Manners is throwing another dinner party.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>This time she invited 144 guests and prepared 12 round tables with 12 seats each.</p></li><li class="listitem"><p>Every guest should sit next to someone (left and right) of the opposite gender.</p></li><li class="listitem"><p>And that neighbour should have at least one hobby in common with the guest.</p></li><li class="listitem"><p>At every table, there should be 2 politicians, 2 doctors, 2 socialites, 2 coaches, 2 teachers and 2
            programmers.</p></li><li class="listitem"><p>And the 2 politicians, 2 doctors, 2 coaches and 2 programmers shouldn't be the same kind at a
            table.</p></li></ul></div><p>Drools Expert also has the normal Miss Manners example (which is much smaller) and employs an exhaustive
        heuristic to solve it. Planner's implementation is far more scalable because it uses heuristics to find the
        best solution and Drools Expert to calculate the score of each solution.</p></div><div class="section" title="3.2.4.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="dinnerPartyProblemSize"/>3.2.4.2. Problem size</h4></div></div></div><pre><code class="no-highlight">wedding01 has 18 jobs, 144 guests, 288 hobby practicians, 12 tables and 144 seats with a search space of 10^310.</code></pre></div></div><div class="section" title="3.2.5. Tennis club scheduling"><div class="titlepage"><div><div><h3 class="title"><a id="tennis"/>3.2.5. Tennis club scheduling</h3></div></div></div><div class="section" title="3.2.5.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="tennisProblemDescription"/>3.2.5.1. Problem description</h4></div></div></div><p>Every week the tennis club has 4 teams playing round robin against each other. Assign those 4 spots to the
        teams fairly.</p><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Conflict: A team can only play once per day.</p></li><li class="listitem"><p>Unavailability: Some teams are unavailable on some dates.</p></li></ul></div><p>Medium constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Fair assignment: All teams should play an (almost) equal number of times.</p></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Evenly confrontation: Each team should play against every other team an equal number of times.</p></li></ul></div></div><div class="section" title="3.2.5.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="tennisProblemSize"/>3.2.5.2. Problem size</h4></div></div></div><pre><code class="no-highlight">munich-7teams has 7 teams, 18 days, 12 unavailabilityPenalties and 72 teamAssignments with a search space of 10^60.</code></pre></div><div class="section" title="3.2.5.3. Domain model"><div class="titlepage"><div><div><h4 class="title"><a id="tennisDomainModel"/>3.2.5.3. Domain model</h4></div></div></div><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/tennisClassDiagram.png"/></div></div></div></div><div class="section" title="3.3. Real examples"><div class="titlepage"><div><div><h2 class="title"><a id="realExamples"/>3.3. Real examples</h2></div></div></div><div class="section" title="3.3.1. Course timetabling (ITC 2007 track 3 - Curriculum course scheduling)"><div class="titlepage"><div><div><h3 class="title"><a id="curriculumCourse"/>3.3.1. Course timetabling (ITC 2007 track 3 - Curriculum course scheduling)</h3></div></div></div><div class="section" title="3.3.1.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="curriculumCourseProblemDescription"/>3.3.1.1. Problem description</h4></div></div></div><p>Schedule each lecture into a timeslot and into a room.</p><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Teacher conflict: A teacher must not have 2 lectures in the same period.</p></li><li class="listitem"><p>Curriculum conflict: A curriculum must not have 2 lectures in the same period.</p></li><li class="listitem"><p>Room occupancy: 2 lectures must not be in the same room in the same period.</p></li><li class="listitem"><p>Unavailable period (specified per dataset): A specific lecture must not be assigned to a specific
            period.</p></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Room capacity: A room's capacity should not be less than the number of students in its lecture.</p></li><li class="listitem"><p>Minimum working days: Lectures of the same course should be spread out into a minimum number of
            days.</p></li><li class="listitem"><p>Curriculum compactness: Lectures belonging to the same curriculum should be adjacent to each other (so
            in consecutive periods).</p></li><li class="listitem"><p>Room stability: Lectures of the same course should be assigned the same room.</p></li></ul></div><p>The problem is defined by <a class="link" href="http://www.cs.qub.ac.uk/itc2007/curriculmcourse/course_curriculm_index.htm">the International
        Timetabling Competition 2007 track 3</a>.</p></div><div class="section" title="3.3.1.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="curriculumCourseProblemSize"/>3.3.1.2. Problem size</h4></div></div></div><pre><code class="no-highlight">comp01 has 24 teachers,  14 curricula,  30 courses, 160 lectures, 30 periods,  6 rooms and   53 unavailable period constraints with a search space of  10^360.
comp02 has 71 teachers,  70 curricula,  82 courses, 283 lectures, 25 periods, 16 rooms and  513 unavailable period constraints with a search space of  10^736.
comp03 has 61 teachers,  68 curricula,  72 courses, 251 lectures, 25 periods, 16 rooms and  382 unavailable period constraints with a search space of  10^653.
comp04 has 70 teachers,  57 curricula,  79 courses, 286 lectures, 25 periods, 18 rooms and  396 unavailable period constraints with a search space of  10^758.
comp05 has 47 teachers, 139 curricula,  54 courses, 152 lectures, 36 periods,  9 rooms and  771 unavailable period constraints with a search space of  10^381.
comp06 has 87 teachers,  70 curricula, 108 courses, 361 lectures, 25 periods, 18 rooms and  632 unavailable period constraints with a search space of  10^957.
comp07 has 99 teachers,  77 curricula, 131 courses, 434 lectures, 25 periods, 20 rooms and  667 unavailable period constraints with a search space of 10^1171.
comp08 has 76 teachers,  61 curricula,  86 courses, 324 lectures, 25 periods, 18 rooms and  478 unavailable period constraints with a search space of  10^859.
comp09 has 68 teachers,  75 curricula,  76 courses, 279 lectures, 25 periods, 18 rooms and  405 unavailable period constraints with a search space of  10^740.
comp10 has 88 teachers,  67 curricula, 115 courses, 370 lectures, 25 periods, 18 rooms and  694 unavailable period constraints with a search space of  10^981.
comp11 has 24 teachers,  13 curricula,  30 courses, 162 lectures, 45 periods,  5 rooms and   94 unavailable period constraints with a search space of  10^381.
comp12 has 74 teachers, 150 curricula,  88 courses, 218 lectures, 36 periods, 11 rooms and 1368 unavailable period constraints with a search space of  10^566.
comp13 has 77 teachers,  66 curricula,  82 courses, 308 lectures, 25 periods, 19 rooms and  468 unavailable period constraints with a search space of  10^824.
comp14 has 68 teachers,  60 curricula,  85 courses, 275 lectures, 25 periods, 17 rooms and  486 unavailable period constraints with a search space of  10^722.</code></pre></div><div class="section" title="3.3.1.3. Domain model"><div class="titlepage"><div><div><h4 class="title"><a id="curriculumCourseDomainModel"/>3.3.1.3. Domain model</h4></div></div></div><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/curriculumCourseClassDiagram.png"/></div></div></div><div class="section" title="3.3.2. Machine reassignment (Google ROADEF 2012)"><div class="titlepage"><div><div><h3 class="title"><a id="machineReassignment"/>3.3.2. Machine reassignment (Google ROADEF 2012)</h3></div></div></div><div class="section" title="3.3.2.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="machineReassignmentProblemDescription"/>3.3.2.1. Problem description</h4></div></div></div><p>Assign each process to a machine. All processes already have an original (unoptimized) assignment. Each
        process requires an amount of each resource (such as CPU, RAM, ...). This is a more complex version of the Cloud
        Balancing example.</p><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Maximum capacity: The maximum capacity for each resource for each machine must not be exceeded.</p></li><li class="listitem"><p>Conflict: Processes of the same service must run on distinct machines.</p></li><li class="listitem"><p>Spread: Processes of the same service must be spread out across locations.</p></li><li class="listitem"><p>Dependency: The processes of a service depending on another service must run in the neighborhood of a
            process of the other service.</p></li><li class="listitem"><p>Transient usage: Some resources are transient and count towards the maximum capacity of both the
            original machine as the newly assigned machine.</p></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Load: The safety capacity for each resource for each machine should not be exceeded.</p></li><li class="listitem"><p>Balance: Leave room for future assignments by balancing the available resources on each
            machine.</p></li><li class="listitem"><p>Process move cost: A process has a move cost.</p></li><li class="listitem"><p>Service move cost: A service has a move cost.</p></li><li class="listitem"><p>Machine move cost: Moving a process from machine A to machine B has another A-B specific move
            cost.</p></li></ul></div><p>The problem is defined by <a class="link" href="http://challenge.roadef.org/2012/en/">the Google ROADEF/EURO
        Challenge 2012</a>.</p></div><div class="section" title="3.3.2.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="machineReassignmentProblemSize"/>3.3.2.2. Problem size</h4></div></div></div><pre><code class="no-highlight">model_a1_1 has  2 resources,  1 neighborhoods,   4 locations,    4 machines,    79 services,   100 processes and 1 balancePenalties with a search space of     10^60.
model_a1_2 has  4 resources,  2 neighborhoods,   4 locations,  100 machines,   980 services,  1000 processes and 0 balancePenalties with a search space of   10^2000.
model_a1_3 has  3 resources,  5 neighborhoods,  25 locations,  100 machines,   216 services,  1000 processes and 0 balancePenalties with a search space of   10^2000.
model_a1_4 has  3 resources, 50 neighborhoods,  50 locations,   50 machines,   142 services,  1000 processes and 1 balancePenalties with a search space of   10^1698.
model_a1_5 has  4 resources,  2 neighborhoods,   4 locations,   12 machines,   981 services,  1000 processes and 1 balancePenalties with a search space of   10^1079.
model_a2_1 has  3 resources,  1 neighborhoods,   1 locations,  100 machines,  1000 services,  1000 processes and 0 balancePenalties with a search space of   10^2000.
model_a2_2 has 12 resources,  5 neighborhoods,  25 locations,  100 machines,   170 services,  1000 processes and 0 balancePenalties with a search space of   10^2000.
model_a2_3 has 12 resources,  5 neighborhoods,  25 locations,  100 machines,   129 services,  1000 processes and 0 balancePenalties with a search space of   10^2000.
model_a2_4 has 12 resources,  5 neighborhoods,  25 locations,   50 machines,   180 services,  1000 processes and 1 balancePenalties with a search space of   10^1698.
model_a2_5 has 12 resources,  5 neighborhoods,  25 locations,   50 machines,   153 services,  1000 processes and 0 balancePenalties with a search space of   10^1698.
model_b_1  has 12 resources,  5 neighborhoods,  10 locations,  100 machines,  2512 services,  5000 processes and 0 balancePenalties with a search space of  10^10000.
model_b_2  has 12 resources,  5 neighborhoods,  10 locations,  100 machines,  2462 services,  5000 processes and 1 balancePenalties with a search space of  10^10000.
model_b_3  has  6 resources,  5 neighborhoods,  10 locations,  100 machines, 15025 services, 20000 processes and 0 balancePenalties with a search space of  10^40000.
model_b_4  has  6 resources,  5 neighborhoods,  50 locations,  500 machines,  1732 services, 20000 processes and 1 balancePenalties with a search space of  10^53979.
model_b_5  has  6 resources,  5 neighborhoods,  10 locations,  100 machines, 35082 services, 40000 processes and 0 balancePenalties with a search space of  10^80000.
model_b_6  has  6 resources,  5 neighborhoods,  50 locations,  200 machines, 14680 services, 40000 processes and 1 balancePenalties with a search space of  10^92041.
model_b_7  has  6 resources,  5 neighborhoods,  50 locations, 4000 machines, 15050 services, 40000 processes and 1 balancePenalties with a search space of 10^144082.
model_b_8  has  3 resources,  5 neighborhoods,  10 locations,  100 machines, 45030 services, 50000 processes and 0 balancePenalties with a search space of 10^100000.
model_b_9  has  3 resources,  5 neighborhoods, 100 locations, 1000 machines,  4609 services, 50000 processes and 1 balancePenalties with a search space of 10^150000.
model_b_10 has  3 resources,  5 neighborhoods, 100 locations, 5000 machines,  4896 services, 50000 processes and 1 balancePenalties with a search space of 10^184948.</code></pre></div><div class="section" title="3.3.2.3. Domain model"><div class="titlepage"><div><div><h4 class="title"><a id="machineReassignmentDomainModel"/>3.3.2.3. Domain model</h4></div></div></div><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/machineReassignmentClassDiagram.png"/></div></div></div><div class="section" title="3.3.3. Vehicle routing"><div class="titlepage"><div><div><h3 class="title"><a id="vehicleRouting"/>3.3.3. Vehicle routing</h3></div></div></div><div class="section" title="3.3.3.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="vehicleRoutingProblemDescription"/>3.3.3.1. Problem description</h4></div></div></div><p>Using a fleet of vehicles, pick up the objects of each customer and bring them to the depot. Each vehicle
        can service multiple customers, but it has a limited capacity.</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/vehicleRoutingUseCase.png"/></div><p>Besides the basic case (CVRP), there is also a variant with time windows (CVRPTW).</p><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Vehicle capacity: a vehicle cannot carry more items then its capacity.</p></li><li class="listitem"><p>Time windows (only in CVRPTW):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Travel time: Traveling from one location to another takes time.</p></li><li class="listitem"><p>Customer service duration: a vehicle must stay at the customer for the length of the service
                duration.</p></li><li class="listitem"><p>Customer ready time: a vehicle may arrive before the customer's ready time, but it must wait until
                the ready time before servicing.</p></li><li class="listitem"><p>Customer due time: a vehicle must arrive on time, before the customer's due time.</p></li></ul></div></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Total distance: minimize the total distance driven (fuel consumption) of all vehicles.</p></li></ul></div><p>The capacitated vehicle routing problem (CVRP) and its timewindowed variant (CVRPTW) are defined by <a class="link" href="http://neo.lcc.uma.es/vrp/">the VRP web</a>.</p></div><div class="section" title="3.3.3.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="vehicleRoutingProblemSize"/>3.3.3.2. Problem size</h4></div></div></div><p>CVRP instances (without time windows):</p><pre><code class="no-highlight">A-n32-k5  has 1 depots,  5 vehicles and  31 customers with a search space of  10^46.
A-n33-k5  has 1 depots,  5 vehicles and  32 customers with a search space of  10^48.
A-n33-k6  has 1 depots,  6 vehicles and  32 customers with a search space of  10^48.
A-n34-k5  has 1 depots,  5 vehicles and  33 customers with a search space of  10^50.
A-n36-k5  has 1 depots,  5 vehicles and  35 customers with a search space of  10^54.
A-n37-k5  has 1 depots,  5 vehicles and  36 customers with a search space of  10^56.
A-n37-k6  has 1 depots,  6 vehicles and  36 customers with a search space of  10^56.
A-n38-k5  has 1 depots,  5 vehicles and  37 customers with a search space of  10^58.
A-n39-k5  has 1 depots,  5 vehicles and  38 customers with a search space of  10^60.
A-n39-k6  has 1 depots,  6 vehicles and  38 customers with a search space of  10^60.
A-n44-k7  has 1 depots,  7 vehicles and  43 customers with a search space of  10^70.
A-n45-k6  has 1 depots,  6 vehicles and  44 customers with a search space of  10^72.
A-n45-k7  has 1 depots,  7 vehicles and  44 customers with a search space of  10^72.
A-n46-k7  has 1 depots,  7 vehicles and  45 customers with a search space of  10^74.
A-n48-k7  has 1 depots,  7 vehicles and  47 customers with a search space of  10^78.
A-n53-k7  has 1 depots,  7 vehicles and  52 customers with a search space of  10^89.
A-n54-k7  has 1 depots,  7 vehicles and  53 customers with a search space of  10^91.
A-n55-k9  has 1 depots,  9 vehicles and  54 customers with a search space of  10^93.
A-n60-k9  has 1 depots,  9 vehicles and  59 customers with a search space of 10^104.
A-n61-k9  has 1 depots,  9 vehicles and  60 customers with a search space of 10^106.
A-n62-k8  has 1 depots,  8 vehicles and  61 customers with a search space of 10^108.
A-n63-k10 has 1 depots, 10 vehicles and  62 customers with a search space of 10^111.
A-n63-k9  has 1 depots,  9 vehicles and  62 customers with a search space of 10^111.
A-n64-k9  has 1 depots,  9 vehicles and  63 customers with a search space of 10^113.
A-n65-k9  has 1 depots,  9 vehicles and  64 customers with a search space of 10^115.
A-n69-k9  has 1 depots,  9 vehicles and  68 customers with a search space of 10^124.
A-n80-k10 has 1 depots, 10 vehicles and  79 customers with a search space of 10^149.
F-n135-k7 has 1 depots,  7 vehicles and 134 customers with a search space of 10^285.
F-n45-k4  has 1 depots,  4 vehicles and  44 customers with a search space of  10^72.
F-n72-k4  has 1 depots,  4 vehicles and  71 customers with a search space of 10^131.</code></pre><p>CVRPTW instances (with time windows):</p><pre><code class="no-highlight">Solomon_025_C101       has 1 depots,  25 vehicles and   25 customers with a search space of   10^34.
Solomon_025_C201       has 1 depots,  25 vehicles and   25 customers with a search space of   10^34.
Solomon_025_R101       has 1 depots,  25 vehicles and   25 customers with a search space of   10^34.
Solomon_025_R201       has 1 depots,  25 vehicles and   25 customers with a search space of   10^34.
Solomon_025_RC101      has 1 depots,  25 vehicles and   25 customers with a search space of   10^34.
Solomon_025_RC201      has 1 depots,  25 vehicles and   25 customers with a search space of   10^34.
Solomon_100_C101       has 1 depots,  25 vehicles and  100 customers with a search space of  10^200.
Solomon_100_C201       has 1 depots,  25 vehicles and  100 customers with a search space of  10^200.
Solomon_100_R101       has 1 depots,  25 vehicles and  100 customers with a search space of  10^200.
Solomon_100_R201       has 1 depots,  25 vehicles and  100 customers with a search space of  10^200.
Solomon_100_RC101      has 1 depots,  25 vehicles and  100 customers with a search space of  10^200.
Solomon_100_RC201      has 1 depots,  25 vehicles and  100 customers with a search space of  10^200.
Homberger_0200_C1_2_1  has 1 depots,  50 vehicles and  200 customers with a search space of  10^460.
Homberger_0200_C2_2_1  has 1 depots,  50 vehicles and  200 customers with a search space of  10^460.
Homberger_0200_R1_2_1  has 1 depots,  50 vehicles and  200 customers with a search space of  10^460.
Homberger_0200_R2_2_1  has 1 depots,  50 vehicles and  200 customers with a search space of  10^460.
Homberger_0200_RC1_2_1 has 1 depots,  50 vehicles and  200 customers with a search space of  10^460.
Homberger_0200_RC2_2_1 has 1 depots,  50 vehicles and  200 customers with a search space of  10^460.
Homberger_0400_C1_4_1  has 1 depots, 100 vehicles and  400 customers with a search space of 10^1040.
Homberger_0400_C2_4_1  has 1 depots, 100 vehicles and  400 customers with a search space of 10^1040.
Homberger_0400_R1_4_1  has 1 depots, 100 vehicles and  400 customers with a search space of 10^1040.
Homberger_0400_R2_4_1  has 1 depots, 100 vehicles and  400 customers with a search space of 10^1040.
Homberger_0400_RC1_4_1 has 1 depots, 100 vehicles and  400 customers with a search space of 10^1040.
Homberger_0400_RC2_4_1 has 1 depots, 100 vehicles and  400 customers with a search space of 10^1040.
Homberger_0600_C1_6_1  has 1 depots, 150 vehicles and  600 customers with a search space of 10^1666.
Homberger_0600_C2_6_1  has 1 depots, 150 vehicles and  600 customers with a search space of 10^1666.
Homberger_0600_R1_6_1  has 1 depots, 150 vehicles and  600 customers with a search space of 10^1666.
Homberger_0600_R2_6_1  has 1 depots, 150 vehicles and  600 customers with a search space of 10^1666.
Homberger_0600_RC1_6_1 has 1 depots, 150 vehicles and  600 customers with a search space of 10^1666.
Homberger_0600_RC2_6_1 has 1 depots, 150 vehicles and  600 customers with a search space of 10^1666.
Homberger_0800_C1_8_1  has 1 depots, 200 vehicles and  800 customers with a search space of 10^2322.
Homberger_0800_C2_8_1  has 1 depots, 200 vehicles and  800 customers with a search space of 10^2322.
Homberger_0800_R1_8_1  has 1 depots, 200 vehicles and  800 customers with a search space of 10^2322.
Homberger_0800_R2_8_1  has 1 depots, 200 vehicles and  800 customers with a search space of 10^2322.
Homberger_0800_RC1_8_1 has 1 depots, 200 vehicles and  800 customers with a search space of 10^2322.
Homberger_0800_RC2_8_1 has 1 depots, 200 vehicles and  800 customers with a search space of 10^2322.
Homberger_1000_C110_1  has 1 depots, 250 vehicles and 1000 customers with a search space of 10^3000.
Homberger_1000_C210_1  has 1 depots, 250 vehicles and 1000 customers with a search space of 10^3000.
Homberger_1000_R110_1  has 1 depots, 250 vehicles and 1000 customers with a search space of 10^3000.
Homberger_1000_R210_1  has 1 depots, 250 vehicles and 1000 customers with a search space of 10^3000.
Homberger_1000_RC110_1 has 1 depots, 250 vehicles and 1000 customers with a search space of 10^3000.
Homberger_1000_RC210_1 has 1 depots, 250 vehicles and 1000 customers with a search space of 10^3000.</code></pre></div><div class="section" title="3.3.3.3. Domain model"><div class="titlepage"><div><div><h4 class="title"><a id="vehicleRoutingDomainModel"/>3.3.3.3. Domain model</h4></div></div></div><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/vehicleRoutingClassDiagram.png"/></div><p>The vehicle routing with timewindows domain model makes heavily use of <a class="link" href="#shadowVariable" title="4.3.6. Shadow variable">shadow variables</a>. This allows it to express its constraints more
        naturally, because properties such as <code class="literal">arrivalTime</code> and <code class="literal">departureTime</code>, are
        directly available on the domain model.</p></div><div class="section" title="3.3.3.4. Road distances instead of air distances"><div class="titlepage"><div><div><h4 class="title"><a id="roadDistancesInsteadOfAirDistances"/>3.3.3.4. Road distances instead of air distances</h4></div></div></div><p>In the real world, vehicles can't follow a straight line from location to location: they have to use roads
        and highways. From a business point of view, this matters a lot:</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/vehicleRoutingDistanceType.png"/></div><p>For the optimization algorithm, this doesn't matter much, as long as the distance between 2 points can be
        looked up (and are preferably precalculated). The road cost doesn't even need to be a distance, it can also be
        travel time, fuel cost, or a weighted function of those. There are several Google Maps like technologies
        available to precalculate road costs, such as <a class="link" href="https://graphhopper.com/">GraphHopper</a>
        (embeddable, offline Java engine) and <a class="link" href="http://open.mapquestapi.com/directions/#matrix">Open
        MapQuest</a> (web service). There are also several technologies to render it, such as <a class="link" href="http://leafletjs.com">Leaflet</a>.</p><p>Take special care that the road costs between 2 points use the same optimization criteria as the one used
        in Planner. For example, GraphHopper etc will by default return the fastest route, not the shortest route.
        Don't use the km (or miles) distances of the fastest GPS routes to optimize the shortest trip in Planner:
        this leads to a suboptimal solution as shown below:</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/roadDistanceTriangleInequality.png"/></div><p>Contrary to popular belief, most users don't want the shortest route: they want the fastest route instead.
        They prefer highways over normal roads. They prefer normal roads over dirt roads. In the real world, the fastest
        and shortest route are rarely the same.</p></div></div><div class="section" title="3.3.4. Project job scheduling"><div class="titlepage"><div><div><h3 class="title"><a id="projectJobScheduling"/>3.3.4. Project job scheduling</h3></div></div></div><div class="section" title="3.3.4.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="projectJobSchedulingProblemDescription"/>3.3.4.1. Problem description</h4></div></div></div><p>Schedule all jobs in time and execution mode to minimize project delays. Each job is part of a project. A
        job can be executed in different ways: each way is an execution mode that implies a different duration but also
        different resource usages. This is a form of flexible <span class="emphasis"><em>job shop scheduling</em></span>.</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/projectJobSchedulingUseCase.png"/></div><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Job precedence: a job can only start when all its predecessor jobs are finished.</p></li><li class="listitem"><p>Resource capacity: do not use more resources then available.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Resources are local (shared between jobs of the same project) or global (shared between all
                jobs)</p></li><li class="listitem"><p>Resource are renewable (capacity available per day) or nonrenewable (capacity available for all
                days)</p></li></ul></div></li></ul></div><p>Medium constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Total project delay: minimize the duration (makespan) of each project.</p></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Total makespan: minimize the duration of the whole multi-project schedule.</p></li></ul></div><p>The problem is defined by <a class="link" href="http://allserv.kahosl.be/mista2013challenge/">the MISTA 2013
        challenge</a>.</p></div><div class="section" title="3.3.4.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="projectJobSchedulingProblemSize"/>3.3.4.2. Problem size</h4></div></div></div><pre><code class="no-highlight">Schedule A-1  has  2 projects,  24 jobs,   64 execution modes,  7 resources and  150 resource requirements.
Schedule A-2  has  2 projects,  44 jobs,  124 execution modes,  7 resources and  420 resource requirements.
Schedule A-3  has  2 projects,  64 jobs,  184 execution modes,  7 resources and  630 resource requirements.
Schedule A-4  has  5 projects,  60 jobs,  160 execution modes, 16 resources and  390 resource requirements.
Schedule A-5  has  5 projects, 110 jobs,  310 execution modes, 16 resources and  900 resource requirements.
Schedule A-6  has  5 projects, 160 jobs,  460 execution modes, 16 resources and 1440 resource requirements.
Schedule A-7  has 10 projects, 120 jobs,  320 execution modes, 22 resources and  900 resource requirements.
Schedule A-8  has 10 projects, 220 jobs,  620 execution modes, 22 resources and 1860 resource requirements.
Schedule A-9  has 10 projects, 320 jobs,  920 execution modes, 31 resources and 2880 resource requirements.
Schedule A-10 has 10 projects, 320 jobs,  920 execution modes, 31 resources and 2970 resource requirements.
Schedule B-1  has 10 projects, 120 jobs,  320 execution modes, 31 resources and  900 resource requirements.
Schedule B-2  has 10 projects, 220 jobs,  620 execution modes, 22 resources and 1740 resource requirements.
Schedule B-3  has 10 projects, 320 jobs,  920 execution modes, 31 resources and 3060 resource requirements.
Schedule B-4  has 15 projects, 180 jobs,  480 execution modes, 46 resources and 1530 resource requirements.
Schedule B-5  has 15 projects, 330 jobs,  930 execution modes, 46 resources and 2760 resource requirements.
Schedule B-6  has 15 projects, 480 jobs, 1380 execution modes, 46 resources and 4500 resource requirements.
Schedule B-7  has 20 projects, 240 jobs,  640 execution modes, 61 resources and 1710 resource requirements.
Schedule B-8  has 20 projects, 440 jobs, 1240 execution modes, 42 resources and 3180 resource requirements.
Schedule B-9  has 20 projects, 640 jobs, 1840 execution modes, 61 resources and 5940 resource requirements.
Schedule B-10 has 20 projects, 460 jobs, 1300 execution modes, 42 resources and 4260 resource requirements.</code></pre></div></div><div class="section" title="3.3.5. Hospital bed planning (PAS - Patient admission scheduling)"><div class="titlepage"><div><div><h3 class="title"><a id="bedAllocation"/>3.3.5. Hospital bed planning (PAS - Patient admission scheduling)</h3></div></div></div><div class="section" title="3.3.5.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="bedAllocationProblemDescription"/>3.3.5.1. Problem description</h4></div></div></div><p>Assign each patient (that will come to the hospital) into a bed for each night that the patient will stay
        in the hospital. Each bed belongs to a room and each room belongs to a department. The arrival and departure
        dates of the patients is fixed: only a bed needs to be assigned for each night.</p><p>This problem features <span class="emphasis"><em>overconstrained</em></span> datasets.</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/patientAdmissionScheduleUseCase.png"/></div><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>2 patients must not be assigned to the same bed in the same night. Weight: <code class="literal">-1000hard *
            conflictNightCount</code>.</p></li><li class="listitem"><p>A room can have a gender limitation: only females, only males, the same gender in the same night or no
            gender limitation at all. Weight: <code class="literal">-50hard * nightCount</code>.</p></li><li class="listitem"><p>A department can have a minimum or maximum age. Weight: <code class="literal">-100hard *
            nightCount</code>.</p></li><li class="listitem"><p>A patient can require a room with specific equipment(s). Weight: <code class="literal">-50hard *
            nightCount</code>.</p></li></ul></div><p>Medium constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Assign every patient to a bed, unless the dataset is overconstrained. Weight: <code class="literal">-1medium *
            nightCount</code>.</p></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A patient can prefer a maximum room size, for example if he/she wants a single room. Weight:
            <code class="literal">-8soft * nightCount</code>.</p></li><li class="listitem"><p>A patient is best assigned to a department that specializes in his/her problem. Weight:
            <code class="literal">-10soft * nightCount</code>.</p></li><li class="listitem"><p>A patient is best assigned to a room that specializes in his/her problem. Weight: <code class="literal">-20soft *
            nightCount</code>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>That room speciality should be priority 1. Weight: <code class="literal">-10soft * (priority - 1) *
                nightCount</code>.</p></li></ul></div></li><li class="listitem"><p>A patient can prefer a room with specific equipment(s). Weight: <code class="literal">-20soft *
            nightCount</code>.</p></li></ul></div><p>The problem is a variant on <a class="link" href="http://allserv.kahosl.be/~peter/pas/">Kaho's Patient
        Scheduling</a> and the datasets come from real world hospitals.</p></div><div class="section" title="3.3.5.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="bedAllocationProblemSize"/>3.3.5.2. Problem size</h4></div></div></div><pre><code class="no-highlight">testdata01 has 4 specialisms, 2 equipments, 4 departments,  98 rooms, 286 beds, 14 nights,  652 patients and  652 admissions with a search space of 10^1601.
testdata02 has 6 specialisms, 2 equipments, 6 departments, 151 rooms, 465 beds, 14 nights,  755 patients and  755 admissions with a search space of 10^2013.
testdata03 has 5 specialisms, 2 equipments, 5 departments, 131 rooms, 395 beds, 14 nights,  708 patients and  708 admissions with a search space of 10^1838.
testdata04 has 6 specialisms, 2 equipments, 6 departments, 155 rooms, 471 beds, 14 nights,  746 patients and  746 admissions with a search space of 10^1994.
testdata05 has 4 specialisms, 2 equipments, 4 departments, 102 rooms, 325 beds, 14 nights,  587 patients and  587 admissions with a search space of 10^1474.
testdata06 has 4 specialisms, 2 equipments, 4 departments, 104 rooms, 313 beds, 14 nights,  685 patients and  685 admissions with a search space of 10^1709.
testdata07 has 6 specialisms, 4 equipments, 6 departments, 162 rooms, 472 beds, 14 nights,  519 patients and  519 admissions with a search space of 10^1387.
testdata08 has 6 specialisms, 4 equipments, 6 departments, 148 rooms, 441 beds, 21 nights,  895 patients and  895 admissions with a search space of 10^2366.
testdata09 has 4 specialisms, 4 equipments, 4 departments, 105 rooms, 310 beds, 28 nights, 1400 patients and 1400 admissions with a search space of 10^3487.
testdata10 has 4 specialisms, 4 equipments, 4 departments, 104 rooms, 308 beds, 56 nights, 1575 patients and 1575 admissions with a search space of 10^3919.
testdata11 has 4 specialisms, 4 equipments, 4 departments, 107 rooms, 318 beds, 91 nights, 2514 patients and 2514 admissions with a search space of 10^6291.
testdata12 has 4 specialisms, 4 equipments, 4 departments, 105 rooms, 310 beds, 84 nights, 2750 patients and 2750 admissions with a search space of 10^6851.
testdata13 has 5 specialisms, 4 equipments, 5 departments, 125 rooms, 368 beds, 28 nights,  907 patients and 1109 admissions with a search space of 10^2845.</code></pre></div></div></div><div class="section" title="3.4. Difficult examples"><div class="titlepage"><div><div><h2 class="title"><a id="difficultExamples"/>3.4. Difficult examples</h2></div></div></div><div class="section" title="3.4.1. Exam timetabling (ITC 2007 track 1 - Examination)"><div class="titlepage"><div><div><h3 class="title"><a id="examination"/>3.4.1. Exam timetabling (ITC 2007 track 1 - Examination)</h3></div></div></div><div class="section" title="3.4.1.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="examinationProblemDescription"/>3.4.1.1. Problem description</h4></div></div></div><p>Schedule each exam into a period and into a room. Multiple exams can share the same room during the same
        period.</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/examinationTimetablingUseCase.png"/></div><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Exam conflict: 2 exams that share students must not occur in the same period.</p></li><li class="listitem"><p>Room capacity: A room's seating capacity must suffice at all times.</p></li><li class="listitem"><p>Period duration: A period's duration must suffice for all of its exams.</p></li><li class="listitem"><p>Period related hard constraints (specified per dataset):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Coincidence: 2 specified exams must use the same period (but possibly another room).</p></li><li class="listitem"><p>Exclusion: 2 specified exams must not use the same period.</p></li><li class="listitem"><p>After: A specified exam must occur in a period after another specified exam's period.</p></li></ul></div></li><li class="listitem"><p>Room related hard constraints (specified per dataset):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Exclusive: 1 specified exam should not have to share its room with any other exam.</p></li></ul></div></li></ul></div><p>Soft constraints (each of which has a parametrized penalty):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The same student should not have 2 exams in a row.</p></li><li class="listitem"><p>The same student should not have 2 exams on the same day.</p></li><li class="listitem"><p>Period spread: 2 exams that share students should be a number of periods apart.</p></li><li class="listitem"><p>Mixed durations: 2 exams that share a room should not have different durations.</p></li><li class="listitem"><p>Front load: Large exams should be scheduled earlier in the schedule.</p></li><li class="listitem"><p>Period penalty (specified per dataset): Some periods have a penalty when used.</p></li><li class="listitem"><p>Room penalty (specified per dataset): Some rooms have a penalty when used.</p></li></ul></div><p>It uses large test data sets of real-life universities.</p><p>The problem is defined by <a class="link" href="http://www.cs.qub.ac.uk/itc2007/examtrack/exam_track_index.htm">the International Timetabling
        Competition 2007 track 1</a>. Geoffrey De Smet finished 4th in that competition with a very early version of
        Planner. Many improvements have been made since then.</p></div><div class="section" title="3.4.1.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="examinationProblemSize"/>3.4.1.2. Problem size</h4></div></div></div><pre><code class="no-highlight">exam_comp_set1 has  7883 students,  607 exams, 54 periods,  7 rooms,  12 period constraints and  0 room constraints with a search space of 10^1564.
exam_comp_set2 has 12484 students,  870 exams, 40 periods, 49 rooms,  12 period constraints and  2 room constraints with a search space of 10^2864.
exam_comp_set3 has 16365 students,  934 exams, 36 periods, 48 rooms, 168 period constraints and 15 room constraints with a search space of 10^3023.
exam_comp_set4 has  4421 students,  273 exams, 21 periods,  1 rooms,  40 period constraints and  0 room constraints with a search space of  10^360.
exam_comp_set5 has  8719 students, 1018 exams, 42 periods,  3 rooms,  27 period constraints and  0 room constraints with a search space of 10^2138.
exam_comp_set6 has  7909 students,  242 exams, 16 periods,  8 rooms,  22 period constraints and  0 room constraints with a search space of  10^509.
exam_comp_set7 has 13795 students, 1096 exams, 80 periods, 15 rooms,  28 period constraints and  0 room constraints with a search space of 10^3374.
exam_comp_set8 has  7718 students,  598 exams, 80 periods,  8 rooms,  20 period constraints and  1 room constraints with a search space of 10^1678.</code></pre></div><div class="section" title="3.4.1.3. Domain model"><div class="titlepage"><div><div><h4 class="title"><a id="examinationDomainModel"/>3.4.1.3. Domain model</h4></div></div></div><p>Below you can see the main examination domain classes:</p><div class="figure"><a id="d0e2491"/><p class="title"><strong>Figure 3.3. Examination domain class diagram</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/examinationDomainDiagram.png" alt="Examination domain class diagram"/></div></div></div><br class="figure-break"/><p>Notice that we've split up the exam concept into an <code class="literal">Exam</code> class and a
        <code class="literal">Topic</code> class. The <code class="literal">Exam</code> instances change during solving (this is the
        planning entity class), when their period or room property changes. The <code class="literal">Topic</code>,
        <code class="literal">Period</code> and <code class="literal">Room</code> instances never change during solving (these are problem
        facts, just like some other classes).</p></div></div><div class="section" title="3.4.2. Employee rostering (INRC 2010 - Nurse rostering)"><div class="titlepage"><div><div><h3 class="title"><a id="employeeRostering"/>3.4.2. Employee rostering (INRC 2010 - Nurse rostering)</h3></div></div></div><div class="section" title="3.4.2.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="employeeRosteringProblemDescription"/>3.4.2.1. Problem description</h4></div></div></div><p>For each shift, assign a nurse to work that shift.</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/employeeShiftRosteringUseCase.png"/></div><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/employeeShiftRosteringHardConstraints.png"/></div><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/employeeShiftRosteringSoftConstraints.png"/></div><p>The problem is defined by <a class="link" href="http://www.kuleuven-kortrijk.be/nrpcompetition">the
        International Nurse Rostering Competition 2010</a>.</p></div><div class="section" title="3.4.2.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="employeeRosteringProblemSize"/>3.4.2.2. Problem size</h4></div></div></div><p>There are 3 dataset types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>sprint: must be solved in seconds.</p></li><li class="listitem"><p>medium: must be solved in minutes.</p></li><li class="listitem"><p>long: must be solved in hours.</p></li></ul></div><pre><code class="no-highlight">toy1          has 1 skills, 3 shiftTypes, 2 patterns, 1 contracts,  6 employees,  7 shiftDates,  35 shiftAssignments and   0 requests with a search space of   10^27.
toy2          has 1 skills, 3 shiftTypes, 3 patterns, 2 contracts, 20 employees, 28 shiftDates, 180 shiftAssignments and 140 requests with a search space of  10^234.

sprint01      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint02      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint03      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint04      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint05      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint06      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint07      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint08      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint09      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint10      has 1 skills, 4 shiftTypes, 3 patterns, 4 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_hint01 has 1 skills, 4 shiftTypes, 8 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_hint02 has 1 skills, 4 shiftTypes, 0 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_hint03 has 1 skills, 4 shiftTypes, 8 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_late01 has 1 skills, 4 shiftTypes, 8 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_late02 has 1 skills, 3 shiftTypes, 4 patterns, 3 contracts, 10 employees, 28 shiftDates, 144 shiftAssignments and 139 requests with a search space of  10^144.
sprint_late03 has 1 skills, 4 shiftTypes, 8 patterns, 3 contracts, 10 employees, 28 shiftDates, 160 shiftAssignments and 150 requests with a search space of  10^160.
sprint_late04 has 1 skills, 4 shiftTypes, 8 patterns, 3 contracts, 10 employees, 28 shiftDates, 160 shiftAssignments and 150 requests with a search space of  10^160.
sprint_late05 has 1 skills, 4 shiftTypes, 8 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_late06 has 1 skills, 4 shiftTypes, 0 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_late07 has 1 skills, 4 shiftTypes, 0 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.
sprint_late08 has 1 skills, 4 shiftTypes, 0 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and   0 requests with a search space of  10^152.
sprint_late09 has 1 skills, 4 shiftTypes, 0 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and   0 requests with a search space of  10^152.
sprint_late10 has 1 skills, 4 shiftTypes, 0 patterns, 3 contracts, 10 employees, 28 shiftDates, 152 shiftAssignments and 150 requests with a search space of  10^152.

medium01      has 1 skills, 4 shiftTypes, 0 patterns, 4 contracts, 31 employees, 28 shiftDates, 608 shiftAssignments and 403 requests with a search space of  10^906.
medium02      has 1 skills, 4 shiftTypes, 0 patterns, 4 contracts, 31 employees, 28 shiftDates, 608 shiftAssignments and 403 requests with a search space of  10^906.
medium03      has 1 skills, 4 shiftTypes, 0 patterns, 4 contracts, 31 employees, 28 shiftDates, 608 shiftAssignments and 403 requests with a search space of  10^906.
medium04      has 1 skills, 4 shiftTypes, 0 patterns, 4 contracts, 31 employees, 28 shiftDates, 608 shiftAssignments and 403 requests with a search space of  10^906.
medium05      has 1 skills, 4 shiftTypes, 0 patterns, 4 contracts, 31 employees, 28 shiftDates, 608 shiftAssignments and 403 requests with a search space of  10^906.
medium_hint01 has 1 skills, 4 shiftTypes, 7 patterns, 4 contracts, 30 employees, 28 shiftDates, 428 shiftAssignments and 390 requests with a search space of  10^632.
medium_hint02 has 1 skills, 4 shiftTypes, 7 patterns, 3 contracts, 30 employees, 28 shiftDates, 428 shiftAssignments and 390 requests with a search space of  10^632.
medium_hint03 has 1 skills, 4 shiftTypes, 7 patterns, 4 contracts, 30 employees, 28 shiftDates, 428 shiftAssignments and 390 requests with a search space of  10^632.
medium_late01 has 1 skills, 4 shiftTypes, 7 patterns, 4 contracts, 30 employees, 28 shiftDates, 424 shiftAssignments and 390 requests with a search space of  10^626.
medium_late02 has 1 skills, 4 shiftTypes, 7 patterns, 3 contracts, 30 employees, 28 shiftDates, 428 shiftAssignments and 390 requests with a search space of  10^632.
medium_late03 has 1 skills, 4 shiftTypes, 0 patterns, 4 contracts, 30 employees, 28 shiftDates, 428 shiftAssignments and 390 requests with a search space of  10^632.
medium_late04 has 1 skills, 4 shiftTypes, 7 patterns, 3 contracts, 30 employees, 28 shiftDates, 416 shiftAssignments and 390 requests with a search space of  10^614.
medium_late05 has 2 skills, 5 shiftTypes, 7 patterns, 4 contracts, 30 employees, 28 shiftDates, 452 shiftAssignments and 390 requests with a search space of  10^667.

long01        has 2 skills, 5 shiftTypes, 3 patterns, 3 contracts, 49 employees, 28 shiftDates, 740 shiftAssignments and 735 requests with a search space of 10^1250.
long02        has 2 skills, 5 shiftTypes, 3 patterns, 3 contracts, 49 employees, 28 shiftDates, 740 shiftAssignments and 735 requests with a search space of 10^1250.
long03        has 2 skills, 5 shiftTypes, 3 patterns, 3 contracts, 49 employees, 28 shiftDates, 740 shiftAssignments and 735 requests with a search space of 10^1250.
long04        has 2 skills, 5 shiftTypes, 3 patterns, 3 contracts, 49 employees, 28 shiftDates, 740 shiftAssignments and 735 requests with a search space of 10^1250.
long05        has 2 skills, 5 shiftTypes, 3 patterns, 3 contracts, 49 employees, 28 shiftDates, 740 shiftAssignments and 735 requests with a search space of 10^1250.
long_hint01   has 2 skills, 5 shiftTypes, 9 patterns, 3 contracts, 50 employees, 28 shiftDates, 740 shiftAssignments and   0 requests with a search space of 10^1257.
long_hint02   has 2 skills, 5 shiftTypes, 7 patterns, 3 contracts, 50 employees, 28 shiftDates, 740 shiftAssignments and   0 requests with a search space of 10^1257.
long_hint03   has 2 skills, 5 shiftTypes, 7 patterns, 3 contracts, 50 employees, 28 shiftDates, 740 shiftAssignments and   0 requests with a search space of 10^1257.
long_late01   has 2 skills, 5 shiftTypes, 9 patterns, 3 contracts, 50 employees, 28 shiftDates, 752 shiftAssignments and   0 requests with a search space of 10^1277.
long_late02   has 2 skills, 5 shiftTypes, 9 patterns, 4 contracts, 50 employees, 28 shiftDates, 752 shiftAssignments and   0 requests with a search space of 10^1277.
long_late03   has 2 skills, 5 shiftTypes, 9 patterns, 3 contracts, 50 employees, 28 shiftDates, 752 shiftAssignments and   0 requests with a search space of 10^1277.
long_late04   has 2 skills, 5 shiftTypes, 9 patterns, 4 contracts, 50 employees, 28 shiftDates, 752 shiftAssignments and   0 requests with a search space of 10^1277.
long_late05   has 2 skills, 5 shiftTypes, 9 patterns, 3 contracts, 50 employees, 28 shiftDates, 740 shiftAssignments and   0 requests with a search space of 10^1257.</code></pre></div></div><div class="section" title="3.4.3. Traveling tournament problem (TTP)"><div class="titlepage"><div><div><h3 class="title"><a id="travelingTournament"/>3.4.3. Traveling tournament problem (TTP)</h3></div></div></div><div class="section" title="3.4.3.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="travelingTournamentProblemDescription"/>3.4.3.1. Problem description</h4></div></div></div><p>Schedule matches between <span class="emphasis"><em>n</em></span> teams.</p><div class="mediaobject"><img src="images/Chapter-Use_cases_and_examples/travelingTournamentUseCase.png"/></div><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Each team plays twice against every other team: once home and once away.</p></li><li class="listitem"><p>Each team has exactly 1 match on each timeslot.</p></li><li class="listitem"><p>No team must have more than 3 consecutive home or 3 consecutive away matches.</p></li><li class="listitem"><p>No repeaters: no 2 consecutive matches of the same 2 opposing teams.</p></li></ul></div><p>Soft constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Minimize the total distance traveled by all teams.</p></li></ul></div><p>The problem is defined on <a class="link" href="http://mat.gsia.cmu.edu/TOURN/">Michael Trick's website (which
        contains the world records too)</a>.</p></div><div class="section" title="3.4.3.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="travelingTournamentProblemSize"/>3.4.3.2. Problem size</h4></div></div></div><pre><code class="no-highlight">1-nl04     has  6 days,  4 teams and   12 matches with a search space of    10^9.
1-nl06     has 10 days,  6 teams and   30 matches with a search space of   10^30.
1-nl08     has 14 days,  8 teams and   56 matches with a search space of   10^64.
1-nl10     has 18 days, 10 teams and   90 matches with a search space of  10^112.
1-nl12     has 22 days, 12 teams and  132 matches with a search space of  10^177.
1-nl14     has 26 days, 14 teams and  182 matches with a search space of  10^257.
1-nl16     has 30 days, 16 teams and  240 matches with a search space of  10^354.
2-bra24    has 46 days, 24 teams and  552 matches with a search space of  10^917.
3-nfl16    has 30 days, 16 teams and  240 matches with a search space of  10^354.
3-nfl18    has 34 days, 18 teams and  306 matches with a search space of  10^468.
3-nfl20    has 38 days, 20 teams and  380 matches with a search space of  10^600.
3-nfl22    has 42 days, 22 teams and  462 matches with a search space of  10^749.
3-nfl24    has 46 days, 24 teams and  552 matches with a search space of  10^917.
3-nfl26    has 50 days, 26 teams and  650 matches with a search space of 10^1104.
3-nfl28    has 54 days, 28 teams and  756 matches with a search space of 10^1309.
3-nfl30    has 58 days, 30 teams and  870 matches with a search space of 10^1534.
3-nfl32    has 62 days, 32 teams and  992 matches with a search space of 10^1778.
4-super04  has  6 days,  4 teams and   12 matches with a search space of    10^9.
4-super06  has 10 days,  6 teams and   30 matches with a search space of   10^30.
4-super08  has 14 days,  8 teams and   56 matches with a search space of   10^64.
4-super10  has 18 days, 10 teams and   90 matches with a search space of  10^112.
4-super12  has 22 days, 12 teams and  132 matches with a search space of  10^177.
4-super14  has 26 days, 14 teams and  182 matches with a search space of  10^257.
5-galaxy04 has  6 days,  4 teams and   12 matches with a search space of    10^9.
5-galaxy06 has 10 days,  6 teams and   30 matches with a search space of   10^30.
5-galaxy08 has 14 days,  8 teams and   56 matches with a search space of   10^64.
5-galaxy10 has 18 days, 10 teams and   90 matches with a search space of  10^112.
5-galaxy12 has 22 days, 12 teams and  132 matches with a search space of  10^177.
5-galaxy14 has 26 days, 14 teams and  182 matches with a search space of  10^257.
5-galaxy16 has 30 days, 16 teams and  240 matches with a search space of  10^354.
5-galaxy18 has 34 days, 18 teams and  306 matches with a search space of  10^468.
5-galaxy20 has 38 days, 20 teams and  380 matches with a search space of  10^600.
5-galaxy22 has 42 days, 22 teams and  462 matches with a search space of  10^749.
5-galaxy24 has 46 days, 24 teams and  552 matches with a search space of  10^917.
5-galaxy26 has 50 days, 26 teams and  650 matches with a search space of 10^1104.
5-galaxy28 has 54 days, 28 teams and  756 matches with a search space of 10^1309.
5-galaxy30 has 58 days, 30 teams and  870 matches with a search space of 10^1534.
5-galaxy32 has 62 days, 32 teams and  992 matches with a search space of 10^1778.
5-galaxy34 has 66 days, 34 teams and 1122 matches with a search space of 10^2041.
5-galaxy36 has 70 days, 36 teams and 1260 matches with a search space of 10^2324.
5-galaxy38 has 74 days, 38 teams and 1406 matches with a search space of 10^2628.
5-galaxy40 has 78 days, 40 teams and 1560 matches with a search space of 10^2951.</code></pre></div></div><div class="section" title="3.4.4. Cheap time scheduling"><div class="titlepage"><div><div><h3 class="title"><a id="cheapTimeScheduling"/>3.4.4. Cheap time scheduling</h3></div></div></div><div class="section" title="3.4.4.1. Problem description"><div class="titlepage"><div><div><h4 class="title"><a id="cheapTimeSchedulingProblemDescription"/>3.4.4.1. Problem description</h4></div></div></div><p>Schedule all tasks in time and on a machine to minimize power cost. Power prices differs in time. This is
        a form of <span class="emphasis"><em>job shop scheduling</em></span>.</p><p>Hard constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Start time limits: each task must start between its earliest start and latest start limit.</p></li><li class="listitem"><p>Maximum capacity: the maximum capacity for each resource for each machine must not be exceeded.</p></li><li class="listitem"><p>Startup and shutdown: each machine must be active in the periods during which it has assigned tasks.
            Between tasks it is allowed to be idle to avoid startup and shutdown costs.</p></li></ul></div><p>Medium constraints:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Power cost: minimize the total power cost of the whole schedule.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Machine power cost: Each active or idle machine consumes power, which infers a power cost
                (depending on the power price during that time).</p></li><li class="listitem"><p>Task power cost: Each task consumes power too, which infers a power cost (depending on the power
                price during its time).</p></li><li class="listitem"><p>Machine startup and shutdown cost: Every time a machine starts up or shuts down, an extra cost is
                inflicted.</p></li></ul></div></li></ul></div><p>Soft constraints (addendum to the original problem definition):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Start early: prefer starting a task sooner rather than later.</p></li></ul></div><p>The problem is defined by <a class="link" href="http://iconchallenge.insight-centre.org/">the ICON
        challenge</a>.</p></div><div class="section" title="3.4.4.2. Problem size"><div class="titlepage"><div><div><h4 class="title"><a id="cheapTimeSchedulingProblemSize"/>3.4.4.2. Problem size</h4></div></div></div><pre><code class="no-highlight">sample01   has 3 resources,   2 machines, 288 periods and   25 tasks with a search space of    10^53.
sample02   has 3 resources,   2 machines, 288 periods and   50 tasks with a search space of   10^114.
sample03   has 3 resources,   2 machines, 288 periods and  100 tasks with a search space of   10^226.
sample04   has 3 resources,   5 machines, 288 periods and  100 tasks with a search space of   10^266.
sample05   has 3 resources,   2 machines, 288 periods and  250 tasks with a search space of   10^584.
sample06   has 3 resources,   5 machines, 288 periods and  250 tasks with a search space of   10^673.
sample07   has 3 resources,   2 machines, 288 periods and 1000 tasks with a search space of  10^2388.
sample08   has 3 resources,   5 machines, 288 periods and 1000 tasks with a search space of  10^2748.
sample09   has 4 resources,  20 machines, 288 periods and 2000 tasks with a search space of  10^6668.
instance00 has 1 resources,  10 machines, 288 periods and  200 tasks with a search space of   10^595.
instance01 has 1 resources,  10 machines, 288 periods and  200 tasks with a search space of   10^599.
instance02 has 1 resources,  10 machines, 288 periods and  200 tasks with a search space of   10^599.
instance03 has 1 resources,  10 machines, 288 periods and  200 tasks with a search space of   10^591.
instance04 has 1 resources,  10 machines, 288 periods and  200 tasks with a search space of   10^590.
instance05 has 2 resources,  25 machines, 288 periods and  200 tasks with a search space of   10^667.
instance06 has 2 resources,  25 machines, 288 periods and  200 tasks with a search space of   10^660.
instance07 has 2 resources,  25 machines, 288 periods and  200 tasks with a search space of   10^662.
instance08 has 2 resources,  25 machines, 288 periods and  200 tasks with a search space of   10^651.
instance09 has 2 resources,  25 machines, 288 periods and  200 tasks with a search space of   10^659.
instance10 has 2 resources,  20 machines, 288 periods and  500 tasks with a search space of  10^1657.
instance11 has 2 resources,  20 machines, 288 periods and  500 tasks with a search space of  10^1644.
instance12 has 2 resources,  20 machines, 288 periods and  500 tasks with a search space of  10^1637.
instance13 has 2 resources,  20 machines, 288 periods and  500 tasks with a search space of  10^1659.
instance14 has 2 resources,  20 machines, 288 periods and  500 tasks with a search space of  10^1643.
instance15 has 3 resources,  40 machines, 288 periods and  500 tasks with a search space of  10^1782.
instance16 has 3 resources,  40 machines, 288 periods and  500 tasks with a search space of  10^1778.
instance17 has 3 resources,  40 machines, 288 periods and  500 tasks with a search space of  10^1764.
instance18 has 3 resources,  40 machines, 288 periods and  500 tasks with a search space of  10^1769.
instance19 has 3 resources,  40 machines, 288 periods and  500 tasks with a search space of  10^1778.
instance20 has 3 resources,  50 machines, 288 periods and 1000 tasks with a search space of  10^3689.
instance21 has 3 resources,  50 machines, 288 periods and 1000 tasks with a search space of  10^3678.
instance22 has 3 resources,  50 machines, 288 periods and 1000 tasks with a search space of  10^3706.
instance23 has 3 resources,  50 machines, 288 periods and 1000 tasks with a search space of  10^3676.
instance24 has 3 resources,  50 machines, 288 periods and 1000 tasks with a search space of  10^3681.
instance25 has 3 resources,  60 machines, 288 periods and 1000 tasks with a search space of  10^3774.
instance26 has 3 resources,  60 machines, 288 periods and 1000 tasks with a search space of  10^3737.
instance27 has 3 resources,  60 machines, 288 periods and 1000 tasks with a search space of  10^3744.
instance28 has 3 resources,  60 machines, 288 periods and 1000 tasks with a search space of  10^3731.
instance29 has 3 resources,  60 machines, 288 periods and 1000 tasks with a search space of  10^3746.
instance30 has 4 resources,  70 machines, 288 periods and 2000 tasks with a search space of  10^7718.
instance31 has 4 resources,  70 machines, 288 periods and 2000 tasks with a search space of  10^7740.
instance32 has 4 resources,  70 machines, 288 periods and 2000 tasks with a search space of  10^7686.
instance33 has 4 resources,  70 machines, 288 periods and 2000 tasks with a search space of  10^7672.
instance34 has 4 resources,  70 machines, 288 periods and 2000 tasks with a search space of  10^7695.
instance35 has 4 resources,  80 machines, 288 periods and 2000 tasks with a search space of  10^7807.
instance36 has 4 resources,  80 machines, 288 periods and 2000 tasks with a search space of  10^7814.
instance37 has 4 resources,  80 machines, 288 periods and 2000 tasks with a search space of  10^7764.
instance38 has 4 resources,  80 machines, 288 periods and 2000 tasks with a search space of  10^7736.
instance39 has 4 resources,  80 machines, 288 periods and 2000 tasks with a search space of  10^7783.
instance40 has 4 resources,  90 machines, 288 periods and 4000 tasks with a search space of 10^15976.
instance41 has 4 resources,  90 machines, 288 periods and 4000 tasks with a search space of 10^15935.
instance42 has 4 resources,  90 machines, 288 periods and 4000 tasks with a search space of 10^15887.
instance43 has 4 resources,  90 machines, 288 periods and 4000 tasks with a search space of 10^15896.
instance44 has 4 resources,  90 machines, 288 periods and 4000 tasks with a search space of 10^15885.
instance45 has 4 resources, 100 machines, 288 periods and 5000 tasks with a search space of 10^20173.
instance46 has 4 resources, 100 machines, 288 periods and 5000 tasks with a search space of 10^20132.
instance47 has 4 resources, 100 machines, 288 periods and 5000 tasks with a search space of 10^20126.
instance48 has 4 resources, 100 machines, 288 periods and 5000 tasks with a search space of 10^20110.
instance49 has 4 resources, 100 machines, 288 periods and 5000 tasks with a search space of 10^20078.</code></pre></div></div></div></div><div class="chapter" title="Chapter 4. Planner configuration"><div class="titlepage"><div><div><h2 class="title"><a id="plannerConfiguration"/>Chapter 4. Planner configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#plannerConfigurationOverview">4.1. Overview</a></span></dt><dt><span class="section"><a href="#solverConfiguration">4.2. Solver configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#solverConfigurationByXML">4.2.1. Solver configuration by XML</a></span></dt><dt><span class="section"><a href="#solverConfigurationByJavaAPI">4.2.2. Solver configuration by Java API</a></span></dt></dl></dd><dt><span class="section"><a href="#modelAPlanningProblem">4.3. Model a planning problem</a></span></dt><dd><dl><dt><span class="section"><a href="#isThisClassAProblemFactOrPlanningEntity">4.3.1. Is this class a problem fact or planning entity?</a></span></dt><dt><span class="section"><a href="#problemFact">4.3.2. Problem fact</a></span></dt><dt><span class="section"><a href="#planningEntity">4.3.3. Planning entity</a></span></dt><dt><span class="section"><a href="#planningVariable">4.3.4. Planning variable</a></span></dt><dt><span class="section"><a href="#planningValueAndPlanningValueRange">4.3.5. Planning value and planning value range</a></span></dt><dt><span class="section"><a href="#shadowVariable">4.3.6. Shadow variable</a></span></dt><dt><span class="section"><a href="#planningProblemAndPlanningSolution">4.3.7. Planning problem and planning solution</a></span></dt></dl></dd><dt><span class="section"><a href="#useTheSolver">4.4. Use the <code class="literal">Solver</code></a></span></dt><dd><dl><dt><span class="section"><a href="#theSolverInterface">4.4.1. The <code class="literal">Solver</code> interface</a></span></dt><dt><span class="section"><a href="#solvingAProblem">4.4.2. Solving a problem</a></span></dt><dt><span class="section"><a href="#environmentMode">4.4.3. Environment mode: Are there bugs in my code?</a></span></dt><dt><span class="section"><a href="#logging">4.4.4. Logging level: What is the <code class="literal">Solver</code> doing?</a></span></dt><dt><span class="section"><a href="#randomNumberGenerator">4.4.5. Random number generator</a></span></dt></dl></dd></dl></div><div class="section" title="4.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="plannerConfigurationOverview"/>4.1. Overview</h2></div></div></div><p>Solving a planning problem with Planner consists out of 5 steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="bold"><strong>Model your planning problem</strong></span> as a class that implements the interface
        <code class="literal">Solution</code>, for example the class <code class="literal">NQueens</code>.</p></li><li class="listitem"><p><span class="bold"><strong>Configure a <code class="literal">Solver</code></strong></span>, for example a First Fit and Tabu
        Search solver for any <code class="literal">NQueens</code> instance.</p></li><li class="listitem"><p><span class="bold"><strong>Load a problem data set</strong></span> from your data layer, for example a 4 Queens
        instance. That is the planning problem.</p></li><li class="listitem"><p><span class="bold"><strong>Solve it</strong></span> with <code class="literal">Solver.solve(planningProblem)</code>.</p></li><li class="listitem"><p><span class="bold"><strong>Get the best solution found</strong></span> by the <code class="literal">Solver</code> with
        <code class="literal">Solver.getBestSolution()</code>.</p></li></ol></div><div class="mediaobject"><img src="images/Chapter-Planner_configuration/inputOutputOverview.png"/></div></div><div class="section" title="4.2. Solver configuration"><div class="titlepage"><div><div><h2 class="title"><a id="solverConfiguration"/>4.2. Solver configuration</h2></div></div></div><div class="section" title="4.2.1. Solver configuration by XML"><div class="titlepage"><div><div><h3 class="title"><a id="solverConfigurationByXML"/>4.2.1. Solver configuration by XML</h3></div></div></div><p>Build a <code class="literal">Solver</code> instance with the <code class="literal">SolverFactory</code>. Configure it with a
      solver configuration XML file, provided as a classpath resource (as definied by
      <code class="literal">ClassLoader.getResource()</code>):</p><pre><code class="language-java">       SolverFactory solverFactory = SolverFactory.createFromXmlResource(
               "org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml");
       Solver solver = solverFactory.buildSolver();</code></pre><p>In a typical project (following the Maven directory structure), that solverConfig XML file would be located
      at
      <code class="literal">$PROJECT_DIR/src/main/resources/org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml</code>.
      On some environments (<a class="link" href="#integrationWithOSGi" title="16.4.2. OSGi">OSGi</a>, <a class="link" href="#integrationWithJBossModules" title="16.4.1. JBoss modules, WildFly and JBoss EAP">JBoss modules</a>, ...), classpath resources in your jars might not be
      available in by default to the classes in optaplanner's jars.</p><p>Alternatively, a <code class="literal">SolverFactory</code> can be created from a <code class="literal">File</code>, an
      <code class="literal">InputStream</code> or a <code class="literal">Reader</code> with methods such as
      <code class="literal">SolverFactory.createFromXmlFile()</code>. However, for portability reasons, a classpath resource is
      recommended.</p><p>A solver configuration file looks like this:</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;solver&gt;
  &lt;!-- Define the model --&gt;
  &lt;solutionClass&gt;org.optaplanner.examples.nqueens.domain.NQueens&lt;/solutionClass&gt;
  &lt;entityClass&gt;org.optaplanner.examples.nqueens.domain.Queen&lt;/entityClass&gt;

  &lt;!-- Define the score function --&gt;
  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;SIMPLE&lt;/scoreDefinitionType&gt;
    &lt;scoreDrl&gt;org/optaplanner/examples/nqueens/solver/nQueensScoreRules.drl&lt;/scoreDrl&gt;
  &lt;/scoreDirectorFactory&gt;

  &lt;!-- Configure the optimization algorithm(s) --&gt;
  &lt;termination&gt;
    ...
  &lt;/termination&gt;
  &lt;constructionHeuristic&gt;
    ...
  &lt;/constructionHeuristic&gt;
  &lt;localSearch&gt;
    ...
  &lt;/localSearch&gt;
&lt;/solver&gt;</code></pre><p>Notice the 3 parts in it:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Define the model</p></li><li class="listitem"><p>Define the score function</p></li><li class="listitem"><p>Configure the optimization algorithm(s)</p></li></ul></div><p>These various parts of a configuration are explained further in this manual.</p><p><span class="bold"><strong>Planner makes it relatively easy to switch optimization algorithm(s) just by changing
      the configuration.</strong></span> There's even a <code class="literal">Benchmarker</code> utility which allows you to play out
      different configurations against each other and report the most appropriate configuration for your use
      case.</p></div><div class="section" title="4.2.2. Solver configuration by Java API"><div class="titlepage"><div><div><h3 class="title"><a id="solverConfigurationByJavaAPI"/>4.2.2. Solver configuration by Java API</h3></div></div></div><p>A solver configuration can also be configured with the <code class="literal">SolverConfig</code> API. This especially
      useful to change some values dynamically at runtime, for example to change the running time based on user input,
      before building the <code class="literal">Solver</code>:</p><pre><code class="language-java">        SolverFactory solverFactory = SolverFactory.createFromXmlResource(
                "org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml");

        SolverConfig solverConfig = solverFactory.getSolverConfig();
        TerminationConfig terminationConfig = solverConfig.getTerminationConfig();
        terminationConfig.setMinutesSpentLimit(userInput);

        Solver solver = solverFactory.buildSolver();</code></pre><p>Every element in the solver configuration XML is available as a <code class="literal">*Config</code> class or a
      property on a <code class="literal">*Config</code> class in the package namespace
      <code class="literal">org.optaplanner.core.config</code>. These <code class="literal">*Config</code> classes are the Java
      representation of the XML format and they also provide the user-friendly way to assemble the runtime components
      (of the package namespace <code class="literal">org.optaplanner.core.impl</code>) into an efficient
      <code class="literal">Solver</code>.</p></div></div><div class="section" title="4.3. Model a planning problem"><div class="titlepage"><div><div><h2 class="title"><a id="modelAPlanningProblem"/>4.3. Model a planning problem</h2></div></div></div><div class="section" title="4.3.1. Is this class a problem fact or planning entity?"><div class="titlepage"><div><div><h3 class="title"><a id="isThisClassAProblemFactOrPlanningEntity"/>4.3.1. Is this class a problem fact or planning entity?</h3></div></div></div><p>Look at a dataset of your planning problem. You'll recognize domain classes in there, each of which can be
      categorized as one of these:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A unrelated class: not used by any of the score constraints. From a planning standpoint, this data is
          obsolete.</p></li><li class="listitem"><p>A <span class="bold"><strong>problem fact</strong></span> class: used by the score constraints, but does NOT
          change during planning (as long as the problem stays the same). For example: <code class="literal">Bed</code>,
          <code class="literal">Room</code>, <code class="literal">Shift</code>, <code class="literal">Employee</code>, <code class="literal">Topic</code>,
          <code class="literal">Period</code>, ... All the properties of a problem fact class are problem properties.</p></li><li class="listitem"><p>A <span class="bold"><strong>planning entity</strong></span> class: used by the score constraints and changes
          during planning. For example: <code class="literal">BedDesignation</code>, <code class="literal">ShiftAssignment</code>,
          <code class="literal">Exam</code>, ... The properties that change during planning are planning variables. The other
          properties are problem properties.</p></li></ul></div><p>Ask yourself: <span class="emphasis"><em>What class changes during planning?</em></span> <span class="emphasis"><em>Which class has variables
      that I want the <code class="literal">Solver</code> to change for me?</em></span> That class is a planning entity. Most use
      cases have only 1 planning entity class. Most use cases also have only 1 planning variable per planning entity
      class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In <a class="link" href="#realTimePlanning" title="15.4. Real-time planning">real-time planning</a>, even thought the problem itself changes,
        problem facts don't really change during planning, instead they change between planning (because the Solver
        temporarily stops to apply the problem fact changes).</p></div><p>A good model can greatly improve the success of your planning implementation. Follow these guidelines to
      design a good model:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>In a <span class="emphasis"><em>many to one</em></span> relationship, it's normally the <span class="emphasis"><em>many</em></span> side
          that is the planning entity class. The property referencing the other side is then the planning variable. For
          example in employee rostering: the planning entity class is <code class="literal">ShiftAssignment</code>, not
          <code class="literal">Employee</code>, and the planning variable is <code class="literal">ShiftAssignment.getEmployee()</code>
          because 1 <code class="literal">Employee</code> has multiple <code class="literal">ShiftAssignment</code>s but 1
          <code class="literal">ShiftAssignment</code> has only 1 <code class="literal">Employee</code>.</p></li><li class="listitem"><p>A planning entity class should have at least 1 problem property. A planning entity class with only
          planning variables can normally be simplified by converting 1 of those planning variables into a problem
          property. That heavily decreases <a class="link" href="#searchSpaceSize" title="6.1. Search space size in the real world">the search space size</a>. For example in
          employee rostering: the <code class="literal">ShiftAssignment</code>'s <code class="literal">getShift()</code> is a problem
          property and the <code class="literal">getEmployee()</code> is a planning variable. If both were a planning variable,
          solving it would be far less efficient.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A surrogate ID does not suffice as that at least 1 problem property. It needs to be understandable
              by the business. A business key does suffice. This prevents an unassigned entity from being nameless
              (unidentifiable by the business).</p></li><li class="listitem"><p>This way, there is no need to add a hard constraint to assure that 2 planning entities are
              different: they are already different due to their problem properties.</p></li><li class="listitem"><p>In some cases, multiple planning entities have the same problem property. In such cases, it can be
              useful to create an extra problem property to distinguish them. For example in employee rostering:
              <code class="literal">ShiftAssignment</code> has besides the problem property <code class="literal">Shift</code> also the
              problem property <code class="literal">indexInShift</code>.</p></li></ul></div></li><li class="listitem"><p>The number of planning entities is recommended to be fixed during planning. When in doubt which property
          should be a planning variable and which should be a problem property, choose it so the number of planning
          entities is fixed. For example in employee rostering: if the planning entity class would have been
          <code class="literal">EmployeeAssignment</code> with a problem property <code class="literal">getEmployee()</code> and a planning
          variable <code class="literal">getShift()</code>, than it's impossible to accurately predict how many
          <code class="literal">EmployeeAssignment</code> instances to make per <code class="literal">Employee</code>.</p></li></ul></div><p>For inspiration, take a look at how the examples modeled their domain:</p><div class="mediaobject"><img src="images/Chapter-Planner_configuration/entityVariableAndValueExamples.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Vehicle routing is special, because it uses a <a class="link" href="#chainedPlanningVariable" title="4.3.5.4. Chained planning variable (TSP, VRP, ...)">chained planning
        variable</a>.</p></div><p><span class="bold"><strong>In Planner all problems facts and planning entities are plain old JavaBeans
      (POJO's).</strong></span> You can load them from a database, an XML file, a data repository, a noSQL cloud, ... (see
      <a class="link" href="#integration" title="Chapter 16. Integration">Integration</a>): Planner doesn't care.</p></div><div class="section" title="4.3.2. Problem fact"><div class="titlepage"><div><div><h3 class="title"><a id="problemFact"/>4.3.2. Problem fact</h3></div></div></div><p>A problem fact is any JavaBean (POJO) with getters that does not change during planning. Implementing the
      interface <code class="literal">Serializable</code> is recommended (but not required). For example in n queens, the columns
      and rows are problem facts:</p><pre><code class="language-java">public class Column implements Serializable {

    private int index;

    // ... getters
}</code></pre><pre><code class="language-java">public class Row implements Serializable {

    private int index;

    // ... getters
}</code></pre><p>A problem fact can reference other problem facts of course:</p><pre><code class="language-java">public class Course implements Serializable {

    private String code;

    private Teacher teacher; // Other problem fact
    private int lectureSize;
    private int minWorkingDaySize;

    private List&lt;Curriculum&gt; curriculumList; // Other problem facts
    private int studentSize;

    // ... getters
}</code></pre><p>A problem fact class does <span class="emphasis"><em>not</em></span> require any Planner specific code. For example, you can
      reuse your domain classes, which might have JPA annotations.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Generally, better designed domain classes lead to simpler and more efficient score constraints. Therefore,
        when dealing with a messy legacy system, it can sometimes be worth it to convert the messy domain set into a
        planner specific POJO set first. For example: if your domain model has 2 <code class="literal">Teacher</code> instances
        for the same teacher that teaches at 2 different departments, it's hard to write a correct score constraint that
        constrains a teacher's spare time.</p><p>Alternatively, you can sometimes also introduce <a class="link" href="#cachedProblemFact" title="4.3.7.5. Cached problem fact"><span class="emphasis"><em>a cached
        problem fact</em></span></a> to enrich the domain model for planning only.</p></div></div><div class="section" title="4.3.3. Planning entity"><div class="titlepage"><div><div><h3 class="title"><a id="planningEntity"/>4.3.3. Planning entity</h3></div></div></div><div class="section" title="4.3.3.1. Planning entity annotation"><div class="titlepage"><div><div><h4 class="title"><a id="planningEntityAnnotation"/>4.3.3.1. Planning entity annotation</h4></div></div></div><p>A planning entity is a JavaBean (POJO) that changes during solving, for example a <code class="literal">Queen</code>
        that changes to another row. A planning problem has multiple planning entities, for example for a single n
        queens problem, each <code class="literal">Queen</code> is a planning entity. But there's usually only 1 planning entity
        class, for example the <code class="literal">Queen</code> class.</p><p>A planning entity class needs to be annotated with the <code class="literal">@PlanningEntity</code>
        annotation.</p><p>Each planning entity class has 1 or more <span class="emphasis"><em>planning variables</em></span>. It usually also has 1 or
        more <span class="emphasis"><em>defining</em></span> properties. For example in n queens, a <code class="literal">Queen</code> is defined by
        its <code class="literal">Column</code> and has a planning variable <code class="literal">Row</code>. This means that a Queen's
        column never changes during solving, while its row does change.</p><pre><code class="language-java">@PlanningEntity
public class Queen {

    private Column column;

    // Planning variables: changes during planning, between score calculations.
    private Row row;

    // ... getters and setters
}</code></pre><p>A planning entity class can have multiple planning variables. For example, a <code class="literal">Lecture</code> is
        defined by its <code class="literal">Course</code> and its index in that course (because 1 course has multiple lectures).
        Each <code class="literal">Lecture</code> needs to be scheduled into a <code class="literal">Period</code> and a
        <code class="literal">Room</code> so it has 2 planning variables (period and room). For example: the course Mathematics
        has 8 lectures per week, of which the first lecture is Monday morning at 08:00 in room 212.</p><pre><code class="language-java">@PlanningEntity
public class Lecture {

    private Course course;
    private int lectureIndexInCourse;

    // Planning variables: changes during planning, between score calculations.
    private Period period;
    private Room room;

    // ...
}</code></pre><p>The solver configuration also needs to be made aware of each planning entity class:</p><pre><code class="language-java">&lt;solver&gt;
  ...
  &lt;entityClass&gt;org.optaplanner.examples.nqueens.domain.Queen&lt;/entityClass&gt;
  ...
&lt;/solver&gt;</code></pre><p>Some uses cases have multiple planning entity classes. For example: route freight and trains into railway
        network arcs, where each freight can use multiple trains over its journey and each train can carry multiple
        freights per arc. Having multiple planning entity classes directly raises the implementation complexity of your
        use case.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p><span class="emphasis"><em>Do not create unnecessary planning entity classes.</em></span> This leads to difficult
          <code class="literal">Move</code> implementations and slower score calculation.</p><p>For example, do not create a planning entity class to hold the total free time of a teacher, which needs
          to be kept up to date as the <code class="literal">Lecture</code> planning entities change. Instead, calculate the free
          time in the score constraints and put the result per teacher into a logically inserted score object.</p><p>If historic data needs to be considered too, then create problem fact to hold the total of the historic
          assignments up to, but <span class="emphasis"><em>not including</em></span>, the planning window (so it doesn't change when a
          planning entity changes) and let the score constraints take it into account.</p></div></div><div class="section" title="4.3.3.2. Planning entity difficulty"><div class="titlepage"><div><div><h4 class="title"><a id="planningEntityDifficulty"/>4.3.3.2. Planning entity difficulty</h4></div></div></div><p>Some optimization algorithms work more efficiently if they have an estimation of which planning entities
        are more difficult to plan. For example: in bin packing bigger items are harder to fit, in course scheduling
        lectures with more students are more difficult to schedule and in n queens the middle queens are more difficult
        to fit on the board.</p><p>Therefore, you can set a <code class="literal">difficultyComparatorClass</code> to the
        <code class="literal">@PlanningEntity</code> annotation:</p><pre><code class="language-java">@PlanningEntity(difficultyComparatorClass = CloudProcessDifficultyComparator.class)
public class CloudProcess {
    // ...
}</code></pre><pre><code class="language-java">public class CloudProcessDifficultyComparator implements Comparator&lt;CloudProcess&gt; {

    public int compare(CloudProcess a, CloudProcess b) {
        return new CompareToBuilder()
                .append(a.getRequiredMultiplicand(), b.getRequiredMultiplicand())
                .append(a.getId(), b.getId())
                .toComparison();
    }

}</code></pre><p>Alternatively, you can also set a <code class="literal">difficultyWeightFactoryClass</code> to the
        <code class="literal">@PlanningEntity</code> annotation, so you have access to the rest of the problem facts from the
        <code class="literal">Solution</code> too:</p><pre><code class="language-java">@PlanningEntity(difficultyWeightFactoryClass = QueenDifficultyWeightFactory.class)
public class Queen {
    // ...
}</code></pre><p>See <a class="link" href="#sortedSelection" title="7.6.5. Sorted selection">sorted selection</a> for more information.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Difficulty should be implemented ascending: easy entities are lower, difficult entities are higher. For
          example in bin packing: small item &lt; medium item &lt; big item.</p><p>Even though some algorithms start with the more difficult entities first, they just reverse the
          ordering.</p></div><p><span class="emphasis"><em>None of the current planning variable states should be used to compare planning entity
        difficult.</em></span> During Construction Heuristics, those variables are likely to be <code class="literal">null</code>
        anyway. For example, a <code class="literal">Queen</code>'s <code class="literal">row</code> variable should not be used.</p></div></div><div class="section" title="4.3.4. Planning variable"><div class="titlepage"><div><div><h3 class="title"><a id="planningVariable"/>4.3.4. Planning variable</h3></div></div></div><div class="section" title="4.3.4.1. Planning variable annotation"><div class="titlepage"><div><div><h4 class="title"><a id="planningVariableAnnotation"/>4.3.4.1. Planning variable annotation</h4></div></div></div><p>A planning variable is a property (including getter and setter) on a planning entity. It points to a
        planning value, which changes during planning. For example, a <code class="literal">Queen</code>'s <code class="literal">row</code>
        property is a planning variable. Note that even though a <code class="literal">Queen</code>'s <code class="literal">row</code>
        property changes to another <code class="literal">Row</code> during planning, no <code class="literal">Row</code> instance itself is
        changed.</p><p>A planning variable getter needs to be annotated with the <code class="literal">@PlanningVariable</code> annotation,
        which needs a non-empty <code class="literal">valueRangeProviderRefs</code> property.</p><pre><code class="language-java">@PlanningEntity
public class Queen {

    private Row row;

    // ...

    @PlanningVariable(valueRangeProviderRefs = {"rowRange"})
    public Row getRow() {
        return row;
    }

    public void setRow(Row row) {
        this.row = row;
    }

}</code></pre><p>The <code class="literal">valueRangeProviderRefs</code> property defines what are the possible planning values for
        this planning variable. It references 1 or more <code class="literal">@ValueRangeProvider</code>
        <code class="literal">id</code>'s.</p></div><div class="section" title="4.3.4.2. Nullable planning variable"><div class="titlepage"><div><div><h4 class="title"><a id="nullablePlanningVariable"/>4.3.4.2. Nullable planning variable</h4></div></div></div><p>By default, an initialized planning variable cannot be <code class="literal">null</code>, so an initialized solution
        will never use <code class="literal">null</code> for any of its planning variables. In an over-constrained use case, this
        can be counterproductive. For example: in task assignment with too many tasks for the workforce, we would rather
        leave low priority tasks unassigned instead of assigning them to an overloaded worker.</p><p>To allow an initialized planning variable to be <code class="literal">null</code>, set <code class="literal">nullable</code>
        to <code class="literal">true</code>:</p><pre><code class="language-java">    @PlanningVariable(..., nullable = true)
    public Worker getWorker() {
        return worker;
    }</code></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Planner will automatically add the value <code class="literal">null</code> to the value range. There is no need to
          add <code class="literal">null</code> in a collection used by a <code class="literal">ValueRangeProvider</code>.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Using a nullable planning variable implies that your score calculation is responsible for punishing (or
          even rewarding) variables with a null value.</p></div><p><a class="link" href="#repeatedPlanning" title="Chapter 15. Repeated planning">Repeated planning</a> (especially <a class="link" href="#realTimePlanning" title="15.4. Real-time planning">real-time planning</a>) does not mix well with a nullable planning variable: every
        time the Solver starts or a problem fact change is made, the <a class="link" href="#constructionHeuristics" title="Chapter 9. Construction heuristics">Construction
        Heuristics</a> will try to initialize all the <code class="literal">null</code> variables again, which can be a huge
        waste of time. One way to deal with this, is to change when a planning entity should be reinitialized with an
        <code class="literal">reinitializeVariableEntityFilter</code>:</p><pre><code class="language-java">    @PlanningVariable(..., nullable = true, reinitializeVariableEntityFilter = ReinitializeTaskFilter.class)
    public Worker getWorker() {
        return worker;
    }</code></pre></div><div class="section" title="4.3.4.3. When is a planning variable considered initialized?"><div class="titlepage"><div><div><h4 class="title"><a id="whenIsAPlanningVariableInitialized"/>4.3.4.3. When is a planning variable considered initialized?</h4></div></div></div><p>A planning variable is considered initialized if its value is not <code class="literal">null</code> or if the
        variable is <code class="literal">nullable</code>. So a nullable variable is always considered initialized, even when a
        custom <code class="literal">reinitializeVariableEntityFilter</code> triggers a reinitialization during construction
        heuristics.</p><p>A planning entity is initialized if all of its planning variables are initialized.</p><p>A <code class="literal">Solution</code> is initialized if all of its planning entities are initialized.</p></div></div><div class="section" title="4.3.5. Planning value and planning value range"><div class="titlepage"><div><div><h3 class="title"><a id="planningValueAndPlanningValueRange"/>4.3.5. Planning value and planning value range</h3></div></div></div><div class="section" title="4.3.5.1. Planning value"><div class="titlepage"><div><div><h4 class="title"><a id="planningValue"/>4.3.5.1. Planning value</h4></div></div></div><p>A planning value is a possible value for a planning variable. Usually, a planning value is a problem fact,
        but it can also be any object, for example a <code class="literal">double</code>. It can even be another planning entity
        or even a interface implemented by both a planning entity and a problem fact.</p><p>A planning value range is the set of possible planning values for a planning variable. This set can be a
        countable (for example row <code class="literal">1</code>, <code class="literal">2</code>, <code class="literal">3</code> or
        <code class="literal">4</code>) or uncountable (for example any <code class="literal">double</code> between <code class="literal">0.0</code>
        and <code class="literal">1.0</code>).</p></div><div class="section" title="4.3.5.2. Planning value range provider"><div class="titlepage"><div><div><h4 class="title"><a id="planningValueRangeProvider"/>4.3.5.2. Planning value range provider</h4></div></div></div><div class="section" title="4.3.5.2.1. Overview"><div class="titlepage"><div><div><h5 class="title"><a id="planningValueRangeProviderOverview"/>4.3.5.2.1. Overview</h5></div></div></div><p>The value range of a planning variable is defined with the <code class="literal">@ValueRangeProvider</code>
          annotation. A <code class="literal">@ValueRangeProvider</code> annotation always has a property <code class="literal">id</code>,
          which is referenced by the <code class="literal">@PlanningVariable</code>'s property
          <code class="literal">valueRangeProviderRefs</code>.</p><p>This annotation can be located on 2 types of methods:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>On the Solution: All planning entities share the same value range.</p></li><li class="listitem"><p>On the planning entity: The value range differs per planning entity. This is less common.</p></li></ul></div><p>The return type of that method can be 2 types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">Collection</code>: The value range is defined by a <code class="literal">Collection</code>
              (usually a <code class="literal">List</code>) of it's possible values.</p></li><li class="listitem"><p><code class="literal">ValueRange</code>: The value range is defined by its bounds. This is less common.</p></li></ul></div></div><div class="section" title="4.3.5.2.2. ValueRangeProvider on the Solution"><div class="titlepage"><div><div><h5 class="title"><a id="valueRangeProviderOnSolution"/>4.3.5.2.2. <code class="literal">ValueRangeProvider</code> on the <code class="literal">Solution</code></h5></div></div></div><p>All instances of the same planning entity class share the same set of possible planning values for that
          planning variable. This is the most common way to configure a value range.</p><p>The <code class="literal">Solution</code> implementation has method which returns a <code class="literal">Collection</code>
          (or a <code class="literal">ValueRange</code>). Any value from that <code class="literal">Collection</code> is a possible planning
          value for this planning variable.</p><pre><code class="language-java">    @PlanningVariable(valueRangeProviderRefs = {"rowRange"})
    public Row getRow() {
        return row;
    }</code></pre><pre><code class="language-java">@PlanningSolution
public class NQueens implements Solution&lt;SimpleScore&gt; {

    // ...

    @ValueRangeProvider(id = "rowRange")
    public List&lt;Row&gt; getRowList() {
        return rowList;
    }

}</code></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>That <code class="literal">Collection</code> (or <code class="literal">ValueRange</code>) must not contain the value
            <code class="literal">null</code>, not even for a <a class="link" href="#nullablePlanningVariable" title="4.3.4.2. Nullable planning variable">nullable planning
            variable</a>.</p></div></div><div class="section" title="4.3.5.2.3. ValueRangeProvider on the planning entity"><div class="titlepage"><div><div><h5 class="title"><a id="valueRangeProviderOnPlanningEntity"/>4.3.5.2.3. <code class="literal">ValueRangeProvider</code> on the planning entity</h5></div></div></div><p>Each planning entity has its own value range (a set of possible planning values) for the planning
          variable. For example, if a teacher can <span class="bold"><strong>never</strong></span> teach in a room that does not
          belong to his department, lectures of that teacher can limit their room value range to the rooms of his
          department.</p><pre><code class="language-java">    @PlanningVariable(valueRangeProviderRefs = {"departmentRoomRange"})
    public Room getRoom() {
        return room;
    }

    @ValueRangeProvider(id = "departmentRoomRange")
    public List&lt;Room&gt; getPossibleRoomList() {
        return getCourse().getTeacher().getDepartment().getRoomList();
    }</code></pre><p>Never use this to enforce a soft constraint (or even a hard constraint when the problem might not have a
          feasible solution). For example: <span class="emphasis"><em>Unless there is no other way</em></span>, a teacher can not teach in
          a room that does not belong to his department. In this case, the teacher should <span class="emphasis"><em>not</em></span> be
          limited in his room value range (because sometimes there is no other way).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>By limiting the value range specifically of 1 planning entity, you are effectively creating a
            <span class="emphasis"><em>built-in hard constraint</em></span>. This can be a very good thing, as the number of possible
            solutions is severely lowered. But this can also be a bad thing because it takes away the freedom of the
            optimization algorithms to temporarily break that constraint in order to escape from a local optimum.</p></div><p>A planning entity should <span class="emphasis"><em>not</em></span> use other planning entities to determinate its value
          range. That would only try to make it solve the planning problem itself and interfere with the optimization
          algorithms.</p><p>Every entity has its own <code class="literal">List</code> instance, except if multiple entity have the same value
          range. For example, if teacher A and B belong to the same department, they use the same
          <code class="literal">List&lt;Room&gt;</code> instance. Furthermore, each <code class="literal">List</code> contains a subset of
          the same set of planning value instances. For example, if department A and B can both use room X, then their
          <code class="literal">List&lt;Room&gt;</code> instances contain the same <code class="literal">Room</code> instance.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>A value range on planning entity is not (yet) compatible with a <a class="link" href="#chainedPlanningVariable" title="4.3.5.4. Chained planning variable (TSP, VRP, ...)">chained</a> variable.</p></div></div><div class="section" title="4.3.5.2.4. ValueRangeFactory"><div class="titlepage"><div><div><h5 class="title"><a id="valueRangeFactory"/>4.3.5.2.4. <code class="literal">ValueRangeFactory</code></h5></div></div></div><p>Instead of a <code class="literal">Collection</code>, you can also return a <code class="literal">ValueRange</code> or
          <code class="literal">CountableValueRange</code>, build by the <code class="literal">ValueRangeFactory</code>:</p><pre><code class="language-java">    @ValueRangeProvider(id = "delayRange")
    public CountableValueRange&lt;Integer&gt; getDelayRange() {
        return ValueRangeFactory.createIntValueRange(0, 5000);
    }</code></pre><p>A <code class="literal">ValueRange</code> uses far less memory, because it only holds the bounds. In the example
          above, a <code class="literal">Collection</code> would need to hold all <code class="literal">5000</code> ints, instead of just
          the 2 bounds.</p><p>Furthermore, an <code class="literal">incrementUnit</code> can be specified, for example if you have to buy stocks
          in units of 200 pieces:</p><pre><code class="language-java">    @ValueRangeProvider(id = "stockAmountRange")
    public CountableValueRange&lt;Integer&gt; getStockAmountRange() {
         // Range: 0, 200, 400, 600, ..., 9999600, 9999800, 10000000
        return ValueRangeFactory.createIntValueRange(0, 10000000, 200);
    }</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Return <code class="literal">CountableValueRange</code> instead of <code class="literal">ValueRange</code> whenever
            possible (so Planner knows it's countable).</p></div><p>The <code class="literal">ValueRangeFactory</code> supports several value class types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">int</code>: An integer range.</p></li><li class="listitem"><p><code class="literal">double</code>: A floating point range which only supports random selection (because it
              does not implement <code class="literal">CountableValueRange</code>).</p></li><li class="listitem"><p><code class="literal">BigDecimal</code>: A decimal point range. By default, the increment unit is the lowest
              non-zero value in the scale of the bounds.</p></li></ul></div></div><div class="section" title="4.3.5.2.5. Combine ValueRangeProviders"><div class="titlepage"><div><div><h5 class="title"><a id="combineValueRangeProviders"/>4.3.5.2.5. Combine ValueRangeProviders</h5></div></div></div><p>Value range providers can be combined, for example:</p><pre><code class="language-java">    @PlanningVariable(valueRangeProviderRefs = {"companyCarRange", "personalCarRange"})
    public Car getCar() {
        return car;
    }</code></pre><pre><code class="language-java">    @ValueRangeProvider(id = "companyCarRange")
    public List&lt;CompanyCar&gt; getCompanyCarList() {
        return companyCarList;
    }

    @ValueRangeProvider(id = "personalCarRange")
    public List&lt;PersonalCar&gt; getPersonalCarList() {
        return personalCarList;
    }</code></pre></div></div><div class="section" title="4.3.5.3. Planning value strength"><div class="titlepage"><div><div><h4 class="title"><a id="planningValueStrength"/>4.3.5.3. Planning value strength</h4></div></div></div><p>Some optimization algorithms work more efficiently if they have an estimation of which planning values are
        stronger, which means they are more likely to satisfy a planning entity. For example: in bin packing bigger
        containers are more likely to fit an item and in course scheduling bigger rooms are less likely to break the
        student capacity constraint.</p><p>Therefore, you can set a <code class="literal">strengthComparatorClass</code> to the
        <code class="literal">@PlanningVariable</code> annotation:</p><pre><code class="language-java">    @PlanningVariable(..., strengthComparatorClass = CloudComputerStrengthComparator.class)
    public CloudComputer getComputer() {
        // ...
    }</code></pre><pre><code class="language-java">public class CloudComputerStrengthComparator implements Comparator&lt;CloudComputer&gt; {

    public int compare(CloudComputer a, CloudComputer b) {
        return new CompareToBuilder()
                .append(a.getMultiplicand(), b.getMultiplicand())
                .append(b.getCost(), a.getCost()) // Descending (but this is debatable)
                .append(a.getId(), b.getId())
                .toComparison();
    }

}</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If you have multiple planning value classes in the <span class="emphasis"><em>same</em></span> value range, the
          <code class="literal">strengthComparatorClass</code> needs to implement a <code class="literal">Comparator</code> of a common
          superclass (for example <code class="literal">Comparator&lt;Object&gt;</code>) and be able to handle comparing instances
          of those different classes.</p></div><p>Alternatively, you can also set a <code class="literal">strengthWeightFactoryClass</code> to the
        <code class="literal">@PlanningVariable</code> annotation, so you have access to the rest of the problem facts from the
        solution too:</p><pre><code class="language-java">    @PlanningVariable(..., strengthWeightFactoryClass = RowStrengthWeightFactory.class)
    public Row getRow() {
        // ...
    }</code></pre><p>See <a class="link" href="#sortedSelection" title="7.6.5. Sorted selection">sorted selection</a> for more information.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Strength should be implemented ascending: weaker values are lower, stronger values are higher. For
          example in bin packing: small container &lt; medium container &lt; big container.</p></div><p><span class="emphasis"><em>None of the current planning variable state in any of the planning entities should be used to
        compare planning values.</em></span> During construction heuristics, those variables are likely to be
        <code class="literal">null</code> anyway. For example, none of the <code class="literal">row</code> variables of any
        <code class="literal">Queen</code> may be used to determine the strength of a <code class="literal">Row</code>.</p></div><div class="section" title="4.3.5.4. Chained planning variable (TSP, VRP, ...)"><div class="titlepage"><div><div><h4 class="title"><a id="chainedPlanningVariable"/>4.3.5.4. Chained planning variable (TSP, VRP, ...)</h4></div></div></div><p>Some use cases, such as TSP and Vehicle Routing, require <span class="emphasis"><em>chaining</em></span>. This means the
        planning entities point to each other and form a chain. By modeling the problem as a set of chains (instead of a
        set of trees/loops), the search space is heavily reduced.</p><p>A planning variable that is chained either:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Directly points to a planning fact, which is called an <span class="emphasis"><em>anchor</em></span>.</p></li><li class="listitem"><p>Points to another planning entity with the same planning variable, which recursively points to an
            anchor.</p></li></ul></div><p>Here are some example of valid and invalid chains:</p><div class="mediaobject"><img src="images/Chapter-Planner_configuration/chainPrinciples.png"/></div><p><span class="bold"><strong>Every initialized planning entity is part of an open-ended chain that begins from an
        anchor.</strong></span> A valid model means that:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A chain is never a loop. The tail is always open.</p></li><li class="listitem"><p>Every chain always has exactly 1 anchor. The anchor is a problem fact, never a planning entity.</p></li><li class="listitem"><p>A chain is never a tree, it is always a line. Every anchor or planning entity has at most 1 trailing
            planning entity.</p></li><li class="listitem"><p>Every initialized planning entity is part of a chain.</p></li><li class="listitem"><p>An anchor with no planning entities pointing to it, is also considered a chain.</p></li></ul></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>A planning problem instance given to the <code class="literal">Solver</code> must be valid.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If your constraints dictate a closed chain, model it as an open-ended chain (which is easier to persist
          in a database) and implement a score constraint for the last entity back to the anchor.</p></div><p>The optimization algorithms and built-in <code class="literal">Move</code>'s do chain correction to guarantee that
        the model stays valid:</p><div class="mediaobject"><img src="images/Chapter-Planner_configuration/chainCorrection.png"/></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>A custom <code class="literal">Move</code> implementation must leave the model in a valid state.</p></div><p>For example, in TSP the anchor is a <code class="literal">Domicile</code> (in vehicle routing it is
        <code class="literal">Vehicle</code>):</p><pre><code class="language-java">public class Domicile ... implements Standstill {

    ...

    public City getCity() {...}

}</code></pre><p>The anchor (which is a problem fact) and the planning entity implement a common interface, for example
        TSP's <code class="literal">Standstill</code>:</p><pre><code class="language-java">public interface Standstill {

    City getCity();

}</code></pre><p>That interface is the return type of the planning variable. Furthermore, the planning variable is chained.
        For example TSP's <code class="literal">Visit</code> (in vehicle routing it is <code class="literal">Customer</code>):</p><pre><code class="language-java">@PlanningEntity
public class Visit ... implements Standstill {

    ...

    public City getCity() {...}

    @PlanningVariable(graphType = PlanningVariableGraphType.CHAINED, valueRangeProviderRefs = {"domicileRange", "visitRange"})
    public Standstill getPreviousStandstill() {
        return previousStandstill;
    }

    public void setPreviousStandstill(Standstill previousStandstill) {
        this.previousStandstill = previousStandstill;
    }

}</code></pre><p>Notice how 2 value range providers are usually combined:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The value range provider which holds the anchors, for example <code class="literal">domicileList</code>.</p></li><li class="listitem"><p>The value range provider which holds the initialized planning entities, for example
            <code class="literal">visitList</code>.</p></li></ul></div></div></div><div class="section" title="4.3.6. Shadow variable"><div class="titlepage"><div><div><h3 class="title"><a id="shadowVariable"/>4.3.6. Shadow variable</h3></div></div></div><div class="section" title="4.3.6.1. Introduction"><div class="titlepage"><div><div><h4 class="title"><a id="shadowVariableIntroduction"/>4.3.6.1. Introduction</h4></div></div></div><p>A shadow variable is a variable whose correct value can be deduced from the state of the genuine planning
        variables. Even though such a variable violates the principle of normalization by definition, in some use cases
        it can be very practical to use a shadow variable, especially to express the constraints more naturally. For
        example in vehicle routing with time windows: the arrival time at a customer for a vehicle can be calculated
        based on the previously visited customers of that vehicle (and the known travel times between 2
        locations).</p><div class="mediaobject"><img src="images/Chapter-Planner_configuration/planningVariableListener.png"/></div><p>When the customers for a vehicle change, the arrival time for each customer is automatically adjusted. For
        more information, see the <a class="link" href="#vehicleRoutingDomainModel" title="3.3.3.3. Domain model">vehicle routing domain model</a>.</p><p>From a score calculation perspective, a shadow variable is like any other planning variable. From an
        optimization perspective, Planner effectively only optimizes the genuine variables (and mostly ignores the
        shadow variables): it just assures that when a genuine variable changes, any dependent shadow variables are
        changed accordingly.</p><p>There are several build-in shadow variables:</p></div><div class="section" title="4.3.6.2. Bi-directional variable (inverse relation shadow variable)"><div class="titlepage"><div><div><h4 class="title"><a id="bidirectionalVariable"/>4.3.6.2. Bi-directional variable (inverse relation shadow variable)</h4></div></div></div><p>2 variables are bi-directional if their instances always point to each other (unless they point to null).
        So if A references B, then B references A.</p><div class="mediaobject"><img src="images/Chapter-Planner_configuration/bidirectionalVariable.png"/></div><p>To map a bi-directional relationship between 2 planning variables, annotate the master side as a normal (=
        genuine) planning variable:</p><pre><code class="language-java">@PlanningEntity
public class Customer ... {

    @PlanningVariable(graphType = PlanningVariableGraphType.CHAINED, ...)
    public Standstill getPreviousStandstill() {
        return previousStandstill;
    }

    public void setPreviousStandstill(Standstill previousStandstill) {...}

}</code></pre><p>And then annotate the other side as a <code class="literal">@InverseRelationShadowVariable</code> annotation.</p><pre><code class="language-java">@PlanningEntity
public interface Standstill {

    @InverseRelationShadowVariable(sourceVariableName = "previousStandstill")
    Customer getNextCustomer();
    void setNextCustomer(Customer nextCustomer);

}</code></pre><p>The <code class="literal">sourceVariableName</code> property is the name of the planning variable on the return type
        of the getter.</p><p>Currently, only chained variables support a <code class="literal">@InverseRelationShadowVariable</code>
        annotation.</p></div><div class="section" title="4.3.6.3. Anchor shadow variable"><div class="titlepage"><div><div><h4 class="title"><a id="anchorShadowVariable"/>4.3.6.3. Anchor shadow variable</h4></div></div></div><p>An anchor shadow variable is the anchor of <a class="link" href="#chainedPlanningVariable" title="4.3.5.4. Chained planning variable (TSP, VRP, ...)">a chained
        variable</a>.</p><p>Annotate the anchor property as a <code class="literal">@AnchorShadowVariable</code> annotation:</p><pre><code class="language-java">@PlanningEntity
public class Customer {

    @AnchorShadowVariable(sourceVariableName = "previousStandstill")
    public Vehicle getVehicle() {...}
    public void setVehicle(Vehicle vehicle) {...}

}</code></pre><p>The <code class="literal">sourceVariableName</code> property is the name of the chained variable on the same entity
        class.</p></div><div class="section" title="4.3.6.4. Custom VariableListener"><div class="titlepage"><div><div><h4 class="title"><a id="customVariableListener"/>4.3.6.4. Custom <code class="literal">VariableListener</code></h4></div></div></div><p>To update a shadow variable, Planner uses a <code class="literal">VariableListener</code>. To define a custom shadow
        variable, write a custom <code class="literal">VariableListener</code>: implement the interface and annotate it on the
        shadow variable that needs to change.</p><pre><code class="language-java">    @PlanningVariable(...)
    public Standstill getPreviousStandstill() {
        return previousStandstill;
    }

    @CustomShadowVariable(variableListenerClass = VehicleUpdatingVariableListener.class,
            sources = {@CustomShadowVariable.Source(variableName = "previousStandstill")})
    public Vehicle getVehicle() {
        return vehicle;
    }</code></pre><p>The <code class="literal">variableName</code> is the variable that triggers changes in the shadow
        variable(s).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the class of the trigger variable is different than the shadow variable, also specify the
          <code class="literal">entityClass</code> on <code class="literal">@CustomShadowVariable.Source</code>. In that case, make sure
          that that <code class="literal">entityClass</code> is also properly configured as a planning entity class in the solver
          config, or the <code class="literal">VariableListener</code> will simply never trigger.</p><p>Any class that has at least 1 shadow variable, is a planning entity class, even it has no genuine
          planning variables.</p></div><p>For example, the <code class="literal">VehicleUpdatingVariableListener</code> assures that every
        <code class="literal">Customer</code> in a chain has the same <code class="literal">Vehicle</code>, namely the chain's
        anchor.</p><pre><code class="language-java">public class VehicleUpdatingVariableListener implements VariableListener&lt;Customer&gt; {

    public void afterEntityAdded(ScoreDirector scoreDirector, Customer customer) {
        updateVehicle(scoreDirector, customer);
    }

    public void afterVariableChanged(ScoreDirector scoreDirector, Customer customer) {
        updateVehicle(scoreDirector, customer);
    }

    ...

    protected void updateVehicle(ScoreDirector scoreDirector, Customer sourceCustomer) {
        Standstill previousStandstill = sourceCustomer.getPreviousStandstill();
        Vehicle vehicle = previousStandstill == null ? null : previousStandstill.getVehicle();
        Customer shadowCustomer = sourceCustomer;
        while (shadowCustomer != null &amp;&amp; shadowCustomer.getVehicle() != vehicle) {
            scoreDirector.beforeVariableChanged(shadowCustomer, "vehicle");
            shadowCustomer.setVehicle(vehicle);
            scoreDirector.afterVariableChanged(shadowCustomer, "vehicle");
            shadowCustomer = shadowCustomer.getNextCustomer();
        }
    }

}</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>A <code class="literal">VariableListener</code> can only change shadow variables. It must never change a genuine
          planning variable or a problem fact.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Any change of a shadow variable must be told to the <code class="literal">ScoreDirector</code>.</p></div></div></div><div class="section" title="4.3.7. Planning problem and planning solution"><div class="titlepage"><div><div><h3 class="title"><a id="planningProblemAndPlanningSolution"/>4.3.7. Planning problem and planning solution</h3></div></div></div><div class="section" title="4.3.7.1. Planning problem instance"><div class="titlepage"><div><div><h4 class="title"><a id="planningProblemInstance"/>4.3.7.1. Planning problem instance</h4></div></div></div><p>A dataset for a planning problem needs to be wrapped in a class for the <code class="literal">Solver</code> to
        solve. You must implement this class. For example in n queens, this in the <code class="literal">NQueens</code> class
        which contains a <code class="literal">Column</code> list, a <code class="literal">Row</code> list and a <code class="literal">Queen</code>
        list.</p><p>A planning problem is actually a unsolved planning solution or - stated differently - an uninitialized
        <code class="literal">Solution</code>. Therefore, that wrapping class must implement the <code class="literal">Solution</code>
        interface. For example in n queens, that <code class="literal">NQueens</code> class implements
        <code class="literal">Solution</code>, yet every <code class="literal">Queen</code> in a fresh <code class="literal">NQueens</code> class is
        not yet assigned to a <code class="literal">Row</code> (their <code class="literal">row</code> property is <code class="literal">null</code>).
        So it's not a feasible solution. It's not even a possible solution. It's an uninitialized solution.</p></div><div class="section" title="4.3.7.2. Solution interface"><div class="titlepage"><div><div><h4 class="title"><a id="solutionInterface"/>4.3.7.2. <code class="literal">Solution</code> interface</h4></div></div></div><p>You need to present the problem as a <code class="literal">Solution</code> instance to the
        <code class="literal">Solver</code>. So you need to have a class that implements the <code class="literal">Solution</code>
        interface:</p><pre><code class="language-java">public interface Solution&lt;S extends Score&gt; {

    S getScore();
    void setScore(S score);

    Collection&lt;? extends Object&gt; getProblemFacts();

}</code></pre><p>For example, an <code class="literal">NQueens</code> instance holds a list of all columns, all rows and all
        <code class="literal">Queen</code> instances:</p><pre><code class="language-java">public class NQueens implements Solution&lt;SimpleScore&gt; {

    private int n;

    // Problem facts
    private List&lt;Column&gt; columnList;
    private List&lt;Row&gt; rowList;

    // Planning entities
    private List&lt;Queen&gt; queenList;

    // ...
}</code></pre></div><div class="section" title="4.3.7.3. The getScore() and setScore() methods"><div class="titlepage"><div><div><h4 class="title"><a id="getScoreAndSetScoreMethods"/>4.3.7.3. The <code class="literal">getScore()</code> and <code class="literal">setScore()</code> methods</h4></div></div></div><p>A <code class="literal">Solution</code> requires a score property. The score property is <code class="literal">null</code> if
        the <code class="literal">Solution</code> is uninitialized or if the score has not yet been (re)calculated. The
        <code class="literal">score</code> property is usually typed to the specific <code class="literal">Score</code> implementation you
        use. For example, <code class="literal">NQueens</code> uses a <code class="literal">SimpleScore</code>:</p><pre><code class="language-java">public class NQueens implements Solution&lt;SimpleScore&gt; {

    private SimpleScore score;

    public SimpleScore getScore() {
        return score;
    }

    public void setScore(SimpleScore score) {
        this.score = score;
    }

    // ...
}</code></pre><p>Most use cases use a <code class="literal">HardSoftScore</code> instead:</p><pre><code class="language-java">public class CourseSchedule implements Solution&lt;HardSoftScore&gt; {

    private HardSoftScore score;

    public HardSoftScore getScore() {
        return score;
    }

    public void setScore(HardSoftScore score) {
        this.score = score;
    }

    // ...
}</code></pre><p>See the Score calculation section for more information on the <code class="literal">Score</code>
        implementations.</p></div><div class="section" title="4.3.7.4. The getProblemFacts() method"><div class="titlepage"><div><div><h4 class="title"><a id="getProblemFacts"/>4.3.7.4. The <code class="literal">getProblemFacts()</code> method</h4></div></div></div><p>The method is only used if Drools is used for score calculation. Other score directors do not use
        it.</p><p>All objects returned by the <code class="literal">getProblemFacts()</code> method will be asserted into the Drools
        working memory, so the score rules can access them. For example, <code class="literal">NQueens</code> just returns all
        <code class="literal">Column</code> and <code class="literal">Row</code> instances.</p><pre><code class="language-java">    public Collection&lt;? extends Object&gt; getProblemFacts() {
        List&lt;Object&gt; facts = new ArrayList&lt;Object&gt;();
        facts.addAll(columnList);
        facts.addAll(rowList);
        // Do not add the planning entity's (queenList) because that will be done automatically
        return facts;
    }</code></pre><p><span class="emphasis"><em>All planning entities are automatically inserted into the Drools working memory.</em></span> Do
        not add them in the method <code class="literal">getProblemFacts()</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A common mistake is to use <code class="literal">facts.add(...)</code> instead of
          <code class="literal">fact.addAll(...)</code> for a <code class="literal">Collection</code>, which leads to score rules failing to
          match because the elements of that <code class="literal">Collection</code> aren't in the Drools working memory.</p></div><p>The <code class="literal">getProblemFacts()</code> method is not called much: at most only once per solver phase per
        solver thread.</p></div><div class="section" title="4.3.7.5. Cached problem fact"><div class="titlepage"><div><div><h4 class="title"><a id="cachedProblemFact"/>4.3.7.5. Cached problem fact</h4></div></div></div><p>A cached problem fact is a problem fact that doesn't exist in the real domain model, but is calculated
        before the <code class="literal">Solver</code> really starts solving. The <code class="literal">getProblemFacts()</code> method has
        the chance to enrich the domain model with such cached problem facts, which can lead to simpler and faster score
        constraints.</p><p>For example in examination, a cached problem fact <code class="literal">TopicConflict</code> is created for every 2
        <code class="literal">Topic</code>'s which share at least 1 <code class="literal">Student</code>.</p><pre><code class="language-java">    public Collection&lt;? extends Object&gt; getProblemFacts() {
        List&lt;Object&gt; facts = new ArrayList&lt;Object&gt;();
        // ...
        facts.addAll(calculateTopicConflictList());
        // ...
        return facts;
    }

    private List&lt;TopicConflict&gt; calculateTopicConflictList() {
        List&lt;TopicConflict&gt; topicConflictList = new ArrayList&lt;TopicConflict&gt;();
        for (Topic leftTopic : topicList) {
            for (Topic rightTopic : topicList) {
                if (leftTopic.getId() &lt; rightTopic.getId()) {
                    int studentSize = 0;
                    for (Student student : leftTopic.getStudentList()) {
                        if (rightTopic.getStudentList().contains(student)) {
                            studentSize++;
                        }
                    }
                    if (studentSize &gt; 0) {
                        topicConflictList.add(new TopicConflict(leftTopic, rightTopic, studentSize));
                    }
                }
            }
        }
        return topicConflictList;
    }</code></pre><p>Any score constraint that needs to check if no 2 exams have a topic which share a student are being
        scheduled close together (depending on the constraint: at the same time, in a row or in the same day), can
        simply use the <code class="literal">TopicConflict</code> instance as a problem fact, instead of having to combine every 2
        <code class="literal">Student</code> instances.</p></div><div class="section" title="4.3.7.6. Cloning a Solution"><div class="titlepage"><div><div><h4 class="title"><a id="cloningASolution"/>4.3.7.6. Cloning a <code class="literal">Solution</code></h4></div></div></div><p>Most (if not all) optimization algorithms clone the solution each time they encounter a new best solution
        (so they can recall it later) or to work with multiple solutions in parallel.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>There are many ways to clone, such as a shallow clone, deep clone, ... This context focuses on
          <span class="emphasis"><em>a planning clone</em></span>.</p></div><p>A planning clone of a <code class="literal">Solution</code> must fulfill these requirements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The clone must represent the same planning problem. Usually it reuses the same instances of the
            problem facts and problem fact collections as the original.</p></li><li class="listitem"><p>The clone must use different, cloned instances of the entities and entity collections. Changes to an
            original <code class="literal">Solution</code>'s entity's variables must not effect its clone.</p></li></ul></div><div class="mediaobject"><img src="images/Chapter-Planner_configuration/solutionCloning.png"/></div><p><span class="bold"><strong>Implementing a planning clone method is hard, therefore you don't need to implement
        it.</strong></span></p><div class="section" title="4.3.7.6.1. FieldAccessingSolutionCloner"><div class="titlepage"><div><div><h5 class="title"><a id="fieldAccessingSolutionCloner"/>4.3.7.6.1. <code class="literal">FieldAccessingSolutionCloner</code></h5></div></div></div><p>This <code class="literal">SolutionCloner</code> is used by default. It works well for most use cases.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>When the <code class="literal">FieldAccessingSolutionCloner</code> clones your entity collection, it might not
            recognize the implementation and replace it with <code class="literal">ArrayList</code>,
            <code class="literal">LinkedHashSet</code> or <code class="literal">TreeSet</code> (whichever is more applicable). It recognizes
            most of the common JDK <code class="literal">Collection</code> implementations.</p></div><p>The <code class="literal">FieldAccessingSolutionCloner</code> does not clone problem facts by default. If any of
          your problem facts needs to be deep cloned for a planning clone, for example if the problem fact references a
          planning entity or the planning solution, mark it with a <code class="literal">@DeepPlanningClone</code>
          annotation:</p><pre><code class="language-java">@DeepPlanningClone
public class SeatDesignationDependency {
    private SeatDesignation leftSeatDesignation; // planning entity
    private SeatDesignation rightSeatDesignation; // planning entity
    ...
}</code></pre><p>In the example above, because <code class="literal">SeatDesignation</code> is a planning entity (which is deep
          planning cloned automatically), <code class="literal">SeatDesignationDependency</code> must be deep planning cloned
          too.</p><p>Alternatively, the <code class="literal">@DeepPlanningClone</code> annotation can also be used on a getter
          method.</p></div><div class="section" title="4.3.7.6.2. Custom cloning: Make Solution implement PlanningCloneable"><div class="titlepage"><div><div><h5 class="title"><a id="customCloning"/>4.3.7.6.2. Custom cloning: Make <code class="literal">Solution</code> implement <code class="literal">PlanningCloneable</code></h5></div></div></div><p>If your <code class="literal">Solution</code> implements <code class="literal">PlanningCloneable</code>, Planner will
          automatically choose to clone it by calling the <code class="literal">planningClone()</code> method.</p><pre><code class="language-java">public interface PlanningCloneable&lt;T&gt; {

    T planningClone();

}</code></pre><p>For example: If <code class="literal">NQueens</code> implements <code class="literal">PlanningCloneable</code>, it would
          only deep clone all <code class="literal">Queen</code> instances. When the original solution is changed during planning,
          by changing a <code class="literal">Queen</code>, the clone stays the same.</p><pre><code class="language-java">public class NQueens implements Solution&lt;...&gt;, PlanningCloneable&lt;NQueens&gt; {
    ...

    /**
     * Clone will only deep copy the {@link #queenList}.
     */
    public NQueens planningClone() {
        NQueens clone = new NQueens();
        clone.id = id;
        clone.n = n;
        clone.columnList = columnList;
        clone.rowList = rowList;
        List&lt;Queen&gt; clonedQueenList = new ArrayList&lt;Queen&gt;(queenList.size());
        for (Queen queen : queenList) {
            clonedQueenList.add(queen.planningClone());
        }
        clone.queenList = clonedQueenList;
        clone.score = score;
        return clone;
    }
}</code></pre><p><span class="emphasis"><em>The <code class="literal">planningClone()</code> method should only deep clone the planning
          entities.</em></span> Notice that the problem facts, such as <code class="literal">Column</code> and
          <code class="literal">Row</code> are normally <span class="emphasis"><em>not</em></span> cloned: even their <code class="literal">List</code>
          instances are <span class="emphasis"><em>not</em></span> cloned. If you were to clone the problem facts too, then you'd have to
          make sure that the new planning entity clones also refer to the new problem facts clones used by the solution.
          For example, if you would clone all <code class="literal">Row</code> instances, then each <code class="literal">Queen</code> clone
          and the <code class="literal">NQueens</code> clone itself should refer to those new <code class="literal">Row</code>
          clones.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Cloning an entity with a <a class="link" href="#chainedPlanningVariable" title="4.3.5.4. Chained planning variable (TSP, VRP, ...)">chained</a> variable is devious: a
            variable of an entity A might point to another entity B. If A is cloned, then it's variable must point to
            the clone of B, not the original B.</p></div></div></div><div class="section" title="4.3.7.7. Create an uninitialized solution"><div class="titlepage"><div><div><h4 class="title"><a id="createAnUninitializedSolution"/>4.3.7.7. Create an uninitialized solution</h4></div></div></div><p>Create a <code class="literal">Solution</code> instance to represent your planning problem's dataset, so it can be set on the
        <code class="literal">Solver</code> as the planning problem to solve. For example in n queens, an
        <code class="literal">NQueens</code> instance is created with the required <code class="literal">Column</code> and
        <code class="literal">Row</code> instances and every <code class="literal">Queen</code> set to a different <code class="literal">column</code>
        and every <code class="literal">row</code> set to <code class="literal">null</code>.</p><pre><code class="language-java">    private NQueens createNQueens(int n) {
        NQueens nQueens = new NQueens();
        nQueens.setId(0L);
        nQueens.setN(n);
        nQueens.setColumnList(createColumnList(nQueens));
        nQueens.setRowList(createRowList(nQueens));
        nQueens.setQueenList(createQueenList(nQueens));
        return nQueens;
    }

    private List&lt;Queen&gt; createQueenList(NQueens nQueens) {
        int n = nQueens.getN();
        List&lt;Queen&gt; queenList = new ArrayList&lt;Queen&gt;(n);
        long id = 0;
        for (Column column : nQueens.getColumnList()) {
            Queen queen = new Queen();
            queen.setId(id);
            id++;
            queen.setColumn(column);
            // Notice that we leave the PlanningVariable properties on null
            queenList.add(queen);
        }
        return queenList;
    }</code></pre><div class="figure"><a id="d0e4256"/><p class="title"><strong>Figure 4.1. Uninitialized solution for the 4 queens puzzle</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Planner_configuration/uninitializedNQueens04.png" alt="Uninitialized solution for the 4 queens puzzle"/></div></div></div><br class="figure-break"/><p>Usually, most of this data comes from your data layer, and your <code class="literal">Solution</code> implementation
        just aggregates that data and creates the uninitialized planning entity instances to plan:</p><pre><code class="language-java">        private void createLectureList(CourseSchedule schedule) {
            List&lt;Course&gt; courseList = schedule.getCourseList();
            List&lt;Lecture&gt; lectureList = new ArrayList&lt;Lecture&gt;(courseList.size());
            for (Course course : courseList) {
                for (int i = 0; i &lt; course.getLectureSize(); i++) {
                    Lecture lecture = new Lecture();
                    lecture.setCourse(course);
                    lecture.setLectureIndexInCourse(i);
                    // Notice that we leave the PlanningVariable properties (period and room) on null
                    lectureList.add(lecture);
                }
            }
            schedule.setLectureList(lectureList);
        }</code></pre></div></div></div><div class="section" title="4.4. Use the Solver"><div class="titlepage"><div><div><h2 class="title"><a id="useTheSolver"/>4.4. Use the <code class="literal">Solver</code></h2></div></div></div><div class="section" title="4.4.1. The Solver interface"><div class="titlepage"><div><div><h3 class="title"><a id="theSolverInterface"/>4.4.1. The <code class="literal">Solver</code> interface</h3></div></div></div><p>A <code class="literal">Solver</code> implementation will solve your planning problem.</p><pre><code class="language-java">public interface Solver {
    
    void solve(Solution planningProblem);

    Solution getBestSolution();

    // ...

}</code></pre><p>A <code class="literal">Solver</code> can only solve 1 planning problem instance at a time. A
      <code class="literal">Solver</code> should only be accessed from a single thread, except for the methods that are
      specifically javadocced as being thread-safe. It's built with a <code class="literal">SolverFactory</code>, do not implement
      or build it yourself.</p></div><div class="section" title="4.4.2. Solving a problem"><div class="titlepage"><div><div><h3 class="title"><a id="solvingAProblem"/>4.4.2. Solving a problem</h3></div></div></div><p>Solving a problem is quite easy once you have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A <code class="literal">Solver</code> built from a solver configuration</p></li><li class="listitem"><p>A <code class="literal">Solution</code> that represents the planning problem instance</p></li></ul></div><p>Just set the planning problem, solve it and extract the best solution:</p><pre><code class="language-java">    solver.solve(planningProblem);
    Solution bestSolution = solver.getBestSolution();</code></pre><p>For example in n queens, the <code class="literal">getBestSolution()</code> method will return an
      <code class="literal">NQueens</code> instance with every <code class="literal">Queen</code> assigned to a
      <code class="literal">Row</code>.</p><div class="figure"><a id="d0e4334"/><p class="title"><strong>Figure 4.2. Best solution for the 4 queens puzzle in 8 ms (also an optimal solution)</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Planner_configuration/solvedNQueens04.png" alt="Best solution for the 4 queens puzzle in 8 ms (also an optimal solution)"/></div></div></div><br class="figure-break"/><p>The <code class="literal">solve(Solution)</code> method can take a long time (depending on the problem size and the
      solver configuration). The <code class="literal">Solver</code> will remember (actually clone) the best solution it
      encounters during its solving. Depending on a number factors (including problem size, how much time the
      <code class="literal">Solver</code> has, the solver configuration, ...), that best solution will be a feasible or even an
      optimal solution.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <code class="literal">Solution</code> instance given to the method <code class="literal">solve(Solution)</code> will be
        changed by the <code class="literal">Solver</code>, but do not mistake it for the best solution.</p><p>The <code class="literal">Solution</code> instance returned by the <code class="literal">getBestSolution()</code> method will
        most likely be a clone of the instance given to the method <code class="literal">solve(Solution)</code>, which means it's
        a different instance.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <code class="literal">Solution</code> instance given to the <code class="literal">solve(Solution)</code> method does not
        need to be uninitialized. It can be partially or fully initialized, which is likely to be the case in <a class="link" href="#repeatedPlanning" title="Chapter 15. Repeated planning">repeated planning</a>.</p></div></div><div class="section" title="4.4.3. Environment mode: Are there bugs in my code?"><div class="titlepage"><div><div><h3 class="title"><a id="environmentMode"/>4.4.3. Environment mode: Are there bugs in my code?</h3></div></div></div><p>The environment mode allows you to detect common bugs in your implementation. It does not affect the logging
      level.</p><p>You can set the environment mode in the solver configuration XML file:</p><pre><code class="language-xml">&lt;solver&gt;
  &lt;environmentMode&gt;FAST_ASSERT&lt;/environmentMode&gt;
  ...
&lt;/solver&gt;</code></pre><p>A solver has a single <code class="literal">Random</code> instance. Some solver configurations use the
      <code class="literal">Random</code> instance a lot more than others. For example Simulated Annealing depends highly on
      random numbers, while Tabu Search only depends on it to deal with score ties. The environment mode influences the
      seed of that <code class="literal">Random</code> instance.</p><p>These are the environment modes:</p><div class="section" title="4.4.3.1. FULL_ASSERT"><div class="titlepage"><div><div><h4 class="title"><a id="environmentModeFullAssert"/>4.4.3.1. FULL_ASSERT</h4></div></div></div><p>The FULL_ASSERT mode turns on all assertions (such as assert that the incremental score calculation is
        uncorrupted for each move) to fail-fast on a bug in a Move implementation, a score rule, the rule engine itself,
        ...</p><p>This mode is reproducible (see the reproducible mode). It is also intrusive because it calls the method
        <code class="literal">calculateScore()</code> more frequently than a non assert mode.</p><p>The FULL_ASSERT mode is horribly slow (because it doesn't rely on incremental score calculation).</p></div><div class="section" title="4.4.3.2. NON_INTRUSIVE_FULL_ASSERT"><div class="titlepage"><div><div><h4 class="title"><a id="environmentModeNonIntrusiveFullAssert"/>4.4.3.2. NON_INTRUSIVE_FULL_ASSERT</h4></div></div></div><p>The NON_INTRUSIVE_FULL_ASSERT turns on several assertions to fail-fast on a bug in a Move implementation,
        a score rule, the rule engine itself, ...</p><p>This mode is reproducible (see the reproducible mode). It is non-intrusive because it does not call the
        method <code class="literal">calculateScore()</code> more frequently than a non assert mode.</p><p>The NON_INTRUSIVE_FULL_ASSERT mode is horribly slow (because it doesn't rely on incremental score
        calculation).</p></div><div class="section" title="4.4.3.3. FAST_ASSERT"><div class="titlepage"><div><div><h4 class="title"><a id="environmentModeFastAssert"/>4.4.3.3. FAST_ASSERT</h4></div></div></div><p>The FAST_ASSERT mode turns on most assertions (such as assert that an undoMove's score is the same as
        before the Move) to fail-fast on a bug in a Move implementation, a score rule, the rule engine itself,
        ...</p><p>This mode is reproducible (see the reproducible mode). It is also intrusive because it calls the method
        <code class="literal">calculateScore()</code> more frequently than a non assert mode.</p><p>The FAST_ASSERT mode is slow.</p><p>It's recommended to write a test case which does a short run of your planning problem with the FAST_ASSERT
        mode on.</p></div><div class="section" title="4.4.3.4. REPRODUCIBLE (default)"><div class="titlepage"><div><div><h4 class="title"><a id="environmentModeReproducible"/>4.4.3.4. REPRODUCIBLE (default)</h4></div></div></div><p>The reproducible mode is the default mode because it is recommended during development. In this mode, 2
        runs in the same Planner version will execute the same code in the same order. <span class="bold"><strong>Those 2
        runs will have the same result at every step</strong></span>, except if the note below applies. This enables you to
        reproduce bugs consistently. It also allows you to benchmark certain refactorings (such as a score constraint
        performance optimization) fairly across runs.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Despite the reproducible mode, your application might still not be fully reproducible because of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Use of <code class="literal">HashSet</code> (or another <code class="literal">Collection</code> which has an
              inconsistent order between JVM runs) for collections of planning entities or planning values (but not
              normal problem facts), especially in the <code class="literal">Solution</code> implementation. Replace it with
              <code class="literal">LinkedHashSet</code>.</p></li><li class="listitem"><p>Combining a time gradient dependent algorithms (most notably Simulated Annealing) together with time
              spent termination. A sufficiently large difference in allocated CPU time will influence the time gradient
              values. Replace Simulated Annealing with Late Acceptance. Or instead, replace time spent termination with
              step count termination.</p></li></ul></div></div><p>The reproducible mode is slightly slower than the production mode. If your production environment requires
        reproducibility, use this mode in production too.</p><p>In practice, this mode uses the default, fixed <a class="link" href="#randomNumberGenerator" title="4.4.5. Random number generator">random seed</a> if
        no seed is specified, and it also disables certain concurrency optimizations (such as work stealing).</p></div><div class="section" title="4.4.3.5. PRODUCTION"><div class="titlepage"><div><div><h4 class="title"><a id="environmentModeProduction"/>4.4.3.5. PRODUCTION</h4></div></div></div><p>The production mode is the fastest, but it is not reproducible. It is recommended for a production
        environment, unless reproducibility is required.</p><p>In practice, this mode uses no fixed <a class="link" href="#randomNumberGenerator" title="4.4.5. Random number generator">random seed</a> if no seed is
        specified.</p></div></div><div class="section" title="4.4.4. Logging level: What is the Solver doing?"><div class="titlepage"><div><div><h3 class="title"><a id="logging"/>4.4.4. Logging level: What is the <code class="literal">Solver</code> doing?</h3></div></div></div><p>The best way to illuminate the black box that is a <code class="literal">Solver</code>, is to play with the logging
      level:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>error</strong></span>: Log errors, except those that are thrown to the calling code as
          a <code class="literal">RuntimeException</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p><span class="bold"><strong>If an error happens, Planner normally fails fast</strong></span>: it throws a
            subclass of <code class="literal">RuntimeException</code> with a detailed message to the calling code. It does not log
            it as an error itself to avoid duplicate log messages. Except if the calling code explicitly catches and
            eats that <code class="literal">RuntimeException</code>, a <code class="literal">Thread</code>'s default
            <code class="literal">ExceptionHandler</code> will log it as an error anyway. Meanwhile, the code is disrupted from
            doing further harm or obfuscating the error.</p></div></li><li class="listitem"><p><span class="bold"><strong>warn</strong></span>: Log suspicious circumstances.</p></li><li class="listitem"><p><span class="bold"><strong>info</strong></span>: Log every phase and the solver itself. See <a class="link" href="#scopeOverview" title="6.7. Scope overview">scope overview</a>.</p></li><li class="listitem"><p><span class="bold"><strong>debug</strong></span>: Log every step of every phase. See <a class="link" href="#scopeOverview" title="6.7. Scope overview">scope overview</a>.</p></li><li class="listitem"><p><span class="bold"><strong>trace</strong></span>: Log every move of every step of every phase. See <a class="link" href="#scopeOverview" title="6.7. Scope overview">scope overview</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Turning on <code class="literal">trace</code> logging, will slow down performance considerably: it's often 4
            times slower. However, it's invaluable during development to discover a bottleneck.</p><p>Even debug logging can slow down performance considerably for fast stepping algorithms (such as Late
            Acceptance and Simulated Annealing), but not for slow stepping algorithms (such as Tabu Search).</p></div></li></ul></div><p>For example, set it to <code class="literal">debug</code> logging, to see when the phases end and how fast steps are
      taken:</p><pre><code class="no-highlight">INFO  Solving started: time spent (3), best score (uninitialized/0), random (JDK with seed 0).
DEBUG     CH step (0), time spent (5), score (0), selected move count (1), picked move (col2@null =&gt; row0).
DEBUG     CH step (1), time spent (7), score (0), selected move count (3), picked move (col1@null =&gt; row2).
DEBUG     CH step (2), time spent (10), score (0), selected move count (4), picked move (col3@null =&gt; row3).
DEBUG     CH step (3), time spent (12), score (-1), selected move count (4), picked move (col0@null =&gt; row1).
INFO  Construction Heuristic phase (0) ended: step total (4), time spent (12), best score (-1).
DEBUG     LS step (0), time spent (19), score (-1),     best score (-1), accepted/selected move count (12/12), picked move (col1@row2 =&gt; row3).
DEBUG     LS step (1), time spent (24), score (0), new best score (0), accepted/selected move count (9/12), picked move (col3@row3 =&gt; row2).
INFO  Local Search phase (1) ended: step total (2), time spent (24), best score (0).
INFO  Solving ended: time spent (24), best score (0), average calculate count per second (1625).</code></pre><p>All time spent values are in milliseconds.</p><p>Everything is logged to <a class="link" href="http://www.slf4j.org/">SLF4J</a>, which is a simple logging
      facade which delegates every log message to Logback, Apache Commons Logging, Log4j or java.util.logging. Add a
      dependency to the logging adaptor for your logging framework of choice.</p><p>If you're not using any logging framework yet, use Logback by adding this Maven dependency (there is no need
      to add an extra bridge dependency):</p><pre><code class="language-xml">    &lt;dependency&gt;
      &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;
      &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;
      &lt;version&gt;1.x&lt;/version&gt;
    &lt;/dependency&gt;</code></pre><p>Configure the logging level on the <code class="literal">org.optaplanner</code> package in your
      <code class="filename">logback.xml</code> file:</p><pre><code class="language-xml">&lt;configuration&gt;

  &lt;logger name="org.optaplanner" level="debug"/&gt;

  ...

&lt;configuration&gt;</code></pre><p>If instead, you're still using Log4J 1.x (and you don't want to switch to its faster successor, Logback),
      add the bridge dependency:</p><pre><code class="language-xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
      &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
      &lt;version&gt;1.x&lt;/version&gt;
    &lt;/dependency&gt;</code></pre><p>And configure the logging level on the package <code class="literal">org.optaplanner</code> in your
      <code class="filename">log4j.xml</code> file:</p><pre><code class="language-xml">&lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"&gt;

  &lt;category name="org.optaplanner"&gt;
    &lt;priority value="debug" /&gt;
  &lt;/category&gt;

  ...

&lt;/log4j:configuration&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In a multitenant application, multiple <code class="literal">Solver</code> instances might be running at the same
        time. To separate their logging into distinct files, surround the <code class="literal">solve()</code> call with an <a class="link" href="http://logback.qos.ch/manual/mdc.html">MDC</a>:</p><pre><code class="language-java">        MDC.put("tenant.name",tenantName);
        solver.solve(planningProblem);
        Solution bestSolution = solver.getBestSolution();
        MDC.remove("tenant.name");</code></pre><p>Then configure your logger to use different files for each <code class="literal">${tenant.name}</code>. For example
        in Logback, use a <code class="literal">SiftingAppender</code> in <code class="literal">logback.xml</code>:</p><pre><code class="language-xml">  &lt;appender name="fileAppender" class="ch.qos.logback.classic.sift.SiftingAppender"&gt;
    &lt;discriminator&gt;
      &lt;key&gt;tenant.name&lt;/key&gt;
      &lt;defaultValue&gt;unknown&lt;/defaultValue&gt;
    &lt;/discriminator&gt;
    &lt;sift&gt;
      &lt;appender name="fileAppender.${tenant.name}" class="...FileAppender"&gt;
        &lt;file&gt;local/log/optaplanner-${tenant.name}.log&lt;/file&gt;
        ...
      &lt;/appender&gt;
    &lt;/sift&gt;
  &lt;/appender&gt;</code></pre></div></div><div class="section" title="4.4.5. Random number generator"><div class="titlepage"><div><div><h3 class="title"><a id="randomNumberGenerator"/>4.4.5. Random number generator</h3></div></div></div><p>Many heuristics and metaheuristics depend on a pseudorandom number generator for move selection, to resolve
      score ties, probability based move acceptance, ... During solving, the same <code class="literal">Random</code> instance is
      reused to improve reproducibility, performance and uniform distribution of random values.</p><p>To change the random seed of that <code class="literal">Random</code> instance, specify a
      <code class="literal">randomSeed</code>:</p><pre><code class="language-xml">&lt;solver&gt;
  &lt;randomSeed&gt;0&lt;/randomSeed&gt;
  ...
&lt;/solver&gt;</code></pre><p>To change the pseudorandom number generator implementation, specify a <code class="literal">randomType</code>:</p><pre><code class="language-xml">&lt;solver&gt;
  &lt;randomType&gt;MERSENNE_TWISTER&lt;/randomType&gt;
  ...
&lt;/solver&gt;</code></pre><p>The following types are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">JDK</code> (default): Standard implementation (<code class="literal">java.util.Random</code>).</p></li><li class="listitem"><p><code class="literal">MERSENNE_TWISTER</code>: Implementation by <a class="link" href="http://commons.apache.org/proper/commons-math/userguide/random.html">Commons Math</a>.</p></li><li class="listitem"><p><code class="literal">WELL512A</code>, <code class="literal">WELL1024A</code>, <code class="literal">WELL19937A</code>,
          <code class="literal">WELL19937C</code>, <code class="literal">WELL44497A</code> and <code class="literal">WELL44497B</code>: Implementation
          by <a class="link" href="http://commons.apache.org/proper/commons-math/userguide/random.html">Commons Math</a>.</p></li></ul></div><p>For most use cases, the randomType has no significant impact on the average quality of the best solution on
      multiple datasets. If you want to confirm this on your use case, use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">benchmarker</a>.</p></div></div></div><div class="chapter" title="Chapter 5. Score calculation"><div class="titlepage"><div><div><h2 class="title"><a id="scoreCalculation"/>Chapter 5. Score calculation</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#scoreTerminology">5.1. Score terminology</a></span></dt><dd><dl><dt><span class="section"><a href="#whatIsAScore">5.1.1. What is a score?</a></span></dt><dt><span class="section"><a href="#scoreConstraintSignum">5.1.2. Score constraint signum (positive or negative)</a></span></dt><dt><span class="section"><a href="#scoreConstraintWeight">5.1.3. Score constraint weight</a></span></dt><dt><span class="section"><a href="#scoreLevel">5.1.4. Score level</a></span></dt><dt><span class="section"><a href="#paretoScoring">5.1.5. Pareto scoring (AKA multi-objective optimization scoring)</a></span></dt><dt><span class="section"><a href="#combiningScoreTechniques">5.1.6. Combining score techniques</a></span></dt><dt><span class="section"><a href="#scoreInterface">5.1.7. <code class="literal">Score</code> interface</a></span></dt><dt><span class="section"><a href="#avoidFloatingPointNumbersInScoreCalculation">5.1.8. Avoid floating point numbers in score calculation</a></span></dt></dl></dd><dt><span class="section"><a href="#scoreDefinition">5.2. Choose a Score definition</a></span></dt><dd><dl><dt><span class="section"><a href="#simpleScore">5.2.1. SimpleScore</a></span></dt><dt><span class="section"><a href="#hardSoftScore">5.2.2. HardSoftScore (recommended)</a></span></dt><dt><span class="section"><a href="#hardMediumSoftScore">5.2.3. HardMediumSoftScore</a></span></dt><dt><span class="section"><a href="#bendableScore">5.2.4. BendableScore</a></span></dt><dt><span class="section"><a href="#customScore">5.2.5. Implementing a custom Score</a></span></dt></dl></dd><dt><span class="section"><a href="#calculateTheScore">5.3. Calculate the <code class="literal">Score</code></a></span></dt><dd><dl><dt><span class="section"><a href="#scoreCalculationTypes">5.3.1. Score calculation types</a></span></dt><dt><span class="section"><a href="#easyJavaScoreCalculation">5.3.2. Easy Java score calculation</a></span></dt><dt><span class="section"><a href="#incrementalJavaScoreCalculation">5.3.3. Incremental Java score calculation</a></span></dt><dt><span class="section"><a href="#droolsScoreCalculation">5.3.4. Drools score calculation</a></span></dt><dt><span class="section"><a href="#initializingScoreTrend">5.3.5. InitializingScoreTrend</a></span></dt><dt><span class="section"><a href="#invalidScoreDetection">5.3.6. Invalid score detection</a></span></dt></dl></dd><dt><span class="section"><a href="#scoreCalculationPerformanceTricks">5.4. Score calculation performance tricks</a></span></dt><dd><dl><dt><span class="section"><a href="#scoreCalculationPerformanceTricksOverview">5.4.1. Overview</a></span></dt><dt><span class="section"><a href="#averageCalculationCountPerSecond">5.4.2. Average calculation count per second</a></span></dt><dt><span class="section"><a href="#incrementalScoreCalculation">5.4.3. Incremental score calculation (with delta's)</a></span></dt><dt><span class="section"><a href="#avoidCallingRemoteServicesDuringScoreCalculation">5.4.4. Avoid calling remote services during score calculation</a></span></dt><dt><span class="section"><a href="#pointlessConstraints">5.4.5. Pointless constraints</a></span></dt><dt><span class="section"><a href="#buildInHardConstraint">5.4.6. Built-in hard constraint</a></span></dt><dt><span class="section"><a href="#otherScoreCalculationPerformanceTricks">5.4.7. Other score calculation performance tricks</a></span></dt><dt><span class="section"><a href="#scoreTrap">5.4.8. Score trap</a></span></dt><dt><span class="section"><a href="#stepLimitBenchmark">5.4.9. stepLimit benchmark</a></span></dt><dt><span class="section"><a href="#fairnessScoreConstraints">5.4.10. Fairness score constraints</a></span></dt></dl></dd><dt><span class="section"><a href="#explainingTheScore">5.5. Explaining the score: using score calculation outside the <code class="literal">Solver</code></a></span></dt></dl></div><div class="section" title="5.1. Score terminology"><div class="titlepage"><div><div><h2 class="title"><a id="scoreTerminology"/>5.1. Score terminology</h2></div></div></div><div class="section" title="5.1.1. What is a score?"><div class="titlepage"><div><div><h3 class="title"><a id="whatIsAScore"/>5.1.1. What is a score?</h3></div></div></div><p>Every initialized <code class="literal">Solution</code> has a score. That score is an objective way to compare 2
      solutions: the solution with the higher score is better. The <code class="literal">Solver</code> aims to find the
      <code class="literal">Solution</code> with the highest <code class="literal">Score</code> of all possible solutions. The
      <span class="emphasis"><em>best solution</em></span> is the <code class="literal">Solution</code> with the highest <code class="literal">Score</code>
      that <code class="literal">Solver</code> has encountered during solving, which might be the <span class="emphasis"><em>optimal
      solution</em></span>.</p><p>Planner cannot automatically know which <code class="literal">Solution</code> is best for your business, so you need
      to tell it how to calculate the score of a given <code class="literal">Solution</code> according to your business needs.
      If you forget or unable to implement an important constraint, the solution is probably useless:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/optimalWithIncompleteConstraints.png"/></div><p>Luckily, Planner is very flexible to define constraints, thanks to these score techniques, which can be
      used and combined as much as needed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Score signum (positive or negative)</strong></span>: maximize or minimize a constraint type.</p></li><li class="listitem"><p><span class="bold"><strong>Score weight</strong></span>: put a cost/profit on a constraint type.</p></li><li class="listitem"><p><span class="bold"><strong>Score level</strong></span>: prioritize a group of constraint types</p></li><li class="listitem"><p><span class="bold"><strong>Pareto scoring</strong></span></p></li></ul></div></div><div class="section" title="5.1.2. Score constraint signum (positive or negative)"><div class="titlepage"><div><div><h3 class="title"><a id="scoreConstraintSignum"/>5.1.2. Score constraint signum (positive or negative)</h3></div></div></div><p>All score techniques are based on constraints. Such a constraint can be a simple pattern (such as
      <span class="emphasis"><em>Maximize the apple harvest in the solution</em></span>) or a more complex pattern. A positive constraint
      is a constraint you're trying to maximize. A negative constraint is a constraint you're trying to minimize.</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/positiveAndNegativeConstraints.png"/></div><p>Notice in the image above, that the optimal solution always has the highest score, regardless if the
      constraints are positive or negative.</p><p>Most planning problems have only negative constraints and therefore have a negative score. In that case, the
      score is usually the sum of the weight of the negative constraints being broken, with a perfect score of 0. This
      explains why the score of a solution of 4 queens is the negative (and not the positive!) of the number of queen
      pairs which can attack each other.</p><p>Negative and positive constraints can be combined, even in the same score level.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Don't presume your business knows all its score constraints in advance. Expect score constraints to be
        added or changed after the first releases.</p></div><p>When a constraint activates (because the negative constraint is broken or the positive constraint is
      fulfilled) on a certain planning entity set, it is called a <span class="emphasis"><em>constraint match</em></span>.</p></div><div class="section" title="5.1.3. Score constraint weight"><div class="titlepage"><div><div><h3 class="title"><a id="scoreConstraintWeight"/>5.1.3. Score constraint weight</h3></div></div></div><p>Not all score constraints are equally important. If breaking one constraint is equally bad as breaking
      another constraint x times, then those 2 constraints have a different weight (but they are in the same score
      level). For example in vehicle routing, you can make1 "unhappy driver" constraint match count as much as 2 "fuel
      tank usage" constraint matches:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreWeighting.png"/></div><p>Score weighting is often used in use cases where you can put a price tag on everything. In that case, the
      positive constraints maximize revenue and the negative constraints minimize expenses: together they maximize
      profit. Alternatively, score weighting is also often used to create social fairness. For example: a nurse that
      requests a free day pays a higher weight on New Year's eve than on a normal day.</p><p>Put a good weight on a constraint can be a difficult analytical decision, because it's about making choices
      and tradeoffs with other constraints. However, a non-accurate weight is less damaging than not good
      algorithms:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreTradeoffInPerspective.png"/></div><p>Furthermore, it is often useful to allow the planning end-user to recalibrate penalty weights in his/her
      user interface, as demonstrated in the exam timetabling example.</p><p>The weight of a constraint match can be dynamically based on the planning entities involved. For example in
      cloud balance: the weight of the soft constraint match for an active <code class="literal">Computer</code> is the
      <code class="literal">cost</code> of that <code class="literal">Computer</code>.</p></div><div class="section" title="5.1.4. Score level"><div class="titlepage"><div><div><h3 class="title"><a id="scoreLevel"/>5.1.4. Score level</h3></div></div></div><p>Sometimes a score constraint outranks another score constraint, no matter how many times the other is
      broken. In that case, those score constraints are in different levels. For example: a nurse cannot do 2 shifts at
      the same time (due to the constraints of physical reality), this outranks all nurse happiness constraints.</p><p>Most use cases have only 2 score levels: hard and soft. When comparing 2 scores, they are compared
      lexicographically: the first score level gets compared first. If those differ, the others score levels are
      ignored. For example: a score that breaks 0 hard constraints and 1000000 soft constraints is better than a score
      that breaks 1 hard constraint and 0 soft constraints.</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreLevels.png"/></div><p>Score levels often employ score weighting per level. In such case, the hard constraint level usually makes
      the solution feasible and the soft constraint level maximizes profit by weighting the constraints on price.</p><p>Don't use a big constraint weight when your business actually wants different score levels. That hack, known
      as <span class="emphasis"><em>score folding</em></span>, is broken:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreFoldingIsBroken.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Your business will probably tell you that your hard constraints all have the same weight, because they
        cannot be broken (so their weight does not matter). This is not true and it could create a <a class="link" href="#scoreTrap" title="5.4.8. Score trap">score trap</a>. For example in cloud balance: if a <code class="literal">Computer</code> has 7 CPU
        too little for its <code class="literal">Process</code>es, then it must be weighted 7 times as much as if it had only 1
        CPU too little. This way, there is an incentive to move a <code class="literal">Process</code> with 6 CPU or less away
        from that Computer.</p></div><p>Three or more score levels are also supported. For example: a company might decide that profit outranks
      employee satisfaction (or visa versa), while both are outranked by the constraints of physical reality.</p></div><div class="section" title="5.1.5. Pareto scoring (AKA multi-objective optimization scoring)"><div class="titlepage"><div><div><h3 class="title"><a id="paretoScoring"/>5.1.5. Pareto scoring (AKA multi-objective optimization scoring)</h3></div></div></div><p>Far less common is the use case of pareto optimization, which is also known under the more confusing term
      multi-objective optimization. In pareto scoring, score constraints are in the same score level, yet they are not
      weighted against each other. When 2 scores are compared, each of the score constraints are compared individually
      and the score with the most dominating score constraints wins. Pareto scoring can even be combined with score
      levels and score constraint weighting.</p><p>Consider this example with positive constraints, where we want to get the most apples and oranges. Since
      it's impossible to compare apples and oranges, we can't weight them against each other. Yet, despite that we can't
      compare them, we can state that 2 apples are better then 1 apple. Similarly, we can state that 2 apples and 1
      orange are better than just 1 orange. So despite our inability to compare some Scores conclusively (at which point
      we declare them equal), we can find a set of optimal scores. Those are called pareto optimal.</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/paretoOptimizationScoring.png"/></div><p>Scores are considered equal far more often. It's left up to a human to choose the better out of a set of
      best solutions (with equal scores) found by Planner. In the example above, the user must choose between solution A
      (3 apples and 1 orange) and solution B (1 apple and 6 oranges). It's guaranteed that Planner has not found
      another solution which has more apples or more oranges or even a better combination of both (such as 2 apples and
      3 oranges).</p><p>To implement pareto scoring in Planner, <a class="link" href="#customScore" title="5.2.5. Implementing a custom Score">implement a custom
      <code class="literal">ScoreDefinition</code> and <code class="literal">Score</code></a> (and replace the
      <code class="literal">BestSolutionRecaller</code>). Future versions will provide out-of-the-box support.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A pareto <code class="literal">Score</code>'s <code class="literal">compareTo</code> method is not transitive because it does
        a pareto comparison. For example: having 2 apples is greater than 1 apple. 1 apple is equal to 1 orange. Yet, 2 apples
        are not greater than 1 orange (but actually equal). Pareto comparison violates the contract of the interface
        <code class="literal">java.lang.Comparable</code>'s <code class="literal">compareTo</code> method, but Planner's systems are
        <span class="emphasis"><em>pareto comparison safe</em></span>, unless explicitly stated otherwise in this documentation.</p></div></div><div class="section" title="5.1.6. Combining score techniques"><div class="titlepage"><div><div><h3 class="title"><a id="combiningScoreTechniques"/>5.1.6. Combining score techniques</h3></div></div></div><p>All the score techniques mentioned above, can be combined seamlessly:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreComposition.png"/></div></div><div class="section" title="5.1.7. Score interface"><div class="titlepage"><div><div><h3 class="title"><a id="scoreInterface"/>5.1.7. <code class="literal">Score</code> interface</h3></div></div></div><p>A score is represented by the <code class="literal">Score</code> interface, which naturally extends
      <code class="literal">Comparable</code>:</p><pre><code class="language-java">public interface Score&lt;...&gt; extends Comparable&lt;...&gt; {
    ...
}</code></pre><p>The <code class="literal">Score</code> implementation to use depends on your use case. Your score might not
      efficiently fit in a single <code class="literal">long</code> value. Planner has several built-in <code class="literal">Score</code>
      implementations, but you can implement a custom <code class="literal">Score</code> too. Most use cases tend to use the
      built-in <code class="literal">HardSoftScore</code>.</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreClassDiagram.png"/></div><p>The <code class="literal">Score</code> implementation (for example <code class="literal">HardSoftScore</code>) must be the same
      throughout a <code class="literal">Solver</code> runtime. The <code class="literal">Score</code> implementation is configured in the
      solver configuration as a ScoreDefinition:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    ...
  &lt;/scoreDirectorFactory&gt;</code></pre></div><div class="section" title="5.1.8. Avoid floating point numbers in score calculation"><div class="titlepage"><div><div><h3 class="title"><a id="avoidFloatingPointNumbersInScoreCalculation"/>5.1.8. Avoid floating point numbers in score calculation</h3></div></div></div><p>Avoid the use of <code class="literal">float</code> and <code class="literal">double</code> for score calculation. Use
      <code class="literal">BigDecimal</code> instead.</p><p>Floating point numbers (<code class="literal">float</code> and <code class="literal">double</code>) cannot represent a decimal
      number correctly. For example: a <code class="literal">double</code> cannot hold the value <code class="literal">0.05</code>
      correctly. Instead, it holds the nearest representable value. Arithmetic (including addition and subtraction) with
      floating point numbers, especially for planning problems, leads to incorrect decisions:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreWeightType.png"/></div><p>Additionally, floating point number addition is not associative:</p><pre><code class="language-java">System.out.println( ((0.01 + 0.02) + 0.03) == (0.01 + (0.02 + 0.03)) ); // returns false</code></pre><p>This leads to <span class="emphasis"><em>score corruption</em></span>.</p><p>Decimal numbers (<code class="literal">BigDecimal</code>) have none of these problems.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>BigDecimal arithmetic is considerably slower than <code class="literal">int</code>, <code class="literal">long</code> or
        <code class="literal">double</code> arithmetic. In experiments we've seen the average calculation count get divided by
        5.</p><p>Therefore, in some cases, it can be worthwhile to multiply <span class="emphasis"><em>all</em></span> numbers for a single
        score weight by a plural of ten (for example <code class="literal">1000</code>), so the score weight fits in an
        <code class="literal">int</code> or <code class="literal">long</code>.</p></div></div></div><div class="section" title="5.2. Choose a Score definition"><div class="titlepage"><div><div><h2 class="title"><a id="scoreDefinition"/>5.2. Choose a Score definition</h2></div></div></div><p>Each <code class="literal">Score</code> implementation also has a <code class="literal">ScoreDefinition</code> implementation. For
    example: <code class="literal">SimpleScore</code> is defined by <code class="literal">SimpleScoreDefinition</code>.</p><div class="section" title="5.2.1. SimpleScore"><div class="titlepage"><div><div><h3 class="title"><a id="simpleScore"/>5.2.1. SimpleScore</h3></div></div></div><p>A <code class="literal">SimpleScore</code> has a single <code class="literal">int</code> value, for example
      <code class="literal">-123</code>. It has a single score level.</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;SIMPLE&lt;/scoreDefinitionType&gt;
    ...
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Variants of this <code class="literal">scoreDefinitionType</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">SIMPLE_LONG</code>: Uses <code class="literal">SimpleLongScore</code> which has a
          <code class="literal">long</code> value instead of an <code class="literal">int</code> value.</p></li><li class="listitem"><p><code class="literal">SIMPLE_DOUBLE</code>: Uses <code class="literal">SimpleDoubleScore</code> which has a
          <code class="literal">double</code> value instead of an <code class="literal">int</code> value. <a class="link" href="#avoidFloatingPointNumbersInScoreCalculation" title="5.1.8. Avoid floating point numbers in score calculation">Not recommended to use.</a></p></li><li class="listitem"><p><code class="literal">SIMPLE_BIG_DECIMAL</code>: Uses <code class="literal">SimpleBigDecimalScore</code> which has a
          <code class="literal">BigDecimal</code> value instead of an <code class="literal">int</code> value.</p></li></ul></div></div><div class="section" title="5.2.2. HardSoftScore (recommended)"><div class="titlepage"><div><div><h3 class="title"><a id="hardSoftScore"/>5.2.2. HardSoftScore (recommended)</h3></div></div></div><p>A <code class="literal">HardSoftScore</code> has a hard <code class="literal">int</code> value and a soft <code class="literal">int</code>
      value, for example <code class="literal">-123hard/-456soft</code>. It has 2 score levels (hard and soft).</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    ...
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Variants of this <code class="literal">scoreDefinitionType</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">HARD_SOFT_LONG</code>: Uses <code class="literal">HardSoftLongScore</code> which has
          <code class="literal">long</code> values instead of <code class="literal">int</code> values.</p></li><li class="listitem"><p><code class="literal">HARD_SOFT_DOUBLE</code>: Uses <code class="literal">HardSoftDoubleScore</code> which has
          <code class="literal">double</code> values instead of <code class="literal">int</code> values. <a class="link" href="#avoidFloatingPointNumbersInScoreCalculation" title="5.1.8. Avoid floating point numbers in score calculation">Not recommended to use.</a></p></li><li class="listitem"><p><code class="literal">HARD_SOFT_BIG_DECIMAL</code>: Uses <code class="literal">HardSoftBigDecimalScore</code> which has
          <code class="literal">BigDecimal</code> values instead of <code class="literal">int</code> values.</p></li></ul></div></div><div class="section" title="5.2.3. HardMediumSoftScore"><div class="titlepage"><div><div><h3 class="title"><a id="hardMediumSoftScore"/>5.2.3. HardMediumSoftScore</h3></div></div></div><p>A <code class="literal">HardMediumSoftScore</code> which has a hard <code class="literal">int</code> value, a medium
      <code class="literal">int</code> value and a soft <code class="literal">int</code> value, for example
      <code class="literal">-123hard/-456medium/-789soft</code>. It has 3 score levels (hard, medium and soft).</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_MEDIUM_SOFT&lt;/scoreDefinitionType&gt;
    ...
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Variants of this <code class="literal">scoreDefinitionType</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">HARD_MEDIUM_SOFT_LONG</code>: Uses <code class="literal">HardMediumSoftLongScore</code> which has
          <code class="literal">long</code> values instead of <code class="literal">int</code> values.</p></li></ul></div></div><div class="section" title="5.2.4. BendableScore"><div class="titlepage"><div><div><h3 class="title"><a id="bendableScore"/>5.2.4. BendableScore</h3></div></div></div><p>A <code class="literal">BendableScore</code> has a configurable number of score levels. It has an array of hard
      <code class="literal">int</code> values and an array of soft <code class="literal">int</code> value, for example with 2 hard levels
      and 3 soft levels, the score can be <code class="literal">-123/-456/-789/-012/-345</code>.</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;BENDABLE&lt;/scoreDefinitionType&gt;
    &lt;bendableHardLevelsSize&gt;2&lt;/bendableHardLevelsSize&gt;
    &lt;bendableSoftLevelsSize&gt;3&lt;/bendableSoftLevelsSize&gt;
    ...
  &lt;/scoreDirectorFactory&gt;</code></pre><p>The number of hard and soft score levels needs to be set at configuration time: it's not flexible to change
      during solving.</p><p>Variants of this <code class="literal">scoreDefinitionType</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">BENDABLE_Long</code>: Uses <code class="literal">BendableLongScore</code> which has
            <code class="literal">long</code> values instead of <code class="literal">int</code> values.
          </p></li><li class="listitem"><p><code class="literal">BENDABLE_BIG_DECIMAL</code>: Uses <code class="literal">BendableBigDecimalScore</code> which has
          <code class="literal">BigDecimal</code> values instead of <code class="literal">int</code> values.</p></li></ul></div></div><div class="section" title="5.2.5. Implementing a custom Score"><div class="titlepage"><div><div><h3 class="title"><a id="customScore"/>5.2.5. Implementing a custom Score</h3></div></div></div><p>The <code class="literal">ScoreDefinition</code> interface defines the score representation.</p><p>To implement a custom <code class="literal">Score</code>, you'll also need to implement a custom <code class="literal">ScoreDefinition</code>.
      Extend <code class="literal">AbstractScoreDefinition</code> (preferably by copy pasting
      <code class="literal">HardSoftScoreDefinition</code>) and start from there.</p><p>Then hook your custom <code class="literal">ScoreDefinition</code> in your
      <code class="filename">SolverConfig.xml</code>:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionClass&gt;...MyScoreDefinition&lt;/scoreDefinitionClass&gt;
    ...
  &lt;/scoreDirectorFactory&gt;</code></pre></div></div><div class="section" title="5.3. Calculate the Score"><div class="titlepage"><div><div><h2 class="title"><a id="calculateTheScore"/>5.3. Calculate the <code class="literal">Score</code></h2></div></div></div><div class="section" title="5.3.1. Score calculation types"><div class="titlepage"><div><div><h3 class="title"><a id="scoreCalculationTypes"/>5.3.1. Score calculation types</h3></div></div></div><p>There are several ways to calculate the <code class="literal">Score</code> of a <code class="literal">Solution</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Easy Java score calculation</strong></span>: implement a single Java method</p></li><li class="listitem"><p><span class="bold"><strong>Incremental Java score calculation</strong></span>: implement multiple Java
          methods</p></li><li class="listitem"><p><span class="bold"><strong>Drools score calculation</strong></span> (recommended): implement score rules</p></li></ul></div><p>Every score calculation type can use any Score definition. For example, easy Java score calculation can
      output a <code class="literal">HardSoftScore</code>.</p><p>All score calculation types are Object Oriented and can reuse existing Java code.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>The score calculation should be read-only: it should not change the planning entities or the problem facts
        in any way. For example, it must not call a setter method on a planning entity in a Drools score rule's RHS.
        This does not apply to <span class="emphasis"><em>logically inserted</em></span> objects, which can be changed by the score rules
        that logically inserted them in the first place.</p><p>Planner will not recalculate the score of a <code class="literal">Solution</code> if it can predict it (unless
        an <a class="link" href="#environmentMode" title="4.4.3. Environment mode: Are there bugs in my code?">environmentMode assertion</a> is enabled). For example, after a winning
        step is done, there is no need to calculate the score because that move was done and undone earlier. As a
        result, there's no guarantee that such changes applied during score calculation are actually done.</p></div></div><div class="section" title="5.3.2. Easy Java score calculation"><div class="titlepage"><div><div><h3 class="title"><a id="easyJavaScoreCalculation"/>5.3.2. Easy Java score calculation</h3></div></div></div><p>An easy way to implement your score calculation in Java.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Advantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Plain old Java: no learning curve</p></li><li class="listitem"><p>Opportunity to delegate score calculation to an existing code base or legacy system</p></li></ul></div></li><li class="listitem"><p>Disadvantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Slower and less scalable</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Because there is no <a class="link" href="#incrementalScoreCalculation" title="5.4.3. Incremental score calculation (with delta's)">incremental score
                  calculation</a></p></li></ul></div></li></ul></div></li></ul></div><p>Just implement one method of the interface <code class="literal">EasyScoreCalculator</code>:</p><pre><code class="language-java">public interface EasyScoreCalculator&lt;Sol extends Solution&gt; {

    Score calculateScore(Sol solution);
   
}</code></pre><p>For example in n queens:</p><pre><code class="language-java">public class NQueensEasyScoreCalculator implements EasyScoreCalculator&lt;NQueens&gt; {

    public SimpleScore calculateScore(NQueens nQueens) {
        int n = nQueens.getN();
        List&lt;Queen&gt; queenList = nQueens.getQueenList();
        
        int score = 0;
        for (int i = 0; i &lt; n; i++) {
            for (int j = i + 1; j &lt; n; j++) {
                Queen leftQueen = queenList.get(i);
                Queen rightQueen = queenList.get(j);
                if (leftQueen.getRow() != null &amp;&amp; rightQueen.getRow() != null) {
                    if (leftQueen.getRowIndex() == rightQueen.getRowIndex()) {
                        score--;
                    }
                    if (leftQueen.getAscendingDiagonalIndex() == rightQueen.getAscendingDiagonalIndex()) {
                        score--;
                    }
                    if (leftQueen.getDescendingDiagonalIndex() == rightQueen.getDescendingDiagonalIndex()) {
                        score--;
                    }
                }
            }
        }
        return SimpleScore.valueOf(score);
    }

}</code></pre><p>Configure it in your solver configuration:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;...&lt;/scoreDefinitionType&gt;
    &lt;easyScoreCalculatorClass&gt;org.optaplanner.examples.nqueens.solver.score.NQueensEasyScoreCalculator&lt;/easyScoreCalculatorClass&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Alternatively, build a <code class="literal">EasyScoreCalculator</code> instance at runtime and set it with the
      programmatic API:</p><pre><code class="language-java">    solverFactory.getSolverConfig().getScoreDirectorFactoryConfig.setEasyScoreCalculator(easyScoreCalculator);</code></pre></div><div class="section" title="5.3.3. Incremental Java score calculation"><div class="titlepage"><div><div><h3 class="title"><a id="incrementalJavaScoreCalculation"/>5.3.3. Incremental Java score calculation</h3></div></div></div><p>A way to implement your score calculation incrementally in Java.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Advantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Very fast and scalable</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Currently the fastest if implemented correctly</p></li></ul></div></li></ul></div></li><li class="listitem"><p>Disadvantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Hard to write</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A scalable implementation heavily uses maps, indexes, ... (things the Drools rule engine can do
                  for you)</p></li><li class="listitem"><p>You have to learn, design, write and improve all these performance optimizations yourself</p></li></ul></div></li><li class="listitem"><p>Hard to read</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Regular score constraint changes can lead to a high maintenance cost</p></li></ul></div></li></ul></div></li></ul></div><p>Implement all the methods of the interface <code class="literal">IncrementalScoreCalculator</code> and extend the
      class <code class="literal">AbstractIncrementalScoreCalculator</code>:</p><pre><code class="language-java">public interface IncrementalScoreCalculator&lt;Sol extends Solution&gt; {

    void resetWorkingSolution(Sol workingSolution);

    void beforeEntityAdded(Object entity);

    void afterEntityAdded(Object entity);

    void beforeVariableChanged(Object entity, String variableName);

    void afterVariableChanged(Object entity, String variableName);

    void beforeEntityRemoved(Object entity);

    void afterEntityRemoved(Object entity);

    Score calculateScore();
    
}</code></pre><div class="mediaobject"><img src="images/Chapter-Score_calculation/incrementalScoreCalculatorSequenceDiagram.png"/></div><p>For example in n queens:</p><pre><code class="language-java">public class NQueensAdvancedIncrementalScoreCalculator extends AbstractIncrementalScoreCalculator&lt;NQueens&gt; {

    private Map&lt;Integer, List&lt;Queen&gt;&gt; rowIndexMap;
    private Map&lt;Integer, List&lt;Queen&gt;&gt; ascendingDiagonalIndexMap;
    private Map&lt;Integer, List&lt;Queen&gt;&gt; descendingDiagonalIndexMap;

    private int score;

    public void resetWorkingSolution(NQueens nQueens) {
        int n = nQueens.getN();
        rowIndexMap = new HashMap&lt;Integer, List&lt;Queen&gt;&gt;(n);
        ascendingDiagonalIndexMap = new HashMap&lt;Integer, List&lt;Queen&gt;&gt;(n * 2);
        descendingDiagonalIndexMap = new HashMap&lt;Integer, List&lt;Queen&gt;&gt;(n * 2);
        for (int i = 0; i &lt; n; i++) {
            rowIndexMap.put(i, new ArrayList&lt;Queen&gt;(n));
            ascendingDiagonalIndexMap.put(i, new ArrayList&lt;Queen&gt;(n));
            descendingDiagonalIndexMap.put(i, new ArrayList&lt;Queen&gt;(n));
            if (i != 0) {
                ascendingDiagonalIndexMap.put(n - 1 + i, new ArrayList&lt;Queen&gt;(n));
                descendingDiagonalIndexMap.put((-i), new ArrayList&lt;Queen&gt;(n));
            }
        }
        score = 0;
        for (Queen queen : nQueens.getQueenList()) {
            insert(queen);
        }
    }

    public void beforeEntityAdded(Object entity) {
        // Do nothing
    }

    public void afterEntityAdded(Object entity) {
        insert((Queen) entity);
    }

    public void beforeVariableChanged(Object entity, String variableName) {
        retract((Queen) entity);
    }

    public void afterVariableChanged(Object entity, String variableName) {
        insert((Queen) entity);
    }

    public void beforeEntityRemoved(Object entity) {
        retract((Queen) entity);
    }

    public void afterEntityRemoved(Object entity) {
        // Do nothing
    }

    private void insert(Queen queen) {
        Row row = queen.getRow();
        if (row != null) {
            int rowIndex = queen.getRowIndex();
            List&lt;Queen&gt; rowIndexList = rowIndexMap.get(rowIndex);
            score -= rowIndexList.size();
            rowIndexList.add(queen);
            List&lt;Queen&gt; ascendingDiagonalIndexList = ascendingDiagonalIndexMap.get(queen.getAscendingDiagonalIndex());
            score -= ascendingDiagonalIndexList.size();
            ascendingDiagonalIndexList.add(queen);
            List&lt;Queen&gt; descendingDiagonalIndexList = descendingDiagonalIndexMap.get(queen.getDescendingDiagonalIndex());
            score -= descendingDiagonalIndexList.size();
            descendingDiagonalIndexList.add(queen);
        }
    }

    private void retract(Queen queen) {
        Row row = queen.getRow();
        if (row != null) {
            List&lt;Queen&gt; rowIndexList = rowIndexMap.get(queen.getRowIndex());
            rowIndexList.remove(queen);
            score += rowIndexList.size();
            List&lt;Queen&gt; ascendingDiagonalIndexList = ascendingDiagonalIndexMap.get(queen.getAscendingDiagonalIndex());
            ascendingDiagonalIndexList.remove(queen);
            score += ascendingDiagonalIndexList.size();
            List&lt;Queen&gt; descendingDiagonalIndexList = descendingDiagonalIndexMap.get(queen.getDescendingDiagonalIndex());
            descendingDiagonalIndexList.remove(queen);
            score += descendingDiagonalIndexList.size();
        }
    }

    public SimpleScore calculateScore() {
        return SimpleScore.valueOf(score);
    }

}</code></pre><p>Configure it in your solver configuration:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;...&lt;/scoreDefinitionType&gt;
    &lt;incrementalScoreCalculatorClass&gt;org.optaplanner.examples.nqueens.solver.score.NQueensAdvancedIncrementalScoreCalculator&lt;/incrementalScoreCalculatorClass&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Optionally, to explain a score with <code class="literal">ScoreDirector.getConstraintMatchTotals()</code> or to get
      better output when the <code class="literal">IncrementalScoreCalculator</code> is corrupted in
      <code class="literal">FAST_ASSERT</code> or <code class="literal">FULL_ASSERT environmentMode</code>, implement also the
      <code class="literal">ConstraintMatchAwareIncrementalScoreCalculator</code> interface:</p><pre><code class="language-java">public interface ConstraintMatchAwareIncrementalScoreCalculator&lt;Sol extends Solution&gt; {

    void resetWorkingSolution(Sol workingSolution, boolean constraintMatchEnabled);

    Collection&lt;ConstraintMatchTotal&gt; getConstraintMatchTotals();
    
}</code></pre></div><div class="section" title="5.3.4. Drools score calculation"><div class="titlepage"><div><div><h3 class="title"><a id="droolsScoreCalculation"/>5.3.4. Drools score calculation</h3></div></div></div><div class="section" title="5.3.4.1. Overview"><div class="titlepage"><div><div><h4 class="title"><a id="droolsScoreCalculationOverview"/>5.3.4.1. Overview</h4></div></div></div><p>Implement your score calculation using the Drools rule engine. Every score constraint is written as one or
        more score rules.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Advantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Incremental score calculation for free</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Because most DRL syntax uses forward chaining, it does incremental calculation without any
                    extra code</p></li></ul></div></li><li class="listitem"><p>Score constraints are isolated as separate rules</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Easy to add or edit existing score rules</p></li></ul></div></li><li class="listitem"><p>Flexibility to augment your score constraints by</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Defining them in decision tables</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Excel (XLS) spreadsheet</p></li><li class="listitem"><p>KIE Workbench WebUI</p></li></ul></div></li><li class="listitem"><p>Translate them into natural language with DSL</p></li><li class="listitem"><p>Store and release in the KIE Workbench repository</p></li></ul></div></li><li class="listitem"><p>Performance optimizations in future versions for free</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>In every release, the Drools rule engine tends to become faster</p></li></ul></div></li></ul></div></li><li class="listitem"><p>Disadvantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>DRL learning curve</p></li><li class="listitem"><p>Usage of DRL</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Polyglot fear can prohibit the use of a new language such as DRL in some organizations</p></li></ul></div></li></ul></div></li></ul></div></div><div class="section" title="5.3.4.2. Drools score rules configuration"><div class="titlepage"><div><div><h4 class="title"><a id="droolsScoreRulesConfiguration"/>5.3.4.2. Drools score rules configuration</h4></div></div></div><p>There are several ways to define where your score rules live.</p><div class="section" title="5.3.4.2.1. A scoreDrl resource on the classpath"><div class="titlepage"><div><div><h5 class="title"><a id="droolsScoreCalculationScoreDrl"/>5.3.4.2.1. A scoreDrl resource on the classpath</h5></div></div></div><p>This is the easy way: the score rule live in a DRL file which is provided as a classpath resource. Just
          add the score rules DRL file in the solver configuration as a <code class="literal">&lt;scoreDrl&gt;</code>
          element:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;...&lt;/scoreDefinitionType&gt;
    &lt;scoreDrl&gt;org/optaplanner/examples/nqueens/solver/nQueensScoreRules.drl&lt;/scoreDrl&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>In a typical project (following the Maven directory structure), that DRL file would be located at
          <code class="literal">$PROJECT_DIR/src/main/resources/org/optaplanner/examples/nqueens/solver/nQueensScoreRules.drl</code>
          (even for a war project).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <code class="literal">&lt;scoreDrl&gt;</code> element expects a classpath resource, as defined by
            <code class="literal">ClassLoader.getResource(String)</code>, it does not accept a <code class="literal">File</code>, nor an
            URL, nor a webapp resource. See below to use a <code class="literal">File</code> instead.</p></div><p>Add multiple <code class="literal">&lt;scoreDrl&gt;</code> elements if the score rules are split across multiple
          DRL files.</p><p>Optionally, you can also set drools configuration properties (but be careful of backwards compatibility
          issues):</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    ...
    &lt;scoreDrl&gt;org/optaplanner/examples/nqueens/solver/nQueensScoreRules.drl&lt;/scoreDrl&gt;
    &lt;kieBaseConfigurationProperties&gt;
      &lt;drools.equalityBehavior&gt;...&lt;/drools.equalityBehavior&gt;
    &lt;/kieBaseConfigurationProperties&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre></div><div class="section" title="5.3.4.2.2. A scoreDrlFile"><div class="titlepage"><div><div><h5 class="title"><a id="droolsScoreCalculationScoreDrlFile"/>5.3.4.2.2. A scoreDrlFile</h5></div></div></div><p>To use <code class="literal">File</code> on the local file system, instead of a classpath resource, add the score
          rules DRL file in the solver configuration as a <code class="literal">&lt;scoreDrlFile&gt;</code> element:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;...&lt;/scoreDefinitionType&gt;
    &lt;scoreDrlFile&gt;/home/ge0ffrey/tmp/nQueensScoreRules.drl&lt;/scoreDrlFile&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>For portability reasons, a classpath resource is recommended over a File. An application build on one
            computer, but used on another computer, might not find the file on the same location. Worse, if they use a
            different Operating System, it's hard to choose a portable file path.</p></div><p>Add multiple <code class="literal">&lt;scoreDrlFile&gt;</code> elements if the score rules are split across
          multiple DRL files.</p></div><div class="section" title="5.3.4.2.3. A KieBase (possibly defined by Drools Workbench)"><div class="titlepage"><div><div><h5 class="title"><a id="droolsScoreCalculationKieBase"/>5.3.4.2.3. A KieBase (possibly defined by Drools Workbench)</h5></div></div></div><p>To build the <code class="literal">KieBase</code> yourself or to combine Planner with
          KIE Workbench (formerly known as Guvnor), set the <code class="literal">KieBase</code> on the
          <code class="literal">SolverFactory</code> before building the <code class="literal">Solver</code>:</p><pre><code class="language-java">    solverFactory.getSolverConfig().getScoreDirectorFactoryConfig.setKieBase(kieBase);</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>To be able to define your score rules in Drools Workbench, you'll want to:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Upload the <code class="literal">optaplanner-core</code> jar as a POJO model.</p></li><li class="listitem"><p>Add a global variable called <code class="literal">scoreHolder</code> (see below).</p></li></ol></div></div></div></div><div class="section" title="5.3.4.3. Implementing a score rule"><div class="titlepage"><div><div><h4 class="title"><a id="implementingAScoreRule"/>5.3.4.3. Implementing a score rule</h4></div></div></div><p>Here's an example of a score constraint implemented as a score rule in a DRL file:</p><pre><code class="no-highlight">rule "multipleQueensHorizontal"
    when
        Queen($id : id, row != null, $i : rowIndex)
        Queen(id &gt; $id, rowIndex == $i)
    then
        scoreHolder.addConstraintMatch(kcontext, -1);
end</code></pre><p>This score rule will fire once for every 2 queens with the same <code class="literal">rowIndex</code>. The
        <code class="literal">(id &gt; $id)</code> condition is needed to assure that for 2 queens A and B, it can only fire for
        (A, B) and not for (B, A), (A, A) or (B, B). Let's take a closer look at this score rule on this solution of 4
        queens:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/unsolvedNQueens04.png"/></div><p>In this solution the multipleQueensHorizontal score rule will fire for 6 queen couples: (A, B), (A, C),
        (A, D), (B, C), (B, D) and (C, D). Because none of the queens are on the same vertical or diagonal line, this
        solution will have a score of <code class="literal">-6</code>. An optimal solution of 4 queens has a score of
        <code class="literal">0</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Notice that every score rule will relate to at least 1 planning entity class (directly or indirectly
          through a logically inserted fact).</p><p>This is normal: it would be a waste of time to write a score rule that only relates to problem facts, as
          the consequence will never change during planning, no matter what the possible solution.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <code class="literal">kcontext</code> variable is a magic variable in Drools Expert. The <code class="literal">scoreHolder</code>'s method
          uses it to do incremental score calculation correctly and to create a <code class="literal">ConstraintMatch</code>
          instance.</p></div></div><div class="section" title="5.3.4.4. Weighing score rules"><div class="titlepage"><div><div><h4 class="title"><a id="weighingScoreRules"/>5.3.4.4. Weighing score rules</h4></div></div></div><p>A <code class="literal">ScoreHolder</code> instance is asserted into the <code class="literal">KieSession</code> as a global
        called <code class="literal">scoreHolder</code>. Your score rules need to (directly or indirectly) update that
        instance.</p><pre><code class="no-highlight">global SimpleScoreHolder scoreHolder;

rule "multipleQueensHorizontal"
    when
        Queen($id : id, row != null, $i : rowIndex)
        Queen(id &gt; $id, rowIndex == $i)
    then
        scoreHolder.addConstraintMatch(kcontext, -1);
end

// multipleQueensVertical is obsolete because it is always 0

rule "multipleQueensAscendingDiagonal"
    when
        Queen($id : id, row != null, $i : ascendingDiagonalIndex)
        Queen(id &gt; $id, ascendingDiagonalIndex == $i)
    then
        scoreHolder.addConstraintMatch(kcontext, -1);
end

rule "multipleQueensDescendingDiagonal"
    when
        Queen($id : id, row != null, $i : descendingDiagonalIndex)
        Queen(id &gt; $id, descendingDiagonalIndex == $i)
    then
        scoreHolder.addConstraintMatch(kcontext, -1);
end</code></pre><p>Most use cases will also weigh their constraint types or even their matches differently, by using a
        specific weight for each constraint match.</p><p>Here's an example from CurriculumCourse, where assigning a <code class="literal">Lecture</code> to a
        <code class="literal">Room</code> which is missing 2 seats is weighted equally bad as having 1 isolated
        <code class="literal">Lecture</code> in a <code class="literal">Curriculum</code>:</p><pre><code class="no-highlight">global HardSoftScoreHolder scoreHolder;

// RoomCapacity: For each lecture, the number of students that attend the course must be less or equal
// than the number of seats of all the rooms that host its lectures.
// Each student above the capacity counts as 1 point of penalty.
rule "roomCapacity"
    when
        $room : Room($capacity : capacity)
        $lecture : Lecture(room == $room, studentSize &gt; $capacity, $studentSize : studentSize)
    then
        scoreHolder.addSoftConstraintMatch(kcontext, ($capacity - $studentSize));
end

// CurriculumCompactness: Lectures belonging to a curriculum should be adjacent
// to each other (i.e., in consecutive periods).
// For a given curriculum we account for a violation every time there is one lecture not adjacent
// to any other lecture within the same day.
// Each isolated lecture in a curriculum counts as 2 points of penalty.
rule "curriculumCompactness"
    when
        ...
    then
        scoreHolder.addSoftConstraintMatch(kcontext, -2);
end</code></pre></div></div><div class="section" title="5.3.5. InitializingScoreTrend"><div class="titlepage"><div><div><h3 class="title"><a id="initializingScoreTrend"/>5.3.5. InitializingScoreTrend</h3></div></div></div><p>The <code class="literal">InitializingScoreTrend</code> specifies how the Score will change as more and more variables
      are initialized (while the already initialized variables don't change). Some optimization algorithms (such
      Construction Heuristics and Exhaustive Search) run faster if they have such information.</p><p>For for the Score (or each <a class="link" href="#scoreLevel" title="5.1.4. Score level">score level</a> separately), specify a
      trend:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">ANY</code> (default): Initializing an extra variable can change the score positively or
          negatively. Gives no performance gain.</p></li><li class="listitem"><p><code class="literal">ONLY_UP</code> (rare): Initializing an extra variable can only change the score positively.
          Implies that:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>There are only positive constraints</p></li><li class="listitem"><p>And initializing the next variable can not unmatch a positive constraint that was matched by a
              previous initialized variable.</p></li></ul></div></li><li class="listitem"><p><code class="literal">ONLY_DOWN</code>: Initializing an extra variable can only change the score negatively.
          Implies that:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>There are only negative constraints</p></li><li class="listitem"><p>And initializing the next variable can not unmatch a negative constraint that was matched by a
              previous initialized variable.</p></li></ul></div></li></ul></div><p>Most use cases only have negative constraints. Many of those have an
      <code class="literal">InitializingScoreTrend</code> that only goes down:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    &lt;scoreDrl&gt;.../cloudBalancingScoreRules.drl&lt;/scoreDrl&gt;
    &lt;initializingScoreTrend&gt;ONLY_DOWN&lt;/initializingScoreTrend&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>Alternatively, you can also specify the trend for each score level separately:</p><pre><code class="language-xml">  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;HARD_SOFT&lt;/scoreDefinitionType&gt;
    &lt;scoreDrl&gt;.../cloudBalancingScoreRules.drl&lt;/scoreDrl&gt;
    &lt;initializingScoreTrend&gt;ONLY_DOWN/ONLY_DOWN&lt;/initializingScoreTrend&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre></div><div class="section" title="5.3.6. Invalid score detection"><div class="titlepage"><div><div><h3 class="title"><a id="invalidScoreDetection"/>5.3.6. Invalid score detection</h3></div></div></div><p>Put the <code class="literal">environmentMode</code> in <code class="literal">FULL_ASSERT</code> (or
      <code class="literal">FAST_ASSERT</code>) to detect corruption in the <a class="link" href="#incrementalScoreCalculation" title="5.4.3. Incremental score calculation (with delta's)">incremental score calculation</a>. For more information, <a class="link" href="#environmentMode" title="4.4.3. Environment mode: Are there bugs in my code?">see the section about <code class="literal">environmentMode</code></a>. However, that will not
      verify that your score calculator implements your score constraints as your business actually desires.</p><p>A piece of incremental score calculator code can be difficult to write and to review. Assert its correctness
      by using a different implementation (for example a <code class="literal">EasyScoreCalculator</code>) to do the assertions
      triggered by the <code class="literal">environmentMode</code>. Just configure the different implementation as a
      <code class="literal">assertionScoreDirectorFactory</code>:</p><pre><code class="language-xml">  &lt;environmentMode&gt;FAST_ASSERT&lt;/environmentMode&gt;
  ...
  &lt;scoreDirectorFactory&gt;
    &lt;scoreDefinitionType&gt;...&lt;/scoreDefinitionType&gt;
    &lt;scoreDrl&gt;org/optaplanner/examples/nqueens/solver/nQueensScoreRules.drl&lt;/scoreDrl&gt;
    &lt;assertionScoreDirectorFactory&gt;
      &lt;easyScoreCalculatorClass&gt;org.optaplanner.examples.nqueens.solver.score.NQueensEasyScoreCalculator&lt;/easyScoreCalculatorClass&gt;
    &lt;/assertionScoreDirectorFactory&gt;
  &lt;/scoreDirectorFactory&gt;</code></pre><p>This way, the <code class="literal">scoreDrl</code> will be validated by the
      <code class="literal">EasyScoreCalculator</code>.</p></div></div><div class="section" title="5.4. Score calculation performance tricks"><div class="titlepage"><div><div><h2 class="title"><a id="scoreCalculationPerformanceTricks"/>5.4. Score calculation performance tricks</h2></div></div></div><div class="section" title="5.4.1. Overview"><div class="titlepage"><div><div><h3 class="title"><a id="scoreCalculationPerformanceTricksOverview"/>5.4.1. Overview</h3></div></div></div><p>The <code class="literal">Solver</code> will normally spend most of its execution time running the score calculation
      (which is called in its deepest loops). Faster score calculation will return the same solution in less time with
      the same algorithm, which normally means a better solution in equal time.</p></div><div class="section" title="5.4.2. Average calculation count per second"><div class="titlepage"><div><div><h3 class="title"><a id="averageCalculationCountPerSecond"/>5.4.2. Average calculation count per second</h3></div></div></div><p>After solving a problem, the <code class="literal">Solver</code> will log the <span class="emphasis"><em>average calculation count per
      second</em></span>. This is a good measurement of Score calculation performance, despite that it is affected by non
      score calculation execution time. It depends on the problem scale of the problem dataset. Normally, even for high
      scale problems, it is higher than <code class="literal">1000</code>, except when you're using
      <code class="literal">EasyScoreCalculator</code>.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>When improving your score calculation, focus on maximizing the average calculation count per second,
        instead of maximizing the best score. A big improvement in score calculation can sometimes yield little or no
        best score improvement, for example when the algorithm is stuck in a local or global optima. If you're watching
        the calculation count instead, score calculation improvements are far more visible.</p><p>Furthermore, watching the calculation count, allows you to remove or add score constraints, and still
        compare it with the original calculation count. Comparing the best score with the original would be wrong,
        because it's comparing apples and oranges.</p></div></div><div class="section" title="5.4.3. Incremental score calculation (with delta's)"><div class="titlepage"><div><div><h3 class="title"><a id="incrementalScoreCalculation"/>5.4.3. Incremental score calculation (with delta's)</h3></div></div></div><p>When a <code class="literal">Solution</code> changes, incremental score calculation (AKA delta based score
      calculation), will calculate the delta with the previous state to find the new <code class="literal">Score</code>, instead
      of recalculating the entire score on every solution evaluation.</p><p>For example, if a single queen A moves from row <code class="literal">1</code> to <code class="literal">2</code>, it won't
      bother to check if queen B and C can attack each other, since neither of them changed.</p><div class="figure"><a id="d0e5899"/><p class="title"><strong>Figure 5.1. Incremental score calculation for the 4 queens puzzle</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Score_calculation/deltaBasedScoreCalculationNQueens04.png" alt="Incremental score calculation for the 4 queens puzzle"/></div></div></div><br class="figure-break"/><p>This is a huge performance and scalability gain. <span class="bold"><strong>Drools score calculation gives you
      this huge scalability gain without forcing you to write a complicated incremental score calculation
      algorithm.</strong></span> Just let the Drools rule engine do the hard work.</p><p>Notice that the speedup is relative to the size of your planning problem (your <span class="emphasis"><em>n</em></span>),
      making incremental score calculation far more scalable.</p></div><div class="section" title="5.4.4. Avoid calling remote services during score calculation"><div class="titlepage"><div><div><h3 class="title"><a id="avoidCallingRemoteServicesDuringScoreCalculation"/>5.4.4. Avoid calling remote services during score calculation</h3></div></div></div><p>Do not call remote services in your score calculation (except if you're bridging
      <code class="literal">EasyScoreCalculator</code> to a legacy system). The network latency will kill your score calculation
      performance. Cache the results of those remote services if possible.</p><p>If some parts of a constraint can be calculated once, when the <code class="literal">Solver</code> starts, and never
      change during solving, then turn them into <a class="link" href="#cachedProblemFact" title="4.3.7.5. Cached problem fact">cached problem facts</a>.</p></div><div class="section" title="5.4.5. Pointless constraints"><div class="titlepage"><div><div><h3 class="title"><a id="pointlessConstraints"/>5.4.5. Pointless constraints</h3></div></div></div><p>If you know a certain constraint can never be broken (or it is always broken), don't bother writing a score
      constraint for it. For example in n queens, the score calculation doesn't check if multiple queens occupy the same
      column, because a <code class="literal">Queen</code>'s <code class="literal">column</code> never changes and every
      <code class="literal">Solution</code> starts with each <code class="literal">Queen</code> on a different
      <code class="literal">column</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Don't go overboard with this. If some datasets don't use a specific constraint but others do, just return
        out of the constraint as soon as you can. There is no need to dynamically change your score calculation based on
        the dataset.</p></div></div><div class="section" title="5.4.6. Built-in hard constraint"><div class="titlepage"><div><div><h3 class="title"><a id="buildInHardConstraint"/>5.4.6. Built-in hard constraint</h3></div></div></div><p>Instead of implementing a hard constraint, you can sometimes make it built-in too. For example: If
      <code class="literal">Lecture</code> A should never be assigned to <code class="literal">Room</code> X, but it uses ValueRangeProvider
      on Solution, the <code class="literal">Solver</code> will often try to assign it to <code class="literal">Room</code> X too (only to
      find out that it breaks a hard constraint). Use <a class="link" href="#filteredSelection" title="7.6.4. Filtered selection">filtered selection</a> to
      define that Course A should only be assigned a <code class="literal">Room</code> other than X.</p><p>This tends to give a good performance gain, not just because the score calculation is faster, but mainly
      because most optimization algorithms will spend less time evaluating unfeasible solutions.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Don't go overboard with this. Many optimization algorithms rely on the freedom to break hard constraints
        when changing planning entities, to get out of local optima. There is a real risk of trading short term benefits
        for long term harm.</p></div></div><div class="section" title="5.4.7. Other score calculation performance tricks"><div class="titlepage"><div><div><h3 class="title"><a id="otherScoreCalculationPerformanceTricks"/>5.4.7. Other score calculation performance tricks</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Verify that your score calculation happens in the correct <code class="literal">Number</code> type. If you're
          making the sum of <code class="literal">int</code> values, don't let Drools sum it in a <code class="literal">double</code> which
          takes longer.</p></li><li class="listitem"><p>For optimal performance, always use server mode (<code class="literal">java -server</code>). We have seen
          performance increases of 50% by turning on server mode.</p></li><li class="listitem"><p>For optimal performance, use the latest Java version. For example, in the past we have seen performance
          increases of 30% by switching from java 1.5 to 1.6.</p></li><li class="listitem"><p>Always remember that premature optimization is the root of all evil. Make sure your design is flexible
          enough to allow configuration based tweaking.</p></li></ul></div></div><div class="section" title="5.4.8. Score trap"><div class="titlepage"><div><div><h3 class="title"><a id="scoreTrap"/>5.4.8. Score trap</h3></div></div></div><p>Make sure that none of your score constraints cause a score trap. A trapped score constraint uses the same
      weight for different constraint matches, when it could just as easily use a different weight. It effectively lumps
      its constraint matches together, which creates a flatlined score function for that constraint. This can cause a
      solution state in which several moves need to be done to resolve or lower the weight of that single constraint.
      Some examples of score traps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If you need 2 doctors at each table, but you're only moving 1 doctor at a time. So the solver has no
          incentive to move a doctor to a table with no doctors. Punish a table with no doctors more then a table with
          only 1 doctor in that score constraint in the score function.</p></li><li class="listitem"><p>2 exams need to be conducted at the same time, but you're only moving 1 exam at a time. So the solver has
          to move one of those exams to another timeslot without moving the other in the same move. Add a
          coarse-grained move that moves both exams at the same time.</p></li></ul></div><p>For example, consider this score trap. If the blue item moves from an overloaded computer to an empty
      computer, the hard score should improve. The trapped score implementation fails to do that:</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/scoreTrap.png"/></div><p>The Solver should eventually get out of this trap, but it will take a lot of effort (especially if there are
      even more processes on the overloaded computer). Before they do that, they might actually start moving more
      processes into that overloaded computer, as there is no penalty for doing so.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Avoiding score traps does not mean that your score function should be smart enough to avoid local optima.
        Leave it to the optimization algorithms to deal with the local optima.</p><p>Avoiding score traps means to avoid - for each score constraint individually - a flatlined score
        function.</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Always specify the degree of infeasibility. The business will often say: "if the solution is infeasible,
        it doesn't matter how infeasible it." While that's true for the business, it's not true for score calculation:
        it benefits from knowing how infeasible it is. In practice, soft constraints usually do this naturally and it's
        just a matter of doing it for the hard constraints too.</p></div><p>There are several ways to deal with a score trap:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Improve the score constraint to make a distinction in the score weight. For example: penalize
          <code class="literal">-1hard</code> for every missing CPU, instead of just <code class="literal">-1hard</code> if any CPU is
          missing.</p></li><li class="listitem"><p>If changing the score constraint is not allowed from the business perspective, add a lower score level
          with a score constraint that makes such a distinction. For example: penalize <code class="literal">-1subsoft</code> for
          every missing CPU, on top of <code class="literal">-1hard</code> if any CPU is missing. The business ignores the subsoft
          score level.</p></li><li class="listitem"><p>Add coarse-grained moves and union select them with the existing fine-grained moves. A coarse-grained
          move effectively does multiple moves to directly get out of a score trap with a single move. For example: move
          multiple items from the same container to another container.</p></li></ul></div></div><div class="section" title="5.4.9. stepLimit benchmark"><div class="titlepage"><div><div><h3 class="title"><a id="stepLimitBenchmark"/>5.4.9. stepLimit benchmark</h3></div></div></div><p>Not all score constraints have the same performance cost. Sometimes 1 score constraint can kill the score
      calculation performance outright. Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to do a 1
      minute run and check what happens to the average calculation count per second if you comment out all but 1 of the
      score constraints.</p></div><div class="section" title="5.4.10. Fairness score constraints"><div class="titlepage"><div><div><h3 class="title"><a id="fairnessScoreConstraints"/>5.4.10. Fairness score constraints</h3></div></div></div><p>Some use cases have a business requirement to provide a fair schedule (usually as a soft score constraint),
      for example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Fairly distribute the workload amongst the employees, to avoid envy.</p></li><li class="listitem"><p>Evenly distribute the workload amongst assets, to improve reliability.</p></li></ul></div><p>Implementing such a constraint can seem difficult (especially because there are different ways to formalize
      fairness), but usually the <span class="emphasis"><em>squared workload</em></span> implementation behaves most desirable: for each
      employee/asset, count the workload <code class="literal">w</code> and subtract the square <code class="literal">w²</code> from the
      score.</p><div class="mediaobject"><img src="images/Chapter-Score_calculation/fairnessScoreConstraints.png"/></div><p>As shown above, the <span class="emphasis"><em>squared workload</em></span> implementation guarantees that if you select 2
      employees from a given solution and make their distribution between those 2 employees fairer, then the resulting
      new solution will have a better overall score.</p></div></div><div class="section" title="5.5. Explaining the score: using score calculation outside the Solver"><div class="titlepage"><div><div><h2 class="title"><a id="explainingTheScore"/>5.5. Explaining the score: using score calculation outside the <code class="literal">Solver</code></h2></div></div></div><p>Other parts of your application, for example your webUI, might need to calculate the score too. Do that by
    reusing the <code class="literal">ScoreDirectorFactory</code> of the <code class="literal">Solver</code> to build a separate
    <code class="literal">ScoreDirector</code> for that webUI:</p><pre><code class="language-java">ScoreDirectorFactory scoreDirectorFactory = solver.getScoreDirectorFactory();
ScoreDirector guiScoreDirector = scoreDirectorFactory.buildScoreDirector();</code></pre><p>Then use it when you need to calculate the <code class="literal">Score</code> of a <code class="literal">Solution</code>:</p><pre><code class="language-java">guiScoreDirector.setWorkingSolution(solution);
Score score = guiScoreDirector.calculateScore();</code></pre><p>To explain in the GUI what entities are causing which part of the <code class="literal">Score</code>, get the
    <code class="literal">ConstraintMatch</code> objects from the <code class="literal">ScoreDirector</code>:</p><pre><code class="language-java">for (ConstraintMatchTotal constraintMatchTotal : guiScoreDirector.getConstraintMatchTotals()) {
    String constraintName = constraintMatchTotal.getConstraintName();
    Number weightTotal = constraintMatchTotal.getWeightTotalAsNumber();
    for (ConstraintMatch constraintMatch : constraintMatchTotal.getConstraintMatchSet()) {
        List&lt;Object&gt; justificationList = constraintMatch.getJustificationList();
        Number weight = constraintMatch.getWeightAsNumber();
        ...
    }
}</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p><a class="link" href="#droolsScoreCalculation" title="5.3.4. Drools score calculation">Drools score calculation</a> supports constraint matches
      automatically, but <a class="link" href="#incrementalJavaScoreCalculation" title="5.3.3. Incremental Java score calculation">incremental Java score calculation</a>
      requires requires implementing an extra interface (see that section).</p></div></div></div><div class="chapter" title="Chapter 6. Optimization algorithms"><div class="titlepage"><div><div><h2 class="title"><a id="optimizationAlgorithms"/>Chapter 6. Optimization algorithms</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#searchSpaceSize">6.1. Search space size in the real world</a></span></dt><dt><span class="section"><a href="#doesPlannerFindTheOptimalSolution">6.2. Does Planner find the optimal solution?</a></span></dt><dt><span class="section"><a href="#architectureOverview">6.3. Architecture overview</a></span></dt><dt><span class="section"><a href="#optimizationAlgorithmsOverview">6.4. Optimization algorithms overview</a></span></dt><dt><span class="section"><a href="#whichOptimizationAlgorithmsShouldIUse">6.5. Which optimization algorithms should I use?</a></span></dt><dt><span class="section"><a href="#solverPhase">6.6. Solver phase</a></span></dt><dt><span class="section"><a href="#scopeOverview">6.7. Scope overview</a></span></dt><dt><span class="section"><a href="#termination">6.8. Termination</a></span></dt><dd><dl><dt><span class="section"><a href="#timeMillisSpentTermination">6.8.1. TimeMillisSpentTermination</a></span></dt><dt><span class="section"><a href="#unimprovedTimeMillisSpentTermination">6.8.2. UnimprovedTimeMillisSpentTermination</a></span></dt><dt><span class="section"><a href="#bestScoreTermination">6.8.3. BestScoreTermination</a></span></dt><dt><span class="section"><a href="#bestScoreFeasibleTermination">6.8.4. BestScoreFeasibleTermination</a></span></dt><dt><span class="section"><a href="#stepCountTermination">6.8.5. StepCountTermination</a></span></dt><dt><span class="section"><a href="#unimprovedStepCountTermination">6.8.6. UnimprovedStepCountTermination</a></span></dt><dt><span class="section"><a href="#combiningMultipleTerminations">6.8.7. Combining multiple Terminations</a></span></dt><dt><span class="section"><a href="#asynchronousTermination">6.8.8. Asynchronous termination from another thread</a></span></dt></dl></dd><dt><span class="section"><a href="#SolverEventListener">6.9. SolverEventListener</a></span></dt><dt><span class="section"><a href="#customSolverPhase">6.10. Custom solver phase</a></span></dt></dl></div><div class="section" title="6.1. Search space size in the real world"><div class="titlepage"><div><div><h2 class="title"><a id="searchSpaceSize"/>6.1. Search space size in the real world</h2></div></div></div><p>The number of possible solutions for a planning problem can be mind blowing. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>4 queens has <code class="literal">256</code> possible solutions (<code class="literal">4^4</code>) and 2 optimal
        solutions.</p></li><li class="listitem"><p>5 queens has <code class="literal">3125</code> possible solutions (<code class="literal">5^5</code>) and 1 optimal
        solution.</p></li><li class="listitem"><p>8 queens has <code class="literal">16777216</code> possible solutions (<code class="literal">8^8</code>) and 92 optimal
        solutions.</p></li><li class="listitem"><p>64 queens has more than <code class="literal">10^115</code> possible solutions (<code class="literal">64^64</code>).</p></li><li class="listitem"><p>Most real-life planning problems have an incredible number of possible solutions and only 1 or a few
        optimal solutions.</p></li></ul></div><p>For comparison: the minimal number of atoms in the known universe (10^80). As a planning problem gets bigger,
    the search space tends to blow up really fast. Adding only 1 extra planning entity or planning value can heavily
    multiply the running time of some algorithms.</p><div class="mediaobject"><img src="images/Chapter-Optimization_algorithms/cloudBalanceSearchSpaceSize.png"/></div><p>Calculating the number of possible solutions depends on the design of the domain model:</p><div class="mediaobject"><img src="images/Chapter-Optimization_algorithms/searchSpaceSizeCalculation.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>This search space size calculation includes infeasible solutions (if they can be represented by the model),
      because:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The optimal solution might be infeasible.</p></li><li class="listitem"><p>There are many types of hard constraints which cannot be incorporated in the formula practically. For
          example in Cloud Balancing, try incorporating the CPU capacity constraint in the formula.</p></li></ul></div><p>Even in cases were adding some of the hard constraints in the formula is practical, for example Course
      Scheduling, the resulting search space is still huge.</p></div><p>An algorithm that checks every possible solution (even with pruning such as in <a class="link" href="#branchAndBound" title="8.3. Branch And Bound">Branch And Bound</a>) can easily run for billions of years on a single real-life
    planning problem. What we really want is to <span class="bold"><strong>find the best solution in the limited time at our
    disposal</strong></span>. Planning competitions (such as the International Timetabling Competition) show that Local
    Search variations (<a class="link" href="#tabuSearch" title="10.4. Tabu Search">Tabu Search</a>, <a class="link" href="#simulatedAnnealing" title="10.5. Simulated Annealing">Simulated
    Annealing</a>, <a class="link" href="#lateAcceptance" title="10.6. Late Acceptance">Late Acceptance</a>, ...) usually perform best for real-world
    problems given real-world time limitations.</p></div><div class="section" title="6.2. Does Planner find the optimal solution?"><div class="titlepage"><div><div><h2 class="title"><a id="doesPlannerFindTheOptimalSolution"/>6.2. Does Planner find the optimal solution?</h2></div></div></div><p>The business wants the optimal solution, but they also have other requirements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Scale out: Large production datasets must not crash and have good results too.</p></li><li class="listitem"><p>Optimize the right problem: The constraints must match the actual business needs.</p></li><li class="listitem"><p>Available time: The solution must be found in time, before it becomes useless to execute.</p></li><li class="listitem"><p>Reliability: Every dataset must have at least a decent result (better than a human planner).</p></li></ul></div><p>Given these requirements, and despite the promises of some salesmen, it's usually impossible for anyone or
    anything to find the optimal solution. Therefore, Planner focuses on finding the best solution in available time. In
    <a class="link" href="#examplesOverview" title="3.1. Examples overview">realistic, independent competitions</a>, it often comes out as the best
    <span class="emphasis"><em>reusable</em></span> software.</p><p>The nature of NP-complete problems make scaling a prime concern. <span class="bold"><strong>The result quality of a
    small dataset guarantees nothing about the result quality of a large dataset.</strong></span> Scaling issues cannot be
    mitigated by hardware purchases later on. Start testing with a production sized dataset as soon as possible. Don't
    assess quality on small datasets (unless production encounters only such datasets). Instead, solve a production
    sized dataset and compare the results of longer executions, different algorithms and - if available - the human
    planner.</p></div><div class="section" title="6.3. Architecture overview"><div class="titlepage"><div><div><h2 class="title"><a id="architectureOverview"/>6.3. Architecture overview</h2></div></div></div><p>Planner is the first framework to combine optimization algorithms (metaheuristics, ...) with score calculation
    by a rule engine (such as Drools Expert). This combination turns out to be a very efficient, because:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A rule engine such as Drools Expert is <span class="bold"><strong>great for calculating the score</strong></span> of
        a solution of a planning problem. It makes it easy and scalable to add additional soft or hard constraints such
        as "a teacher shouldn't teach more then 7 hours a day". It does delta based score calculation without any extra
        code. However it tends to be not suitable to actually find new solutions.</p></li><li class="listitem"><p>An optimization algorithm is <span class="bold"><strong>great at finding new improving solutions</strong></span> for
        a planning problem, without necessarily brute-forcing every possibility. However it needs to know the score of a
        solution and offers no support in calculating that score efficiently.</p></li></ul></div><div class="mediaobject"><img src="images/Chapter-Optimization_algorithms/architectureOverview.png"/></div></div><div class="section" title="6.4. Optimization algorithms overview"><div class="titlepage"><div><div><h2 class="title"><a id="optimizationAlgorithmsOverview"/>6.4. Optimization algorithms overview</h2></div></div></div><p>Planner supports 3 <span class="emphasis"><em>families</em></span> of optimization algorithms: Exhaustive Search, Construction
    Heuristics and Metaheuristics. In practice, Metaheuristics (in combination with Construction Heuristics to
    initialize) are the recommended choice:</p><div class="mediaobject"><img src="images/Chapter-Optimization_algorithms/scalabilityOfOptimizationAlgorithms.png"/></div><p>Each of these families of algorithms has multiple optimization algorithms:</p><div class="table"><a id="d0e6301"/><p class="title"><strong>Table 6.1. Optimization algorithms overview</strong></p><div class="table-contents"><table summary="Optimization algorithms overview" border="1"><colgroup><col width="4*" align="left"/><col width="1*" align="center"/><col width="1*" align="center"/><col width="1*" align="center"/><col width="1*" align="center"/><col width="1*" align="center"/></colgroup><thead><tr><th align="left">Algorithm</th><th align="center">Scalable?</th><th align="center">Optimal?</th><th align="center">Easy to use?</th><th align="center">Tweakable?</th><th align="center">Requires CH?</th></tr></thead><tbody><tr><td align="left"><span class="bold"><strong>Exhaustive Search (ES)</strong></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">  <a class="link" href="#bruteForce" title="8.2. Brute Force">Brute Force</a></td><td align="center">0/5</td><td align="center">5/5</td><td align="center">5/5</td><td align="center">0/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#branchAndBound" title="8.3. Branch And Bound">Branch And Bound</a></td><td align="center">0/5</td><td align="center">5/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left"><span class="bold"><strong>Construction heuristics (CH)</strong></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">  <a class="link" href="#firstFit" title="9.2. First Fit">First Fit</a></td><td align="center">5/5</td><td align="center">1/5</td><td align="center">5/5</td><td align="center">1/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#firstFitDecreasing" title="9.3. First Fit Decreasing">First Fit Decreasing</a></td><td align="center">5/5</td><td align="center">2/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#weakestFit" title="9.4. Weakest Fit">Weakest Fit</a></td><td align="center">5/5</td><td align="center">2/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#weakestFitDecreasing" title="9.5. Weakest Fit Decreasing">Weakest Fit Decreasing</a></td><td align="center">5/5</td><td align="center">2/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#strongestFit" title="9.6. Strongest Fit">Strongest Fit</a></td><td align="center">5/5</td><td align="center">2/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#strongestFitDecreasing" title="9.7. Strongest Fit Decreasing">Strongest Fit Decreasing</a></td><td align="center">5/5</td><td align="center">2/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#cheapestInsertion" title="9.10. Cheapest Insertion">Cheapest Insertion</a></td><td align="center">3/5</td><td align="center">2/5</td><td align="center">5/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left">  <a class="link" href="#regretInsertion" title="9.11. Regret Insertion">Regret Insertion</a></td><td align="center">3/5</td><td align="center">2/5</td><td align="center">5/5</td><td align="center">2/5</td><td align="center">No</td></tr><tr><td align="left"><span class="bold"><strong>Metaheuristics (MH)</strong></span></td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">  Local Search</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">    <a class="link" href="#hillClimbing" title="10.3. Hill Climbing (Simple Local Search)">Hill Climbing</a></td><td align="center">5/5</td><td align="center">2/5</td><td align="center">4/5</td><td align="center">3/5</td><td align="center">Yes</td></tr><tr><td align="left">    <a class="link" href="#tabuSearch" title="10.4. Tabu Search">Tabu Search</a></td><td align="center">5/5</td><td align="center">4/5</td><td align="center">3/5</td><td align="center">5/5</td><td align="center">Yes</td></tr><tr><td align="left">    <a class="link" href="#simulatedAnnealing" title="10.5. Simulated Annealing">Simulated Annealing</a></td><td align="center">5/5</td><td align="center">4/5</td><td align="center">2/5</td><td align="center">5/5</td><td align="center">Yes</td></tr><tr><td align="left">    <a class="link" href="#lateAcceptance" title="10.6. Late Acceptance">Late Acceptance</a></td><td align="center">5/5</td><td align="center">4/5</td><td align="center">3/5</td><td align="center">5/5</td><td align="center">Yes</td></tr><tr><td align="left">    <a class="link" href="#stepCountingHillClimbing" title="10.7. Step Counting Hill Climbing">Step Counting Hill Climbing</a></td><td align="center">5/5</td><td align="center">4/5</td><td align="center">3/5</td><td align="center">5/5</td><td align="center">Yes</td></tr><tr><td align="left">  Evolutionary Algorithms</td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td><td align="center"> </td></tr><tr><td align="left">    <a class="link" href="#evolutionaryStrategies" title="11.2. Evolutionary Strategies">Evolutionary Strategies</a></td><td align="center">4/5</td><td align="center">3/5</td><td align="center">2/5</td><td align="center">5/5</td><td align="center">Yes</td></tr><tr><td align="left">    <a class="link" href="#geneticAlgorithms" title="11.3. Genetic Algorithms">Genetic Algorithms</a></td><td align="center">4/5</td><td align="center">3/5</td><td align="center">2/5</td><td align="center">5/5</td><td align="center">Yes</td></tr></tbody></table></div></div><br class="table-break"/><p>If you want to learn more about metaheuristics, read the free books <a class="link" href="http://www.cs.gmu.edu/~sean/book/metaheuristics/">Essentials of Metaheuristics</a> or <a class="link" href="http://www.cleveralgorithms.com/">Clever Algorithms</a>.</p></div><div class="section" title="6.5. Which optimization algorithms should I use?"><div class="titlepage"><div><div><h2 class="title"><a id="whichOptimizationAlgorithmsShouldIUse"/>6.5. Which optimization algorithms should I use?</h2></div></div></div><p>The <span class="emphasis"><em>best</em></span> optimization algorithms configuration for your use case depends heavily on your
    use case. Nevertheless, this vanilla recipe will get you into the game with a pretty good configuration, probably
    much better than what you're used to.</p><p>Start with a quick configuration that involves little or no configuration and optimization code:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="link" href="#firstFit" title="9.2. First Fit">First Fit</a></p></li></ol></div><p>Next, implement <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty</a> comparison and turn
    it into:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="link" href="#firstFitDecreasing" title="9.3. First Fit Decreasing">First Fit Decreasing</a></p></li></ol></div><p>Next, add Late Acceptance behind it:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>First Fit Decreasing</p></li><li class="listitem"><p><a class="link" href="#lateAcceptance" title="10.6. Late Acceptance">Late Acceptance</a>. A Late Acceptance size of 400 usually works
        well.</p></li></ol></div><p>At this point <span class="emphasis"><em>the free lunch is over</em></span>. The return on invested time lowers. The result is
    probably already more than good enough.</p><p>But you can do even better, at a lower return on invested time. Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> and try a couple of different Tabu Search, Simulated Annealing and Late
    Acceptance configurations, for example:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>First Fit Decreasing</p></li><li class="listitem"><p><a class="link" href="#tabuSearch" title="10.4. Tabu Search">Tabu Search</a>. An entity tabu size of 7 usually works well.</p></li></ol></div><p>Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to improve the values for those size parameters.</p><p>If it's worth your time, continue experimenting further. For example, try combining multiple algorithms
    together:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>First Fit Decreasing</p></li><li class="listitem"><p>Late Acceptance (relatively long time)</p></li><li class="listitem"><p>Tabu Search (relatively short time)</p></li></ol></div></div><div class="section" title="6.6. Solver phase"><div class="titlepage"><div><div><h2 class="title"><a id="solverPhase"/>6.6. Solver phase</h2></div></div></div><p>A <code class="literal">Solver</code> can use multiple optimization algorithms in sequence. <span class="bold"><strong>Each
    optimization algorithm is represented by a solver <code class="literal">Phase</code>.</strong></span> There is never more than 1
    <code class="literal">Phase</code> solving at the same time.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Some <code class="literal">Phase</code> implementations can combine techniques from multiple optimization algorithms,
      but they is still just 1 <code class="literal">Phase</code>. For example: a Local Search <code class="literal">Phase</code> can do
      Simulated Annealing with entity Tabu.</p></div><p>Here's a configuration that runs 3 phases in sequence:</p><pre><code class="language-xml">&lt;solver&gt;
  ...
  &lt;constructionHeuristic&gt;
    ... &lt;!-- First phase: First Fit Decreasing --&gt;
  &lt;/constructionHeuristic&gt;
  &lt;localSearch&gt;
    ... &lt;!-- Second phase: Late Acceptance --&gt;
  &lt;/localSearch&gt;
  &lt;localSearch&gt;
    ... &lt;!-- Third phase: Tabu Search --&gt;
  &lt;/localSearch&gt;
&lt;/solver&gt;</code></pre><p>The solver phases are run in the order defined by solver configuration. When the first
    <code class="literal">Phase</code> terminates, the second <code class="literal">Phase</code> starts, and so on. When the last
    <code class="literal">Phase</code> terminates, the <code class="literal">Solver</code> terminates. Usually, a <code class="literal">Solver</code>
    will first run a construction heuristic and then run 1 or multiple metaheuristics:</p><div class="mediaobject"><img src="images/Chapter-Optimization_algorithms/generalPhaseSequence.png"/></div><p>Some phases (especially construction heuristics) will terminate automatically. Other phases (especially
    metaheuristics) will only terminate if the <code class="literal">Phase</code> is configured to terminate:</p><pre><code class="language-xml">&lt;solver&gt;
  ...
  &lt;termination&gt;&lt;!-- Solver termination --&gt;
    &lt;secondsSpentLimit&gt;90&lt;/secondsSpentLimit&gt;
  &lt;/termination&gt;
  &lt;localSearch&gt;
    &lt;termination&gt;&lt;!-- Phase termination --&gt;
      &lt;secondsSpentLimit&gt;60&lt;/secondsSpentLimit&gt;&lt;!-- Give the next phase a chance to run too, before the Solver terminates --&gt;
    &lt;/termination&gt;
    ...
  &lt;/localSearch&gt;
  &lt;localSearch&gt;
    ...
  &lt;/localSearch&gt;
&lt;/solver&gt;</code></pre><p>If the <code class="literal">Solver</code> terminates (before the last <code class="literal">Phase</code> terminates itself), the
    current phase is terminated and all subsequent phases won't run.</p></div><div class="section" title="6.7. Scope overview"><div class="titlepage"><div><div><h2 class="title"><a id="scopeOverview"/>6.7. Scope overview</h2></div></div></div><p>A solver will iteratively run phases. Each phase will usually iteratively run steps. Each step, in turn,
    usually iteratively runs moves. These form 4 nested scopes: solver, phase, step and move.</p><div class="mediaobject"><img src="images/Chapter-Optimization_algorithms/scopeOverview.png"/></div><p>Configure <a class="link" href="#logging" title="4.4.4. Logging level: What is the Solver doing?">logging</a> to display the log messages of each scope.</p></div><div class="section" title="6.8. Termination"><div class="titlepage"><div><div><h2 class="title"><a id="termination"/>6.8. Termination</h2></div></div></div><p>Not all phases terminate automatically and sometimes you don't want to wait that long anyway. A
    <code class="literal">Solver</code> can be terminated synchronously by up-front configuration or asynchronously from another
    thread.</p><p>Especially metaheuristic phases will need to be told when to stop solving. This can be because of a number of
    reasons: the time is up, the perfect score has been reached, ... The only thing you can't depend on, is on finding
    the optimal solution (unless you know the optimal score), because a metaheuristic algorithm generally doesn't know
    it when it finds the optimal solution. For real-life problems this doesn't turn out to be much of a problem, because
    finding the optimal solution could take years, so you'll want to terminate sooner anyway. The only thing that
    matters is finding the best solution in the available time.</p><p>For synchronous termination, configure a <code class="literal">Termination</code> on a <code class="literal">Solver</code> or a
    <code class="literal">Phase</code> when it needs to stop. You can implement your own <code class="literal">Termination</code>, but the
    built-in implementations should suffice for most needs. Every <code class="literal">Termination</code> can calculate a
    <span class="emphasis"><em>time gradient</em></span> (needed for some optimization algorithms), which is a ratio between the time
    already spent solving and the estimated entire solving time of the <code class="literal">Solver</code> or
    <code class="literal">Phase</code>.</p><div class="section" title="6.8.1. TimeMillisSpentTermination"><div class="titlepage"><div><div><h3 class="title"><a id="timeMillisSpentTermination"/>6.8.1. TimeMillisSpentTermination</h3></div></div></div><p>Terminates when an amount of time has been used:</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;millisecondsSpentLimit&gt;500&lt;/millisecondsSpentLimit&gt;
  &lt;/termination&gt;</code></pre><pre><code class="language-xml">  &lt;termination&gt;
    &lt;secondsSpentLimit&gt;10&lt;/secondsSpentLimit&gt;
  &lt;/termination&gt;</code></pre><pre><code class="language-xml">  &lt;termination&gt;
    &lt;minutesSpentLimit&gt;5&lt;/minutesSpentLimit&gt;
  &lt;/termination&gt;</code></pre><pre><code class="language-xml">  &lt;termination&gt;
    &lt;hoursSpentLimit&gt;1&lt;/hoursSpentLimit&gt;
  &lt;/termination&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>This <code class="literal">Termination</code> will most likely sacrifice perfect reproducibility (even with
        <code class="literal">environmentMode</code> <code class="literal">REPRODUCIBLE</code>) because the available CPU time differs
        frequently between runs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The available CPU time influences the number of steps that can be taken, which might be a few more or
            less.</p></li><li class="listitem"><p>The <code class="literal">Termination</code> might produce slightly different time gradient values, which will
            send time gradient based algorithms (such as Simulated Annealing) on a radically different path.</p></li></ul></div></div></div><div class="section" title="6.8.2. UnimprovedTimeMillisSpentTermination"><div class="titlepage"><div><div><h3 class="title"><a id="unimprovedTimeMillisSpentTermination"/>6.8.2. UnimprovedTimeMillisSpentTermination</h3></div></div></div><p>Terminates when the best score hasn't improved in an amount of time:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;termination&gt;
      &lt;unimprovedMillisecondsSpentLimit&gt;500&lt;/unimprovedMillisecondsSpentLimit&gt;
    &lt;/termination&gt;
  &lt;/localSearch&gt;</code></pre><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;termination&gt;
      &lt;unimprovedSecondsSpentLimit&gt;10&lt;/unimprovedSecondsSpentLimit&gt;
    &lt;/termination&gt;
  &lt;/localSearch&gt;</code></pre><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;termination&gt;
      &lt;unimprovedMinutesSpentLimit&gt;5&lt;/unimprovedMinutesSpentLimit&gt;
    &lt;/termination&gt;
  &lt;/localSearch&gt;</code></pre><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;termination&gt;
      &lt;unimprovedHoursSpentLimit&gt;1&lt;/unimprovedHoursSpentLimit&gt;
    &lt;/termination&gt;
  &lt;/localSearch&gt;</code></pre><p>This termination should not be applied to Construction Heuristics, because they only update the best
      solution at the end. Therefore it might be better to configure it on a specific <code class="literal">Phase</code> (such as
      <code class="literal">&lt;localSearch&gt;</code>), instead of on the <code class="literal">Solver</code> itself.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>This <code class="literal">Termination</code> will most likely sacrifice perfect reproducibility (even with
        <code class="literal">environmentMode</code> <code class="literal">REPRODUCIBLE</code>) because the available CPU time differs
        frequently between runs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The available CPU time influences the number of steps that can be taken, which might be a few more or
            less.</p></li><li class="listitem"><p>The <code class="literal">Termination</code> might produce slightly different time gradient values, which will
            send time gradient based algorithms (such as Simulated Annealing) on a radically different path.</p></li></ul></div></div></div><div class="section" title="6.8.3. BestScoreTermination"><div class="titlepage"><div><div><h3 class="title"><a id="bestScoreTermination"/>6.8.3. BestScoreTermination</h3></div></div></div><p>Terminates when a certain score has been reached. You can use this <code class="literal">Termination</code> if you
      know the perfect score, for example for 4 queens (which uses a <a class="link" href="#simpleScore" title="5.2.1. SimpleScore">SimpleScore</a>):</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;bestScoreLimit&gt;0&lt;/bestScoreLimit&gt;
  &lt;/termination&gt;</code></pre><p>For a planning problem with a <a class="link" href="#hardSoftScore" title="5.2.2. HardSoftScore (recommended)">HardSoftScore</a>, it could look like
      this:</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;bestScoreLimit&gt;0hard/-5000soft&lt;/bestScoreLimit&gt;
  &lt;/termination&gt;</code></pre><p>For a planning problem with a <a class="link" href="#bendableScore" title="5.2.4. BendableScore">BendableScore</a> with 3 hard levels and 1
      soft level, it could look like this:</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;bestScoreLimit&gt;0/0/0/-5000&lt;/bestScoreLimit&gt;
  &lt;/termination&gt;</code></pre><p>To terminate once a feasible solution has been reached, this <code class="literal">Termination</code> isn't practical
      because it requires a <code class="literal">bestScoreLimit</code> such as <code class="literal">0hard/-2147483648soft</code>. Instead,
      use the next termination.</p></div><div class="section" title="6.8.4. BestScoreFeasibleTermination"><div class="titlepage"><div><div><h3 class="title"><a id="bestScoreFeasibleTermination"/>6.8.4. BestScoreFeasibleTermination</h3></div></div></div><p>Terminates when a certain score is feasible. Requires that the <code class="literal">Score</code> implementation
      implements <code class="literal">FeasibilityScore</code>.</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;bestScoreFeasible&gt;true&lt;/bestScoreFeasible&gt;
  &lt;/termination&gt;</code></pre><p>This <code class="literal">Termination</code> is usually combined with other terminations.</p></div><div class="section" title="6.8.5. StepCountTermination"><div class="titlepage"><div><div><h3 class="title"><a id="stepCountTermination"/>6.8.5. StepCountTermination</h3></div></div></div><p>Terminates when an amount of steps has been reached:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;termination&gt;
      &lt;stepCountLimit&gt;100&lt;/stepCountLimit&gt;
    &lt;/termination&gt;
  &lt;/localSearch&gt;</code></pre><p>This <code class="literal">Termination</code> can only be used for a <code class="literal">Phase</code> (such as
      <code class="literal">&lt;localSearch&gt;</code>), not for the <code class="literal">Solver</code> itself.</p></div><div class="section" title="6.8.6. UnimprovedStepCountTermination"><div class="titlepage"><div><div><h3 class="title"><a id="unimprovedStepCountTermination"/>6.8.6. UnimprovedStepCountTermination</h3></div></div></div><p>Terminates when the best score hasn't improved in a number of steps:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;termination&gt;
      &lt;unimprovedStepCountLimit&gt;100&lt;/unimprovedStepCountLimit&gt;
    &lt;/termination&gt;
  &lt;/localSearch&gt;</code></pre><p>If the score hasn't improved recently, it's probably not going to improve soon anyway and it's not worth the
      effort to continue. We have observed that once a new best solution is found (even after a long time of no
      improvement on the best solution), the next few steps tend to improve the best solution too.</p><p>This <code class="literal">Termination</code> can only be used for a <code class="literal">Phase</code> (such as
      <code class="literal">&lt;localSearch&gt;</code>), not for the <code class="literal">Solver</code> itself.</p></div><div class="section" title="6.8.7. Combining multiple Terminations"><div class="titlepage"><div><div><h3 class="title"><a id="combiningMultipleTerminations"/>6.8.7. Combining multiple Terminations</h3></div></div></div><p>Terminations can be combined, for example: terminate after <code class="literal">100</code> steps or if a score of
      <code class="literal">0</code> has been reached:</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;terminationCompositionStyle&gt;OR&lt;/terminationCompositionStyle&gt;
    &lt;stepCountLimit&gt;100&lt;/stepCountLimit&gt;
    &lt;bestScoreLimit&gt;0&lt;/bestScoreLimit&gt;
  &lt;/termination&gt;</code></pre><p>Alternatively you can use AND, for example: terminate after reaching a feasible score of at least
      <code class="literal">-100</code> and no improvements in <code class="literal">5</code> steps:</p><pre><code class="language-xml">  &lt;termination&gt;
    &lt;terminationCompositionStyle&gt;AND&lt;/terminationCompositionStyle&gt;
    &lt;unimprovedStepCountLimit&gt;5&lt;/unimprovedStepCountLimit&gt;
    &lt;bestScoreLimit&gt;-100&lt;/bestScoreLimit&gt;
  &lt;/termination&gt;</code></pre><p>This example ensures it doesn't just terminate after finding a feasible solution, but also completes any
      obvious improvements on that solution before terminating.</p></div><div class="section" title="6.8.8. Asynchronous termination from another thread"><div class="titlepage"><div><div><h3 class="title"><a id="asynchronousTermination"/>6.8.8. Asynchronous termination from another thread</h3></div></div></div><p>Sometimes you'll want to terminate a Solver early from another thread, for example because a user action or
      a server restart. This cannot be configured by a <code class="literal">Termination</code> as it's impossible to predict when
      and if it will occur. Therefore the <code class="literal">Solver</code> interface has these 2 thread-safe methods:</p><pre><code class="language-java">public interface Solver {

    // ...

    boolean terminateEarly();
    boolean isTerminateEarly();

}</code></pre><p>If you call the <code class="literal">terminateEarly()</code> method from another thread, the
      <code class="literal">Solver</code> will terminate at its earliest convenience and the <code class="literal">solve(Solution)</code>
      method will return in the original <code class="literal">Solver</code> thread.</p></div></div><div class="section" title="6.9. SolverEventListener"><div class="titlepage"><div><div><h2 class="title"><a id="SolverEventListener"/>6.9. SolverEventListener</h2></div></div></div><p>Each time a new best solution is found, the <code class="literal">Solver</code> fires a
    <code class="literal">BestSolutionChangedEvent</code>, in the solver's thread.</p><p>To listen to such events, add a <code class="literal">SolverEventListener</code> to the
    <code class="literal">Solver</code>:</p><pre><code class="language-java">public interface Solver {

    // ...

    void addEventListener(SolverEventListener&lt;? extends Solution&gt; eventListener);
    void removeEventListener(SolverEventListener&lt;? extends Solution&gt; eventListener);

}</code></pre><p>The <code class="literal">BestSolutionChangedEvent</code>'s <code class="literal">newBestSolution</code> might not be initialized
    or feasible. Use the methods on <code class="literal">BestSolutionChangedEvent</code> to detect such cases:</p><pre><code class="language-java">    solver.addEventListener(new SolverEventListener&lt;CloudBalance&gt;() {
        public void bestSolutionChanged(BestSolutionChangedEvent&lt;CloudBalance&gt; event) {
            // Ignore invalid solutions
            if (event.isNewBestSolutionInitialized()
                    &amp;&amp; event.getNewBestSolution().getScore().isFeasible()) {
                ...
            }
        }
    });</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The <code class="literal">bestSolutionChanged()</code> method is called in the solver's thread, as part of
      <code class="literal">Solver.solve()</code>. So it should return quickly to avoid slowing down the solving.</p></div></div><div class="section" title="6.10. Custom solver phase"><div class="titlepage"><div><div><h2 class="title"><a id="customSolverPhase"/>6.10. Custom solver phase</h2></div></div></div><p>Between phases or before the first phase, you might want to execute a custom action on the
    <code class="literal">Solution</code> to get a better score. Yet you'll still want to reuse the score calculation. For
    example, to implement a custom construction heuristic without implementing an entire
    <code class="literal">Phase</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Most of the time, a custom construction heuristic is not worth the hassle. The supported constructions
      heuristics are configurable (use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to tweak them),
      <code class="literal">Termination</code> aware and support partially initialized solutions too.</p></div><p>Implement the <code class="literal">CustomPhaseCommand</code> interface:</p><pre><code class="language-java">public interface CustomPhaseCommand {

    void changeWorkingSolution(ScoreDirector scoreDirector);

}</code></pre><p>For example:</p><pre><code class="language-java">public class ToOriginalMachineSolutionInitializer implements CustomPhaseCommand {

    public void changeWorkingSolution(ScoreDirector scoreDirector) {
        MachineReassignment machineReassignment = (MachineReassignment) scoreDirector.getWorkingSolution();
        for (MrProcessAssignment processAssignment : machineReassignment.getProcessAssignmentList()) {
            scoreDirector.beforeVariableChanged(processAssignment, "machine");
            processAssignment.setMachine(processAssignment.getOriginalMachine());
            scoreDirector.afterVariableChanged(processAssignment, "machine");
        }
    }

}</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Any change on the planning entities in a <code class="literal">CustomPhaseCommand</code> must be notified to the
      <code class="literal">ScoreDirector</code>.</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Do not change any of the planning facts in a <code class="literal">CustomPhaseCommand</code>. That will corrupt the
      <code class="literal">Solver</code> because any previous score or solution was for a different problem. To do that, read
      about <a class="link" href="#repeatedPlanning" title="Chapter 15. Repeated planning">repeated planning</a> and do it with a <a class="link" href="#problemFactChange" title="15.4.1. ProblemFactChange">ProblemFactChange</a> instead.</p></div><p>Configure your <code class="literal">CustomPhaseCommand</code> like this:</p><pre><code class="language-xml">&lt;solver&gt;
  ...
  &lt;customPhase&gt;
    &lt;customPhaseCommandClass&gt;org.optaplanner.examples.machinereassignment.solver.solution.initializer.ToOriginalMachineSolutionInitializer&lt;/customPhaseCommandClass&gt;
  &lt;/customPhase&gt;
  ... &lt;!-- Other phases --&gt;
&lt;/solver&gt;</code></pre><p>Configure multiple <code class="literal">customPhaseCommandClass</code> instances to run them in sequence.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>If the changes of a <code class="literal">CustomPhaseCommand</code> don't result in a better score, the best solution
      won't be changed (so effectively nothing will have changed for the next <code class="literal">Phase</code> or
      <code class="literal">CustomPhaseCommand</code>). To force such changes anyway, use
      <code class="literal">forceUpdateBestSolution</code>:</p><pre><code class="language-xml">  &lt;customPhase&gt;
    &lt;customPhaseCommandClass&gt;...MyUninitializer&lt;/customPhaseCommandClass&gt;
    &lt;forceUpdateBestSolution&gt;true&lt;/forceUpdateBestSolution&gt;
  &lt;/customPhase&gt;</code></pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <code class="literal">Solver</code> or a <code class="literal">Phase</code> wants to terminate while a
      <code class="literal">CustomPhaseCommand</code> is still running, it will wait to terminate until the
      <code class="literal">CustomPhaseCommand</code> is done, however long that takes.</p></div></div></div><div class="chapter" title="Chapter 7. Move and neighborhood selection"><div class="titlepage"><div><div><h2 class="title"><a id="moveAndNeighborhoodSelection"/>Chapter 7. <code class="literal">Move</code> and neighborhood selection</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#moveAndNeighborhoodSelectionIntroduction">7.1. <code class="literal">Move</code> and neighborhood introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#whatIsAMove">7.1.1. What is a <code class="literal">Move</code>?</a></span></dt><dt><span class="section"><a href="#whatIsAMoveSelector">7.1.2. What is a <code class="literal">MoveSelector</code>?</a></span></dt><dt><span class="section"><a href="#subselectingOfEntitiesValuesAndOtherMoves">7.1.3. Subselecting of entities, values and other moves</a></span></dt></dl></dd><dt><span class="section"><a href="#genericMoveSelectors">7.2. Generic MoveSelectors</a></span></dt><dd><dl><dt><span class="section"><a href="#changeMoveSelector">7.2.1. <code class="literal">changeMoveSelector</code></a></span></dt><dt><span class="section"><a href="#swapMoveSelector">7.2.2. swapMoveSelector</a></span></dt><dt><span class="section"><a href="#pillarChangeMoveSelector">7.2.3. pillarChangeMoveSelector</a></span></dt><dt><span class="section"><a href="#pillarSwapMoveSelector">7.2.4. pillarSwapMoveSelector</a></span></dt><dt><span class="section"><a href="#tailChainSwapMoveSelector">7.2.5. tailChainSwapMoveSelector or 2-opt (chained variables only)</a></span></dt><dt><span class="section"><a href="#subChainChangeMoveSelector">7.2.6. subChainChangeMoveSelector (chained variables only)</a></span></dt><dt><span class="section"><a href="#subChainSwapMoveSelector">7.2.7. subChainSwapMoveSelector (chained variables only)</a></span></dt></dl></dd><dt><span class="section"><a href="#combiningMultipleMoveSelectors">7.3. Combining multiple <code class="literal">MoveSelector</code>s</a></span></dt><dd><dl><dt><span class="section"><a href="#unionMoveSelector">7.3.1. unionMoveSelector</a></span></dt><dt><span class="section"><a href="#cartesianProductMoveSelector">7.3.2. cartesianProductMoveSelector</a></span></dt></dl></dd><dt><span class="section"><a href="#entitySelector">7.4. EntitySelector</a></span></dt><dt><span class="section"><a href="#valueSelector">7.5. ValueSelector</a></span></dt><dt><span class="section"><a href="#generalSelectorFeatures">7.6. General <code class="literal">Selector</code> features</a></span></dt><dd><dl><dt><span class="section"><a href="#cacheType">7.6.1. <code class="literal">CacheType</code>: Create moves ahead of time or Just In Time</a></span></dt><dt><span class="section"><a href="#selectionOrder">7.6.2. SelectionOrder: original, sorted, random, shuffled or probabilistic</a></span></dt><dt><span class="section"><a href="#recommendedCombinationsOfCacheTypeAndSelectionOrder">7.6.3. Recommended combinations of <code class="literal">CacheType</code> and <code class="literal">SelectionOrder</code></a></span></dt><dt><span class="section"><a href="#filteredSelection">7.6.4. Filtered selection</a></span></dt><dt><span class="section"><a href="#sortedSelection">7.6.5. Sorted selection</a></span></dt><dt><span class="section"><a href="#probabilisticSelection">7.6.6. Probabilistic selection</a></span></dt><dt><span class="section"><a href="#limitedSelection">7.6.7. Limited selection</a></span></dt><dt><span class="section"><a href="#mimicSelection">7.6.8. Mimic selection (record/replay)</a></span></dt><dt><span class="section"><a href="#nearbySelection">7.6.9. Nearby selection</a></span></dt></dl></dd><dt><span class="section"><a href="#customMoves">7.7. Custom moves</a></span></dt><dd><dl><dt><span class="section"><a href="#whichMoveTypesMightBeMissing">7.7.1. Which move types might be missing in my implementation?</a></span></dt><dt><span class="section"><a href="#customMovesIntroduction">7.7.2. Custom moves introduction</a></span></dt><dt><span class="section"><a href="#theInterfaceMove">7.7.3. The interface <code class="literal">Move</code></a></span></dt><dt><span class="section"><a href="#moveListFactory">7.7.4. <code class="literal">MoveListFactory</code>: the easy way to generate custom moves</a></span></dt><dt><span class="section"><a href="#moveIteratorFactory">7.7.5. <code class="literal">MoveIteratorFactory</code>: generate custom moves just in time</a></span></dt></dl></dd></dl></div><div class="section" title="7.1. Move and neighborhood introduction"><div class="titlepage"><div><div><h2 class="title"><a id="moveAndNeighborhoodSelectionIntroduction"/>7.1. <code class="literal">Move</code> and neighborhood introduction</h2></div></div></div><div class="section" title="7.1.1. What is a Move?"><div class="titlepage"><div><div><h3 class="title"><a id="whatIsAMove"/>7.1.1. What is a <code class="literal">Move</code>?</h3></div></div></div><p>A <code class="literal">Move</code> is a change (or set of changes) from a solution A to a solution B. For example,
      the move below changes queen <code class="literal">C</code> from row <code class="literal">0</code> to row
      <code class="literal">2</code>:</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/singleMoveNQueens04.png"/></div><p>The new solution is called a <span class="emphasis"><em>neighbor</em></span> of the original solution, because it can be
      reached in a single <code class="literal">Move</code>. Although a single move can change multiple queens, the neighbors of a
      solution should always be a very small subset of all possible solutions. For example, on that original solution,
      these are all possible <code class="literal">changeMove</code>'s:</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/possibleMovesNQueens04.png"/></div><p>If we ignore the 4 <code class="literal">changeMove</code>'s that have not impact and are therefore not doable, we can
      see that number of moves is <code class="literal">n * (n - 1) = 12</code>. This is far less than the number of possible
      solutions, which is <code class="literal">n ^ n = 256</code>. As the problem scales out, the number of possible moves
      increases far less than the number of possible solutions.</p><p>Yet, in 4 <code class="literal">changeMove</code>'s or less we can reach any solution. For example we can reach a very
      different solution in 3 <code class="literal">changeMove</code>'s:</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/sequentialMovesNQueens04.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>There are many other types of moves besides <code class="literal">changeMove</code>'s. Many move types are included
        out-of-the-box, but you can also implement custom moves.</p><p>A <code class="literal">Move</code> can affect multiple entities or even create/delete entities. But it must not
        change the problem facts.</p></div><p>All optimization algorithms use <code class="literal">Move</code>'s to transition from one solution to a neighbor
      solution. Therefore, all the optimization algorithms are confronted with <code class="literal">Move</code> selection: the
      craft of creating and iterating moves efficiently and the art of finding the most promising subset of random moves
      to evaluate first.</p></div><div class="section" title="7.1.2. What is a MoveSelector?"><div class="titlepage"><div><div><h3 class="title"><a id="whatIsAMoveSelector"/>7.1.2. What is a <code class="literal">MoveSelector</code>?</h3></div></div></div><p>A <code class="literal">MoveSelector</code>'s main function is to create <code class="literal">Iterator&lt;Move&gt;</code> when
      needed. An optimization algorithm will iterate through a subset of those moves.</p><p>Here's an example how to configure a <code class="literal">changeMoveSelector</code> for the optimization algorithm
      Local Search:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;changeMoveSelector/&gt;
    ...
  &lt;/localSearch&gt;</code></pre><p>Out of the box, this works and all properties of the <code class="literal">changeMoveSelector</code> are defaulted
      sensibly (unless that fails fast due to ambiguity). On the other hand, the configuration can be customized
      significantly for specific use cases. For example: you might want to configure a filter to discard pointless
      moves.</p></div><div class="section" title="7.1.3. Subselecting of entities, values and other moves"><div class="titlepage"><div><div><h3 class="title"><a id="subselectingOfEntitiesValuesAndOtherMoves"/>7.1.3. Subselecting of entities, values and other moves</h3></div></div></div><p>To create a <code class="literal">Move</code>, a <code class="literal">MoveSelector</code> needs to select 1 or more planning
      entities and/or planning values to move. Just like <code class="literal">MoveSelector</code>s,
      <code class="literal">EntitySelector</code>s and <code class="literal">ValueSelector</code>s need to support a similar feature set
      (such as scalable just-in-time selection). Therefore, they all implement a common interface
      <code class="literal">Selector</code> and they are configured similarly.</p><p>A MoveSelector is often composed out of <code class="literal">EntitySelector</code>s,
      <code class="literal">ValueSelector</code>s or even other <code class="literal">MoveSelector</code>s, which can be configured
      individually if desired:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector&gt;
          ...
        &lt;/entitySelector&gt;
        &lt;valueSelector&gt;
          ...
        &lt;/valueSelector&gt;
        ...
      &lt;/changeMoveSelector&gt;
      &lt;swapMoveSelector&gt;
        ...
      &lt;/swapMoveSelector&gt;
    &lt;/unionMoveSelector&gt;</code></pre><p>Together, this structure forms a <code class="literal">Selector</code> tree:</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/selectorTree.png"/></div><p>The root of this tree is a <code class="literal">MoveSelector</code> which is injected into the optimization algorithm
      implementation to be (partially) iterated in every step.</p></div></div><div class="section" title="7.2. Generic MoveSelectors"><div class="titlepage"><div><div><h2 class="title"><a id="genericMoveSelectors"/>7.2. Generic MoveSelectors</h2></div></div></div><div class="section" title="7.2.1. changeMoveSelector"><div class="titlepage"><div><div><h3 class="title"><a id="changeMoveSelector"/>7.2.1. <code class="literal">changeMoveSelector</code></h3></div></div></div><p>For 1 planning variable, the <code class="literal">ChangeMove</code> selects 1 planning entity and 1 planning value
      and assigns the entity's variable to that value.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/changeMove.png"/></div><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;changeMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;changeMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;entitySelector&gt;
        &lt;entityClass&gt;...Lecture&lt;/entityClass&gt;
        ...
      &lt;/entitySelector&gt;
      &lt;valueSelector&gt;
        &lt;variableName&gt;room&lt;/variableName&gt;
        ...
        &lt;nearbySelection&gt;...&lt;/nearbySelection&gt;
      &lt;/valueSelector&gt;
    &lt;/changeMoveSelector&gt;</code></pre><p>A <code class="literal">ChangeMove</code> is the finest grained move.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Almost every <code class="literal">moveSelector</code> configuration injected into a metaheuristic algorithm should
        include a changeMoveSelector or a custom implementation. This guarantees that every possible
        <code class="literal">Solution</code> can be reached through applying a number of moves in sequence (not taking <a class="link" href="#scoreTrap" title="5.4.8. Score trap">score traps</a> into account). Of course, normally it is unioned with other, more coarse
        grained move selectors.</p></div></div><div class="section" title="7.2.2. swapMoveSelector"><div class="titlepage"><div><div><h3 class="title"><a id="swapMoveSelector"/>7.2.2. swapMoveSelector</h3></div></div></div><p>The <code class="literal">SwapMove</code> selects 2 different planning entities and swaps the planning values of all
      their planning variables.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/swapMove.png"/></div><p>Although a <code class="literal">SwapMove</code> on a single variable is essentially just 2
      <code class="literal">ChangeMove</code>s, it's often the winning step where the first of the 2
      <code class="literal">ChangeMove</code>s would not be the winning step because it leaves the solution in a state with broken
      hard constraints. For example: swapping the room of 2 lectures doesn't bring the solution in a intermediate state
      where both lectures are in the same room which breaks a hard constraint.</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;swapMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;swapMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;entitySelector&gt;
        &lt;entityClass&gt;...Lecture&lt;/entityClass&gt;
        ...
      &lt;/entitySelector&gt;
      &lt;secondaryEntitySelector&gt;
        &lt;entityClass&gt;...Lecture&lt;/entityClass&gt;
        ...
        &lt;nearbySelection&gt;...&lt;/nearbySelection&gt;
      &lt;/secondaryEntitySelector&gt;
      &lt;variableNameInclude&gt;room&lt;/variableNameInclude&gt;
      &lt;variableNameInclude&gt;...&lt;/variableNameInclude&gt;
    &lt;/swapMoveSelector&gt;</code></pre><p>The <code class="literal">secondaryEntitySelector</code> is rarely needed: if it is not specified, entities from the
      same <code class="literal">entitySelector</code> are swapped.</p><p>If one or more <code class="literal">variableNameInclude</code> properties are specified, not all planning variables
      will be swapped, but only those specified. For example for course scheduling, specifying only
      <code class="literal">variableNameInclude</code> room will make it only swap room, not period.</p></div><div class="section" title="7.2.3. pillarChangeMoveSelector"><div class="titlepage"><div><div><h3 class="title"><a id="pillarChangeMoveSelector"/>7.2.3. pillarChangeMoveSelector</h3></div></div></div><p>A <span class="emphasis"><em>pillar</em></span> is a set of planning entities which have the same planning value(s) for their
      planning variable(s). The <code class="literal">PillarChangeMove</code> selects 1 entity pillar (or subset of those) and
      changes the value of 1 variable (which is the same for all entities) to another value.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/pillarChangeMove.png"/></div><p>In the example above, queen A and C have the same value (row 0) and are moved to row 2. Also the yellow and
      blue process have the same value (computer Y) and are moved to computer X.</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;pillarChangeMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;pillarSwapMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;pillarSelector&gt;
        &lt;entitySelector&gt;
          &lt;entityClass&gt;...Lecture&lt;/entityClass&gt;
          ...
        &lt;/entitySelector&gt;
        &lt;subPillarEnabled&gt;true&lt;/subPillarEnabled&gt;
        &lt;minimumSubPillarSize&gt;1&lt;/minimumSubPillarSize&gt;
        &lt;maximumSubPillarSize&gt;1000&lt;/maximumSubPillarSize&gt;
      &lt;/pillarSelector&gt;
      &lt;valueSelector&gt;
        &lt;variableName&gt;room&lt;/variableName&gt;
        ...
      &lt;/valueSelector&gt;
    &lt;/pillarSwapMoveSelector&gt;</code></pre><p>A sub pillar is a subset of entities that share the same value(s) for their variable(s). For example if
      queen A, B, C and D are all located on row 0, they are a pillar and <code class="literal">[A, D]</code> is one of the many
      sub pillars. If <code class="literal">subPillarEnabled</code> (defaults to <code class="literal">true</code>) is false, no sub pillars
      are selected. If sub pillars are enabled, the pillar itself is also included and the properties
      <code class="literal">minimumSubPillarSize</code> (defaults to <code class="literal">1</code>) and
      <code class="literal">maximumSubPillarSize</code> (defaults to <code class="literal">infinity</code>) limit the size of the selected
      (sub) pillar.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The number of sub pillars of a pillar is exponential to the size of the pillar. For example a pillar of
        size 32 has <code class="literal">(2^32 - 1)</code> subpillars. Therefore a <code class="literal">pillarSelector</code> only
        supports <a class="link" href="#justInTimeRandomSelection" title="7.6.3.1. Just in time random selection (default)">JIT random selection</a> (which is the default).</p></div><p>The other properties are explained in <a class="link" href="#changeMoveSelector" title="7.2.1. changeMoveSelector">changeMoveSelector</a>.</p></div><div class="section" title="7.2.4. pillarSwapMoveSelector"><div class="titlepage"><div><div><h3 class="title"><a id="pillarSwapMoveSelector"/>7.2.4. pillarSwapMoveSelector</h3></div></div></div><p>A <span class="emphasis"><em>pillar</em></span> is a set of planning entities which have the same planning value(s) for their
      planning variable(s). The <code class="literal">PillarSwapMove</code> selects 2 different entity pillars and swaps the
      values of all their variables for all their entities.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/pillarSwapMove.png"/></div><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;pillarSwapMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;pillarSwapMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;pillarSelector&gt;
        &lt;entitySelector&gt;
          &lt;entityClass&gt;...Lecture&lt;/entityClass&gt;
          ...
        &lt;/entitySelector&gt;
        &lt;subPillarEnabled&gt;true&lt;/subPillarEnabled&gt;
        &lt;minimumSubPillarSize&gt;1&lt;/minimumSubPillarSize&gt;
        &lt;maximumSubPillarSize&gt;1000&lt;/maximumSubPillarSize&gt;
      &lt;/pillarSelector&gt;
      &lt;secondaryPillarSelector&gt;
        &lt;entitySelector&gt;
          ...
        &lt;/entitySelector&gt;
        ...
      &lt;/secondaryPillarSelector&gt;
      &lt;variableNameInclude&gt;room&lt;/variableNameInclude&gt;
      &lt;variableNameInclude&gt;...&lt;/variableNameInclude&gt;
    &lt;/pillarSwapMoveSelector&gt;</code></pre><p>The <code class="literal">secondaryPillarSelector</code> is rarely needed: if it is not specified, entities from the
      same <code class="literal">pillarSelector</code> are swapped.</p><p>The other properties are explained in <a class="link" href="#swapMoveSelector" title="7.2.2. swapMoveSelector">swapMoveSelector</a> and <a class="link" href="#pillarChangeMoveSelector" title="7.2.3. pillarChangeMoveSelector">pillarChangeMoveSelector</a>.</p></div><div class="section" title="7.2.5. tailChainSwapMoveSelector or 2-opt (chained variables only)"><div class="titlepage"><div><div><h3 class="title"><a id="tailChainSwapMoveSelector"/>7.2.5. tailChainSwapMoveSelector or 2-opt (chained variables only)</h3></div></div></div><p>A <span class="emphasis"><em>tailChain</em></span> is a set of planning entities with a chained planning variable which form a
      last part of a chain. The <code class="literal">tailChainSwapMove</code> selects a tail chain and swaps it with the tail
      chain of another planning value (in a different or the same anchor chain). If the targeted planning value, doesn't
      have a tail chain, it swaps with nothing (resulting in a change like move). If it occurs within the same anchor
      chain, a partial chain reverse occurs. In academic papers, this is often called a 2-opt move.</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;tailChainSwapMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;subChainChangeMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;entitySelector&gt;
        &lt;entityClass&gt;...Customer&lt;/entityClass&gt;
        ...
      &lt;/entitySelector&gt;
      &lt;valueSelector&gt;
        &lt;variableName&gt;previousStandstill&lt;/variableName&gt;
        ...
        &lt;nearbySelection&gt;...&lt;/nearbySelection&gt;
      &lt;/valueSelector&gt;
    &lt;/subChainChangeMoveSelector&gt;</code></pre><p>The <code class="literal">entitySelector</code> selects the start of the tail chain that is being moved. The
      valueSelector selects to where that tail chain is moved. If it has a tail chain itself, that is moved to the
      location of the original tail chain. It uses a <code class="literal">valueSelector</code> instead of a
      <code class="literal">secondaryEntitySelector</code> to be able to include all possible 2opt moves (such as moving to the
      end of a tail) and to work correctly with <a class="link" href="#nearbySelection" title="7.6.9. Nearby selection">nearby selection</a> (because of
      asymmetric distances and also swapped entity distance gives an incorrect selection probability).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Although <code class="literal">subChainChangeMoveSelector</code> and <code class="literal">subChainSwapMoveSelector</code>
        include almost every possible <code class="literal">tailChainSwapMove</code>, experiments have shown that focusing on
        <code class="literal">tailChainSwapMove</code>s increases efficiency.</p></div></div><div class="section" title="7.2.6. subChainChangeMoveSelector (chained variables only)"><div class="titlepage"><div><div><h3 class="title"><a id="subChainChangeMoveSelector"/>7.2.6. subChainChangeMoveSelector (chained variables only)</h3></div></div></div><p>A <span class="emphasis"><em>subChain</em></span> is a set of planning entities with a chained planning variable which form
      part of a chain. The <code class="literal">subChainChangeMoveSelector</code> selects a subChain and moves it to another
      place (in a different or the same anchor chain).</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;subChainChangeMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;subChainChangeMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;entityClass&gt;...Customer&lt;/entityClass&gt;
      &lt;subChainSelector&gt;
        &lt;valueSelector&gt;
          &lt;variableName&gt;previousStandstill&lt;/variableName&gt;
          ...
        &lt;/valueSelector&gt;
        &lt;minimumSubChainSize&gt;2&lt;/minimumSubChainSize&gt;
        &lt;maximumSubChainSize&gt;40&lt;/maximumSubChainSize&gt;
      &lt;/subChainSelector&gt;
      &lt;valueSelector&gt;
        &lt;variableName&gt;previousStandstill&lt;/variableName&gt;
        ...
      &lt;/valueSelector&gt;
      &lt;selectReversingMoveToo&gt;true&lt;/selectReversingMoveToo&gt;
    &lt;/subChainChangeMoveSelector&gt;</code></pre><p>The <code class="literal">subChainSelector</code> selects a number of entities, no less than
      <code class="literal">minimumSubChainSize</code> (defaults to <code class="literal">1</code>) and no more than
      <code class="literal">maximumSubChainSize</code> (defaults to <code class="literal">infinity</code>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If <code class="literal">minimumSubChainSize</code> is <code class="literal">1</code> (which is the default), this selector
        might select the same move as a <code class="literal">ChangeMoveSelector</code>, at a far lower selection probability
        (because each move <span class="emphasis"><em>type</em></span> has the same selection chance by default (not every move instance)
        and there are far more <code class="literal">SubChainChangeMove</code> instances than <code class="literal">ChangeMove</code>
        instances). However, don't just remove the <code class="literal">ChangeMoveSelector</code>, because experiments show that
        it's good to focus on <code class="literal">ChangeMove</code>s.</p><p>Furthermore, in a <code class="literal">SubChainSwapMoveSelector</code>, setting
        <code class="literal">minimumSubChainSize</code> prevents swapping a subchain of size <code class="literal">1</code> with a subchain
        of at least size <code class="literal">2</code>.</p></div><p>The <code class="literal">selectReversingMoveToo</code> property (defaults to true) enables selecting the reverse of
      every subchain too.</p></div><div class="section" title="7.2.7. subChainSwapMoveSelector (chained variables only)"><div class="titlepage"><div><div><h3 class="title"><a id="subChainSwapMoveSelector"/>7.2.7. subChainSwapMoveSelector (chained variables only)</h3></div></div></div><p>The <code class="literal">subChainSwapMoveSelector</code> selects 2 different subChains and moves them to another
      place in a different or the same anchor chain.</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;subChainSwapMoveSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;subChainSwapMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;entityClass&gt;...Customer&lt;/entityClass&gt;
      &lt;subChainSelector&gt;
        &lt;valueSelector&gt;
          &lt;variableName&gt;previousStandstill&lt;/variableName&gt;
          ...
        &lt;/valueSelector&gt;
        &lt;minimumSubChainSize&gt;2&lt;/minimumSubChainSize&gt;
        &lt;maximumSubChainSize&gt;40&lt;/maximumSubChainSize&gt;
      &lt;/subChainSelector&gt;
      &lt;secondarySubChainSelector&gt;
        &lt;valueSelector&gt;
          &lt;variableName&gt;previousStandstill&lt;/variableName&gt;
          ...
        &lt;/valueSelector&gt;
        &lt;minimumSubChainSize&gt;2&lt;/minimumSubChainSize&gt;
        &lt;maximumSubChainSize&gt;40&lt;/maximumSubChainSize&gt;
      &lt;/secondarySubChainSelector&gt;
      &lt;selectReversingMoveToo&gt;true&lt;/selectReversingMoveToo&gt;
    &lt;/subChainSwapMoveSelector&gt;</code></pre><p>The <code class="literal">secondarySubChainSelector</code> is rarely needed: if it is not specified, entities from the
      same <code class="literal">subChainSelector</code> are swapped.</p><p>The other properties are explained in <a class="link" href="#subChainChangeMoveSelector" title="7.2.6. subChainChangeMoveSelector (chained variables only)">subChainChangeMoveSelector</a>.</p></div></div><div class="section" title="7.3. Combining multiple MoveSelectors"><div class="titlepage"><div><div><h2 class="title"><a id="combiningMultipleMoveSelectors"/>7.3. Combining multiple <code class="literal">MoveSelector</code>s</h2></div></div></div><div class="section" title="7.3.1. unionMoveSelector"><div class="titlepage"><div><div><h3 class="title"><a id="unionMoveSelector"/>7.3.1. unionMoveSelector</h3></div></div></div><p>A <code class="literal">unionMoveSelector</code> selects a <code class="literal">Move</code> by selecting 1 of its
      <code class="literal">MoveSelector</code> children to supply the next <code class="literal">Move</code>.</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;...MoveSelector/&gt;
      &lt;...MoveSelector/&gt;
      &lt;...MoveSelector/&gt;
      ...
    &lt;/unionMoveSelector&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;selectorProbabilityWeightFactoryClass&gt;...ProbabilityWeightFactory&lt;/selectorProbabilityWeightFactoryClass&gt;
      &lt;changeMoveSelector&gt;
        &lt;fixedProbabilityWeight&gt;...&lt;/fixedProbabilityWeight&gt;
        ...
      &lt;/changeMoveSelector&gt;
      &lt;swapMoveSelector&gt;
        &lt;fixedProbabilityWeight&gt;...&lt;/fixedProbabilityWeight&gt;
        ...
      &lt;/swapMoveSelector&gt;
      &lt;...MoveSelector&gt;
        &lt;fixedProbabilityWeight&gt;...&lt;/fixedProbabilityWeight&gt;
        ...
      &lt;/...MoveSelector&gt;
      ...
    &lt;/unionMoveSelector&gt;</code></pre><p>The <code class="literal">selectorProbabilityWeightFactory</code> determines in <code class="literal">selectionOrder</code>
      <code class="literal">RANDOM</code> how often a <code class="literal">MoveSelector</code> child is selected to supply the next Move.
      By default, each <code class="literal">MoveSelector</code> child has the same chance of being selected.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/selectorProbabilityInUnion.png"/></div><p>Change the <code class="literal">fixedProbabilityWeight</code> of such a child to select it more often. For example,
      the <code class="literal">unionMoveSelector</code> can return a <code class="literal">SwapMove</code> twice as often as a
      <code class="literal">ChangeMove</code>:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;fixedProbabilityWeight&gt;1.0&lt;/fixedProbabilityWeight&gt;
        ...
      &lt;/changeMoveSelector&gt;
      &lt;swapMoveSelector&gt;
        &lt;fixedProbabilityWeight&gt;2.0&lt;/fixedProbabilityWeight&gt;
        ...
      &lt;/swapMoveSelector&gt;
    &lt;/unionMoveSelector&gt;</code></pre><p>The number of possible <code class="literal">ChangeMove</code>s is very different from the number of possible
      <code class="literal">SwapMove</code>s and furthermore it's problem dependent. To give each individual
      <code class="literal">Move</code> the same selection chance (as opposed to each <code class="literal">MoveSelector</code>), use the
      <code class="literal">FairSelectorProbabilityWeightFactory</code>:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;selectorProbabilityWeightFactoryClass&gt;org.optaplanner.core.impl.heuristic.selector.common.decorator.FairSelectorProbabilityWeightFactory&lt;/selectorProbabilityWeightFactoryClass&gt;
      &lt;changeMoveSelector/&gt;
      &lt;swapMoveSelector/&gt;
    &lt;/unionMoveSelector&gt;</code></pre></div><div class="section" title="7.3.2. cartesianProductMoveSelector"><div class="titlepage"><div><div><h3 class="title"><a id="cartesianProductMoveSelector"/>7.3.2. cartesianProductMoveSelector</h3></div></div></div><p>A <code class="literal">cartesianProductMoveSelector</code> selects a new <code class="literal">CompositeMove</code>. It builds
      that <code class="literal">CompositeMove</code> by selecting 1 <code class="literal">Move</code> per <code class="literal">MoveSelector</code>
      child and adding it to the <code class="literal">CompositeMove</code>.</p><p>Simplest configuration:</p><pre><code class="language-xml">    &lt;cartesianProductMoveSelector&gt;
      &lt;...MoveSelector/&gt;
      &lt;...MoveSelector/&gt;
      &lt;...MoveSelector/&gt;
      ...
    &lt;/cartesianProductMoveSelector&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;cartesianProductMoveSelector&gt;
      ... &lt;!-- Normal selector properties --&gt;
      &lt;ignoreEmptyChildIterators&gt;true&lt;/ignoreEmptyChildIterators&gt;
      &lt;changeMoveSelector&gt;
        ...
      &lt;/changeMoveSelector&gt;
      &lt;swapMoveSelector&gt;
        ...
      &lt;/swapMoveSelector&gt;
      &lt;...MoveSelector&gt;
        ...
      &lt;/...MoveSelector&gt;
      ...
    &lt;/cartesianProductMoveSelector&gt;</code></pre><p>The <code class="literal">ignoreEmptyChildIterators</code> property (true by default) will ignore every empty
      <code class="literal">childMoveSelector</code> to avoid returning no moves. For example: a cartesian product of
      <code class="literal">changeMoveSelector</code> A and B, for which B is empty (because all it's entities are immovable)
      returns no move if <code class="literal">ignoreEmptyChildIterators</code> is <code class="literal">false</code> and the moves of A if
      <code class="literal">ignoreEmptyChildIterators</code> is <code class="literal">true</code>.</p></div></div><div class="section" title="7.4. EntitySelector"><div class="titlepage"><div><div><h2 class="title"><a id="entitySelector"/>7.4. EntitySelector</h2></div></div></div><p>Simplest configuration:</p><pre><code class="language-xml">      &lt;entitySelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">      &lt;entitySelector&gt;
        ... &lt;!-- Normal selector properties --&gt;
        &lt;entityClass&gt;org.optaplanner.examples.curriculumcourse.domain.Lecture&lt;/entityClass&gt;
      &lt;/entitySelector&gt;</code></pre><p>The <code class="literal">entityClass</code> property is only required if it cannot be deduced automatically because
    there are multiple entity classes.</p></div><div class="section" title="7.5. ValueSelector"><div class="titlepage"><div><div><h2 class="title"><a id="valueSelector"/>7.5. ValueSelector</h2></div></div></div><p>Simplest configuration:</p><pre><code class="language-xml">      &lt;valueSelector/&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">      &lt;valueSelector&gt;
        ... &lt;!-- Normal selector properties --&gt;
        &lt;variableName&gt;room&lt;/variableName&gt;
      &lt;/valueSelector&gt;</code></pre><p>The <code class="literal">variableName</code> property is only required if it cannot be deduced automatically because
    there are multiple variables (for the related entity class).</p><p>In exotic Construction Heuristic configurations, the <code class="literal">entityClass</code> from the
    <code class="literal">EntitySelector</code> sometimes needs to be downcasted, which can be done with the property
    <code class="literal">downcastEntityClass</code>:</p><pre><code class="language-xml">      &lt;valueSelector&gt;
        &lt;downcastEntityClass&gt;...LeadingExam&lt;/downcastEntityClass&gt;
        &lt;variableName&gt;period&lt;/variableName&gt;
      &lt;/valueSelector&gt;</code></pre><p>If a selected entity cannot be downcasted, the <code class="literal">ValueSelector</code> is empty for that
    entity.</p></div><div class="section" title="7.6. General Selector features"><div class="titlepage"><div><div><h2 class="title"><a id="generalSelectorFeatures"/>7.6. General <code class="literal">Selector</code> features</h2></div></div></div><div class="section" title="7.6.1. CacheType: Create moves ahead of time or Just In Time"><div class="titlepage"><div><div><h3 class="title"><a id="cacheType"/>7.6.1. <code class="literal">CacheType</code>: Create moves ahead of time or Just In Time</h3></div></div></div><p>A <code class="literal">Selector</code>'s <code class="literal">cacheType</code> determines when a selection (such as a
      <code class="literal">Move</code>, an entity, a value, ...) is created and how long it lives.</p><p>Almost every <code class="literal">Selector</code> supports setting a <code class="literal">cacheType</code>:</p><pre><code class="language-xml">    &lt;changeMoveSelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      ...
    &lt;/changeMoveSelector&gt;</code></pre><p>The following <code class="literal">cacheType</code>s are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">JUST_IN_TIME</code> (default): Not cached. Construct each selection
          (<code class="literal">Move</code>, ...) just before it's used. This scales up well in memory footprint.</p></li><li class="listitem"><p><code class="literal">STEP</code>: Cached. Create each selection (<code class="literal">Move</code>, ...) at the beginning
          of a step and cache them in a list for the remainder of the step. This scales up badly in memory
          footprint.</p></li><li class="listitem"><p><code class="literal">PHASE</code>: Cached. Create each selection (<code class="literal">Move</code>, ...) at the beginning
          of a solver phase and cache them in a list for the remainder of the phase. Some selections cannot be phase
          cached because the list changes every step. This scales up badly in memory footprint, but has a slight
          performance gain.</p></li><li class="listitem"><p><code class="literal">SOLVER</code>: Cached. Create each selection (<code class="literal">Move</code>, ...) at the beginning
          of a <code class="literal">Solver</code> and cache them in a list for the remainder of the <code class="literal">Solver</code>.
          Some selections cannot be solver cached because the list changes every step. This scales up badly in memory
          footprint, but has a slight performance gain.</p></li></ul></div><p>A <code class="literal">cacheType</code> can be set on composite selectors too:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;changeMoveSelector/&gt;
      &lt;swapMoveSelector/&gt;
      ...
    &lt;/unionMoveSelector&gt;</code></pre><p>Nested selectors of a cached selector cannot be configured to be cached themselves, unless it's a higher
      <code class="literal">cacheType</code>. For example: a <code class="literal">STEP</code> cached <code class="literal">unionMoveSelector</code>
      can hold a <code class="literal">PHASE</code> cached <code class="literal">changeMoveSelector</code>, but not a
      <code class="literal">STEP</code> cached <code class="literal">changeMoveSelector</code>.</p></div><div class="section" title="7.6.2. SelectionOrder: original, sorted, random, shuffled or probabilistic"><div class="titlepage"><div><div><h3 class="title"><a id="selectionOrder"/>7.6.2. SelectionOrder: original, sorted, random, shuffled or probabilistic</h3></div></div></div><p>A <code class="literal">Selector</code>'s <code class="literal">selectionOrder</code> determines the order in which the
      selections (such as <code class="literal">Move</code>s, entities, values, ...) are iterated. An optimization algorithm will
      usually only iterate through a subset of its <code class="literal">MoveSelector</code>'s selections, starting from the
      start, so the <code class="literal">selectionOrder</code> is critical to decide which <code class="literal">Move</code>s are actually
      evaluated.</p><p>Almost every <code class="literal">Selector</code> supports setting a <code class="literal">selectionOrder</code>:</p><pre><code class="language-xml">    &lt;changeMoveSelector&gt;
      ...
      &lt;selectionOrder&gt;RANDOM&lt;/selectionOrder&gt;
      ...
    &lt;/changeMoveSelector&gt;</code></pre><p>The following <code class="literal">selectionOrder</code>s are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">ORIGINAL</code>: Select the selections (<code class="literal">Move</code>s, entities, values, ...) in
          default order. Each selection will be selected only once.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example: A0, A1, A2, A3, ..., B0, B1, B2, B3, ..., C0, C1, C2, C3, ...</p></li></ul></div></li><li class="listitem"><p>SORTED: Select the selections (<code class="literal">Move</code>s, entities, values, ...) in sorted order. Each
          selection will be selected only once. Requires <code class="literal">cacheType &gt;= STEP</code>. Mostly used on an
          <code class="literal">entitySelector</code> or <code class="literal">valueSelector</code> for construction heuristics. See <a class="link" href="#sortedSelection" title="7.6.5. Sorted selection">sorted selection</a>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example: A0, B0, C0, ..., A2, B2, C2, ..., A1, B1, C1, ...</p></li></ul></div></li><li class="listitem"><p>RANDOM (default): Select the selections (<code class="literal">Move</code>s, entities, values, ...) in
          non-shuffled random order. A selection might be selected multiple times. This scales up well in performance
          because it does not require caching.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example: C2, A3, B1, C2, A0, C0, ...</p></li></ul></div></li><li class="listitem"><p>SHUFFLED: Select the selections (<code class="literal">Move</code>s, entities, values, ...) in shuffled random
          order. Each selection will be selected only once. Requires <code class="literal">cacheType &gt;= STEP</code>. This
          scales up badly in performance, not just because it requires caching, but also because a random number is
          generated for each element, even if it's not selected (which is the grand majority when scaling up).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example: C2, A3, B1, A0, C0, ...</p></li></ul></div></li><li class="listitem"><p>PROBABILISTIC: Select the selections (<code class="literal">Move</code>s, entities, values, ...) in random order,
          based on the selection probability of each element. A selection with a higher probability has a higher chance
          to be selected than elements with a lower probability. A selection might be selected multiple times. Requires
          <code class="literal">cacheType &gt;= STEP</code>. Mostly used on an <code class="literal">entitySelector</code> or
          <code class="literal">valueSelector</code>. See <a class="link" href="#probabilisticSelection" title="7.6.6. Probabilistic selection">probabilistic
          selection</a>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>For example: B1, B1, A1, B2, B1, C2, B1, B1, ...</p></li></ul></div></li></ul></div><p>A <code class="literal">selectionOrder</code> can be set on composite selectors too.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>When a <code class="literal">Selector</code> is cached, all of its nested <code class="literal">Selector</code>s will
        naturally default to <code class="literal">selectionOrder</code> <code class="literal">ORIGINAL</code>. Avoid overwriting the
        <code class="literal">selectionOrder</code> of those nested <code class="literal">Selector</code>s.</p></div></div><div class="section" title="7.6.3. Recommended combinations of CacheType and SelectionOrder"><div class="titlepage"><div><div><h3 class="title"><a id="recommendedCombinationsOfCacheTypeAndSelectionOrder"/>7.6.3. Recommended combinations of <code class="literal">CacheType</code> and <code class="literal">SelectionOrder</code></h3></div></div></div><div class="section" title="7.6.3.1. Just in time random selection (default)"><div class="titlepage"><div><div><h4 class="title"><a id="justInTimeRandomSelection"/>7.6.3.1. Just in time random selection (default)</h4></div></div></div><p>This combination is great for big use cases (10 000 entities or more), as it scales up well in memory
        footprint and performance. Other combinations are often not even viable on such sizes. It works for smaller use
        cases too, so it's a good way to start out. It's the default, so this explicit configuration of
        <code class="literal">cacheType</code> and <code class="literal">selectionOrder</code> is actually obsolete:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;cacheType&gt;JUST_IN_TIME&lt;/cacheType&gt;
      &lt;selectionOrder&gt;RANDOM&lt;/selectionOrder&gt;

      &lt;changeMoveSelector/&gt;
      &lt;swapMoveSelector/&gt;
    &lt;/unionMoveSelector&gt;</code></pre><p>Here's how it works. When <code class="literal">Iterator&lt;Move&gt;.next()</code> is called, a child
        <code class="literal">MoveSelector</code> is randomly selected (1), which creates a random <code class="literal">Move</code> (2, 3,
        4) and is then returned (5):</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/jitRandomSelection.png"/></div><p>Notice that <span class="bold"><strong>it never creates a list of <code class="literal">Move</code>s</strong></span> and it
        generates random numbers only for <code class="literal">Move</code>s that are actually selected.</p></div><div class="section" title="7.6.3.2. Cached shuffled selection"><div class="titlepage"><div><div><h4 class="title"><a id="cachedShuffledSelection"/>7.6.3.2. Cached shuffled selection</h4></div></div></div><p>This combination often wins for small and medium use cases (5000 entities or less). Beyond that size, it
        scales up badly in memory footprint and performance.</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SHUFFLED&lt;/selectionOrder&gt;

      &lt;changeMoveSelector/&gt;
      &lt;swapMoveSelector/&gt;
    &lt;/unionMoveSelector&gt;</code></pre><p>Here's how it works: At the start of the phase (or step depending on the <code class="literal">cacheType</code>),
        all moves are created (1) and cached (2). When <code class="literal">MoveSelector.iterator()</code> is called, the moves
        are shuffled (3). When <code class="literal">Iterator&lt;Move&gt;.next()</code> is called, the next element in the
        shuffled list is returned (4):</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/cachedShuffledSelection.png"/></div><p>Notice that <span class="bold"><strong>each <code class="literal">Move</code> will only be selected once</strong></span>, even
        though they are selected in random order.</p><p>Use cacheType PHASE if none of the (possibly nested) Selectors require <code class="literal">STEP</code>. Otherwise,
        do something like this:</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;cacheType&gt;STEP&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SHUFFLED&lt;/selectionOrder&gt;

      &lt;changeMoveSelector&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;/changeMoveSelector&gt;
      &lt;swapMoveSelector/&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;/swapMoveSelector&gt;
      &lt;pillarSwapMoveSelector/&gt;&lt;!-- Does not support cacheType PHASE --&gt;
    &lt;/unionMoveSelector&gt;</code></pre></div><div class="section" title="7.6.3.3. Cached random selection"><div class="titlepage"><div><div><h4 class="title"><a id="cachedRandomSelection"/>7.6.3.3. Cached random selection</h4></div></div></div><p>This combination is often a worthy competitor for medium use cases, especially with fast stepping
        optimization algorithms (such as Simulated Annealing). Unlike cached shuffled selection, it doesn't waste time
        shuffling the moves list at the beginning of every step.</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;RANDOM&lt;/selectionOrder&gt;

      &lt;changeMoveSelector/&gt;
      &lt;swapMoveSelector/&gt;
    &lt;/unionMoveSelector&gt;</code></pre></div></div><div class="section" title="7.6.4. Filtered selection"><div class="titlepage"><div><div><h3 class="title"><a id="filteredSelection"/>7.6.4. Filtered selection</h3></div></div></div><p>There can be certain moves that you don't want to select, because:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The move is pointless and would only waste CPU time. For example, swapping 2 lectures of the same course
          will result in the same score and the same schedule because all lectures of 1 course are interchangeable (same
          teacher, same students, same topic).</p></li><li class="listitem"><p>Doing the move would break <a class="link" href="#buildInHardConstraint" title="5.4.6. Built-in hard constraint">a built-in hard constraint</a>, so
          the solution would be infeasible but the score function doesn't check built-in hard constraints (for
          performance gain). For example, don't change a gym lecture to a room which is not a gym room.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Note that any built-in hard constraint must usually be filtered on every move type. For example,
              also don't swap the room of a gym lecture with another lecture if the other lecture's original room isn't
              a gym room.</p></li></ul></div></li></ul></div><p>Filtered selection can happen on any Selector in the selector tree, including any
      <code class="literal">MoveSelector</code>, <code class="literal">EntitySelector</code> or <code class="literal">ValueSelector</code>. It works
      with any <code class="literal">cacheType</code> and <code class="literal">selectionOrder</code>.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/filteredSelection.png"/></div><p>Filtering uses the interface <code class="literal">SelectionFilter</code>:</p><pre><code class="language-java">public interface SelectionFilter&lt;T&gt; {

    boolean accept(ScoreDirector scoreDirector, T selection);

}</code></pre><p>Implement the <code class="literal">accept</code> method to return <code class="literal">false</code> on a discarded
      <code class="literal">selection</code>. Unaccepted moves will not be selected and will therefore never have their
      <code class="literal">doMove</code> method called.</p><pre><code class="language-java">public class DifferentCourseSwapMoveFilter implements SelectionFilter&lt;SwapMove&gt; {

    public boolean accept(ScoreDirector scoreDirector, SwapMove move) {
        Lecture leftLecture = (Lecture) move.getLeftEntity();
        Lecture rightLecture = (Lecture) move.getRightEntity();
        return !leftLecture.getCourse().equals(rightLecture.getCourse());
    }

}</code></pre><p>Apply the filter on the lowest level possible. In most cases, you'll need to know both the entity and the
      value involved and you'll have to apply a <code class="literal">filterClass</code> on the
      <code class="literal">moveSelector</code>:</p><pre><code class="language-xml">    &lt;swapMoveSelector&gt;
      &lt;filterClass&gt;org.optaplanner.examples.curriculumcourse.solver.move.DifferentCourseSwapMoveFilter&lt;/filterClass&gt;
    &lt;/swapMoveSelector&gt;</code></pre><p>But if possible, apply it on a lower levels, such as a <code class="literal">filterClass</code> on the
      <code class="literal">entitySelector</code> or <code class="literal">valueSelector</code>:</p><pre><code class="language-xml">    &lt;changeMoveSelector&gt;
      &lt;entitySelector&gt;
        &lt;filterClass&gt;...EntityFilter&lt;/filterClass&gt;
      &lt;/entitySelector&gt;
    &lt;/changeMoveSelector&gt;</code></pre><p>You can configure multiple <code class="literal">filterClass</code> elements on a single selector.</p></div><div class="section" title="7.6.5. Sorted selection"><div class="titlepage"><div><div><h3 class="title"><a id="sortedSelection"/>7.6.5. Sorted selection</h3></div></div></div><p>Sorted selection can happen on any Selector in the selector tree, including any
      <code class="literal">MoveSelector</code>, <code class="literal">EntitySelector</code> or <code class="literal">ValueSelector</code>. It does
      not work with <code class="literal">cacheType</code> <code class="literal">JUST_IN_TIME</code> and it only works with
      <code class="literal">selectionOrder SORTED</code>.</p><p>It's mostly used in construction heuristics.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the chosen construction heuristic implies sorting, for example <code class="literal">FIRST_FIT_DECREASING</code>
        implies that the <code class="literal">EntitySelector</code> is sorted, there is no need to explicitly configure a
        <code class="literal">Selector</code> with sorting. If you do explicitly configure the <code class="literal">Selector</code>, it
        overwrites the default settings of that construction heuristic.</p></div><div class="section" title="7.6.5.1. Sorted selection by SorterManner"><div class="titlepage"><div><div><h4 class="title"><a id="sortedSelectionBySorterManner"/>7.6.5.1. Sorted selection by <code class="literal">SorterManner</code></h4></div></div></div><p>Some <code class="literal">Selector</code> types implement a <code class="literal">SorterManner</code> out of the box:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">EntitySelector</code> supports:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">DECREASING_DIFFICULTY</code>: Sorts the planning entities according to decreasing
                <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty</a>. Requires that planning
                entity difficulty is annotated on the domain model.</p><pre><code class="language-xml">    &lt;entitySelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
      &lt;sorterManner&gt;DECREASING_DIFFICULTY&lt;/sorterManner&gt;
    &lt;/entitySelector&gt;</code></pre></li></ul></div></li><li class="listitem"><p><code class="literal">ValueSelector</code> supports:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">INCREASING_STRENGTH</code>: Sorts the planning values according to increasing <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength</a>. Requires that planning value strength is
                annotated on the domain model.</p><pre><code class="language-xml">    &lt;valueSelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
      &lt;sorterManner&gt;INCREASING_STRENGTH&lt;/sorterManner&gt;
    &lt;/valueSelector&gt;</code></pre></li></ul></div></li></ul></div></div><div class="section" title="7.6.5.2. Sorted selection by Comparator"><div class="titlepage"><div><div><h4 class="title"><a id="sortedSelectionByComparator"/>7.6.5.2. Sorted selection by <code class="literal">Comparator</code></h4></div></div></div><p>An easy way to sort a <code class="literal">Selector</code> is with a plain old
        <code class="literal">Comparator</code>:</p><pre><code class="language-java">public class CloudProcessDifficultyComparator implements Comparator&lt;CloudProcess&gt; {

    public int compare(CloudProcess a, CloudProcess b) {
        return new CompareToBuilder()
                .append(a.getRequiredMultiplicand(), b.getRequiredMultiplicand())
                .append(a.getId(), b.getId())
                .toComparison();
    }

}</code></pre><p>You 'll also need to configure it (unless it's annotated on the domain model and automatically applied by
        the optimization algorithm):</p><pre><code class="language-xml">    &lt;entitySelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
      &lt;sorterComparatorClass&gt;...CloudProcessDifficultyComparator&lt;/sorterComparatorClass&gt;
      &lt;sorterOrder&gt;DESCENDING&lt;/sorterOrder&gt;
    &lt;/entitySelector&gt;</code></pre></div><div class="section" title="7.6.5.3. Sorted selection by SelectionSorterWeightFactory"><div class="titlepage"><div><div><h4 class="title"><a id="sortedSelectionBySelectionSorterWeightFactory"/>7.6.5.3. Sorted selection by <code class="literal">SelectionSorterWeightFactory</code></h4></div></div></div><p>If you need the entire <code class="literal">Solution</code> to sort a <code class="literal">Selector</code>, use a
        <code class="literal">SelectionSorterWeightFactory</code> instead:</p><pre><code class="language-java">public interface SelectionSorterWeightFactory&lt;Sol extends Solution, T&gt; {

    Comparable createSorterWeight(Sol solution, T selection);

}</code></pre><pre><code class="language-java">public class QueenDifficultyWeightFactory implements SelectionSorterWeightFactory&lt;NQueens, Queen&gt; {

    public Comparable createSorterWeight(NQueens nQueens, Queen queen) {
        int distanceFromMiddle = calculateDistanceFromMiddle(nQueens.getN(), queen.getColumnIndex());
        return new QueenDifficultyWeight(queen, distanceFromMiddle);
    }

    // ...

    public static class QueenDifficultyWeight implements Comparable&lt;QueenDifficultyWeight&gt; {

        private final Queen queen;
        private final int distanceFromMiddle;

        public QueenDifficultyWeight(Queen queen, int distanceFromMiddle) {
            this.queen = queen;
            this.distanceFromMiddle = distanceFromMiddle;
        }

        public int compareTo(QueenDifficultyWeight other) {
            return new CompareToBuilder()
                    // The more difficult queens have a lower distance to the middle
                    .append(other.distanceFromMiddle, distanceFromMiddle) // Decreasing
                    // Tie breaker
                    .append(queen.getColumnIndex(), other.queen.getColumnIndex())
                    .toComparison();
        }

    }

}</code></pre><p>You 'll also need to configure it (unless it's annotated on the domain model and automatically applied by
        the optimization algorithm):</p><pre><code class="language-xml">    &lt;entitySelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
      &lt;sorterWeightFactoryClass&gt;...QueenDifficultyWeightFactory&lt;/sorterWeightFactoryClass&gt;
      &lt;sorterOrder&gt;DESCENDING&lt;/sorterOrder&gt;
    &lt;/entitySelector&gt;</code></pre></div><div class="section" title="7.6.5.4. Sorted selection by SelectionSorter"><div class="titlepage"><div><div><h4 class="title"><a id="sortedSelectionBySelectionSorter"/>7.6.5.4. Sorted selection by <code class="literal">SelectionSorter</code></h4></div></div></div><p>Alternatively, you can also use the interface <code class="literal">SelectionSorter</code> directly:</p><pre><code class="language-java">public interface SelectionSorter&lt;T&gt; {

    void sort(ScoreDirector scoreDirector, List&lt;T&gt; selectionList);

}</code></pre><pre><code class="language-xml">    &lt;entitySelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
      &lt;sorterClass&gt;...MyEntitySorter&lt;/sorterClass&gt;
    &lt;/entitySelector&gt;</code></pre></div></div><div class="section" title="7.6.6. Probabilistic selection"><div class="titlepage"><div><div><h3 class="title"><a id="probabilisticSelection"/>7.6.6. Probabilistic selection</h3></div></div></div><p>Probabilistic selection can happen on any Selector in the selector tree, including any
      <code class="literal">MoveSelector</code>, <code class="literal">EntitySelector</code> or <code class="literal">ValueSelector</code>. It does
      not work with <code class="literal">cacheType</code> <code class="literal">JUST_IN_TIME</code> and it only works with
      <code class="literal">selectionOrder PROBABILISTIC</code>.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/probabilisticSelection.png"/></div><p>Each selection has a <code class="literal">probabilityWeight</code>, which determines the chance that selection will
      be selected:</p><pre><code class="language-java">public interface SelectionProbabilityWeightFactory&lt;T&gt; {

    double createProbabilityWeight(ScoreDirector scoreDirector, T selection);

}</code></pre><pre><code class="language-xml">    &lt;entitySelector&gt;
      &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;selectionOrder&gt;PROBABILISTIC&lt;/selectionOrder&gt;
      &lt;probabilityWeightFactoryClass&gt;...MyEntityProbabilityWeightFactoryClass&lt;/probabilityWeightFactoryClass&gt;
    &lt;/entitySelector&gt;</code></pre><p>For example, if there are 3 entities: process A (probabilityWeight 2.0), process B (probabilityWeight 0.5)
      and process C (probabilityWeight 0.5), then process A will be selected 4 times more than B and C.</p></div><div class="section" title="7.6.7. Limited selection"><div class="titlepage"><div><div><h3 class="title"><a id="limitedSelection"/>7.6.7. Limited selection</h3></div></div></div><p>Selecting all possible moves sometimes does not scale well enough, especially for construction heuristics
      (which don't support <a class="link" href="#acceptedCountLimit" title="10.2.4.1. Accepted count limit">acceptedCountLimit</a>).</p><p>To limit the number of selected selection per step, apply a <code class="literal">selectedCountLimit</code> on the
      selector:</p><pre><code class="language-xml">    &lt;changeMoveSelector&gt;
      &lt;selectedCountLimit&gt;100&lt;/selectedCountLimit&gt;
    &lt;/changeMoveSelector&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>To scale Local Search, setting <a class="link" href="#acceptedCountLimit" title="10.2.4.1. Accepted count limit">acceptedCountLimit</a> is usually
        better than using <code class="literal">selectedCountLimit</code>.</p></div></div><div class="section" title="7.6.8. Mimic selection (record/replay)"><div class="titlepage"><div><div><h3 class="title"><a id="mimicSelection"/>7.6.8. Mimic selection (record/replay)</h3></div></div></div><p>During mimic selection, 1 normal selector records its selection and 1 or multiple other special selectors
      replay that selection. The recording selector acts as a normal selector and supports all other configuration
      properties. A replaying selector mimics the recording selection and support no other configuration
      properties.</p><p>The recording selector needs an <code class="literal">id</code>. A replaying selector must reference a recorder's id
      with a <code class="literal">mimicSelectorRef</code>:</p><pre><code class="language-xml">      &lt;cartesianProductMoveSelector&gt;
        &lt;changeMoveSelector&gt;
          &lt;entitySelector id="entitySelector"/&gt;
          &lt;valueSelector&gt;
            &lt;variableName&gt;period&lt;/variableName&gt;
          &lt;/valueSelector&gt;
        &lt;/changeMoveSelector&gt;
        &lt;changeMoveSelector&gt;
          &lt;entitySelector mimicSelectorRef="entitySelector"/&gt;
          &lt;valueSelector&gt;
            &lt;variableName&gt;room&lt;/variableName&gt;
          &lt;/valueSelector&gt;
        &lt;/changeMoveSelector&gt;
      &lt;/cartesianProductMoveSelector&gt;</code></pre><p>Mimic selection is useful to create a composite move from 2 moves that affect the same entity.</p></div><div class="section" title="7.6.9. Nearby selection"><div class="titlepage"><div><div><h3 class="title"><a id="nearbySelection"/>7.6.9. Nearby selection</h3></div></div></div><p>In some use cases (such as TSP and VRP, but also in non-chained variable cases), changing entities to nearby
      values or swapping nearby entities can <span class="bold"><strong>heavily increase scalability</strong></span> and improve
      solution quality.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/nearbySelectionMotivation.png"/></div><p>Nearby selection increases the probability of selecting an entity or value which is nearby to the first
      entity being moved in that move.</p><div class="mediaobject"><img src="images/Chapter-Move_and_neighborhood_selection/nearbySelectionRandomDistribution.png"/></div><p>The distance between 2 entities or values is domain specific. Therefore, implement the
      <code class="literal">NearbyDistanceMeter</code> interface:</p><pre><code class="language-java">public interface NearbyDistanceMeter&lt;O, D&gt; {

    double getNearbyDistance(O origin, D destination);

}</code></pre><p>It returns a <code class="literal">double</code> which represents the distance:</p><pre><code class="language-java">public class CustomerNearbyDistanceMeter implements NearbyDistanceMeter&lt;Customer, Standstill&gt; {

    public double getNearbyDistance(Customer origin, Standstill destination) {
        return origin.getDistanceTo(destination);
    }

}</code></pre><p>To configure nearby selection, add a <code class="literal">nearbySelection</code> element in the
      <code class="literal">entitySelector</code> or <code class="literal">valueSelector</code> and use <a class="link" href="#mimicSelection" title="7.6.8. Mimic selection (record/replay)">mimic
      selection</a> to specify which entity should be near by the selection.</p><pre><code class="language-xml">    &lt;unionMoveSelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector id="entitySelector1"/&gt;
        &lt;valueSelector&gt;
          &lt;nearbySelection&gt;
            &lt;originEntitySelector mimicSelectorRef="entitySelector1"/&gt;
            &lt;nearbyDistanceMeterClass&gt;...CustomerNearbyDistanceMeter&lt;/nearbyDistanceMeterClass&gt;
            &lt;parabolicDistributionSizeMaximum&gt;40&lt;/parabolicDistributionSizeMaximum&gt;
          &lt;/nearbySelection&gt;
        &lt;/valueSelector&gt;
      &lt;/changeMoveSelector&gt;
      &lt;swapMoveSelector&gt;
        &lt;entitySelector id="entitySelector2"/&gt;
        &lt;secondaryEntitySelector&gt;
          &lt;nearbySelection&gt;
            &lt;originEntitySelector mimicSelectorRef="entitySelector2"/&gt;
            &lt;nearbyDistanceMeterClass&gt;...CustomerNearbyDistanceMeter&lt;/nearbyDistanceMeterClass&gt;
            &lt;parabolicDistributionSizeMaximum&gt;40&lt;/parabolicDistributionSizeMaximum&gt;
          &lt;/nearbySelection&gt;
        &lt;/secondaryEntitySelector&gt;
      &lt;/swapMoveSelector&gt;
      &lt;tailChainSwapMoveSelector&gt;
        &lt;entitySelector id="entitySelector3"/&gt;
        &lt;valueSelector&gt;
          &lt;nearbySelection&gt;
            &lt;originEntitySelector mimicSelectorRef="entitySelector3"/&gt;
            &lt;nearbyDistanceMeterClass&gt;...CustomerNearbyDistanceMeter&lt;/nearbyDistanceMeterClass&gt;
            &lt;parabolicDistributionSizeMaximum&gt;40&lt;/parabolicDistributionSizeMaximum&gt;
          &lt;/nearbySelection&gt;
        &lt;/valueSelector&gt;
      &lt;/tailChainSwapMoveSelector&gt;
    &lt;/unionMoveSelector&gt;</code></pre><p>The following distribution methods are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Block distribution: Only the n nearest are selected, with an equal probability. For example, select the
          20 nearest:</p><pre><code class="language-xml">  &lt;nearbySelection&gt;
    &lt;blockDistributionSizeMaximum&gt;20&lt;/blockDistributionSizeMaximum&gt;
  &lt;/nearbySelection&gt;</code></pre></li><li class="listitem"><p>Linear distribution: Nearest elements are selected with a higher probability. The probability decreases
          linearly.</p><pre><code class="language-xml">  &lt;nearbySelection&gt;
    &lt;linearDistributionSizeMaximum&gt;40&lt;/linearDistributionSizeMaximum&gt;
  &lt;/nearbySelection&gt;</code></pre></li><li class="listitem"><p>Parabolic distribution (recommended): Nearest elements are selected with a higher probability.</p><pre><code class="language-xml">  &lt;nearbySelection&gt;
    &lt;parabolicDistributionSizeMaximum&gt;80&lt;/parabolicDistributionSizeMaximum&gt;
  &lt;/nearbySelection&gt;</code></pre></li><li class="listitem"><p>Beta distribution: Selection according to a beta distribution. Slows down the solver.</p><pre><code class="language-xml">  &lt;nearbySelection&gt;
    &lt;betaDistributionAlpha&gt;5&lt;/betaDistributionAlpha&gt;
    &lt;betaDistributionBeta&gt;1&lt;/betaDistributionBeta&gt;
  &lt;/nearbySelection&gt;</code></pre></li></ul></div><p>As always, use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to tweak values if
      desired.</p></div></div><div class="section" title="7.7. Custom moves"><div class="titlepage"><div><div><h2 class="title"><a id="customMoves"/>7.7. Custom moves</h2></div></div></div><div class="section" title="7.7.1. Which move types might be missing in my implementation?"><div class="titlepage"><div><div><h3 class="title"><a id="whichMoveTypesMightBeMissing"/>7.7.1. Which move types might be missing in my implementation?</h3></div></div></div><p>To determine which move types might be missing in your implementation, run a <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> <span class="emphasis"><em>for a short amount of time</em></span> and <a class="link" href="#writeTheOutputSolutionOfBenchmarkRuns" title="14.2.6. Write the output solution of benchmark runs">configure it to write the best solutions to disk</a>. Take
      a look at such a best solution: it will likely be a local optima. Try to figure out if there's a move that could
      get out of that local optima faster.</p><p>If you find one, implement that coarse-grained move, mix it with the existing moves and benchmark it against
      the previous configurations to see if you want to keep it.</p></div><div class="section" title="7.7.2. Custom moves introduction"><div class="titlepage"><div><div><h3 class="title"><a id="customMovesIntroduction"/>7.7.2. Custom moves introduction</h3></div></div></div><p>Instead of reusing the generic <code class="literal">Move</code>s (such as <code class="literal">ChangeMove</code>) you can also
      implement your own <code class="literal">Move</code>s. Generic and custom <code class="literal">MoveSelector</code>s can be combined
      as desired.</p><p>A custom <code class="literal">Move</code> can be tailored to work to the advantage of your constraints. For example,
      in examination scheduling, changing the period of an exam A also changes the period of all the exams that need to
      coincide with exam A.</p><p>A custom <code class="literal">Move</code> is also slightly faster than a generic <code class="literal">Move</code>. However,
      it's far more work to implement and much harder to avoid bugs. After implementing a custom
      <code class="literal">Move</code>, make sure to turn on <code class="literal">environmentMode</code> <code class="literal">FULL_ASSERT</code> to
      check for score corruptions.</p></div><div class="section" title="7.7.3. The interface Move"><div class="titlepage"><div><div><h3 class="title"><a id="theInterfaceMove"/>7.7.3. The interface <code class="literal">Move</code></h3></div></div></div><p>Your custom moves must implement the <code class="literal">Move</code> interface:</p><pre><code class="language-java">public interface Move {

    boolean isMoveDoable(ScoreDirector scoreDirector);

    Move createUndoMove(ScoreDirector scoreDirector);
    void doMove(ScoreDirector scoreDirector);

    Collection&lt;? extends Object&gt; getPlanningEntities();
    Collection&lt;? extends Object&gt; getPlanningValues();

}</code></pre><p>Let's take a look at the <code class="literal">Move</code> implementation for 4 queens which moves a queen to a
      different row:</p><pre><code class="language-java">public class RowChangeMove extends AbstractMove {

    private Queen queen;
    private Row toRow;

    public RowChangeMove(Queen queen, Row toRow) {
        this.queen = queen;
        this.toRow = toRow;
    }

    // ... see below

}</code></pre><p>An instance of <code class="literal">RowChangeMove</code> moves a queen from its current row to a different
      row.</p><p>Planner calls the <code class="literal">doMove(ScoreDirector)</code> method to do a move. The <code class="literal">Move</code>
      implementation must notify the <code class="literal">ScoreDirector</code> of any changes it makes to planning entity's
      variables:</p><pre><code class="language-java">    public void doMove(ScoreDirector scoreDirector) {
        scoreDirector.beforeVariableChanged(queen, "row"); // before changes are made to the queen.row
        queen.setRow(toRow);
        scoreDirector.afterVariableChanged(queen, "row"); // after changes are made to the queen.row
    }</code></pre><p>You need to call the <code class="literal">scoreDirector.beforeVariableChanged(Object, String)</code> and
      <code class="literal">scoreDirector.afterVariableChanged(Object, String)</code> methods directly before and after modifying
      the entity.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>You can alter multiple entities in a single move and effectively create a big move (also known as a
        coarse-grained move).</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>A <code class="literal">Move</code> can only change/add/remove planning entities, it must not change any of the
        problem facts.</p></div><p>Planner automatically filters out <span class="emphasis"><em>non doable moves</em></span> by calling the
      <code class="literal">isMoveDoable(ScoreDirector)</code> method on a move. A <span class="emphasis"><em>non doable move</em></span> is:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A move that changes nothing on the current solution. For example, moving queen B0 to row 0 is not
          doable, because it is already there.</p></li><li class="listitem"><p>A move that is impossible to do on the current solution. For example, moving queen B0 to row 10 is not
          doable because it would move it outside the board limits.</p></li></ul></div><p>In the n queens example, a move which moves the queen from its current row to the same row isn't
      doable:</p><pre><code class="language-java">    public boolean isMoveDoable(ScoreDirector scoreDirector) {
        return !ObjectUtils.equals(queen.getRow(), toRow);
    }</code></pre><p>Because we won't generate a move which can move a queen outside the board limits, we don't need to check it.
      A move that is currently not doable could become doable on the working <code class="literal">Solution</code> of a later
      step.</p><p>Each move has an <span class="emphasis"><em>undo move</em></span>: a move (normally of the same type) which does the exact
      opposite. In the example above the undo move of <span class="emphasis"><em>C0 to C2</em></span> would be the move <span class="emphasis"><em>C2 to
      C0</em></span>. An undo move is created from a <code class="literal">Move</code>, before the <code class="literal">Move</code> has been
      done on the current solution.</p><pre><code class="language-java">    public Move createUndoMove(ScoreDirector scoreDirector) {
        return new RowChangeMove(queen, queen.getRow());
    }</code></pre><p>Notice that if C0 would have already been moved to C2, the undo move would create the move <span class="emphasis"><em>C2 to
      C2</em></span>, instead of the move <span class="emphasis"><em>C2 to C0</em></span>.</p><p>A solver phase might do and undo the same <code class="literal">Move</code> more than once. In fact, many solver
      phases will iteratively do and undo a number of moves to evaluate them, before selecting one of those and doing
      that move again (without undoing it this time).</p><p>A <code class="literal">Move</code> must implement the <code class="literal">getPlanningEntities()</code> and
      <code class="literal">getPlanningValues()</code> methods. They are used by entity tabu and value tabu respectively. When
      they are called, the <code class="literal">Move</code> has already been done.</p><pre><code class="language-java">    public List&lt;? extends Object&gt; getPlanningEntities() {
        return Collections.singletonList(queen);
    }

    public Collection&lt;? extends Object&gt; getPlanningValues() {
        return Collections.singletonList(toRow);
    }</code></pre><p>If your <code class="literal">Move</code> changes multiple planning entities, return all of them in
      <code class="literal">getPlanningEntities()</code> and return all their values (to which they are changing) in
      <code class="literal">getPlanningValues()</code>.</p><pre><code class="language-java">    public Collection&lt;? extends Object&gt; getPlanningEntities() {
        return Arrays.asList(leftCloudProcess, rightCloudProcess);
    }

    public Collection&lt;? extends Object&gt; getPlanningValues() {
        return Arrays.asList(leftCloudProcess.getComputer(), rightCloudProcess.getComputer());
    }</code></pre><p>A <code class="literal">Move</code> must implement the <code class="literal">equals()</code> and <code class="literal">hashCode()</code>
      methods. 2 moves which make the same change on a solution, should be equal.</p><pre><code class="language-java">    public boolean equals(Object o) {
        if (this == o) {
            return true;
        } else if (o instanceof RowChangeMove) {
            RowChangeMove other = (RowChangeMove) o;
            return new EqualsBuilder()
                    .append(queen, other.queen)
                    .append(toRow, other.toRow)
                    .isEquals();
        } else {
            return false;
        }
    }

    public int hashCode() {
        return new HashCodeBuilder()
                .append(queen)
                .append(toRow)
                .toHashCode();
    }</code></pre><p>Notice that it checks if the other move is an instance of the same move type. This
      <code class="literal">instanceof</code> check is important because a move will be compared to a move with another move type
      if you're using more then 1 move type.</p><p>It's also recommended to implement the <code class="literal">toString()</code> method as it allows you to read
      Planner's logging more easily:</p><pre><code class="language-java">    public String toString() {
        return queen + " =&gt; " + toRow;
    }</code></pre><p>Now that we can implement a single custom <code class="literal">Move</code>, let's take a look at generating such
      custom moves.</p></div><div class="section" title="7.7.4. MoveListFactory: the easy way to generate custom moves"><div class="titlepage"><div><div><h3 class="title"><a id="moveListFactory"/>7.7.4. <code class="literal">MoveListFactory</code>: the easy way to generate custom moves</h3></div></div></div><p>The easiest way to generate custom moves is by implementing the interface
      <code class="literal">MoveListFactory</code>:</p><pre><code class="language-java">public interface MoveListFactory&lt;S extends Solution&gt; {

    List&lt;Move&gt; createMoveList(S solution);

}</code></pre><p>For example:</p><pre><code class="language-java">public class RowChangeMoveFactory implements MoveListFactory&lt;NQueens&gt; {

    public List&lt;Move&gt; createMoveList(NQueens nQueens) {
        List&lt;Move&gt; moveList = new ArrayList&lt;Move&gt;();
        for (Queen queen : nQueens.getQueenList()) {
            for (Row toRow : nQueens.getRowList()) {
                moveList.add(new RowChangeMove(queen, toRow));
            }
        }
        return moveList;
    }

}</code></pre><p>Simple configuration (which can be nested in a <code class="literal">unionMoveSelector</code> just like any other
      <code class="literal">MoveSelector</code>):</p><pre><code class="language-xml">    &lt;moveListFactory&gt;
      &lt;moveListFactoryClass&gt;org.optaplanner.examples.nqueens.solver.move.factory.RowChangeMoveFactory&lt;/moveListFactoryClass&gt;
    &lt;/moveListFactory&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;moveListFactory&gt;
      ... &lt;!-- Normal moveSelector properties --&gt;
      &lt;moveListFactoryClass&gt;org.optaplanner.examples.nqueens.solver.move.factory.RowChangeMoveFactory&lt;/moveListFactoryClass&gt;
    &lt;/moveListFactory&gt;</code></pre><p>Because the <code class="literal">MoveListFactory</code> generates all moves at once in a
      <code class="literal">List&lt;Move&gt;</code>, it does not support <code class="literal">cacheType</code>
      <code class="literal">JUST_IN_TIME</code>. Therefore, <code class="literal">moveListFactory</code> uses <code class="literal">cacheType</code>
      <code class="literal">STEP</code> by default and it scales badly in memory footprint.</p></div><div class="section" title="7.7.5. MoveIteratorFactory: generate custom moves just in time"><div class="titlepage"><div><div><h3 class="title"><a id="moveIteratorFactory"/>7.7.5. <code class="literal">MoveIteratorFactory</code>: generate custom moves just in time</h3></div></div></div><p>Use this advanced form to generate custom moves by implementing the <code class="literal">MoveIteratorFactory</code>
      interface:</p><pre><code class="language-java">public interface MoveIteratorFactory {

    long getSize(ScoreDirector scoreDirector);

    Iterator&lt;Move&gt; createOriginalMoveIterator(ScoreDirector scoreDirector);

    Iterator&lt;Move&gt; createRandomMoveIterator(ScoreDirector scoreDirector, Random workingRandom);

}</code></pre><p>The <code class="literal">getSize()</code> method must give an estimation of the size. It doesn't need to be correct.
      The <code class="literal">createOriginalMoveIterator</code> method is called if the <code class="literal">selectionOrder</code> is
      <code class="literal">ORIGINAL</code> or if it is cached. The <code class="literal">createRandomMoveIterator</code> method is called
      for <code class="literal">selectionOrder</code> <code class="literal">RANDOM</code> combined with cacheType
      <code class="literal">JUST_IN_TIME</code>.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Don't create a collection (list, array, map, set) of <code class="literal">Move</code>s when creating the
        <code class="literal">Iterator&lt;Move&gt;</code>: the whole purpose of <code class="literal">MoveIteratorFactory</code> over
        <code class="literal">MoveListFactory</code> is giving you the ability to create a <code class="literal">Move</code> just in time in
        the <code class="literal">Iterator</code>'s method <code class="literal">next()</code>.</p></div><p>Simple configuration (which can be nested in a <code class="literal">unionMoveSelector</code> just like any other
      <code class="literal">MoveSelector</code>):</p><pre><code class="language-xml">    &lt;moveIteratorFactory&gt;
      &lt;moveIteratorFactoryClass&gt;...&lt;/moveIteratorFactoryClass&gt;
    &lt;/moveIteratorFactory&gt;</code></pre><p>Advanced configuration:</p><pre><code class="language-xml">    &lt;moveIteratorFactory&gt;
      ... &lt;!-- Normal moveSelector properties --&gt;
      &lt;moveIteratorFactoryClass&gt;...&lt;/moveIteratorFactoryClass&gt;
    &lt;/moveIteratorFactory&gt;</code></pre></div></div></div><div class="chapter" title="Chapter 8. Exhaustive Search"><div class="titlepage"><div><div><h2 class="title"><a id="exhaustiveSearch"/>Chapter 8. Exhaustive Search</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#exhaustiveSearchOverview">8.1. Overview</a></span></dt><dt><span class="section"><a href="#bruteForce">8.2. Brute Force</a></span></dt><dd><dl><dt><span class="section"><a href="#bruteForceAlgorithm">8.2.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#bruteForceConfiguration">8.2.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#branchAndBound">8.3. Branch And Bound</a></span></dt><dd><dl><dt><span class="section"><a href="#branchAndBoundAlgorithm">8.3.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#branchAndBoundConfiguration">8.3.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#scalabilityOfExhaustiveSearch">8.4. Scalability of Exhaustive Search</a></span></dt></dl></div><div class="section" title="8.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="exhaustiveSearchOverview"/>8.1. Overview</h2></div></div></div><p>Exhaustive Search will always find the global optimum and recognize it too. That being said, it doesn't scale (not
    even beyond toy data sets) and is therefore mostly useless.</p></div><div class="section" title="8.2. Brute Force"><div class="titlepage"><div><div><h2 class="title"><a id="bruteForce"/>8.2. Brute Force</h2></div></div></div><div class="section" title="8.2.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="bruteForceAlgorithm"/>8.2.1. Algorithm description</h3></div></div></div><p>The Brute Force algorithm creates and evaluates every possible solution.</p><div class="mediaobject"><img src="images/Chapter-Exhaustive_search/bruteForceNQueens04.png"/></div><p>Notice that it creates a search tree that explodes exponentially as the problem size increases, so it hits a
      scalability wall.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p><span class="bold"><strong>Brute Force is mostly unusable for a real-world problem due to time
        limitations</strong></span>, as shown in <a class="link" href="#scalabilityOfExhaustiveSearch" title="8.4. Scalability of Exhaustive Search">scalability of Exhaustive
        Search</a>.</p></div></div><div class="section" title="8.2.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="bruteForceConfiguration"/>8.2.2. Configuration</h3></div></div></div><p>Simplest configuration of Brute Force:</p><pre><code class="language-xml">&lt;solver&gt;
  ...
  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRUTE_FORCE&lt;/exhaustiveSearchType&gt;
  &lt;/exhaustiveSearch&gt;
&lt;/solver&gt;</code></pre></div></div><div class="section" title="8.3. Branch And Bound"><div class="titlepage"><div><div><h2 class="title"><a id="branchAndBound"/>8.3. Branch And Bound</h2></div></div></div><div class="section" title="8.3.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="branchAndBoundAlgorithm"/>8.3.1. Algorithm description</h3></div></div></div><p>Branch And Bound also explores nodes in an exponential search tree, but it investigates more promising nodes
      first and prunes away worthless nodes.</p><p>For each node, Branch And Bound calculates the optimistic bound: the best possible score to which that node
      can lead to. If the optimistic bound of a node is lower or equal to the global pessimistic bound, then it prunes
      away that node (including the entire branch of all its subnodes).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Academic papers use the term lower bound instead of optimistic bound (and the term upper bound instead of
        pessimistic bound), because they minimize the score.</p><p>Planner maximizes the score (because it supports combining negative and positive constraints).
        Therefore, for clarity, it uses different terms, as it would be confusing to use the term lower bound
        for a bound which is always higher.</p></div><p>For example: at index 15, it can prune away all unvisited solutions with queen A on row 0, because none will
      be better than the solution of index 14 with a score of <code class="literal">-1</code>.</p><div class="mediaobject"><img src="images/Chapter-Exhaustive_search/depthFirstBranchAndBoundNQueens04.png"/></div><p>Notice that Branch And Bound (much like <a class="link" href="#bruteForce" title="8.2. Brute Force">Brute Force</a>) creates a search tree
      that explodes exponentially as the problem size increases. So it hits the same scalability wall, only a little bit
      later.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p><span class="bold"><strong>Branch And Bound is mostly unusable for a real-world problem due to time
        limitations</strong></span>, as shown in <a class="link" href="#scalabilityOfExhaustiveSearch" title="8.4. Scalability of Exhaustive Search">scalability of Exhaustive
        Search</a>.</p></div></div><div class="section" title="8.3.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="branchAndBoundConfiguration"/>8.3.2. Configuration</h3></div></div></div><p>Simplest configuration of Branch And Bound:</p><pre><code class="language-xml">&lt;solver&gt;
  ...
  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRANCH_AND_BOUND&lt;/exhaustiveSearchType&gt;
  &lt;/exhaustiveSearch&gt;
&lt;/solver&gt;</code></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>For the pruning to work with the default <code class="literal">ScoreBounder</code>, the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> should be set. Especially an <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> of <code class="literal">ONLY_DOWN</code> (or at least has
        <code class="literal">ONLY_DOWN</code> in the leading score levels) prunes a lot.</p></div><p>Advanced configuration:</p><pre><code class="language-xml">  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRANCH_AND_BOUND&lt;/exhaustiveSearchType&gt;
    &lt;nodeExplorationType&gt;DEPTH_FIRST&lt;/nodeExplorationType&gt;
    &lt;entitySorterManner&gt;DECREASING_DIFFICULTY_IF_AVAILABLE&lt;/entitySorterManner&gt;
    &lt;valueSorterManner&gt;INCREASING_STRENGTH_IF_AVAILABLE&lt;/valueSorterManner&gt;
  &lt;/exhaustiveSearch&gt;</code></pre><p>The <code class="literal">nodeExplorationType</code> options are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">DEPTH_FIRST</code> (default): Explore deeper nodes first (and then a better score and then a
          better optimistic bound). Deeper nodes (especially leaf nodes) often improve the pessimistic bound. A better
          pessimistic bound allows pruning more nodes to reduce the search space.</p><pre><code class="language-xml">  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRANCH_AND_BOUND&lt;/exhaustiveSearchType&gt;
    &lt;nodeExplorationType&gt;DEPTH_FIRST&lt;/nodeExplorationType&gt;
  &lt;/exhaustiveSearch&gt;</code></pre></li><li class="listitem"><p><code class="literal">BREADTH_FIRST</code> (not recommended): Explore nodes layer by layer (and then a better
          score and then a better optimistic bound). Scales terribly in memory (and usually in performance too).</p><pre><code class="language-xml">  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRANCH_AND_BOUND&lt;/exhaustiveSearchType&gt;
    &lt;nodeExplorationType&gt;BREADTH_FIRST&lt;/nodeExplorationType&gt;
  &lt;/exhaustiveSearch&gt;</code></pre></li><li class="listitem"><p><code class="literal">SCORE_FIRST</code>: Explore nodes with a better score first (and then a better optimistic
          bound and then deeper nodes first). Might scale as terribly as <code class="literal">BREADTH_FIRST</code> in some
          cases.</p><pre><code class="language-xml">  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRANCH_AND_BOUND&lt;/exhaustiveSearchType&gt;
    &lt;nodeExplorationType&gt;SCORE_FIRST&lt;/nodeExplorationType&gt;
  &lt;/exhaustiveSearch&gt;</code></pre></li><li class="listitem"><p><code class="literal">OPTIMISTIC_BOUND_FIRST</code>: Explore nodes with a better optimistic bound first (and then
          a better score and then deeper nodes first). Might scale as terribly as <code class="literal">BREADTH_FIRST</code> in
          some cases.</p><pre><code class="language-xml">  &lt;exhaustiveSearch&gt;
    &lt;exhaustiveSearchType&gt;BRANCH_AND_BOUND&lt;/exhaustiveSearchType&gt;
    &lt;nodeExplorationType&gt;OPTIMISTIC_BOUND_FIRST&lt;/nodeExplorationType&gt;
  &lt;/exhaustiveSearch&gt;</code></pre></li></ul></div><p>The <code class="literal">entitySorterManner</code> options are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">DECREASING_DIFFICULTY</code>: Initialize the more difficult planning entities first. This
          usually increases pruning (and therefore improves scalability). Requires the model to support <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty comparison</a>.</p></li><li class="listitem"><p><code class="literal">DECREASING_DIFFICULTY_IF_AVAILABLE</code> (default): If the model supports <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty comparison</a>, behave like
          <code class="literal">DECREASING_DIFFICULTY</code>, else like <code class="literal">NONE</code>.</p></li><li class="listitem"><p><code class="literal">NONE</code>: Initialize the planning entities in original order.</p></li></ul></div><p>The <code class="literal">valueSorterManner</code> options are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">INCREASING_STRENGTH</code>: Evaluate the planning values in increasing strength. Requires
          the model to support <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>.</p></li><li class="listitem"><p><code class="literal">INCREASING_STRENGTH_IF_AVAILABLE</code> (default): If the model supports <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>, behave like
          <code class="literal">INCREASING_STRENGTH</code>, else like <code class="literal">NONE</code>.</p></li><li class="listitem"><p><code class="literal">DECREASING_STRENGTH</code>: Evaluate the planning values in decreasing strength. Requires
          the model to support <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>.</p></li><li class="listitem"><p><code class="literal">DECREASING_STRENGTH_IF_AVAILABLE</code>: If the model supports <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>, behave like
          <code class="literal">DECREASING_STRENGTH</code>, else like <code class="literal">NONE</code>.</p></li><li class="listitem"><p><code class="literal">NONE</code>: Try the planning values in original order.</p></li></ul></div></div></div><div class="section" title="8.4. Scalability of Exhaustive Search"><div class="titlepage"><div><div><h2 class="title"><a id="scalabilityOfExhaustiveSearch"/>8.4. Scalability of Exhaustive Search</h2></div></div></div><p>Exhaustive Search variants suffer from 2 big scalability issues:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>They scale terribly memory wise.</p></li><li class="listitem"><p>They scale horribly performance wise.</p></li></ul></div><p>As shown in these time spent graphs from the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a>, Brute
    Force and Branch And Bound both hit a performance scalability wall. For example, on N queens it hits wall at a few
    dozen queens:</p><div class="mediaobject"><img src="images/Chapter-Exhaustive_search/exhaustiveSearchScalabilityNQueens.png"/></div><p>In most use cases, such as Cloud Balancing, the wall appears out of thin air:</p><div class="mediaobject"><img src="images/Chapter-Exhaustive_search/exhaustiveSearchScalabilityCloudBalance.png"/></div><p><span class="bold"><strong>Exhaustive Search hits this wall on small datasets already, so in production these
    optimizations algorithms are mostly useless.</strong></span> Use Construction Heuristics with Local Search instead: those
    can handle thousands of queens/computers easily.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Throwing hardware at these scalability issues has no noticeable impact. Newer and more hardware are just a
      drop in the ocean. Moore's law cannot win against the onslaught of a few more planning entities in the
      dataset.</p></div></div></div><div class="chapter" title="Chapter 9. Construction heuristics"><div class="titlepage"><div><div><h2 class="title"><a id="constructionHeuristics"/>Chapter 9. Construction heuristics</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#constructionHeuristicsOverview">9.1. Overview</a></span></dt><dt><span class="section"><a href="#firstFit">9.2. First Fit</a></span></dt><dd><dl><dt><span class="section"><a href="#firstFitAlgorithm">9.2.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#firstFitConfiguration">9.2.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#firstFitDecreasing">9.3. First Fit Decreasing</a></span></dt><dd><dl><dt><span class="section"><a href="#firstFitDecreasingAlgorithm">9.3.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#firstFitDecreasingConfiguration">9.3.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#weakestFit">9.4. Weakest Fit</a></span></dt><dd><dl><dt><span class="section"><a href="#weakestFitAlgorithm">9.4.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#weakestFitConfiguration">9.4.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#weakestFitDecreasing">9.5. Weakest Fit Decreasing</a></span></dt><dd><dl><dt><span class="section"><a href="#weakestFitDecreasingAlgorithm">9.5.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#weakestFitDecreasingConfiguration">9.5.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#strongestFit">9.6. Strongest Fit</a></span></dt><dd><dl><dt><span class="section"><a href="#strongestFitAlgorithm">9.6.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#strongestFitConfiguration">9.6.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#strongestFitDecreasing">9.7. Strongest Fit Decreasing</a></span></dt><dd><dl><dt><span class="section"><a href="#strongestFitDecreasingAlgorithm">9.7.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#strongestFitDecreasingConfiguration">9.7.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#allocateEntityFromQueue">9.8. Allocate Entity From Queue</a></span></dt><dd><dl><dt><span class="section"><a href="#allocateEntityFromQueueAlgorithm">9.8.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#allocateEntityFromQueueConfiguration">9.8.2. Configuration</a></span></dt><dt><span class="section"><a href="#allocateEntityFromQueueMultipleVariables">9.8.3. Multiple variables</a></span></dt><dt><span class="section"><a href="#allocateEntityFromQueueMultipleEntityClasses">9.8.4. Multiple entity classes</a></span></dt><dt><span class="section"><a href="#constructionHeuristicsPickEarlyType">9.8.5. Pick early type</a></span></dt></dl></dd><dt><span class="section"><a href="#allocateToValueFromQueue">9.9. Allocate To Value From Queue</a></span></dt><dd><dl><dt><span class="section"><a href="#allocateToValueFromQueueAlgorithm">9.9.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#allocateToValueFromQueueConfiguration">9.9.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#cheapestInsertion">9.10. Cheapest Insertion</a></span></dt><dd><dl><dt><span class="section"><a href="#cheapestInsertionAlgorithm">9.10.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#cheapestInsertionConfiguration">9.10.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#regretInsertion">9.11. Regret Insertion</a></span></dt><dd><dl><dt><span class="section"><a href="#regretInsertionAlgorithm">9.11.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#regretInsertionConfiguration">9.11.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#allocateFromPool">9.12. Allocate From Pool</a></span></dt><dd><dl><dt><span class="section"><a href="#allocateFromPoolAlgorithm">9.12.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#allocateFromPoolConfiguration">9.12.2. Configuration</a></span></dt></dl></dd></dl></div><div class="section" title="9.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="constructionHeuristicsOverview"/>9.1. Overview</h2></div></div></div><p>A construction heuristic builds a pretty good initial solution in a finite length of time. Its solution isn't
    always feasible, but it finds it fast so metaheuristics can finish the job.</p><p>Construction heuristics terminate automatically, so there's usually no need to configure a
    <code class="literal">Termination</code> on the construction heuristic phase specifically.</p></div><div class="section" title="9.2. First Fit"><div class="titlepage"><div><div><h2 class="title"><a id="firstFit"/>9.2. First Fit</h2></div></div></div><div class="section" title="9.2.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="firstFitAlgorithm"/>9.2.1. Algorithm description</h3></div></div></div><p>The First Fit algorithm cycles through all the planning entities (in default order), initializing 1 planning
      entity at a time. It assigns the planning entity to the best available planning value, taking the already
      initialized planning entities into account. It terminates when all planning entities have been initialized. It
      never changes a planning entity after it has been assigned.</p><div class="mediaobject"><img src="images/Chapter-Construction_heuristics/firstFitNQueens04.png"/></div><p>Notice that it starts with putting <code class="literal">Queen</code> A into row 0 (and never moving it later), which
      makes it impossible to reach the optimal solution. Suffixing this construction heuristic with metaheuristics can
      remedy that.</p></div><div class="section" title="9.2.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="firstFitConfiguration"/>9.2.2. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;FIRST_FIT&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From
      Queue</a>.</p></div></div><div class="section" title="9.3. First Fit Decreasing"><div class="titlepage"><div><div><h2 class="title"><a id="firstFitDecreasing"/>9.3. First Fit Decreasing</h2></div></div></div><div class="section" title="9.3.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="firstFitDecreasingAlgorithm"/>9.3.1. Algorithm description</h3></div></div></div><p>Like First Fit, but assigns the more difficult planning entities first, because they are less likely to fit
      in the leftovers. So it sorts the planning entities on decreasing difficulty.</p><p>Requires the model to support <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty
      comparison</a>.</p><div class="mediaobject"><img src="images/Chapter-Construction_heuristics/firstFitDecreasingNQueens04.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>One would expect that this algorithm has better results than First Fit. That's usually the case, but not
        always.</p></div></div><div class="section" title="9.3.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="firstFitDecreasingConfiguration"/>9.3.2. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;FIRST_FIT_DECREASING&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From
      Queue</a>.</p></div></div><div class="section" title="9.4. Weakest Fit"><div class="titlepage"><div><div><h2 class="title"><a id="weakestFit"/>9.4. Weakest Fit</h2></div></div></div><div class="section" title="9.4.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="weakestFitAlgorithm"/>9.4.1. Algorithm description</h3></div></div></div><p>Like First Fit, but uses the weaker planning values first, because the strong planning values are more
      likely to be able to accommodate later planning entities. So it sorts the planning values on increasing
      strength.</p><p>Requires the model to support <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength
      comparison</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Do not presume that this algorithm has better results than First Fit. That's often not the case.</p></div></div><div class="section" title="9.4.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="weakestFitConfiguration"/>9.4.2. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;WEAKEST_FIT&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From
      Queue</a>.</p></div></div><div class="section" title="9.5. Weakest Fit Decreasing"><div class="titlepage"><div><div><h2 class="title"><a id="weakestFitDecreasing"/>9.5. Weakest Fit Decreasing</h2></div></div></div><div class="section" title="9.5.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="weakestFitDecreasingAlgorithm"/>9.5.1. Algorithm description</h3></div></div></div><p>Combines First Fit Decreasing and Weakest Fit. So it sorts the planning entities on decreasing difficulty
      and the planning values on increasing strength.</p><p>Requires the model to support <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty
      comparison</a> and <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Do not presume that this algorithm has better results than First Fit Decreasing. That's often not the
        case. However, it is usually better than Weakest Fit.</p></div></div><div class="section" title="9.5.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="weakestFitDecreasingConfiguration"/>9.5.2. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;WEAKEST_FIT_DECREASING&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From
      Queue</a>.</p></div></div><div class="section" title="9.6. Strongest Fit"><div class="titlepage"><div><div><h2 class="title"><a id="strongestFit"/>9.6. Strongest Fit</h2></div></div></div><div class="section" title="9.6.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="strongestFitAlgorithm"/>9.6.1. Algorithm description</h3></div></div></div><p>Like First Fit, but uses the strong planning values first, because the strong planning values are more
      likely to have a lower soft cost to use. So it sorts the planning values on decreasing strength.</p><p>Requires the model to support <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength
      comparison</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Do not presume that this algorithm has better results than First Fit or Weakest Fit. That's often not the
        case.</p></div></div><div class="section" title="9.6.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="strongestFitConfiguration"/>9.6.2. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;STRONGEST_FIT&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From
      Queue</a>.</p></div></div><div class="section" title="9.7. Strongest Fit Decreasing"><div class="titlepage"><div><div><h2 class="title"><a id="strongestFitDecreasing"/>9.7. Strongest Fit Decreasing</h2></div></div></div><div class="section" title="9.7.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="strongestFitDecreasingAlgorithm"/>9.7.1. Algorithm description</h3></div></div></div><p>Combines First Fit Decreasing and Strongest Fit. So it sorts the planning entities on decreasing difficulty
      and the planning values on decreasing strength.</p><p>Requires the model to support <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty
      comparison</a> and <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Do not presume that this algorithm has better results than First Fit Decreasing or Weakest Fit Decreasing.
        That's often not the case. However, it is usually better than Strongest Fit.</p></div></div><div class="section" title="9.7.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="strongestFitDecreasingConfiguration"/>9.7.2. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;STRONGEST_FIT_DECREASING&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From
      Queue</a>.</p></div></div><div class="section" title="9.8. Allocate Entity From Queue"><div class="titlepage"><div><div><h2 class="title"><a id="allocateEntityFromQueue"/>9.8. Allocate Entity From Queue</h2></div></div></div><div class="section" title="9.8.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="allocateEntityFromQueueAlgorithm"/>9.8.1. Algorithm description</h3></div></div></div><p>Allocate Entity From Queue is a versatile, generic form of <a class="link" href="#firstFit" title="9.2. First Fit">First Fit</a>, <a class="link" href="#firstFitDecreasing" title="9.3. First Fit Decreasing">First Fit Decreasing</a>, <a class="link" href="#weakestFit" title="9.4. Weakest Fit">Weakest Fit</a> and <a class="link" href="#weakestFitDecreasing" title="9.5. Weakest Fit Decreasing">Weakest Fit Decreasing</a>. It works like this:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Put all entities in a queue.</p></li><li class="listitem"><p>Assign the first entity (from that queue) to the best value.</p></li><li class="listitem"><p>Repeat until all entities are assigned.</p></li></ol></div></div><div class="section" title="9.8.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="allocateEntityFromQueueConfiguration"/>9.8.2. Configuration</h3></div></div></div><p>Simple configuration:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;ALLOCATE_ENTITY_FROM_QUEUE&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>Verbose simple configuration:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;ALLOCATE_ENTITY_FROM_QUEUE&lt;/constructionHeuristicType&gt;
    &lt;entitySorterManner&gt;DECREASING_DIFFICULTY_IF_AVAILABLE&lt;/entitySorterManner&gt;
    &lt;valueSorterManner&gt;INCREASING_STRENGTH_IF_AVAILABLE&lt;/valueSorterManner&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>The <code class="literal">entitySorterManner</code> options are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">DECREASING_DIFFICULTY</code>: Initialize the more difficult planning entities first. This
          usually increases pruning (and therefore improves scalability). Requires the model to support <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty comparison</a>.</p></li><li class="listitem"><p><code class="literal">DECREASING_DIFFICULTY_IF_AVAILABLE</code> (default): If the model supports <a class="link" href="#planningEntityDifficulty" title="4.3.3.2. Planning entity difficulty">planning entity difficulty comparison</a>, behave like
          <code class="literal">DECREASING_DIFFICULTY</code>, else like <code class="literal">NONE</code>.</p></li><li class="listitem"><p><code class="literal">NONE</code>: Initialize the planning entities in original order.</p></li></ul></div><p>The <code class="literal">valueSorterManner</code> options are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">INCREASING_STRENGTH</code>: Evaluate the planning values in increasing strength. Requires
          the model to support <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>.</p></li><li class="listitem"><p><code class="literal">INCREASING_STRENGTH_IF_AVAILABLE</code> (default): If the model supports <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>, behave like
          <code class="literal">INCREASING_STRENGTH</code>, else like <code class="literal">NONE</code>.</p></li><li class="listitem"><p><code class="literal">DECREASING_STRENGTH</code>: Evaluate the planning values in decreasing strength. Requires
          the model to support <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>.</p></li><li class="listitem"><p><code class="literal">DECREASING_STRENGTH_IF_AVAILABLE</code>: If the model supports <a class="link" href="#planningValueStrength" title="4.3.5.3. Planning value strength">planning value strength comparison</a>, behave like
          <code class="literal">DECREASING_STRENGTH</code>, else like <code class="literal">NONE</code>.</p></li><li class="listitem"><p><code class="literal">NONE</code>: Try the planning values in original order.</p></li></ul></div><p>Advanced detailed configuration. For example, a Weakest Fit Decreasing configuration for a single entity
      class with a single variable:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;queuedEntityPlacer&gt;
      &lt;entitySelector id="placerEntitySelector"&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
        &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
        &lt;sorterManner&gt;DECREASING_DIFFICULTY&lt;/sorterManner&gt;
      &lt;/entitySelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
        &lt;valueSelector&gt;
          &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
          &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
          &lt;sorterManner&gt;INCREASING_STRENGTH&lt;/sorterManner&gt;
        &lt;/valueSelector&gt;
      &lt;/changeMoveSelector&gt;
    &lt;/queuedEntityPlacer&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>Per step, the <code class="literal">QueuedEntityPlacer</code> selects 1 uninitialized entity from the
      <code class="literal">EntitySelector</code> and applies the winning <code class="literal">Move</code> (out of all the moves for that
      entity generated by the <code class="literal">MoveSelector</code>). The <a class="link" href="#mimicSelection" title="7.6.8. Mimic selection (record/replay)">mimic
      selection</a> ensures that the winning <code class="literal">Move</code> changes (only) the selected entity.</p><p>To customize the entity or value sorting, see <a class="link" href="#sortedSelection" title="7.6.5. Sorted selection">sorted selection</a>. Other
      <code class="literal">Selector</code> customization (such as <a class="link" href="#filteredSelection" title="7.6.4. Filtered selection">filtering</a> and <a class="link" href="#limitedSelection" title="7.6.7. Limited selection">limiting</a>) is supported too.</p></div><div class="section" title="9.8.3. Multiple variables"><div class="titlepage"><div><div><h3 class="title"><a id="allocateEntityFromQueueMultipleVariables"/>9.8.3. Multiple variables</h3></div></div></div><p>There are 2 ways to deal with multiple variables, depending on how their <code class="literal">ChangeMove</code>s are
      combined:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Cartesian product of the <code class="literal">ChangeMove</code>s (default): All variables of the selected entity
          are assigned together. Has far better results (especially for timetabling use cases).</p></li><li class="listitem"><p>Sequential <code class="literal">ChangeMove</code>s: One variable is assigned at a time. Scales much better,
          especially for 3 or more variables.</p></li></ul></div><p>For example, presume a course scheduling example with 200 rooms and 40 periods.</p><p>This First Fit configuration for a single entity class with 2 variables, using a <a class="link" href="#cartesianProductMoveSelector" title="7.3.2. cartesianProductMoveSelector">cartesian product</a> of their <code class="literal">ChangeMove</code>s, will
      select 8000 moves per entity:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;queuedEntityPlacer&gt;
      &lt;entitySelector id="placerEntitySelector"&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;/entitySelector&gt;
      &lt;cartesianProductMoveSelector&gt;
        &lt;changeMoveSelector&gt;
          &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
          &lt;valueSelector&gt;
            &lt;variableName&gt;room&lt;/variableName&gt;
          &lt;/valueSelector&gt;
        &lt;/changeMoveSelector&gt;
        &lt;changeMoveSelector&gt;
          &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
          &lt;valueSelector&gt;
            &lt;variableName&gt;period&lt;/variableName&gt;
          &lt;/valueSelector&gt;
        &lt;/changeMoveSelector&gt;
      &lt;/cartesianProductMoveSelector&gt;
    &lt;/queuedEntityPlacer&gt;
    ...
  &lt;/constructionHeuristic&gt;</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>With 3 variables of 1000 values each, a cartesian product selects 1000000000 values per entity, which will
        take far too long.</p></div><p>This First Fit configuration for a single entity class with 2 variables, using sequential
      <code class="literal">ChangeMove</code>s, will select 240 moves per entity:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;queuedEntityPlacer&gt;
      &lt;entitySelector id="placerEntitySelector"&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
      &lt;/entitySelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
        &lt;valueSelector&gt;
          &lt;variableName&gt;period&lt;/variableName&gt;
        &lt;/valueSelector&gt;
      &lt;/changeMoveSelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
        &lt;valueSelector&gt;
          &lt;variableName&gt;room&lt;/variableName&gt;
        &lt;/valueSelector&gt;
      &lt;/changeMoveSelector&gt;
    &lt;/queuedEntityPlacer&gt;
    ...
  &lt;/constructionHeuristic&gt;</code></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Especially for sequential <code class="literal">ChangeMove</code>s, the order of the variables is important. In the
        example above, it's better to select the period first (instead of the other way around), because there are more
        hard constraints that do not involve the room (for example: no teacher should teach 2 lectures at the same
        time). Let the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> guide you.</p></div><p>With 3 or more variables, it's possible to combine the cartesian product and sequential techniques:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;queuedEntityPlacer&gt;
      ...
      &lt;cartesianProductMoveSelector&gt;
        &lt;changeMoveSelector&gt;...&lt;/changeMoveSelector&gt;
        &lt;changeMoveSelector&gt;...&lt;/changeMoveSelector&gt;
      &lt;/cartesianProductMoveSelector&gt;
      &lt;changeMoveSelector&gt;...&lt;/changeMoveSelector&gt;
    &lt;/queuedEntityPlacer&gt;
    ...
  &lt;/constructionHeuristic&gt;</code></pre></div><div class="section" title="9.8.4. Multiple entity classes"><div class="titlepage"><div><div><h3 class="title"><a id="allocateEntityFromQueueMultipleEntityClasses"/>9.8.4. Multiple entity classes</h3></div></div></div><p>The easiest way to deal with multiple entity classes is to run a separate construction heuristic for each
      entity class:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;queuedEntityPlacer&gt;
      &lt;entitySelector id="placerEntitySelector"&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
        &lt;entityClass&gt;...DogEntity&lt;/entityClass&gt;
      &lt;/entitySelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
      &lt;/changeMoveSelector&gt;
    &lt;/queuedEntityPlacer&gt;
    ...
  &lt;/constructionHeuristic&gt;
  &lt;constructionHeuristic&gt;
    &lt;queuedEntityPlacer&gt;
      &lt;entitySelector id="placerEntitySelector"&gt;
        &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
        &lt;entityClass&gt;...CatEntity&lt;/entityClass&gt;
      &lt;/entitySelector&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector mimicSelectorRef="placerEntitySelector"/&gt;
      &lt;/changeMoveSelector&gt;
    &lt;/queuedEntityPlacer&gt;
    ...
  &lt;/constructionHeuristic&gt;</code></pre></div><div class="section" title="9.8.5. Pick early type"><div class="titlepage"><div><div><h3 class="title"><a id="constructionHeuristicsPickEarlyType"/>9.8.5. Pick early type</h3></div></div></div><p>There are several pick early types for Construction Heuristics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">NEVER</code>: Evaluate all the selected moves to initialize the variable(s). This is the
          default if the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is not
          <code class="literal">ONLY_DOWN</code>.</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    ...
    &lt;forager&gt;
      &lt;pickEarlyType&gt;NEVER&lt;/pickEarlyType&gt;
    &lt;/forager&gt;
  &lt;/constructionHeuristic&gt;</code></pre></li><li class="listitem"><p><code class="literal">FIRST_NON_DETERIORATING_SCORE</code>: Initialize the variable(s) with the first move that
          doesn't deteriorate the score, ignore the remaining selected moves. This is the default if the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is <code class="literal">ONLY_DOWN</code>.</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    ...
    &lt;forager&gt;
      &lt;pickEarlyType&gt;FIRST_NON_DETERIORATING_SCORE&lt;/pickEarlyType&gt;
    &lt;/forager&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If there are only negative constraints, but the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is strictly not <code class="literal">ONLY_DOWN</code>,
            it can sometimes make sense to apply FIRST_NON_DETERIORATING_SCORE. Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to decide if the score quality loss is worth the time gain.</p></div></li><li class="listitem"><p><code class="literal">FIRST_FEASIBLE_SCORE</code>: Initialize the variable(s) with the first move that has a
          feasible score.</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    ...
    &lt;forager&gt;
      &lt;pickEarlyType&gt;FIRST_FEASIBLE_SCORE&lt;/pickEarlyType&gt;
    &lt;/forager&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
          <code class="literal">ONLY_DOWN</code>, use <code class="literal">FIRST_FEASIBLE_SCORE_OR_NON_DETERIORATING_HARD</code> instead,
          because that's faster without any disadvantages.</p></li><li class="listitem"><p><code class="literal">FIRST_FEASIBLE_SCORE_OR_NON_DETERIORATING_HARD</code>: Initialize the variable(s) with the
          first move that doesn't deteriorate the feasibility of the score any further.</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    ...
    &lt;forager&gt;
      &lt;pickEarlyType&gt;FIRST_FEASIBLE_SCORE_OR_NON_DETERIORATING_HARD&lt;/pickEarlyType&gt;
    &lt;/forager&gt;
  &lt;/constructionHeuristic&gt;</code></pre></li></ul></div></div></div><div class="section" title="9.9. Allocate To Value From Queue"><div class="titlepage"><div><div><h2 class="title"><a id="allocateToValueFromQueue"/>9.9. Allocate To Value From Queue</h2></div></div></div><div class="section" title="9.9.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="allocateToValueFromQueueAlgorithm"/>9.9.1. Algorithm description</h3></div></div></div><p>Allocate To Value From Queue is a versatile, generic form of Nearest Neighbour. It works like this:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Put all values in a round-robin queue.</p></li><li class="listitem"><p>Assign the best entity to the first value (from that queue).</p></li><li class="listitem"><p>Repeat until all entities are assigned.</p></li></ol></div></div><div class="section" title="9.9.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="allocateToValueFromQueueConfiguration"/>9.9.2. Configuration</h3></div></div></div><p>Not yet implemented.</p></div></div><div class="section" title="9.10. Cheapest Insertion"><div class="titlepage"><div><div><h2 class="title"><a id="cheapestInsertion"/>9.10. Cheapest Insertion</h2></div></div></div><div class="section" title="9.10.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="cheapestInsertionAlgorithm"/>9.10.1. Algorithm description</h3></div></div></div><p>The Cheapest Insertion algorithm cycles through all the planning values for all the planning entities,
      initializing 1 planning entity at a time. It assigns a planning entity to the best available planning value (out
      of all the planning entities and values), taking the already initialized planning entities into account. It
      terminates when all planning entities have been initialized. It never changes a planning entity after it has been
      assigned.</p><div class="mediaobject"><img src="images/Chapter-Construction_heuristics/cheapestInsertionNQueens04.png"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Cheapest Insertion scales considerably worse than First Fit, etc.</p></div></div><div class="section" title="9.10.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="cheapestInsertionConfiguration"/>9.10.2. Configuration</h3></div></div></div><p>Simplest configuration of Cheapest Insertion:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;CHEAPEST_INSERTION&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>If the <a class="link" href="#initializingScoreTrend" title="5.3.5. InitializingScoreTrend">InitializingScoreTrend</a> is
        <code class="literal">ONLY_DOWN</code>, this algorithm is faster: for an entity, it picks the first move for which the
        score does not deteriorate the last step score, ignoring all subsequent moves.</p></div><p>For advanced configuration, see <a class="link" href="#allocateFromPool" title="9.12. Allocate From Pool">Allocate from pool</a>.</p></div></div><div class="section" title="9.11. Regret Insertion"><div class="titlepage"><div><div><h2 class="title"><a id="regretInsertion"/>9.11. Regret Insertion</h2></div></div></div><div class="section" title="9.11.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="regretInsertionAlgorithm"/>9.11.1. Algorithm description</h3></div></div></div><p>The Regret Insertion algorithm behaves like the Cheapest Insertion algorithm. It also cycles through all the
      planning values for all the planning entities, initializing 1 planning entity at a time. But instead of picking
      the entity-value combination with the best score, it picks the entity which has the largest score loss between its
      best and second best value assignment. It then assigns that entity to its best value, to avoid regretting not
      having done that.</p></div><div class="section" title="9.11.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="regretInsertionConfiguration"/>9.11.2. Configuration</h3></div></div></div><p>This algorithm has not been implemented yet.</p></div></div><div class="section" title="9.12. Allocate From Pool"><div class="titlepage"><div><div><h2 class="title"><a id="allocateFromPool"/>9.12. Allocate From Pool</h2></div></div></div><div class="section" title="9.12.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="allocateFromPoolAlgorithm"/>9.12.1. Algorithm description</h3></div></div></div><p>Allocate From Pool is a versatile, generic form of <a class="link" href="#cheapestInsertion" title="9.10. Cheapest Insertion">Cheapest
      Insertion</a> and <a class="link" href="#regretInsertion" title="9.11. Regret Insertion">Regret Insertion</a>. It works like this:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Put all entity-value combinations in a pool.</p></li><li class="listitem"><p>Assign the best entity to best value.</p></li><li class="listitem"><p>Repeat until all entities are assigned.</p></li></ol></div></div><div class="section" title="9.12.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="allocateFromPoolConfiguration"/>9.12.2. Configuration</h3></div></div></div><p>Simple configuration:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;ALLOCATE_FROM_POOL&lt;/constructionHeuristicType&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>Verbose simple configuration:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;constructionHeuristicType&gt;ALLOCATE_FROM_POOL&lt;/constructionHeuristicType&gt;
    &lt;entitySorterManner&gt;DECREASING_DIFFICULTY_IF_AVAILABLE&lt;/entitySorterManner&gt;
    &lt;valueSorterManner&gt;INCREASING_STRENGTH_IF_AVAILABLE&lt;/valueSorterManner&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>The <code class="literal">entitySorterManner</code> and <code class="literal">valueSorterManner</code> options are described in
      <a class="link" href="#allocateEntityFromQueue" title="9.8. Allocate Entity From Queue">Allocate Entity From Queue</a>.</p><p>Advanced detailed configuration. For example, a Cheapest Insertion configuration for a single entity class
      with a single variable:</p><pre><code class="language-xml">  &lt;constructionHeuristic&gt;
    &lt;pooledEntityPlacer&gt;
      &lt;changeMoveSelector&gt;
        &lt;entitySelector id="placerEntitySelector"&gt;
          &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
          &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
          &lt;sorterManner&gt;DECREASING_DIFFICULTY&lt;/sorterManner&gt;
        &lt;/entitySelector&gt;
        &lt;valueSelector&gt;
          &lt;cacheType&gt;PHASE&lt;/cacheType&gt;
          &lt;selectionOrder&gt;SORTED&lt;/selectionOrder&gt;
          &lt;sorterManner&gt;INCREASING_STRENGTH&lt;/sorterManner&gt;
        &lt;/valueSelector&gt;
      &lt;/changeMoveSelector&gt;
    &lt;/pooledEntityPlacer&gt;
  &lt;/constructionHeuristic&gt;</code></pre><p>Per step, the <code class="literal">PooledEntityPlacer</code> applies the winning <code class="literal">Move</code> (out of all
      the moves for that entity generated by the <code class="literal">MoveSelector</code>).</p><p>To customize the entity or value sorting, see <a class="link" href="#sortedSelection" title="7.6.5. Sorted selection">sorted selection</a>. Other
      <code class="literal">Selector</code> customization (such as <a class="link" href="#filteredSelection" title="7.6.4. Filtered selection">filtering</a> and <a class="link" href="#limitedSelection" title="7.6.7. Limited selection">limiting</a>) is supported too.</p></div></div></div><div class="chapter" title="Chapter 10. Local Search"><div class="titlepage"><div><div><h2 class="title"><a id="localSearch"/>Chapter 10. Local Search</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#localSearchOverview">10.1. Overview</a></span></dt><dt><span class="section"><a href="#localSearchConcepts">10.2. Local Search concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#localSearchStepByStep">10.2.1. Step by step</a></span></dt><dt><span class="section"><a href="#localSearchConceptsDecideTheNextStep">10.2.2. Decide the next step</a></span></dt><dt><span class="section"><a href="#localSearchAcceptor">10.2.3. Acceptor</a></span></dt><dt><span class="section"><a href="#localSearchForager">10.2.4. Forager</a></span></dt></dl></dd><dt><span class="section"><a href="#hillClimbing">10.3. Hill Climbing (Simple Local Search)</a></span></dt><dd><dl><dt><span class="section"><a href="#hillClimbingAlgorithm">10.3.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#hillClimbingStuckInLocalOptima">10.3.2. Stuck in local optima</a></span></dt><dt><span class="section"><a href="#hillClimbingConfigure">10.3.3. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#tabuSearch">10.4. Tabu Search</a></span></dt><dd><dl><dt><span class="section"><a href="#tabuSearchAlgorithm">10.4.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#tabuSearchConfiguration">10.4.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#simulatedAnnealing">10.5. Simulated Annealing</a></span></dt><dd><dl><dt><span class="section"><a href="#simulatedAnnealingAlgorithm">10.5.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#simulatedAnnealingConfiguration">10.5.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#lateAcceptance">10.6. Late Acceptance</a></span></dt><dd><dl><dt><span class="section"><a href="#lateAcceptanceAlgorithm">10.6.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#lateAcceptanceConfiguration">10.6.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#stepCountingHillClimbing">10.7. Step Counting Hill Climbing</a></span></dt><dd><dl><dt><span class="section"><a href="#stepCountingHillClimbingAlgorithm">10.7.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#stepCountingHillClimbingConfiguration">10.7.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#strategicOscillation">10.8. Strategic Oscillation</a></span></dt><dd><dl><dt><span class="section"><a href="#strategicOscillationAlgorithm">10.8.1. Algorithm description</a></span></dt><dt><span class="section"><a href="#strategicOscillationConfiguration">10.8.2. Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#customTerminationSelectorOrAcceptor">10.9. Using a custom Termination, MoveSelector, EntitySelector, ValueSelector or Acceptor</a></span></dt></dl></div><div class="section" title="10.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="localSearchOverview"/>10.1. Overview</h2></div></div></div><p>Local Search starts from an initial solution and evolves that single solution into a mostly better and better
    solution. It uses a single search path of solutions, not a search tree. At each solution in this path it evaluates a
    number of moves on the solution and applies the most suitable move to take the step to the next solution. It does
    that for a high number of iterations until it's terminated (usually because its time has run out).</p><p>Local Search acts a lot like a human planner: it uses a single search path and moves facts around to find a
    good feasible solution. Therefore it's pretty natural to implement.</p><p><span class="bold"><strong>Local Search usually needs to start from an initialized solution</strong></span>, therefore
    it's usually required to configure a construction heuristic solver phase before it.</p></div><div class="section" title="10.2. Local Search concepts"><div class="titlepage"><div><div><h2 class="title"><a id="localSearchConcepts"/>10.2. Local Search concepts</h2></div></div></div><div class="section" title="10.2.1. Step by step"><div class="titlepage"><div><div><h3 class="title"><a id="localSearchStepByStep"/>10.2.1. Step by step</h3></div></div></div><p>A step is the winning <code class="literal">Move</code>. Local Search tries a number of moves on the current solution
      and picks the best accepted move as the step:</p><div class="figure"><a id="d0e9954"/><p class="title"><strong>Figure 10.1. Decide the next step at step 0 (4 queens example)</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/decideNextStepNQueens04.png" alt="Decide the next step at step 0 (4 queens example)"/></div></div></div><br class="figure-break"/><p>Because the move <span class="emphasis"><em>B0 to B3</em></span> has the highest score (<code class="literal">-3</code>), it is picked
      as the next step. If multiple moves have the same highest score, one is picked randomly, in this case <span class="emphasis"><em>B0
      to B3</em></span>. Note that <span class="emphasis"><em>C0 to C3</em></span> (not shown) could also have been picked because it also
      has the score <code class="literal">-3</code>.</p><p>The step is applied on the solution. From that new solution, Local Search tries every move again, to decide
      the next step after that. It continually does this in a loop, and we get something like this:</p><div class="figure"><a id="d0e9979"/><p class="title"><strong>Figure 10.2. All steps (4 queens example)</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Local_search/allStepsNQueens04.png" alt="All steps (4 queens example)"/></div></div></div><br class="figure-break"/><p>Notice that Local Search doesn't use a search tree, but a search path. The search path is highlighted by the
      green arrows. At each step it tries all selected moves, but unless it's the step, it doesn't investigate that
      solution further. This is one of the reasons why Local Search is very scalable.</p><p>As you can see, Local Search solves the 4 queens problem by starting with the starting solution and make the
      following steps sequentially:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="emphasis"><em>B0 to B3</em></span></p></li><li class="listitem"><p><span class="emphasis"><em>D0 to B2</em></span></p></li><li class="listitem"><p><span class="emphasis"><em>A0 to B1</em></span></p></li></ol></div><p>If we turn on <code class="literal">debug</code> logging for the category <code class="literal">org.optaplanner</code>, then
      those steps are shown into the log:</p><pre><code class="no-highlight">INFO  Solving started: time spent (0), best score (-6), random (JDK with seed 0).
DEBUG     LS step (0), time spent (20), score (-3), new best score (-3), accepted/selected move count (12/12), picked move (col1@row0 =&gt; row3).
DEBUG     LS step (1), time spent (31), score (-1), new best score (-1), accepted/selected move count (12/12), picked move (col0@row0 =&gt; row1).
DEBUG     LS step (2), time spent (40), score (0), new best score (0), accepted/selected move count (12/12), picked move (col3@row0 =&gt; row2).
INFO  Local Search phase (0) ended: step total (3), time spent (41), best score (0).
INFO  Solving ended: time spent (41), best score (0), average calculate count per second (1780).</code></pre><p>Notice that the logging uses the <code class="literal">toString()</code> method of the <code class="literal">Move</code>
      implementation: <code class="literal">col1@row0 =&gt; row3</code>.</p><p>A naive Local Search configuration solves the 4 queens problem in 3 steps, by evaluating only 37 possible
      solutions (3 steps with 12 moves each + 1 starting solution), which is only fraction of all 256 possible
      solutions. It solves 16 queens in 31 steps, by evaluating only 7441 out of 18446744073709551616 possible
      solutions. By doing a good Construction Heuristics first, it's even a lot more efficient.</p></div><div class="section" title="10.2.2. Decide the next step"><div class="titlepage"><div><div><h3 class="title"><a id="localSearchConceptsDecideTheNextStep"/>10.2.2. Decide the next step</h3></div></div></div><p>Local Search decides the next step with the aid of 3 configurable components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A <code class="literal">MoveSelector</code> which selects the possible moves of the current solution. See the
          chapter <a class="link" href="#moveAndNeighborhoodSelection" title="Chapter 7. Move and neighborhood selection">move and neighborhood selection</a>.</p></li><li class="listitem"><p>An <code class="literal">Acceptor</code> which filters out unacceptable moves.</p></li><li class="listitem"><p>A <code class="literal">Forager</code> which gathers accepted moves and picks the next step from them.</p></li></ul></div><p>The solver phase configuration looks like this:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    &lt;unionMoveSelector&gt;
      ...
    &lt;/unionMoveSelector&gt;
    &lt;acceptor&gt;
      ...
    &lt;/acceptor&gt;
    &lt;forager&gt;
      ...
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><p>In the example below, the <code class="literal">MoveSelector</code> generated the moves shown with the blue lines, the
      <code class="literal">Acceptor</code> accepted all of them and the <code class="literal">Forager</code> picked the move <span class="emphasis"><em>B0
      to B3</em></span>.</p><div class="mediaobject"><img src="images/Chapter-Local_search/decideNextStepNQueens04.png"/></div><p><a class="link" href="#logging" title="4.4.4. Logging level: What is the Solver doing?">Turn on <code class="literal">trace</code> logging</a> to show the decision making in the
      log:</p><pre><code class="no-highlight">INFO  Solver started: time spent (0), score (-6), new best score (-6), random (JDK with seed 0).
TRACE         Move index (0) not doable, ignoring move (col0@row0 =&gt; row0).
TRACE         Move index (1), score (-4), accepted (true), move (col0@row0 =&gt; row1).
TRACE         Move index (2), score (-4), accepted (true), move (col0@row0 =&gt; row2).
TRACE         Move index (3), score (-4), accepted (true), move (col0@row0 =&gt; row3).
...
TRACE         Move index (6), score (-3), accepted (true), move (col1@row0 =&gt; row3).
...
TRACE         Move index (9), score (-3), accepted (true), move (col2@row0 =&gt; row3).
...
TRACE         Move index (12), score (-4), accepted (true), move (col3@row0 =&gt; row3).
DEBUG     LS step (0), time spent (6), score (-3), new best score (-3), accepted/selected move count (12/12), picked move (col1@row0 =&gt; row3).
...</code></pre><p>Because the last solution can degrade (for example in Tabu Search), the <code class="literal">Solver</code> remembers
      the best solution it has encountered through the entire search path. Each time the current solution is better than
      the last best solution, the current solution is <a class="link" href="#cloningASolution" title="4.3.7.6. Cloning a Solution">cloned</a> and referenced as
      the new best solution.</p><div class="mediaobject"><img src="images/Chapter-Local_search/localSearchScoreOverTime.png"/></div></div><div class="section" title="10.2.3. Acceptor"><div class="titlepage"><div><div><h3 class="title"><a id="localSearchAcceptor"/>10.2.3. Acceptor</h3></div></div></div><p>An <code class="literal">Acceptor</code> is used (together with a <code class="literal">Forager</code>) to active Tabu Search,
      Simulated Annealing, Late Acceptance, ... For each move it checks whether it is accepted or not.</p><p>By changing a few lines of configuration, you can easily switch from Tabu Search to Simulated Annealing or
      Late Acceptance and back.</p><p>You can implement your own <code class="literal">Acceptor</code>, but the build-in acceptors should suffice for most
      needs. You can also combine multiple acceptors.</p></div><div class="section" title="10.2.4. Forager"><div class="titlepage"><div><div><h3 class="title"><a id="localSearchForager"/>10.2.4. Forager</h3></div></div></div><p>A <code class="literal">Forager</code> gathers all accepted moves and picks the move which is the next step. Normally
      it picks the accepted move with the highest score. If several accepted moves have the highest score, one is picked
      randomly.</p><p>You can implement your own <code class="literal">Forager</code>, but the build-in forager should suffice for most
      needs.</p><div class="section" title="10.2.4.1. Accepted count limit"><div class="titlepage"><div><div><h4 class="title"><a id="acceptedCountLimit"/>10.2.4.1. Accepted count limit</h4></div></div></div><p>When there are many possible moves, it becomes inefficient to evaluate all of them at every step. To
        evaluate only a random subset of all the moves, use:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>An <code class="literal">acceptedCountLimit</code> integer, which specifies how many accepted moves should be
            evaluated during each step. By default, all accepted moves are evaluated at every step.</p><pre><code class="language-xml">  &lt;forager&gt;
    &lt;acceptedCountLimit&gt;1000&lt;/acceptedCountLimit&gt;
  &lt;/forager&gt;</code></pre></li></ul></div><p>Unlike the n queens problem, real world problems require the use of <code class="literal">acceptedCountLimit</code>.
        Start from an <code class="literal">acceptedCountLimit</code> that takes a step in less then 2 seconds. <a class="link" href="#logging" title="4.4.4. Logging level: What is the Solver doing?">Turn on INFO logging</a> to see the step times. Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to tweak the value.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>With a low <code class="literal">acceptedCountLimit</code> it is recommended to avoid using
          <code class="literal">selectionOrder</code> SHUFFLED because the shuffling generates a random number for every element
          in the selector, taking up a lot of time, but only a few elements are actually selected.</p></div></div><div class="section" title="10.2.4.2. Pick early type"><div class="titlepage"><div><div><h4 class="title"><a id="localSearchPickEarlyType"/>10.2.4.2. Pick early type</h4></div></div></div><p>A forager can pick a move early during a step, ignoring subsequent selected moves. There are 3 pick early
        types for Local Search:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">NEVER</code>: A move is never picked early: all accepted moves are evaluated that the
            selection allows. This is the default.</p><pre><code class="language-xml">    &lt;forager&gt;
      &lt;pickEarlyType&gt;NEVER&lt;/pickEarlyType&gt;
    &lt;/forager&gt;</code></pre></li><li class="listitem"><p><code class="literal">FIRST_BEST_SCORE_IMPROVING</code>: Pick the first accepted move that improves the best
            score. If none improve the best score, it behaves exactly like the pickEarlyType NEVER.</p><pre><code class="language-xml">    &lt;forager&gt;
      &lt;pickEarlyType&gt;FIRST_BEST_SCORE_IMPROVING&lt;/pickEarlyType&gt;
    &lt;/forager&gt;</code></pre></li><li class="listitem"><p><code class="literal">FIRST_LAST_STEP_SCORE_IMPROVING</code>: Pick the first accepted move that improves the
            last step score. If none improve the last step score, it behaves exactly like the pickEarlyType
            NEVER.</p><pre><code class="language-xml">    &lt;forager&gt;
      &lt;pickEarlyType&gt;FIRST_LAST_STEP_SCORE_IMPROVING&lt;/pickEarlyType&gt;
    &lt;/forager&gt;</code></pre></li></ul></div></div></div></div><div class="section" title="10.3. Hill Climbing (Simple Local Search)"><div class="titlepage"><div><div><h2 class="title"><a id="hillClimbing"/>10.3. Hill Climbing (Simple Local Search)</h2></div></div></div><div class="section" title="10.3.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="hillClimbingAlgorithm"/>10.3.1. Algorithm description</h3></div></div></div><p>Hill Climbing tries all selected moves and then takes the best move, which is the move which leads to the
      solution with the highest score. That best move is called the step move. From that new solution, it again tries
      all selected moves and takes the best move and continues like that iteratively. If multiple selected moves tie for
      the best move, one of them is randomly chosen as the best move.</p><div class="mediaobject"><img src="images/Chapter-Local_search/hillClimbingNQueens04.png"/></div><p>Notice that once a queen has moved, it can be moved again later. This is a good thing, because in an
      NP-complete problem it's impossible to predict what will be the optimal final value for a planning
      variable.</p></div><div class="section" title="10.3.2. Stuck in local optima"><div class="titlepage"><div><div><h3 class="title"><a id="hillClimbingStuckInLocalOptima"/>10.3.2. Stuck in local optima</h3></div></div></div><p>Hill Climbing always takes improving moves. This may seem like a good thing, but it's not: <span class="bold"><strong>Hill Climbing can easily get stuck in a local optimum.</strong></span> This happens when it reaches a
      solution for which all the moves deteriorate the score. Even if it picks one of those moves, the next step might
      go back to the original solution and which case chasing its own tail:</p><div class="mediaobject"><img src="images/Chapter-Local_search/hillClimbingGetsStuckInLocalOptimaNQueens04.png"/></div><p>Improvements upon Hill Climbing (such as Tabu Search, Simulated Annealing and Late Acceptance) address the
      problem of being stuck in local optima. Therefore, it's recommend to never use Hill Climbing, unless you're
      absolutely sure there are no local optima in your planning problem.</p></div><div class="section" title="10.3.3. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="hillClimbingConfigure"/>10.3.3. Configuration</h3></div></div></div><p>Configure this solver phase:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;acceptorType&gt;HILL_CLIMBING&lt;/acceptorType&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1000&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre></div></div><div class="section" title="10.4. Tabu Search"><div class="titlepage"><div><div><h2 class="title"><a id="tabuSearch"/>10.4. Tabu Search</h2></div></div></div><div class="section" title="10.4.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="tabuSearchAlgorithm"/>10.4.1. Algorithm description</h3></div></div></div><p>Tabu Search works like Hill Climbing, but it maintains a tabu list to avoid getting stuck in local optima.
      The tabu list holds recently used objects that are <span class="emphasis"><em>taboo</em></span> to use for now. Moves that involve
      an object in the tabu list, are not accepted. The tabu list objects can be anything related to the move, such as
      the planning entity, planning value, move, solution, ... Here's an example with entity tabu for 4 queens, so the
      queens are put in the tabu list:</p><div class="mediaobject"><img src="images/Chapter-Local_search/entityTabuSearch.png"/></div><p>Scientific paper: <span class="emphasis"><em>Tabu Search - Part 1 and Part 2</em></span> by Fred Glover (1989 - 1990)</p></div><div class="section" title="10.4.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="tabuSearchConfiguration"/>10.4.2. Configuration</h3></div></div></div><p>When Tabu Search takes steps it creates one or more tabu's. For a number of steps, it does not accept a move
      if that move breaks tabu. That number of steps is the tabu size.</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;entityTabuSize&gt;7&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1000&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>A Tabu Search acceptor should be combined with a high <code class="literal">acceptedCountLimit</code>, such as
        <code class="literal">1000</code>.</p></div><p>Planner implements several tabu types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>Planning entity tabu</em></span> (recommended) makes the planning entities of recent steps
          tabu. For example, for N queens it makes the recently moved queens tabu. It's recommended to start with this
          tabu type.</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;entityTabuSize&gt;7&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;</code></pre><p>To avoid hard coding the tabu size, configure a tabu ratio, relative to the number of entities, for
          example 2%:</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;entityTabuRatio&gt;0.02&lt;/entityTabuRatio&gt;
    &lt;/acceptor&gt;</code></pre></li><li class="listitem"><p><span class="emphasis"><em>Planning value tabu</em></span> makes the planning values of recent steps tabu. For example,
          for N queens it makes the recently moved to rows tabu.</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;valueTabuSize&gt;7&lt;/valueTabuSize&gt;
    &lt;/acceptor&gt;</code></pre><p>To avoid hard coding the tabu size, configure a tabu ratio, relative to the number of values, for
          example 2%:</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;valueTabuRatio&gt;0.02&lt;/valueTabuRatio&gt;
    &lt;/acceptor&gt;</code></pre></li><li class="listitem"><p><span class="emphasis"><em>Move tabu</em></span> makes recent steps tabu. It does not accept a move equal to one of those
          steps.</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;moveTabuSize&gt;7&lt;/moveTabuSize&gt;
    &lt;/acceptor&gt;</code></pre></li><li class="listitem"><p><span class="emphasis"><em>Undo move tabu </em></span>makes the undo move of recent steps tabu.</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;undoMoveTabuSize&gt;7&lt;/undoMoveTabuSize&gt;
    &lt;/acceptor&gt;</code></pre></li><li class="listitem"><p><span class="emphasis"><em>Solution tabu</em></span> makes recently visited solutions tabu. It does not accept a move that
          leads to one of those solutions. It requires that the <code class="literal">Solution</code> implements
          <code class="literal">equals()</code> and <code class="literal">hashCode()</code> properly. If you can spare the memory, don't be
          cheap on the tabu size.</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;solutionTabuSize&gt;1000&lt;/solutionTabuSize&gt;
    &lt;/acceptor&gt;</code></pre><p>For non-trivial cases, solution tabu is usually useless because the <a class="link" href="#searchSpaceSize" title="6.1. Search space size in the real world">search space size</a> makes it statistically highly unlikely to reach the same
          solution twice. Therefore its use is not recommended, except for small datasets.</p></li></ul></div><p>Sometimes it's useful to combine tabu types:</p><pre><code class="language-xml">    &lt;acceptor&gt;
      &lt;entityTabuSize&gt;7&lt;/entityTabuSize&gt;
      &lt;valueTabuSize&gt;3&lt;/valueTabuSize&gt;
    &lt;/acceptor&gt;</code></pre><p>If the tabu size is too small, the solver can still get stuck in a local optimum. On the other hand, if the
      tabu size is too large, the solver can get stuck by bouncing of the walls. Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to fine tweak your configuration.</p></div></div><div class="section" title="10.5. Simulated Annealing"><div class="titlepage"><div><div><h2 class="title"><a id="simulatedAnnealing"/>10.5. Simulated Annealing</h2></div></div></div><div class="section" title="10.5.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="simulatedAnnealingAlgorithm"/>10.5.1. Algorithm description</h3></div></div></div><p>Simulated Annealing evaluates only a few moves per step, so it steps quickly. In the classic implementation,
      the first accepted move is the winning step. A move is accepted if it doesn't decrease the score or - in case it
      does decrease the score - it passes a random check. The chance that a decreasing move passes the random check
      decreases relative to the size of the score decrement and the time the phase has been running (which is
      represented as the temperature).</p><div class="mediaobject"><img src="images/Chapter-Local_search/simulatedAnnealing.png"/></div></div><div class="section" title="10.5.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="simulatedAnnealingConfiguration"/>10.5.2. Configuration</h3></div></div></div><p>Simulated Annealing does not always pick the move with the highest score, neither does it evaluate many
      moves per step. At least at first. Instead, it gives non improving moves also a chance to be picked, depending on
      its score and the time gradient of the <code class="literal">Termination</code>. In the end, it gradually turns into Hill
      Climbing, only accepting improving moves.</p><p>Start with a <code class="literal">simulatedAnnealingStartingTemperature</code> set to the maximum score delta a
      single move can cause. Use the <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> to tweak the value.</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;simulatedAnnealingStartingTemperature&gt;2hard/100soft&lt;/simulatedAnnealingStartingTemperature&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><p>Simulated Annealing should use a low <code class="literal">acceptedCountLimit</code>. The classic algorithm uses an
      <code class="literal">acceptedCountLimit</code> of <code class="literal">1</code>, but often <code class="literal">4</code> performs
      better.</p><p>You can even combine it with a tabu acceptor at the same time. That gives Simulated Annealing salted with a
      bit of Tabu. Use a lower tabu size than in a pure Tabu Search configuration.</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;simulatedAnnealingStartingTemperature&gt;2hard/100soft&lt;/simulatedAnnealingStartingTemperature&gt;
      &lt;entityTabuSize&gt;5&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre></div></div><div class="section" title="10.6. Late Acceptance"><div class="titlepage"><div><div><h2 class="title"><a id="lateAcceptance"/>10.6. Late Acceptance</h2></div></div></div><div class="section" title="10.6.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="lateAcceptanceAlgorithm"/>10.6.1. Algorithm description</h3></div></div></div><p>Late Acceptance (also known as Late Acceptance Hill Climbing) also evaluates only a few moves per step. A
      move is accepted if it does not decrease the score, or if it leads to a score that is at least the late score
      (which is the winning score of a fixed number of steps ago).</p><div class="mediaobject"><img src="images/Chapter-Local_search/lateAcceptance.png"/></div><p>Scientific paper: <a class="link" href="http://www.cs.stir.ac.uk/research/publications/techreps/pdf/TR192.pdf"><span class="emphasis"><em>The Late Acceptance
      Hill-Climbing Heuristic</em></span> by Edmund K. Burke, Yuri Bykov (2012)</a></p></div><div class="section" title="10.6.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="lateAcceptanceConfiguration"/>10.6.2. Configuration</h3></div></div></div><p>Late Acceptance accepts any move that has a score which is higher than the best score of a number of steps
      ago. That number of steps is the <code class="literal">lateAcceptanceSize</code>.</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;lateAcceptanceSize&gt;400&lt;/lateAcceptanceSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><p>You can even combine it with a tabu acceptor at the same time. That gives Late Acceptance salted with a bit
      of Tabu. Use a lower tabu size than in a pure Tabu Search configuration.</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;lateAcceptanceSize&gt;400&lt;/lateAcceptanceSize&gt;
      &lt;entityTabuSize&gt;5&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><p>Late Acceptance should use a low <code class="literal">acceptedCountLimit</code>.</p></div></div><div class="section" title="10.7. Step Counting Hill Climbing"><div class="titlepage"><div><div><h2 class="title"><a id="stepCountingHillClimbing"/>10.7. Step Counting Hill Climbing</h2></div></div></div><div class="section" title="10.7.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="stepCountingHillClimbingAlgorithm"/>10.7.1. Algorithm description</h3></div></div></div><p>Step Counting Hill Climbing also evaluates only a few moves per step. For a number of steps, it keeps the
      step score as a threshold. A move is accepted if it does not decrease the score, or if it leads to a score that is
      at least the threshold score.</p><p>Scientific paper: <a class="link" href="https://www.cs.nott.ac.uk/~yxb/SCHC/SCHC_mista2013_79.pdf"><span class="emphasis"><em>An
      initial study of a novel Step Counting Hill Climbing heuristic applied to timetabling problems</em></span> by Yuri
      Bykov, Sanja Petrovic (2013)</a></p></div><div class="section" title="10.7.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="stepCountingHillClimbingConfiguration"/>10.7.2. Configuration</h3></div></div></div><p>Step Counting Hill Climbing accepts any move that has a score which is higher than a threshold score. Every
      number of steps (specified by <code class="literal">stepCountingHillClimbingSize</code>), the threshold score is set to the
      step score.</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;stepCountingHillClimbingSize&gt;400&lt;/stepCountingHillClimbingSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1&lt;/acceptedCountLimit&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><p>You can even combine it with a tabu acceptor at the same time, similar as shown in <a class="link" href="#lateAcceptance" title="10.6. Late Acceptance">the Late Acceptance section</a>.</p><p>Step Counting Hill Climbing should use a low <code class="literal">acceptedCountLimit</code>.</p></div></div><div class="section" title="10.8. Strategic Oscillation"><div class="titlepage"><div><div><h2 class="title"><a id="strategicOscillation"/>10.8. Strategic Oscillation</h2></div></div></div><div class="section" title="10.8.1. Algorithm description"><div class="titlepage"><div><div><h3 class="title"><a id="strategicOscillationAlgorithm"/>10.8.1. Algorithm description</h3></div></div></div><p>Strategic Oscillation is an add-on, which works especially well with <a class="link" href="#tabuSearch" title="10.4. Tabu Search">Tabu
      Search</a>. Instead of picking the accepted move with the highest score, it employs a different mechanism: If
      there's an improving move, it picks it. If there's no improving move however, it prefers moves which improve a
      softer score level, over moves which break a harder score level less.</p></div><div class="section" title="10.8.2. Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="strategicOscillationConfiguration"/>10.8.2. Configuration</h3></div></div></div><p>Configure a <code class="literal">finalistPodiumType</code>, for example in a Tabu Search configuration:</p><pre><code class="language-xml">  &lt;localSearch&gt;
    ...
    &lt;acceptor&gt;
      &lt;entityTabuSize&gt;7&lt;/entityTabuSize&gt;
    &lt;/acceptor&gt;
    &lt;forager&gt;
      &lt;acceptedCountLimit&gt;1000&lt;/acceptedCountLimit&gt;
      &lt;finalistPodiumType&gt;STRATEGIC_OSCILLATION&lt;/finalistPodiumType&gt;
    &lt;/forager&gt;
  &lt;/localSearch&gt;</code></pre><p>The following <code class="literal">finalistPodiumType</code>s are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">HIGHEST_SCORE</code> (default): Pick the accepted move with the highest score.</p></li><li class="listitem"><p><code class="literal">STRATEGIC_OSCILLATION</code>: Alias for the default strategic oscillation variant.</p></li><li class="listitem"><p><code class="literal">STRATEGIC_OSCILLATION_BY_LEVEL</code>: If there is an accepted improving move, pick it. If
          no such move exists, prefer an accepted move which improves a softer score level over one that doesn't (even
          if it has a better harder score level). A move is improving if it's better than the last completed step
          score.</p></li><li class="listitem"><p><code class="literal">STRATEGIC_OSCILLATION_BY_LEVEL_ON_BEST_SCORE</code>: Like
          <code class="literal">STRATEGIC_OSCILLATION_BY_LEVEL</code>, but define improving as better than the best score (instead
          of the last completed step score).</p></li></ul></div></div></div><div class="section" title="10.9. Using a custom Termination, MoveSelector, EntitySelector, ValueSelector or Acceptor"><div class="titlepage"><div><div><h2 class="title"><a id="customTerminationSelectorOrAcceptor"/>10.9. Using a custom Termination, MoveSelector, EntitySelector, ValueSelector or Acceptor</h2></div></div></div><p>You can plug in a custom <code class="literal">Termination</code>, <code class="literal">MoveSelector</code>,
    <code class="literal">EntitySelector</code>, <code class="literal">ValueSelector</code> or <code class="literal">Acceptor</code> by extending the
    abstract class and also the related <code class="literal">*Config</code> class.</p><p>For example, to use a custom <code class="literal">MoveSelector</code>, extend the
    <code class="literal">AbstractMoveSelector</code> class, extend the <code class="literal">MoveSelectorConfig</code> class and configure
    it in the solver configuration.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>It's not possible to inject a <code class="literal">Termination</code>, ... instance directly (to avoid extending a
      <code class="literal">Config</code> class too) because:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A <code class="literal">SolverFactory</code> can build multiple <code class="literal">Solver</code> instances, which each
          require a distinct <code class="literal">Termination</code>, ... instance.</p></li><li class="listitem"><p>A solver configuration needs to be serializable to and from XML. This makes benchmarking with
          <code class="literal">PlannerBenchmark</code> particularly easy because you can configure different
          <code class="literal">Solver</code> variants in XML.</p></li><li class="listitem"><p>A <code class="literal">Config</code> class is often easier and clearer to configure. For example:
          <code class="literal">TerminationConfig</code> translates <code class="literal">minutesSpentLimit</code> and
          <code class="literal">secondsSpentLimit</code> into <code class="literal">timeMillisSpentLimit</code>.</p></li></ul></div></div><p>If you build a better implementation that's not domain specific, consider contributing it back as a pull
    request on github: we'll optimize it and take it along in future refactorings.</p></div></div><div class="chapter" title="Chapter 11. Evolutionary Algorithms"><div class="titlepage"><div><div><h2 class="title"><a id="evolutionaryAlgorithms"/>Chapter 11. Evolutionary Algorithms</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#evolutionaryAlgorithmsOverview">11.1. Overview</a></span></dt><dt><span class="section"><a href="#evolutionaryStrategies">11.2. Evolutionary Strategies</a></span></dt><dt><span class="section"><a href="#geneticAlgorithms">11.3. Genetic Algorithms</a></span></dt></dl></div><div class="section" title="11.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="evolutionaryAlgorithmsOverview"/>11.1. Overview</h2></div></div></div><p>Evolutionary Algorithms work on a population of solutions and evolve that population.</p></div><div class="section" title="11.2. Evolutionary Strategies"><div class="titlepage"><div><div><h2 class="title"><a id="evolutionaryStrategies"/>11.2. Evolutionary Strategies</h2></div></div></div><p>This algorithm has not been implemented yet.</p></div><div class="section" title="11.3. Genetic Algorithms"><div class="titlepage"><div><div><h2 class="title"><a id="geneticAlgorithms"/>11.3. Genetic Algorithms</h2></div></div></div><p>This algorithm has not been implemented yet.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A good Genetic Algorithms prototype in Planner was written some time ago, but it wasn't practical to merge and
      support it at the time. The results of Genetic Algorithms were consistently and seriously inferior to all the <a class="link" href="#localSearch" title="Chapter 10. Local Search">Local Search</a> variants (except Hill Climbing) on all use cases tried. Nevertheless, a
      future version of Planner will add support for Genetic Algorithms, so you can easily benchmark Genetic
      Algorithms on your use case too.</p></div></div></div><div class="chapter" title="Chapter 12. Hyperheuristics"><div class="titlepage"><div><div><h2 class="title"><a id="hyperheuristics"/>Chapter 12. Hyperheuristics</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#hyperheuristicsOverview">12.1. Overview</a></span></dt></dl></div><div class="section" title="12.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="hyperheuristicsOverview"/>12.1. Overview</h2></div></div></div><p>A hyperheuristic automates the decision which heuristic(s) to use on a specific data set.</p><p>A future version of Planner will have native support for hyperheuristics. Meanwhile, it's pretty easy to
    implement it yourself: Based on the size or difficulty of a data set (which is a criterion), use a different Solver
    configuration (or adjust the default configuration using the Solver configuration API). The <a class="link" href="#benchmarker" title="Chapter 14. Benchmarking and tweaking">Benchmarker</a> can help to identify such criteria.</p></div></div><div class="chapter" title="Chapter 13. Partitioned search"><div class="titlepage"><div><div><h2 class="title"><a id="partitionedSearch"/>Chapter 13. Partitioned search</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#partitionedSearchOverview">13.1. Overview</a></span></dt></dl></div><div class="section" title="13.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="partitionedSearchOverview"/>13.1. Overview</h2></div></div></div><p>For very big datasets, it is sometimes worthwhile to partition the datasets into smaller pieces.</p><p>However, <span class="bold"><strong>partitioning leads to suboptimal results</strong></span>, even if the pieces are
    solved optimally:</p><div class="mediaobject"><img src="images/Chapter-Partitioned_search/mapReduceIsTerribleForTsp.png"/></div><p>A future version of Planner will have native support for several forms of partitioning. Meanwhile, you can
    implement it yourself as shown in the image above. Use an <code class="literal">Solver</code> to solve each piece.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Not all use cases can be partitioned. It only works on use cases for which the planning entities and value
      ranges can be divided into n pieces, such that none of the constraints cross piece boundaries.</p></div></div></div><div class="chapter" title="Chapter 14. Benchmarking and tweaking"><div class="titlepage"><div><div><h2 class="title"><a id="benchmarker"/>Chapter 14. Benchmarking and tweaking</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#findTheBestSolverConfiguration">14.1. Find the best <code class="literal">Solver</code> configuration</a></span></dt><dt><span class="section"><a href="#benchmarkConfiguration">14.2. Benchmark configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarker.addDependency">14.2.1. Add dependency on <code class="literal">optaplanner-benchmark</code></a></span></dt><dt><span class="section"><a href="#buildAndRunAPlannerBenchmark">14.2.2. Build and run a <code class="literal">PlannerBenchmark</code></a></span></dt><dt><span class="section"><a href="#solutionFileIO">14.2.3. SolutionFileIO: input and output of Solution files</a></span></dt><dt><span class="section"><a href="#warmingUpTheHotSpotCompiler">14.2.4. Warming up the HotSpot compiler</a></span></dt><dt><span class="section"><a href="#benchmarkBlueprint">14.2.5. Benchmark blueprint: a predefined configuration</a></span></dt><dt><span class="section"><a href="#writeTheOutputSolutionOfBenchmarkRuns">14.2.6. Write the output solution of benchmark runs</a></span></dt><dt><span class="section"><a href="#benchmarkLogging">14.2.7. Benchmark logging</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReport">14.3. Benchmark report</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarkHtmlReport">14.3.1. HTML report</a></span></dt><dt><span class="section"><a href="#rankingTheSolvers">14.3.2. Ranking the <code class="literal">Solver</code>s</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReportSummaryStatistics">14.4. Summary statistics</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarkReportBestScoreSummary">14.4.1. Best score summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestScoreScalabilitySummary">14.4.2. Best score scalability summary (graph)</a></span></dt><dt><span class="section"><a href="#benchmarkReportWinningScoreDifferenceSummary">14.4.3. Winning score difference summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportWorstScoreDifferencePercentageSummary">14.4.4. Worst score difference percentage (ROI) summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportAverageCalculationCountSummary">14.4.5. Average calculation count summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportTimeSpentSummary">14.4.6. Time spent summary (graph and table)</a></span></dt><dt><span class="section"><a href="#benchmarkReportTimeSpentScalabilitySummary">14.4.7. Time spent scalability summary (graph)</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestScorePerTimeSpentSummary">14.4.8. Best score per time spent summary (graph)</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReportStatisticPerDataset">14.5. Statistic per dataset (graph and CSV)</a></span></dt><dd><dl><dt><span class="section"><a href="#enableAProblemStatistic">14.5.1. Enable a problem statistic</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestScoreOverTimeStatistic">14.5.2. Best score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportStepScoreOverTimeStatistic">14.5.3. Step score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportCalculateCountPerSecondStatistic">14.5.4. Calculate count per second statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportBestSolutionMutationOverTimeStatistic">14.5.5. Best solution mutation over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportMoveCountPerStepStatistic">14.5.6. Move count per step statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportMemoryUseStatistic">14.5.7. Memory use statistic (graph and CSV)</a></span></dt></dl></dd><dt><span class="section"><a href="#benchmarkReportStatisticPerSingleBenchmark">14.6. Statistic per single benchmark (graph and CSV)</a></span></dt><dd><dl><dt><span class="section"><a href="#enableASingleStatistic">14.6.1. Enable a single statistic</a></span></dt><dt><span class="section"><a href="#benchmarkReportConstraintMatchTotalBestScoreOverTimeStatistic">14.6.2. Constraint match total best score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportConstraintMatchTotalStepScoreOverTimeStatistic">14.6.3. Constraint match total step score over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportPickedMoveTypeBestScoreDiffOverTimeStatistic">14.6.4. Picked move type best score diff over time statistic (graph and CSV)</a></span></dt><dt><span class="section"><a href="#benchmarkReportPickedMoveTypeStepScoreDiffOverTimeStatistic">14.6.5. Picked move type step score diff over time statistic (graph and CSV)</a></span></dt></dl></dd><dt><span class="section"><a href="#advancedBenchmarking">14.7. Advanced benchmarking</a></span></dt><dd><dl><dt><span class="section"><a href="#benchmarkingPerformanceTricks">14.7.1. Benchmarking performance tricks</a></span></dt><dt><span class="section"><a href="#templateBasedBenchmarking">14.7.2. Template based benchmarking and matrix benchmarking</a></span></dt><dt><span class="section"><a href="#benchmarkReportAggregation">14.7.3. Benchmark report aggregation</a></span></dt></dl></dd></dl></div><div class="section" title="14.1. Find the best Solver configuration"><div class="titlepage"><div><div><h2 class="title"><a id="findTheBestSolverConfiguration"/>14.1. Find the best <code class="literal">Solver</code> configuration</h2></div></div></div><p>Planner supports several optimization algorithms, so you're probably wondering which is the best one? Although
    some optimization algorithms generally perform better than others, it really depends on your problem domain. Most
    solver phases have parameters which can be tweaked. Those parameters can influence the results a lot, even though
    most solver phases work pretty well out-of-the-box.</p><p>Luckily, Planner includes a benchmarker, which allows you to play out different solver phases with different
    settings against each other in development, so you can use the best configuration for your planning problem in
    production.</p><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/benchmarkOverview.png"/></div></div><div class="section" title="14.2. Benchmark configuration"><div class="titlepage"><div><div><h2 class="title"><a id="benchmarkConfiguration"/>14.2. Benchmark configuration</h2></div></div></div><div class="section" title="14.2.1. Add dependency on optaplanner-benchmark"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarker.addDependency"/>14.2.1. Add dependency on <code class="literal">optaplanner-benchmark</code></h3></div></div></div><p>The benchmarker is in a separate artifact called <code class="literal">optaplanner-benchmark</code>.</p><p>If you use Maven, add a dependency in your <code class="filename">pom.xml</code> file:</p><pre><code class="language-xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.optaplanner&lt;/groupId&gt;
      &lt;artifactId&gt;optaplanner-benchmark&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre><p>This is similar for Gradle, Ivy and Buildr. The version must be exactly the same as the
      <code class="literal">optaplanner-core</code> version used (which is automatically the case if you import
      <code class="literal">optaplanner-bom</code>).</p><p>If you use ANT, you've probably already copied the required jars from the download zip's
      <code class="filename">binaries</code> directory.</p></div><div class="section" title="14.2.2. Build and run a PlannerBenchmark"><div class="titlepage"><div><div><h3 class="title"><a id="buildAndRunAPlannerBenchmark"/>14.2.2. Build and run a <code class="literal">PlannerBenchmark</code></h3></div></div></div><p>Build a <code class="literal">PlannerBenchmark</code> instance with a <code class="literal">PlannerBenchmarkFactory</code>.
      Configure it with a benchmark configuration XML file, provided as a classpath resource:</p><pre><code class="language-java">        PlannerBenchmarkFactory plannerBenchmarkFactory = PlannerBenchmarkFactory.createFromXmlResource(
                "org/optaplanner/examples/nqueens/benchmark/nqueensBenchmarkConfig.xml");
        PlannerBenchmark plannerBenchmark = benchmarkFactory.buildPlannerBenchmark();
        plannerBenchmark.benchmark();</code></pre><p>A benchmark configuration file looks like this:</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;plannerBenchmark&gt;
  &lt;benchmarkDirectory&gt;local/data/nqueens&lt;/benchmarkDirectory&gt;

  &lt;inheritedSolverBenchmark&gt;
    &lt;problemBenchmarks&gt;
      ...
      &lt;inputSolutionFile&gt;data/nqueens/unsolved/32queens.xml&lt;/inputSolutionFile&gt;
      &lt;inputSolutionFile&gt;data/nqueens/unsolved/64queens.xml&lt;/inputSolutionFile&gt;
    &lt;/problemBenchmarks&gt;
    &lt;solver&gt;
      ...&lt;!-- Common solver configuration --&gt;
    &lt;/solver&gt;
  &lt;/inheritedSolverBenchmark&gt;

  &lt;solverBenchmark&gt;
    &lt;name&gt;Tabu Search&lt;/name&gt;
    &lt;solver&gt;
      ...&lt;!-- Tabu Search specific solver configuration --&gt;
    &lt;/solver&gt;
  &lt;/solverBenchmark&gt;
  &lt;solverBenchmark&gt;
    &lt;name&gt;Simulated Annealing&lt;/name&gt;
    &lt;solver&gt;
      ...&lt;!-- Simulated Annealing specific solver configuration --&gt;
    &lt;/solver&gt;
  &lt;/solverBenchmark&gt;
  &lt;solverBenchmark&gt;
    &lt;name&gt;Late Acceptance&lt;/name&gt;
    &lt;solver&gt;
      ...&lt;!-- Late Acceptance specific solver configuration --&gt;
    &lt;/solver&gt;
  &lt;/solverBenchmark&gt;
&lt;/plannerBenchmark&gt;</code></pre><p>This <code class="literal">PlannerBenchmark</code> will try 3 configurations (Tabu Search, Simulated Annealing and
      Late Acceptance) on 2 data sets (32queens and 64queens), so it will run 6 solvers.</p><p>Every <code class="literal">&lt;solverBenchmark&gt;</code> element contains a solver configuration and one or more
      <code class="literal">&lt;inputSolutionFile&gt;</code> elements. It will run the solver configuration on each of those
      unsolved solution files. The element <code class="literal">name</code> is optional, because it is generated if absent. The
      <code class="literal">inputSolutionFile</code> is read by a <a class="link" href="#solutionFileIO" title="14.2.3. SolutionFileIO: input and output of Solution files">SolutionFileIO</a> (relative
      to the working directory).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Use a forward slash (<code class="literal">/</code>) as the file separator (for example in the element
        <code class="literal">&lt;inputSolutionFile&gt;</code>). That will work on any platform (including Windows).</p><p>Do not use backslash (<code class="literal">\</code>) as the file separator: that breaks portability because it does
        not work on Linux and Mac.</p></div><p>To lower verbosity, the common parts of multiple <code class="literal">&lt;solverBenchmark&gt;</code> elements are
      extracted to the <code class="literal">&lt;inheritedSolverBenchmark&gt;</code> element. Every property can still be
      overwritten per <code class="literal">&lt;solverBenchmark&gt;</code> element. Note that inherited solver phases such as
      <code class="literal">&lt;constructionHeuristic&gt;</code> or <code class="literal">&lt;localSearch&gt;</code> are not overwritten but
      instead are added to the tail of the solver phases list.</p><p>The benchmark report will be written in the directory specified the
      <code class="literal">&lt;benchmarkDirectory&gt;</code> element (relative to the working directory).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>It's recommended that the <code class="literal">benchmarkDirectory</code> is a directory ignored for source control
        and not cleaned by your build system. This way the generated files are not bloating your source control and they
        aren't lost when doing a build. Usually that directory is called <code class="literal">local</code>.</p></div><p>If an <code class="literal">Exception</code> or <code class="literal">Error</code> occurs in a single benchmark, the entire
      Benchmarker will not fail-fast (unlike everything else in Planner). Instead, the Benchmarker will continue to run
      all other benchmarks, write the benchmark report and then fail (if there is at least 1 failing single benchmark).
      The failing benchmarks will be clearly marked as such in the benchmark report.</p></div><div class="section" title="14.2.3. SolutionFileIO: input and output of Solution files"><div class="titlepage"><div><div><h3 class="title"><a id="solutionFileIO"/>14.2.3. SolutionFileIO: input and output of Solution files</h3></div></div></div><div class="section" title="14.2.3.1. SolutionFileIO interface"><div class="titlepage"><div><div><h4 class="title"><a id="solutionFileIOInterface"/>14.2.3.1. <code class="literal">SolutionFileIO</code> interface</h4></div></div></div><p>The benchmarker needs to be able to read the input files to load a <code class="literal">Solution</code>. Also, it
        might need to write the best <code class="literal">Solution</code> of each benchmark to an output file. For that it uses a
        class that implements the <code class="literal">SolutionFileIO</code> interface:</p><pre><code class="language-java">public interface SolutionFileIO {

    String getInputFileExtension();

    String getOutputFileExtension();

    Solution read(File inputSolutionFile);

    void write(Solution solution, File outputSolutionFile);

}</code></pre></div><div class="section" title="14.2.3.2. XStreamSolutionFileIO: the default SolutionFileIO"><div class="titlepage"><div><div><h4 class="title"><a id="xStreamSolutionFileIO"/>14.2.3.2. <code class="literal">XStreamSolutionFileIO</code>: the default <code class="literal">SolutionFileIO</code></h4></div></div></div><p>By default, a benchmarker uses a <code class="literal">XStreamSolutionFileIO</code> instance to read and write
        solutions.</p><p>It's required to tell the benchmarker about your <code class="literal">Solution</code> class which is annotated with
        XStream annotations:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      &lt;xStreamAnnotatedClass&gt;org.optaplanner.examples.nqueens.domain.NQueens&lt;/xStreamAnnotatedClass&gt;
      &lt;inputSolutionFile&gt;data/nqueens/unsolved/32queens.xml&lt;/inputSolutionFile&gt;
      ...
    &lt;/problemBenchmarks&gt;</code></pre><p>Those input files need to have been written with a <code class="literal">XStreamSolutionFileIO</code> instance, not
        just any <code class="literal">XStream</code> instance, because the <code class="literal">XStreamSolutionFileIO</code> uses a
        customized <code class="literal">XStream</code> instance.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>XStream (and XML in general) is a very verbose format. Reading or writing very large datasets in this
          format can cause an <code class="literal">OutOfMemoryError</code> and performance degradation.</p></div></div><div class="section" title="14.2.3.3. Custom SolutionFileIO"><div class="titlepage"><div><div><h4 class="title"><a id="customSolutionFileIO"/>14.2.3.3. Custom <code class="literal">SolutionFileIO</code></h4></div></div></div><p>Alternatively, implement your own <code class="literal">SolutionFileIO</code> implementation and configure it with
        the <code class="literal">solutionFileIOClass</code> element:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      &lt;solutionFileIOClass&gt;org.optaplanner.examples.machinereassignment.persistence.MachineReassignmentFileIO&lt;/solutionFileIOClass&gt;
      &lt;inputSolutionFile&gt;data/machinereassignment/import/model_a1_1.txt&lt;/inputSolutionFile&gt;
      ...
    &lt;/problemBenchmarks&gt;</code></pre><p>It's recommended that output files can be read as input files, which also implies that
        <code class="literal">getInputFileExtension()</code> and <code class="literal">getOutputFileExtension()</code> return the same
        value.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>A <code class="literal">SolutionFileIO</code> implementation must be thread-safe.</p></div></div><div class="section" title="14.2.3.4. Reading an input solution from a database (or other repository)"><div class="titlepage"><div><div><h4 class="title"><a id="readingAnInputSolutionFromADatabase"/>14.2.3.4. Reading an input solution from a database (or other repository)</h4></div></div></div><p>The benchmark configuration currently expects an <code class="literal">&lt;inputSolutionFile&gt;</code> element for
        each dataset. There are 2 ways to deal with this if your dataset is in a database or another type of
        repository:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Extract the datasets from the database and serialize them to a local file (for example as XML with
            <code class="literal">XStreamSolutionFileIO</code>). Then use those files an
            <code class="literal">&lt;inputSolutionFile&gt;</code> elements.</p></li><li class="listitem"><p>For each dataset, create a txt file that holds the unique id of the dataset. Write <a class="link" href="#customSolutionFileIO" title="14.2.3.3. Custom SolutionFileIO">a custom <code class="literal">SolutionFileIO</code></a> that reads that identifier,
            connects to the database and extract the problem identified by that id. Configure those txt files as
            <code class="literal">&lt;inputSolutionFile&gt;</code> elements.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Local files are always faster and don't require a network connection.</p></div></div></div><div class="section" title="14.2.4. Warming up the HotSpot compiler"><div class="titlepage"><div><div><h3 class="title"><a id="warmingUpTheHotSpotCompiler"/>14.2.4. Warming up the HotSpot compiler</h3></div></div></div><p><span class="bold"><strong>Without a warm up, the results of the first (or first few) benchmarks are not
      reliable</strong></span>, because they will have lost CPU time on HotSpot JIT compilation (and possibly DRL compilation
      too).</p><p>The avoid that distortion, the benchmarker can run some of the benchmarks for a specified amount of time,
      before running the real benchmarks. Generally, a warm up of 30 seconds suffices:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  ...
  &lt;warmUpSecondsSpentLimit&gt;30&lt;/warmUpSecondsSpentLimit&gt;
  ...
&lt;/plannerBenchmark&gt;</code></pre></div><div class="section" title="14.2.5. Benchmark blueprint: a predefined configuration"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkBlueprint"/>14.2.5. Benchmark blueprint: a predefined configuration</h3></div></div></div><p>To quickly configure and run a benchmark for typical solver configs, use a
      <code class="literal">solverBenchmarkBluePrint</code> instead of <code class="literal">solverBenchmark</code>s:</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;plannerBenchmark&gt;
  &lt;benchmarkDirectory&gt;local/data/nqueens&lt;/benchmarkDirectory&gt;
  &lt;warmUpSecondsSpentLimit&gt;30&lt;/warmUpSecondsSpentLimit&gt;

  &lt;inheritedSolverBenchmark&gt;
    &lt;problemBenchmarks&gt;
      &lt;xStreamAnnotatedClass&gt;org.optaplanner.examples.nqueens.domain.NQueens&lt;/xStreamAnnotatedClass&gt;
      &lt;inputSolutionFile&gt;data/nqueens/unsolved/32queens.xml&lt;/inputSolutionFile&gt;
      &lt;inputSolutionFile&gt;data/nqueens/unsolved/64queens.xml&lt;/inputSolutionFile&gt;
      &lt;problemStatisticType&gt;BEST_SCORE&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;
    &lt;solver&gt;
      &lt;solutionClass&gt;org.optaplanner.examples.nqueens.domain.NQueens&lt;/solutionClass&gt;
      &lt;entityClass&gt;org.optaplanner.examples.nqueens.domain.Queen&lt;/entityClass&gt;
      &lt;scoreDirectorFactory&gt;
        &lt;scoreDefinitionType&gt;SIMPLE&lt;/scoreDefinitionType&gt;
        &lt;scoreDrl&gt;org/optaplanner/examples/nqueens/solver/nQueensScoreRules.drl&lt;/scoreDrl&gt;
        &lt;initializingScoreTrend&gt;ONLY_DOWN&lt;/initializingScoreTrend&gt;
      &lt;/scoreDirectorFactory&gt;
    &lt;/solver&gt;
  &lt;/inheritedSolverBenchmark&gt;

  &lt;solverBenchmarkBluePrint&gt;
    &lt;solverBenchmarkBluePrintType&gt;ALL_CONSTRUCTION_HEURISTIC_TYPES&lt;/solverBenchmarkBluePrintType&gt;
  &lt;/solverBenchmarkBluePrint&gt;
&lt;/plannerBenchmark&gt;</code></pre><p>The following <code class="literal">SolverBenchmarkBluePrintType</code>s are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">ALL_CONSTRUCTION_HEURISTIC_TYPES</code>: Run all Construction Heuristic types (First Fit,
          First Fit Decreasing, Cheapest Insertion, ...).</p></li></ul></div></div><div class="section" title="14.2.6. Write the output solution of benchmark runs"><div class="titlepage"><div><div><h3 class="title"><a id="writeTheOutputSolutionOfBenchmarkRuns"/>14.2.6. Write the output solution of benchmark runs</h3></div></div></div><p>The best solution of each benchmark run can be written in the <code class="literal">benchmarkDirectory</code>. By
      default, this is disabled, because the files are rarely used and considered bloat. Also, on large datasets,
      writing the best solution of each single benchmark can take quite some time and memory (causing an
      <code class="literal">OutOfMemoryError</code>), especially in a verbose format like XStream.</p><p>To write those solutions in the <code class="literal">benchmarkDirectory</code>, enable
      <code class="literal">writeOutputSolutionEnabled</code>:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;writeOutputSolutionEnabled&gt;true&lt;/writeOutputSolutionEnabled&gt;
      ...
    &lt;/problemBenchmarks&gt;</code></pre></div><div class="section" title="14.2.7. Benchmark logging"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkLogging"/>14.2.7. Benchmark logging</h3></div></div></div><p>Benchmark logging is configured like <a class="link" href="#logging" title="4.4.4. Logging level: What is the Solver doing?">the <code class="literal">Solver</code>
      logging</a>.</p><p>To separate the log messages of each single benchmark run into a separate file, use the <a class="link" href="http://logback.qos.ch/manual/mdc.html">MDC</a> with key <code class="literal">singleBenchmark.name</code> in
      a sifting appender. For example with Logback in <code class="literal">logback.xml</code>:</p><pre><code class="language-xml">  &lt;appender name="fileAppender" class="ch.qos.logback.classic.sift.SiftingAppender"&gt;
    &lt;discriminator&gt;
      &lt;key&gt;singleBenchmark.name&lt;/key&gt;
      &lt;defaultValue&gt;app&lt;/defaultValue&gt;
    &lt;/discriminator&gt;
    &lt;sift&gt;
      &lt;appender name="fileAppender.${singleBenchmark.name}" class="...FileAppender"&gt;
        &lt;file&gt;local/log/optaplannerBenchmark-${singleBenchmark.name}.log&lt;/file&gt;
        ...
      &lt;/appender&gt;
    &lt;/sift&gt;
  &lt;/appender&gt;</code></pre></div></div><div class="section" title="14.3. Benchmark report"><div class="titlepage"><div><div><h2 class="title"><a id="benchmarkReport"/>14.3. Benchmark report</h2></div></div></div><div class="section" title="14.3.1. HTML report"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkHtmlReport"/>14.3.1. HTML report</h3></div></div></div><p>After running a benchmark, an HTML report will be written in the <code class="literal">benchmarkDirectory</code> with
      the <code class="filename">index.html</code> filename. Open it in your browser. It has a nice overview of your benchmark
      including:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Summary statistics: graphs and tables</p></li><li class="listitem"><p>Problem statistics per <code class="literal">inputSolutionFile</code>: graphs and CSV</p></li><li class="listitem"><p>Each solver configuration (ranked): Handy to copy and paste</p></li><li class="listitem"><p>Benchmark information: settings, hardware, ...</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Graphs are generated by the excellent <a class="link" href="http://www.jfree.org/jfreechart/">JFreeChart</a> library.</p></div><p>The HTML report will use your default locale to format numbers. If you share the benchmark report with
      people from another country, consider overwriting the <code class="literal">locale</code> accordingly:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  ...
  &lt;benchmarkReport&gt;
    &lt;locale&gt;en_US&lt;/locale&gt;
  &lt;/benchmarkReport&gt;
  ...
&lt;/plannerBenchmark&gt;</code></pre></div><div class="section" title="14.3.2. Ranking the Solvers"><div class="titlepage"><div><div><h3 class="title"><a id="rankingTheSolvers"/>14.3.2. Ranking the <code class="literal">Solver</code>s</h3></div></div></div><p>The benchmark report automatically ranks the solvers. The <code class="literal">Solver</code> with rank
      <code class="literal">0</code> is called the favorite <code class="literal">Solver</code>: it performs best overall, but it might not
      be the best on every problem. It's recommended to use that favorite <code class="literal">Solver</code> in
      production.</p><p>However, there are different ways of ranking the solvers. Configure it like this:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  ...
  &lt;benchmarkReport&gt;
    &lt;solverRankingType&gt;TOTAL_SCORE&lt;/solverRankingType&gt;
  &lt;/benchmarkReport&gt;
  ...
&lt;/plannerBenchmark&gt;</code></pre><p>The following <code class="literal">solverRankingType</code>s are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">TOTAL_SCORE</code> (default): Maximize the overall score, so minimize the overall cost if
          all solutions would be executed.</p></li><li class="listitem"><p><code class="literal">WORST_SCORE</code>: Minimize the worst case scenario.</p></li><li class="listitem"><p><code class="literal">TOTAL_RANKING</code>: Maximize the overall ranking. Use this if your datasets differ greatly
          in size or difficulty, producing a difference in <code class="literal">Score</code> magnitude.</p></li></ul></div><p>You can also use a custom ranking, by implementing a <code class="literal">Comparator</code>:</p><pre><code class="language-xml">  &lt;benchmarkReport&gt;
    &lt;solverRankingComparatorClass&gt;...TotalScoreSolverRankingComparator&lt;/solverRankingComparatorClass&gt;
  &lt;/benchmarkReport&gt;</code></pre><p>Or by implementing a weight factory:</p><pre><code class="language-xml">  &lt;benchmarkReport&gt;
    &lt;solverRankingWeightFactoryClass&gt;...TotalRankSolverRankingWeightFactory&lt;/solverRankingWeightFactoryClass&gt;
  &lt;/benchmarkReport&gt;</code></pre></div></div><div class="section" title="14.4. Summary statistics"><div class="titlepage"><div><div><h2 class="title"><a id="benchmarkReportSummaryStatistics"/>14.4. Summary statistics</h2></div></div></div><div class="section" title="14.4.1. Best score summary (graph and table)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportBestScoreSummary"/>14.4.1. Best score summary (graph and table)</h3></div></div></div><p>Shows the best score per <code class="literal">inputSolutionFile</code> for each solver configuration.</p><p>Useful for visualizing the best solver configuration.</p><div class="figure"><a id="d0e11097"/><p class="title"><strong>Figure 14.1. Best score summary statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/summaryStatistic.png" alt="Best score summary statistic"/></div></div></div><br class="figure-break"/></div><div class="section" title="14.4.2. Best score scalability summary (graph)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportBestScoreScalabilitySummary"/>14.4.2. Best score scalability summary (graph)</h3></div></div></div><p>Shows the best score per problem scale for each solver configuration.</p><p>Useful for visualizing the scalability of each solver configuration.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The problem scale will report <code class="literal">0</code> if any <code class="literal">@ValueRangeProvider</code> method
        signature returns ValueRange (instead of <code class="literal">CountableValueRange</code> or
        <code class="literal">Collection</code>).</p></div></div><div class="section" title="14.4.3. Winning score difference summary (graph and table)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportWinningScoreDifferenceSummary"/>14.4.3. Winning score difference summary (graph and table)</h3></div></div></div><p>Shows the winning score difference per <code class="literal">inputSolutionFile</code> for each solver configuration.
      The winning score difference is the score difference with the score of the winning solver configuration for that
      particular <code class="literal">inputSolutionFile</code>.</p><p>Useful for zooming in on the results of the best score summary.</p></div><div class="section" title="14.4.4. Worst score difference percentage (ROI) summary (graph and table)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportWorstScoreDifferencePercentageSummary"/>14.4.4. Worst score difference percentage (ROI) summary (graph and table)</h3></div></div></div><p>Shows the return on investment (ROI) per <code class="literal">inputSolutionFile</code> for each solver configuration
      if you'd upgrade from the worst solver configuration for that particular
      <code class="literal">inputSolutionFile</code>.</p><p>Useful for visualizing the return on investment (ROI) to decision makers.</p></div><div class="section" title="14.4.5. Average calculation count summary (graph and table)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportAverageCalculationCountSummary"/>14.4.5. Average calculation count summary (graph and table)</h3></div></div></div><p>Shows the score calculation speed: the average calculation count per second per problem scale for each
      solver configuration.</p><p>Useful for comparing different score calculators and/or score rule implementations (presuming that the
      solver configurations do not differ otherwise). Also useful to measure the scalability cost of an extra
      constraint.</p></div><div class="section" title="14.4.6. Time spent summary (graph and table)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportTimeSpentSummary"/>14.4.6. Time spent summary (graph and table)</h3></div></div></div><p>Shows the time spent per <code class="literal">inputSolutionFile</code> for each solver configuration. This is
      pointless if it's benchmarking against a fixed time limit.</p><p>Useful for visualizing the performance of construction heuristics (presuming that no other solver phases are
      configured).</p></div><div class="section" title="14.4.7. Time spent scalability summary (graph)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportTimeSpentScalabilitySummary"/>14.4.7. Time spent scalability summary (graph)</h3></div></div></div><p>Shows the time spent per problem scale for each solver configuration. This is pointless if it's benchmarking
      against a fixed time limit.</p><p>Useful for extrapolating the scalability of construction heuristics (presuming that no other solver phases
      are configured).</p></div><div class="section" title="14.4.8. Best score per time spent summary (graph)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportBestScorePerTimeSpentSummary"/>14.4.8. Best score per time spent summary (graph)</h3></div></div></div><p>Shows the best score per time spent for each solver configuration. This is pointless if it's benchmarking
      against a fixed time limit.</p><p>Useful for visualizing trade-off between the best score versus the time spent for construction heuristics
      (presuming that no other solver phases are configured).</p></div></div><div class="section" title="14.5. Statistic per dataset (graph and CSV)"><div class="titlepage"><div><div><h2 class="title"><a id="benchmarkReportStatisticPerDataset"/>14.5. Statistic per dataset (graph and CSV)</h2></div></div></div><div class="section" title="14.5.1. Enable a problem statistic"><div class="titlepage"><div><div><h3 class="title"><a id="enableAProblemStatistic"/>14.5.1. Enable a problem statistic</h3></div></div></div><p>The benchmarker supports outputting problem statistics as graphs and CSV (comma separated values) files to
      the <code class="literal">benchmarkDirectory</code>. To configure one, add a <code class="literal">problemStatisticType</code>
      line:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  &lt;benchmarkDirectory&gt;local/data/nqueens/solved&lt;/benchmarkDirectory&gt;
  &lt;inheritedSolverBenchmark&gt;
    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;BEST_SCORE&lt;/problemStatisticType&gt;
      &lt;problemStatisticType&gt;CALCULATE_COUNT_PER_SECOND&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;
    ...
  &lt;/inheritedSolverBenchmark&gt;
  ...
&lt;/plannerBenchmark&gt;</code></pre><p>Multiple <code class="literal">problemStatisticType</code> elements are allowed.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>These statistic per dataset can slow down the solver noticeably, which affects the benchmark results.
        That's why they are optional and not enabled by default.</p><p>The non-optional summary statistics cannot slow down the solver noticeably.</p></div><p>The following types are supported:</p></div><div class="section" title="14.5.2. Best score over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportBestScoreOverTimeStatistic"/>14.5.2. Best score over time statistic (graph and CSV)</h3></div></div></div><p>To see how the best score evolves over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;BEST_SCORE&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11217"/><p class="title"><strong>Figure 14.2. Best score over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/bestScoreStatistic.png" alt="Best score over time statistic"/></div></div></div><br class="figure-break"/><p><span class="bold"><strong>The best score over time statistic is very useful to detect abnormalities, such as a
      potential <a class="link" href="#scoreTrap" title="5.4.8. Score trap">score trap</a>.</strong></span></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>A time gradient based algorithm (such as Simulated Annealing) will have a different statistic if it's run
        with a different time limit configuration. That's because this Simulated Annealing implementation automatically
        determines its velocity based on the amount of time that can be spent. On the other hand, for the Tabu Search
        and Late Annealing, what you see is what you'd get.</p></div></div><div class="section" title="14.5.3. Step score over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportStepScoreOverTimeStatistic"/>14.5.3. Step score over time statistic (graph and CSV)</h3></div></div></div><p>To see how the step score evolves over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;STEP_SCORE&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11239"/><p class="title"><strong>Figure 14.3. Step score over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/stepScoreStatistic.png" alt="Step score over time statistic"/></div></div></div><br class="figure-break"/><p>Compare the step score statistic with the best score statistic (especially on parts for which the best score
      flatlines). If it hits a local optima, the solver should take deteriorating steps to escape it. But it shouldn't
      deteriorate too much either.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The step score statistic has been seen to slow down the solver noticeably due to GC stress, especially for
        fast stepping algorithms (such as Simulated Annealing and Late Acceptance).</p></div></div><div class="section" title="14.5.4. Calculate count per second statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportCalculateCountPerSecondStatistic"/>14.5.4. Calculate count per second statistic (graph and CSV)</h3></div></div></div><p>To see how fast the scores are calculated, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;CALCULATE_COUNT_PER_SECOND&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11257"/><p class="title"><strong>Figure 14.4. Calculate count per second statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/calculateCountPerSecondStatistic.png" alt="Calculate count per second statistic"/></div></div></div><br class="figure-break"/><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The initial high calculate count is typical during solution initialization: it's far easier to calculate
        the score of a solution if only a handful planning entities have been initialized, than when all the planning
        entities are initialized.</p><p>After those few seconds of initialization, the calculate count is relatively stable, apart from an
        occasional stop-the-world garbage collector disruption.</p></div></div><div class="section" title="14.5.5. Best solution mutation over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportBestSolutionMutationOverTimeStatistic"/>14.5.5. Best solution mutation over time statistic (graph and CSV)</h3></div></div></div><p>To see how much each new best solution differs from the <span class="emphasis"><em>previous best solution</em></span>, by
      counting the number of planning variables which have a different value (not including the variables that have
      changed multiple times but still end up with the same value), add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;BEST_SOLUTION_MUTATION&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11278"/><p class="title"><strong>Figure 14.5. Best solution mutation over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/bestSolutionMutationStatistic.png" alt="Best solution mutation over time statistic"/></div></div></div><br class="figure-break"/><p>Use Tabu Search - an algorithm that behaves like a human - to get an estimation on how difficult it would be
      for a human to improve the previous best solution to that new best solution.</p></div><div class="section" title="14.5.6. Move count per step statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportMoveCountPerStepStatistic"/>14.5.6. Move count per step statistic (graph and CSV)</h3></div></div></div><p>To see how the selected and accepted move count per step evolves over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;MOVE_COUNT_PER_STEP&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11293"/><p class="title"><strong>Figure 14.6. Move count per step statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/moveCountPerStepStatistic.png" alt="Move count per step statistic"/></div></div></div><br class="figure-break"/><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>This statistic has been seen to slow down the solver noticeably due to GC stress, especially for fast
        stepping algorithms (such as Simulated Annealing and Late Acceptance).</p></div></div><div class="section" title="14.5.7. Memory use statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportMemoryUseStatistic"/>14.5.7. Memory use statistic (graph and CSV)</h3></div></div></div><p>To see how much memory is used, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;MEMORY_USE&lt;/problemStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11309"/><p class="title"><strong>Figure 14.7. Memory use statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/memoryUseStatistic.png" alt="Memory use statistic"/></div></div></div><br class="figure-break"/><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The memory use statistic has been seen to affect the solver noticeably.</p></div></div></div><div class="section" title="14.6. Statistic per single benchmark (graph and CSV)"><div class="titlepage"><div><div><h2 class="title"><a id="benchmarkReportStatisticPerSingleBenchmark"/>14.6. Statistic per single benchmark (graph and CSV)</h2></div></div></div><div class="section" title="14.6.1. Enable a single statistic"><div class="titlepage"><div><div><h3 class="title"><a id="enableASingleStatistic"/>14.6.1. Enable a single statistic</h3></div></div></div><p>A single statistic is a statics for 1 dataset for 1 solver configuration. Unlike a problem statistic, it
      does not aggregate over solver configurations.</p><p>The benchmarker supports outputting single statistics as graphs and CSV (comma separated values) files to
      the <code class="literal">benchmarkDirectory</code>. To configure one, add a <code class="literal">singleStatisticType</code>
      line:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  &lt;benchmarkDirectory&gt;local/data/nqueens/solved&lt;/benchmarkDirectory&gt;
  &lt;inheritedSolverBenchmark&gt;
    &lt;problemBenchmarks&gt;
      ...
      &lt;problemStatisticType&gt;...&lt;/problemStatisticType&gt;
      &lt;singleStatisticType&gt;PICKED_MOVE_TYPE_BEST_SCORE_DIFF&lt;/singleStatisticType&gt;
    &lt;/problemBenchmarks&gt;
    ...
  &lt;/inheritedSolverBenchmark&gt;
  ...
&lt;/plannerBenchmark&gt;</code></pre><p>Multiple <code class="literal">singleStatisticType</code> elements are allowed.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>These statistic per single benchmark can slow down the solver noticeably, which affects the benchmark
        results. That's why they are optional and not enabled by default.</p></div><p>The following types are supported:</p></div><div class="section" title="14.6.2. Constraint match total best score over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportConstraintMatchTotalBestScoreOverTimeStatistic"/>14.6.2. Constraint match total best score over time statistic (graph and CSV)</h3></div></div></div><p>To see which constraints are matched in the best score (and how much) over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;singleStatisticType&gt;CONSTRAINT_MATCH_TOTAL_BEST_SCORE&lt;/singleStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11353"/><p class="title"><strong>Figure 14.8. Constraint match total best score diff over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/constraintMatchTotalBestScoreStatistic.png" alt="Constraint match total best score diff over time statistic"/></div></div></div><br class="figure-break"/><p>Requires the score calculation to support <a class="link" href="#explainingTheScore" title="5.5. Explaining the score: using score calculation outside the Solver">constraint matches</a>.
      <a class="link" href="#droolsScoreCalculation" title="5.3.4. Drools score calculation">Drools score calculation</a> supports constraint matches automatically,
      but <a class="link" href="#incrementalJavaScoreCalculation" title="5.3.3. Incremental Java score calculation">incremental Java score calculation</a> requires requires
      more work.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The constraint match total statistics has been seen to affect the solver noticeably.</p></div></div><div class="section" title="14.6.3. Constraint match total step score over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportConstraintMatchTotalStepScoreOverTimeStatistic"/>14.6.3. Constraint match total step score over time statistic (graph and CSV)</h3></div></div></div><p>To see which constraints are matched in the step score (and how much) over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;singleStatisticType&gt;CONSTRAINT_MATCH_TOTAL_STEP_SCORE&lt;/singleStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11380"/><p class="title"><strong>Figure 14.9. Constraint match total step score diff over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/constraintMatchTotalStepScoreStatistic.png" alt="Constraint match total step score diff over time statistic"/></div></div></div><br class="figure-break"/><p>Requires the score calculation to support <a class="link" href="#explainingTheScore" title="5.5. Explaining the score: using score calculation outside the Solver">constraint matches</a>.
      <a class="link" href="#droolsScoreCalculation" title="5.3.4. Drools score calculation">Drools score calculation</a> supports constraint matches automatically,
      but <a class="link" href="#incrementalJavaScoreCalculation" title="5.3.3. Incremental Java score calculation">incremental Java score calculation</a> requires requires
      more work.</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>The constraint match total statistics has been seen to affect the solver noticeably.</p></div></div><div class="section" title="14.6.4. Picked move type best score diff over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportPickedMoveTypeBestScoreDiffOverTimeStatistic"/>14.6.4. Picked move type best score diff over time statistic (graph and CSV)</h3></div></div></div><p>To see which move types improve the best score (and how much) over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;singleStatisticType&gt;PICKED_MOVE_TYPE_BEST_SCORE_DIFF&lt;/singleStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11407"/><p class="title"><strong>Figure 14.10. Picked move type best score diff over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/pickedMoveTypeBestScoreDiffStatistic.png" alt="Picked move type best score diff over time statistic"/></div></div></div><br class="figure-break"/></div><div class="section" title="14.6.5. Picked move type step score diff over time statistic (graph and CSV)"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportPickedMoveTypeStepScoreDiffOverTimeStatistic"/>14.6.5. Picked move type step score diff over time statistic (graph and CSV)</h3></div></div></div><p>To see how much each winning step affects the step score over time, add:</p><pre><code class="language-xml">    &lt;problemBenchmarks&gt;
      ...
      &lt;singleStatisticType&gt;PICKED_MOVE_TYPE_STEP_SCORE_DIFF&lt;/singleStatisticType&gt;
    &lt;/problemBenchmarks&gt;</code></pre><div class="figure"><a id="d0e11420"/><p class="title"><strong>Figure 14.11. Picked move type step score diff over time statistic</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/pickedMoveTypeStepScoreDiffStatistic.png" alt="Picked move type step score diff over time statistic"/></div></div></div><br class="figure-break"/></div></div><div class="section" title="14.7. Advanced benchmarking"><div class="titlepage"><div><div><h2 class="title"><a id="advancedBenchmarking"/>14.7. Advanced benchmarking</h2></div></div></div><div class="section" title="14.7.1. Benchmarking performance tricks"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkingPerformanceTricks"/>14.7.1. Benchmarking performance tricks</h3></div></div></div><div class="section" title="14.7.1.1. Parallel benchmarking on multiple threads"><div class="titlepage"><div><div><h4 class="title"><a id="parallelBenchmarkingOnMultipleThreads"/>14.7.1.1. Parallel benchmarking on multiple threads</h4></div></div></div><p>If you have multiple processors available on your computer, you can run multiple benchmarks in parallel on
        multiple threads to get your benchmarks results faster:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  ...
  &lt;parallelBenchmarkCount&gt;AUTO&lt;/parallelBenchmarkCount&gt;
  ...
&lt;/plannerBenchmark&gt;</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Running too many benchmarks in parallel will affect the results of benchmarks negatively. Leave some
          processors unused for garbage collection and other processes.</p><p>We tweak <code class="literal">parallelBenchmarkCount</code> <code class="literal">AUTO</code> to maximize the reliability
          and efficiency of the benchmark results.</p></div><p>The following <code class="literal">parallelBenchmarkCount</code>s are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">1</code> (default): Run all benchmarks sequentially.</p></li><li class="listitem"><p><code class="literal">AUTO</code>: Let Planner decide how many benchmarks to run in parallel. This formula is
            based on experience. It's recommended to prefer this over the other parallel enabling options.</p></li><li class="listitem"><p>Static number: The number of benchmarks to run in parallel.</p><pre><code class="language-xml">&lt;parallelBenchmarkCount&gt;2&lt;/parallelBenchmarkCount&gt;</code></pre></li><li class="listitem"><p>JavaScript formula: Formula for the number of benchmarks to run in parallel. It can use the variable
            <code class="literal">availableProcessorCount</code>. For example:</p><pre><code class="language-xml">&lt;parallelBenchmarkCount&gt;(availableProcessorCount / 2) + 1&lt;/parallelBenchmarkCount&gt;</code></pre></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>The <code class="literal">parallelBenchmarkCount</code> is always limited to the number of available processors.
          If it's higher, it will be automatically decreased.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>In the future, we will also support multi-JVM benchmarking. This feature is independent of <a class="link" href="https://issues.jboss.org/browse/PLANNER-76">multi-threaded solving</a> or multi-JVM
          solving.</p></div></div></div><div class="section" title="14.7.2. Template based benchmarking and matrix benchmarking"><div class="titlepage"><div><div><h3 class="title"><a id="templateBasedBenchmarking"/>14.7.2. Template based benchmarking and matrix benchmarking</h3></div></div></div><p>Matrix benchmarking is benchmarking a combination of value sets. For example: benchmark 4
      <code class="literal">entityTabuSize</code> values (<code class="literal">5</code>, <code class="literal">7</code>, <code class="literal">11</code> and
      <code class="literal">13</code>) combined with 3 <code class="literal">acceptedCountLimit</code> values (<code class="literal">500</code>,
      <code class="literal">1000</code> and <code class="literal">2000</code>), resulting in 12 solver configurations.</p><p>To reduce the verbosity of such a benchmark configuration, you can use a <a class="link" href="http://freemarker.org//">Freemarker</a> template for the benchmark configuration instead:</p><pre><code class="language-xml">&lt;plannerBenchmark&gt;
  ...

  &lt;inheritedSolverBenchmark&gt;
    ...
  &lt;/inheritedSolverBenchmark&gt;

&lt;#list [5, 7, 11, 13] as entityTabuSize&gt;
&lt;#list [500, 1000, 2000] as acceptedCountLimit&gt;
  &lt;solverBenchmark&gt;
    &lt;name&gt;entityTabuSize ${entityTabuSize} acceptedCountLimit ${acceptedCountLimit}&lt;/name&gt;
    &lt;solver&gt;
      &lt;localSearch&gt;
        &lt;unionMoveSelector&gt;
          &lt;changeMoveSelector/&gt;
          &lt;swapMoveSelector/&gt;
        &lt;/unionMoveSelector&gt;
        &lt;acceptor&gt;
          &lt;entityTabuSize&gt;${entityTabuSize}&lt;/entityTabuSize&gt;
        &lt;/acceptor&gt;
        &lt;forager&gt;
          &lt;acceptedCountLimit&gt;${acceptedCountLimit}&lt;/acceptedCountLimit&gt;
        &lt;/forager&gt;
      &lt;/localSearch&gt;
    &lt;/solver&gt;
  &lt;/solverBenchmark&gt;
&lt;/#list&gt;
&lt;/#list&gt;
&lt;/plannerBenchmark&gt;</code></pre><p>And build it with the class <code class="literal">PlannerBenchmarkFactory</code>:</p><pre><code class="language-java">        PlannerBenchmarkFactory plannerBenchmarkFactory = PlannerBenchmarkFactory.createFromFreemarkerXmlResource(
                "org/optaplanner/examples/cloudbalancing/benchmark/cloudBalancingBenchmarkConfigTemplate.xml.ftl");
        PlannerBenchmark plannerBenchmark = benchmarkFactory.buildPlannerBenchmark();</code></pre></div><div class="section" title="14.7.3. Benchmark report aggregation"><div class="titlepage"><div><div><h3 class="title"><a id="benchmarkReportAggregation"/>14.7.3. Benchmark report aggregation</h3></div></div></div><p>The <code class="literal">BenchmarkAggregator</code> takes 1 or more existing benchmarks and merges them into new
      benchmark report, without actually running the benchmarks again.</p><div class="mediaobject"><img src="images/Chapter-Benchmarking_and_tweaking/benchmarkAggregator.png"/></div><p>This is useful to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Report on the impact of code changes</strong></span>: Run the same benchmark
          configuration before and after the code changes, then aggregate a report.</p></li><li class="listitem"><p><span class="bold"><strong>Report on the impact of dependency upgrades</strong></span>: Run the same benchmark
          configuration before and after upgrading the dependency, then aggregate a report.</p></li><li class="listitem"><p><span class="bold"><strong>Condense a too verbose report</strong></span>: Select only the interesting solver
          benchmarks from the existing report. This especially useful on template reports to make the graphs
          readable.</p></li><li class="listitem"><p><span class="bold"><strong>Partially rerun a benchmark</strong></span>: Rerun part of an existing report (for
          example only the failed or invalid solvers), then recreate the original intended report with the new
          values.</p></li></ul></div><p>To use it, provide a <code class="literal">PlannerBenchmarkFactory</code> to the
      <code class="literal">BenchmarkAggregatorFrame</code> to display the GUI:</p><pre><code class="language-java">    public static void main(String[] args) {
        PlannerBenchmarkFactory plannerBenchmarkFactory = PlannerBenchmarkFactory.createFromXmlResource(
                "org/optaplanner/examples/nqueens/benchmark/nqueensBenchmarkConfig.xml");
        BenchmarkAggregatorFrame.createAndDisplay(plannerBenchmarkFactory);
    }</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Despite that it uses a benchmark configuration as input, it ignores all elements of that configuration,
        except for the elements <code class="literal">&lt;benchmarkDirectory&gt;</code> and
        <code class="literal">&lt;benchmarkReport&gt;</code>.</p></div><p>In the GUI, select the interesting benchmarks and click the button to generate the report.</p></div></div></div><div class="chapter" title="Chapter 15. Repeated planning"><div class="titlepage"><div><div><h2 class="title"><a id="repeatedPlanning"/>Chapter 15. Repeated planning</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#introductionToRepeatedPlanning">15.1. Introduction to repeated planning</a></span></dt><dt><span class="section"><a href="#backupPlanning">15.2. Backup planning</a></span></dt><dt><span class="section"><a href="#continuousPlanning">15.3. Continuous planning (windowed planning)</a></span></dt><dd><dl><dt><span class="section"><a href="#immovablePlanningEntities">15.3.1. Immovable planning entities</a></span></dt><dt><span class="section"><a href="#nonvolatileReplanning">15.3.2. Nonvolatile replanning (semi movable planning entities) </a></span></dt></dl></dd><dt><span class="section"><a href="#realTimePlanning">15.4. Real-time planning</a></span></dt><dd><dl><dt><span class="section"><a href="#problemFactChange">15.4.1. <code class="literal">ProblemFactChange</code></a></span></dt><dt><span class="section"><a href="#daemon">15.4.2. Daemon: <code class="literal">solve()</code> does not return</a></span></dt></dl></dd></dl></div><div class="section" title="15.1. Introduction to repeated planning"><div class="titlepage"><div><div><h2 class="title"><a id="introductionToRepeatedPlanning"/>15.1. Introduction to repeated planning</h2></div></div></div><p>The world constantly changes. The planning facts used to create a solution, might change before or during the
    execution of that solution. There are 3 types of situations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>Unforeseen fact changes</em></span>: For example: an employee assigned to a shift calls in sick,
        an airplane scheduled to take off has a technical delay, one of the machines or vehicles break down, ... Use
        <span class="bold"><strong>backup planning</strong></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>Unknown long term future facts</em></span>: For example: The hospital admissions for the next 2
        weeks are reliable, but those for week 3 and 4 are less reliable and for week 5 and beyond are not worth
        planning yet. Use <span class="bold"><strong>continuous planning</strong></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>Constantly changing planning facts</em></span>: Use <span class="bold"><strong>real-time
        planning</strong></span>.</p></li></ul></div><p>Waiting to start planning - to lower the risk of planning facts changing - usually isn't a good way to deal
    with that. More CPU time means a better planning solution. An incomplete plan is better than no plan.</p><p>Luckily, the optimization algorithms support planning a solution that's already (partially) planned, known as
    repeated planning.</p></div><div class="section" title="15.2. Backup planning"><div class="titlepage"><div><div><h2 class="title"><a id="backupPlanning"/>15.2. Backup planning</h2></div></div></div><p>Backup planning is the technique of adding extra score constraints to create space in the planning for when
    things go wrong. That creates a backup plan in the plan. For example: try to assign an employee as the spare
    employee (1 for every 10 shifts at the same time), keep 1 hospital bed open in each department, ...</p><p>Then, when things go wrong (one of the employees calls in sick), change the planning facts on the original
    solution (delete the sick employee leave his/her shifts unassigned) and just restart the planning, starting from
    that solution, which has a different score now. The construction heuristics will fill in the newly created gaps
    (probably with the spare employee) and the metaheuristics will even improve it further.</p></div><div class="section" title="15.3. Continuous planning (windowed planning)"><div class="titlepage"><div><div><h2 class="title"><a id="continuousPlanning"/>15.3. Continuous planning (windowed planning)</h2></div></div></div><p>Continuous planning is the technique of planning one or more upcoming planning windows at the same time and
    repeating that process monthly, weekly, daily or hourly. Because time is infinite, there are infinite future
    windows, so planning all future windows is impossible. Instead, plan only a fixed number of upcoming planning
    windows.</p><p>Past planning windows are immutable. The first upcoming planning window is considered stable (unlikely to
    change), while later upcoming planning windows are considered draft (likely to change during the next planning
    effort). Distant future planning windows are not planned at all.</p><p>Past planning windows have only <span class="emphasis"><em>immovable</em></span> planning entities: the planning entities can no
    longer be changed (they are unable to move), but some of them are still needed in the score calculation, as they
    might affect some of the score constraints that apply on the upcoming planning entities. For example: when an
    employee should not work more than 5 days in a row, he shouldn't work today and tomorrow if he worked the past 4
    days already.</p><p>Sometimes some planning entities are semi-immovable: they can be changed, but occur a certain score penalty if
    they differ from their original place. For example: avoid rescheduling hospital beds less than 2 days before the
    patient arrives (unless it's really worth it), avoid changing the airplane gate during the 2 hours before boarding
    (unless there is no alternative), ...</p><div class="mediaobject"><img src="images/Chapter-Repeated_planning/continuousPlanningPatientAdmissionSchedule.png"/></div><p>Notice the difference between the original planning of November 1th and the new planning of November 5th: some
    planning facts (F, H, I, J, K) changed, which results in unrelated planning entities (G) changing too.</p><div class="section" title="15.3.1. Immovable planning entities"><div class="titlepage"><div><div><h3 class="title"><a id="immovablePlanningEntities"/>15.3.1. Immovable planning entities</h3></div></div></div><p>To make some planning entities immovable, simply add an entity <code class="literal">SelectionFilter</code> that
      returns <code class="literal">true</code> if an entity is movable and <code class="literal">false</code> if it is immovable.</p><pre><code class="language-java">public class MovableShiftAssignmentSelectionFilter implements SelectionFilter&lt;ShiftAssignment&gt; {

    public boolean accept(ScoreDirector scoreDirector, ShiftAssignment shiftAssignment) {
        ShiftDate shiftDate = shiftAssignment.getShift().getShiftDate();
        NurseRoster nurseRoster = (NurseRoster) scoreDirector.getWorkingSolution();
        return nurseRoster.getNurseRosterInfo().isInPlanningWindow(shiftDate);
    }

}</code></pre><p>And configure it like this:</p><pre><code class="language-java">@PlanningEntity(movableEntitySelectionFilter = MovableShiftAssignmentSelectionFilter.class)
public class ShiftAssignment {
    ...
}</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Custom <code class="literal">MoveListFactory</code> and <code class="literal">MoveIteratorFactory</code> implementations must
        make sure that they don't move immovable entities.</p></div></div><div class="section" title="15.3.2. Nonvolatile replanning (semi movable planning entities)"><div class="titlepage"><div><div><h3 class="title"><a id="nonvolatileReplanning"/>15.3.2. Nonvolatile replanning (semi movable planning entities) </h3></div></div></div><p>Replanning an existing plan can be very disruptive on the plan. If the plan affects humans (such as
      employees, drivers, ...), very disruptive changes are often undesirable. In such cases, nonvolatile replanning
      helps: the gain of changing a plan must be higher than the disruption it causes.</p><div class="mediaobject"><img src="images/Chapter-Repeated_planning/nonvolatileReplanning.png"/></div><p>For example, in the Machine Reassignment example, the entity has both the planning variable
      <code class="literal">machine</code> and its original value <code class="literal">originalMachine</code>:</p><pre><code class="language-java">@PlanningEntity(...)
public class ProcessAssignment {

    private MrProcess process;
    private Machine originalMachine;
    private Machine machine;

    public Machine getOriginalMachine() {...}

    @PlanningVariable(...)
    public Machine getMachine() {...}

    public boolean isMoved() {
        return originalMachine != null &amp;&amp; originalMachine != machine;
    }

    ...
}</code></pre><p>During planning, the planning variable <code class="literal">machine</code> changes. By comparing it with the
      originalMachine, a change in plan can be penalized:</p><pre><code class="no-highlight">rule "processMoved"
    when
        ProcessAssignment(moved == true)
    then
        scoreHolder.addSoftConstraintMatch(kcontext, -1000);
end</code></pre><p>The soft penalty of <code class="literal">-1000</code> means that a better solution is only accepted if it improves
      the soft score for at least <code class="literal">1000</code> points per variable changed (or if it improves the hard
      score).</p></div></div><div class="section" title="15.4. Real-time planning"><div class="titlepage"><div><div><h2 class="title"><a id="realTimePlanning"/>15.4. Real-time planning</h2></div></div></div><p>To do real-time planning, first combine <a class="link" href="#backupPlanning" title="15.2. Backup planning">backup planning</a> and <a class="link" href="#continuousPlanning" title="15.3. Continuous planning (windowed planning)">continuous planning</a> with short planning windows to lower the burden of real-time
    planning. As time passes, the problem itself changes:</p><div class="mediaobject"><img src="images/Chapter-Repeated_planning/realTimePlanningVehicleRouting.png"/></div><p>In the example above, 3 customers are added at different times (<code class="literal">07:56</code>,
    <code class="literal">08:02</code> and <code class="literal">08:45</code>), after the original customer set finished solving at
    <code class="literal">07:55</code> and in some cases after the vehicles already left. Planner can handle such scenario's
    with <code class="literal">ProblemFactChange</code> (in combination with <a class="link" href="#immovablePlanningEntities" title="15.3.1. Immovable planning entities">immovable
    planning entities</a>).</p><div class="section" title="15.4.1. ProblemFactChange"><div class="titlepage"><div><div><h3 class="title"><a id="problemFactChange"/>15.4.1. <code class="literal">ProblemFactChange</code></h3></div></div></div><p>While the <code class="literal">Solver</code> is solving, an outside event might want to change one of the problem
      facts, for example an airplane is delayed and needs the runway at a later time. Do not change the problem fact
      instances used by the <code class="literal">Solver</code> while it is solving (from another thread or even in the same
      thread), as that will corrupt it. Instead, add a <code class="literal">ProblemFactChange</code> to the
      <code class="literal">Solver</code> which it will execute in the solver thread as soon as possible.</p><pre><code class="language-java">public interface Solver {

    ...

    boolean addProblemFactChange(ProblemFactChange problemFactChange);

    boolean isEveryProblemFactChangeProcessed();

    ...

}</code></pre><pre><code class="language-java">public interface ProblemFactChange {

    void doChange(ScoreDirector scoreDirector);

}</code></pre><p>Here's an example:</p><pre><code class="language-java">    public void deleteComputer(final CloudComputer computer) {
        solver.addProblemFactChange(new ProblemFactChange() {
            public void doChange(ScoreDirector scoreDirector) {
                CloudBalance cloudBalance = (CloudBalance) scoreDirector.getWorkingSolution();
                // First remove the planning fact from all planning entities that use it
                for (CloudProcess process : cloudBalance.getProcessList()) {
                    if (ObjectUtils.equals(process.getComputer(), computer)) {
                        scoreDirector.beforeVariableChanged(process, "computer");
                        process.setComputer(null);
                        scoreDirector.afterVariableChanged(process, "computer");
                    }
                }
                // A SolutionCloner does not clone problem fact lists (such as computerList)
                // Shallow clone the computerList so only workingSolution is affected, not bestSolution or guiSolution
                cloudBalance.setComputerList(new ArrayList&lt;CloudComputer&gt;(cloudBalance.getComputerList()));
                // Next remove it the planning fact itself
                for (Iterator&lt;CloudComputer&gt; it = cloudBalance.getComputerList().iterator(); it.hasNext(); ) {
                    CloudComputer workingComputer = it.next();
                    if (ObjectUtils.equals(workingComputer, computer)) {
                        scoreDirector.beforeProblemFactRemoved(workingComputer);
                        it.remove(); // remove from list
                        scoreDirector.beforeProblemFactRemoved(workingComputer);
                        break;
                    }
                }
            }
        });
    }</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Any change on the problem facts or planning entities in a <code class="literal">ProblemFactChange</code> must be
        told to the <code class="literal">ScoreDirector</code>.</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>To write a <code class="literal">ProblemFactChange</code> correctly, it's important to understand the behaviour of
        <a class="link" href="#cloningASolution" title="4.3.7.6. Cloning a Solution">a planning clone</a>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Any change in a <code class="literal">ProblemFactChange</code> must be done on the <code class="literal">Solution</code>
            instance of <code class="literal">scoreDirector.getWorkingSolution()</code>. The <code class="literal">workingSolution</code> is
            <a class="link" href="#cloningASolution" title="4.3.7.6. Cloning a Solution">a planning clone</a> of the
            <code class="literal">BestSolutionChangedEvent</code>'s <code class="literal">bestSolution</code>. So the
            <code class="literal">workingSolution</code> in the <code class="literal">Solver</code> is never the same instance as the
            <code class="literal">Solution</code> in the rest of your application.</p></li><li class="listitem"><p>A planning clone also clones the planning entities and planning entity collections. So any change on
            the planning entities must happen on the instances hold by
            <code class="literal">scoreDirector.getWorkingSolution()</code>.</p></li><li class="listitem"><p>A planning clone does not clone the problem facts, nor the problem fact collections.
            <span class="emphasis"><em>Therefore the <code class="literal">workingSolution</code> and the <code class="literal">bestSolution</code> share the
            same problem fact instances and the same problem fact list instances.</em></span></p><p>Any problem fact or problem fact list changed by a <code class="literal">ProblemFactChange</code> must be
            problem cloned first (which can imply rerouting references in other problem facts and planning entities).
            Otherwise, if the <code class="literal">workingSolution</code> and <code class="literal">bestSolution</code> are used in
            different threads (for example a solver thread and a GUI event thread), a race condition can occur.</p></li></ul></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Many types of changes can leave a planning entity uninitialized, resulting in a partially initialized
        solution. That's fine, as long as the first solver phase can handle it. All construction heuristics solver
        phases can handle that, so it's recommended to configure such a solver phase as the first phase.</p></div><p>In essence, the <code class="literal">Solver</code> stops, runs the <code class="literal">ProblemFactChange</code> and <span class="bold"><strong>restarts</strong></span>. Each solver phase runs again. This implies the construction heuristic runs again,
      but because little or no planning variables are uninitialized (unless you have a <a class="link" href="#nullablePlanningVariable" title="4.3.4.2. Nullable planning variable">nullable planning variable</a>), this doesn't take long.</p><p>Each configured phase <code class="literal">Termination</code> resets, but each solver Termination (including
      <code class="literal">terminateEarly</code>) does not reset. Normally however, you won't configure any
      <code class="literal">Termination</code>, just call <code class="literal">Solver.terminateEarly()</code> when the results are needed.
      Alternatively, use the daemon mode in combination with <code class="literal"><a class="link" href="#SolverEventListener" title="6.9. SolverEventListener">BestSolutionChangedEvent</a></code> as described below.</p></div><div class="section" title="15.4.2. Daemon: solve() does not return"><div class="titlepage"><div><div><h3 class="title"><a id="daemon"/>15.4.2. Daemon: <code class="literal">solve()</code> does not return</h3></div></div></div><p>In real-time planning, it's often useful to have a solver thread wait when it runs out of work, and
      immediately solve a problem once problem fact changes are added. Putting the Solver in daemon mode has these
      effects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If the <code class="literal">Solver</code>'s <code class="literal">Termination</code> terminates, it does not return from
          <code class="literal">solve()</code> but waits instead (freeing up CPU).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Except for terminateEarly(), which does make it return from <code class="literal">solve()</code>, freeing up
              system resources (and allowing the application to shutdown gracefully).</p></li><li class="listitem"><p>If a <code class="literal">Solver</code> starts with an empty planning entity collection, it goes to the
              waiting state immediately.</p></li></ul></div></li><li class="listitem"><p>If a <code class="literal">ProblemFactChange</code> is added, it's processed and the <code class="literal">Solver</code>
          runs again.</p></li></ul></div><p>To configure the daemon mode:</p><pre><code class="language-xml">&lt;solver&gt;
  &lt;daemon&gt;true&lt;/daemon&gt;
  ...
&lt;/solver&gt;</code></pre><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2><p>Don't forget to call <code class="literal">Solver.terminateEarly()</code> when your application needs to shutdown to
        avoid killing the solver thread unnaturally.</p></div><p>Subscribe to the <code class="literal"><a class="link" href="#SolverEventListener" title="6.9. SolverEventListener">BestSolutionChangedEvent</a></code> to
      process new best solutions found by the solver thread. A <code class="literal">BestSolutionChangedEvent</code> doesn't
      guarantee that every <code class="literal">ProblemFactChange</code> has been processed already, nor that the solution is
      initialized and feasible. To ignore <code class="literal">BestSolutionChangedEvent</code>s with such invalid solutions, do
      this:</p><pre><code class="language-java">    public void bestSolutionChanged(BestSolutionChangedEvent&lt;CloudBalance&gt; event) {
        // Ignore invalid solutions
        if (event.isEveryProblemFactChangeProcessed()
                &amp;&amp; event.isNewBestSolutionInitialized()
                &amp;&amp; event.getNewBestSolution().getScore().isFeasible()) {
            ...
        }
    }</code></pre></div></div></div><div class="chapter" title="Chapter 16. Integration"><div class="titlepage"><div><div><h2 class="title"><a id="integration"/>Chapter 16. Integration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#integrationOverview">16.1. Overview</a></span></dt><dt><span class="section"><a href="#integrationWithPersistentStorage">16.2. Persistent storage</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationWithJpaAndHibernate">16.2.1. Database: JPA and Hibernate</a></span></dt><dt><span class="section"><a href="#integrationWithXStream">16.2.2. XML: XStream</a></span></dt><dt><span class="section"><a href="#integrationWithJaxb">16.2.3. XML: JAXB</a></span></dt></dl></dd><dt><span class="section"><a href="#integrationWithSoaAndEsb">16.3. SOA and ESB</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationWithCamel">16.3.1. Camel and Karaf</a></span></dt></dl></dd><dt><span class="section"><a href="#integrationWithOtherEnvironments">16.4. Other environments</a></span></dt><dd><dl><dt><span class="section"><a href="#integrationWithJBossModules">16.4.1. JBoss modules, WildFly and JBoss EAP</a></span></dt><dt><span class="section"><a href="#integrationWithOSGi">16.4.2. OSGi</a></span></dt><dt><span class="section"><a href="#integrationWithAndroid">16.4.3. Android</a></span></dt></dl></dd><dt><span class="section"><a href="#integrationWithHumanPlanners">16.5. Integration with human planners (politics)</a></span></dt></dl></div><div class="section" title="16.1. Overview"><div class="titlepage"><div><div><h2 class="title"><a id="integrationOverview"/>16.1. Overview</h2></div></div></div><p>Planner's input and output data (the planning problem and the best solution) are plain old JavaBeans
    (POJO's), so integration with other Java technologies is straightforward. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>To read a planning problem from the database (and store the best solution in it), annotate the domain
        POJO's with JPA annotations.</p></li><li class="listitem"><p>To read a planning problem from an XML file (and store the best solution in it), annotate the domain
        POJO's with XStream or JAXB annotations.</p></li><li class="listitem"><p>To expose the Solver as a REST Service that reads the planning problem and responds with the best
        solution, annotate the domain POJO's with XStream or JAXB annotations and hook the <code class="literal">Solver</code> in
        Camel or RESTEasy.</p></li></ul></div><div class="mediaobject"><img src="images/Chapter-Integration/integrationOverview.png"/></div></div><div class="section" title="16.2. Persistent storage"><div class="titlepage"><div><div><h2 class="title"><a id="integrationWithPersistentStorage"/>16.2. Persistent storage</h2></div></div></div><div class="section" title="16.2.1. Database: JPA and Hibernate"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithJpaAndHibernate"/>16.2.1. Database: JPA and Hibernate</h3></div></div></div><p>Enrich the domain POJO's (solution, entities and problem facts) with JPA annotations to store them in a
      database.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Do not confuse JPA's <code class="literal">@Entity</code> annotation with Planner's
        <code class="literal">@PlanningEntity</code> annotation. They can appear both on the same class.</p></div></div><div class="section" title="16.2.2. XML: XStream"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithXStream"/>16.2.2. XML: XStream</h3></div></div></div><p>Enrich the domain POJO's (solution, entities and problem facts) with XStream annotations to serialize them
      to/from XML.</p></div><div class="section" title="16.2.3. XML: JAXB"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithJaxb"/>16.2.3. XML: JAXB</h3></div></div></div><p>Enrich the domain POJO's (solution, entities and problem facts) with JAXB annotations to serialize them
      to/from XML.</p></div></div><div class="section" title="16.3. SOA and ESB"><div class="titlepage"><div><div><h2 class="title"><a id="integrationWithSoaAndEsb"/>16.3. SOA and ESB</h2></div></div></div><div class="section" title="16.3.1. Camel and Karaf"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithCamel"/>16.3.1. Camel and Karaf</h3></div></div></div><p><a class="link" href="http://camel.apache.org/">Camel</a> is an enterprise integration framework which
      includes support for Planner (starting from Camel 2.13). It can expose a use case as a REST service, a SOAP
      service, a JMS service, ...</p><p><a class="link" href="http://camel.apache.org/optaplanner.html">Read the documentation for the camel-optaplanner
      component.</a> That component works in Karaf too.</p></div></div><div class="section" title="16.4. Other environments"><div class="titlepage"><div><div><h2 class="title"><a id="integrationWithOtherEnvironments"/>16.4. Other environments</h2></div></div></div><div class="section" title="16.4.1. JBoss modules, WildFly and JBoss EAP"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithJBossModules"/>16.4.1. JBoss modules, WildFly and JBoss EAP</h3></div></div></div><p>To deploy an Planner web application on WildFly, simply include the optaplanner dependency jars in the
      <code class="literal">war</code> file's <code class="literal">WEB-INF/lib</code> directory (just like any other dependency) as shown
      in the <code class="literal">optaplanner-webexamples-*.war</code>. However, in this approach the war file can easily grow to
      several MB in size, which is fine for a one-time deployment, but too heavyweight for frequent redeployments
      (especially over a slow network connection).</p><p>The remedy is to use deliver the optaplanner jars in a JBoss module to WildFly and create a skinny war.
      Let's create an module called <span class="emphasis"><em>org.optaplanner</em></span>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Navigate to the directory <code class="literal">${WILDFLY_HOME}/modules/system/layers/base/</code>.
          This directory contains the JBoss modules of WildFly. Create directory structure
          <code class="literal">org/optaplanner/main</code> for our new module.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Copy <code class="literal">optaplanner-core-${version}.jar</code> and all its direct and transitive dependency
              jars into that new directory. Use "mvn dependency:tree" on each optaplanner artifact to discover all
              dependencies.</p></li><li class="listitem"><p>Create the file <code class="literal">module.xml</code> in that new directory. Give it this content:</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.3" name="org.optaplanner"&gt;
  &lt;resources&gt;
    ...
    &lt;resource-root path="kie-api-${version}.jar"/&gt;
    ...
    &lt;resource-root path="optaplanner-core-${version}.jar"/&gt;
    ...
    &lt;resource-root path="."/&gt; 
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javaee.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;</code></pre></li></ol></div></li><li class="listitem"><p>Navigate to the deployed <code class="literal">war</code> file.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Remove <code class="literal">optaplanner-core-${version}.jar</code> and all its direct and transitive
              dependency jars from the <code class="literal">WEB-INF/lib</code> directory in the <code class="literal">war</code>
              file.</p></li><li class="listitem"><p>Create the file <code class="literal">jboss-deployment-structure.xml</code> in the
              <code class="literal">WEB-INF/lib</code> directory. Give it this content:</p><pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;jboss-deployment-structure&gt;
   &lt;deployment&gt;
      &lt;dependencies&gt;
         &lt;module name="org.optaplanner" export="true"/&gt;
      &lt;/dependencies&gt;
   &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</code></pre></li></ol></div></li></ol></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Important</h2><p>Because of WildFly's class loading, the method
        <code class="literal">SolverFactory.createFromXmlResource()</code> might not find the solver configuration and throw an
        <code class="literal">IllegalArgumentException</code>. Instead use:</p><pre><code class="language-java">        SolverFactory solverFactory = SolverFactory.createFromXmlInputStream(
                getClass().getClassLoader().getResourceAsStream(
                        "org/optaplanner/examples/nqueens/solver/nqueensSolverConfig.xml"));</code></pre></div></div><div class="section" title="16.4.2. OSGi"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithOSGi"/>16.4.2. OSGi</h3></div></div></div><p>The <code class="literal">optaplanner-core</code> jar includes OSGi metadata to function properly in an OSGi
      environment too.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2><p>Planner does <span class="emphasis"><em>not</em></span> require OSGi. It works perfectly fine in a normal Java
        environment too.</p></div></div><div class="section" title="16.4.3. Android"><div class="titlepage"><div><div><h3 class="title"><a id="integrationWithAndroid"/>16.4.3. Android</h3></div></div></div><p>Planner does not work out-of-the-box on Android yet, because it is not a complete JVM. For more
      information and workarounds, <a class="link" href="https://issues.jboss.org/browse/PLANNER-146">see this
      issue</a>.</p></div></div><div class="section" title="16.5. Integration with human planners (politics)"><div class="titlepage"><div><div><h2 class="title"><a id="integrationWithHumanPlanners"/>16.5. Integration with human planners (politics)</h2></div></div></div><p>A good Planner implementation beats any good human planner for non-trivial datasets. Many human planners
    fail to accept this, often because they feel threatened by an automated system.</p><p>But despite that, Planner can benefit from a human planner as supervisor:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>The human planner defines and validates the score function.</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Some examples expose a <code class="literal">*Parametrization</code> object, which defines the weight for each
            score constraint. The human planner can then tweak those weights at runtime.</p></li><li class="listitem"><p>When the business changes, the score function often needs to change too. The human planner can notify
            the developers to add, change or remove score constraints.</p></li></ul></div></li><li class="listitem"><p><span class="bold"><strong>The human planner is always in control of Planner.</strong></span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>As shown in the course scheduling example, the human planner can lock 1 or more planning variables to
            a specific planning value and make those immovable. Because they are <a class="link" href="#immovablePlanningEntities" title="15.3.1. Immovable planning entities">immovable</a>, Planner does not change them: it optimizes the
            planning around the enforcements made by the human. If the human planner locks all planning variables,
            he/she sidelines Planner completely.</p></li><li class="listitem"><p>In a prototype implementation, the human planner might use this occasionally. But as the
            implementation matures, it must become obsolete. But do keep the feature alive: as a reassurance for the
            humans. Or in case that one day the business changes dramatically before the score constraints can be
            adjusted.</p></li></ul></div></li></ul></div><p>Therefore, it's often a good idea to involve the human planner in your project.</p></div></div><div class="chapter" title="Chapter 17. Development"><div class="titlepage"><div><div><h2 class="title"><a id="development"/>Chapter 17. Development</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#methodologyOverview">17.1. Methodology overview</a></span></dt></dl></div><div class="section" title="17.1. Methodology overview"><div class="titlepage"><div><div><h2 class="title"><a id="methodologyOverview"/>17.1. Methodology overview</h2></div></div></div><p>The diagram below explains the overall structure of the OptaPlanner source code:</p><div class="mediaobject"><img src="images/Chapter-Development/methodologyOverview.png"/></div><p>The development philosophy includes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="bold"><strong>Reuse</strong></span>: The examples are reused as integration tests, stress tests and
        demo's. The documentation images are reused as slides.</p></li><li class="listitem"><p><span class="bold"><strong>Consistent terminology</strong></span>: Each example has a class <code class="literal">App</code>
        (executable class), <code class="literal">Dao</code> (Data Access Object) and <code class="literal">Panel</code> (swing UI).</p></li><li class="listitem"><p><span class="bold"><strong>Consistent structure</strong></span>: Each example has the same packages:
        <code class="literal">domain</code>, <code class="literal">persistence</code>, <code class="literal">app</code>, <code class="literal">solver</code> and
        <code class="literal">swingui</code>.</p></li><li class="listitem"><p><span class="bold"><strong>Real world usefulness</strong></span>: Every feature is used in an example. Most
        examples are real world use cases with real world constraints, often with real world data.</p></li><li class="listitem"><p><span class="bold"><strong>Automated testing</strong></span>: There are unit tests, integration tests and stress
        tests. The test coverage is high.</p></li><li class="listitem"><p><span class="bold"><strong>Fail fast with an understandable error message</strong></span>: Invalid states are
        checked as early as possible.</p></li></ul></div></div></div></div><script type="text/javascript" src="highlight.js/highlight.pack.js"> </script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-39485370-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></body></html>